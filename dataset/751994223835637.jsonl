{"instance_id": "751994223835637", "repo": "bids-standard/bids-specification", "base_commit": "f2cea0f43444b55c9885a9717b25272b27790959", "problem_statement": "[SCHEMA] Refactor channel types:\\n- We have lists of **coordinate systems** for different modalities\\r\\n- For example: MEG, EEG\\r\\n- Coordinate systems from EEG may also be used in MEG\\r\\n- This is nicely expressed in the schema, see the `$ref` items: https://github.com/bids-standard/bids-specification/blob/24dbe58010d96c0ce4d4c775230cef94605c6068/src/schema/objects/metadata.yaml#L60-L72\\r\\n\\r\\n- The situation is similar for channel types: we have types defined in different modalities (search for `type__ieeg_channels`, `type__eeg_channels`, `type__meg_channels`)\\r\\n- For example types like \"EEG\", \"RESP\", or \"PUPIL\" -- these are the same, regardless for which modality they are used (that is, specifying PUPIL in an EEG dataset is the same as PUPIL in an MEG dataset)\\r\\n- Currently these are organized as such: https://github.com/bids-standard/bids-specification/blob/24dbe58010d96c0ce4d4c775230cef94605c6068/src/schema/objects/columns.yaml#L471-L509\\r\\n- Meaning we have lots of duplication\\r\\n\\r\\nShould we just have a single `type__channels` metadata entry? that is shared across the spec?\\r\\n\\r\\nOr should we keep them modality specific in \"overarching variables\", but then have a `type__channels` defined as\\r\\n\\r\\n```yaml\\r\\ntype__channels:\\r\\n  name: ....\\r\\n  description: ...\\r\\n  anyOf:\\r\\n  - $ref: _type__meg_channels\\r\\n  - $ref: _type__eeg_channels\\r\\n  - $ref: _type__ieeg_channels\\r\\n  - $ref: ...\\r\\n```\\r\\n\\nSupport full object definitions for valid values in schema:\\nCurrently, valid values (i.e., `enum`s) for objects in the schema are written as lists. However, in some cases, we also want to have each value defined, and perhaps even summarized in a separate table. As an example, take the [channels file for MEG data](https://bids-specification.readthedocs.io/en/latest/04-modality-specific-files/02-magnetoencephalography.html#channels-description-_channelstsv). Each of the valid values for the `type` column has a description, which is currently rendered  with a hardcoded table, but which could be incorporated into the schema directly.", "FAIL_TO_PASS": ["tools/schemacode/bidsschematools/tests/test_schema.py::test_dereferencing"], "PASS_TO_PASS": ["tools/schemacode/bidsschematools/tests/test_expressions.py::test_selectors", "tools/schemacode/bidsschematools/tests/test_render_text.py::test_make_glossary", "tools/schemacode/bidsschematools/tests/test_expressions.py::test_expected_failures[lhs", "tools/schemacode/bidsschematools/tests/test_render_tables.py::test_make_suffix_table", "tools/schemacode/bidsschematools/tests/test_validator.py::test_error_datasets[invalid_asl003]", "tools/schemacode/bidsschematools/tests/test_validator.py::test_error_datasets[invalid_pet001]", "tools/schemacode/bidsschematools/tests/test_validator.py::test_bids_datasets[qmri_tb1tfl]", "tools/schemacode/bidsschematools/tests/test_validator.py::test_bids_datasets[hcp_example_bids]", "tools/schemacode/bidsschematools/tests/test_render_utils.py::test_combine_extensions", "tools/schemacode/bidsschematools/tests/test_validator.py::test_bids_datasets[micr_SEMzarr]", "tools/schemacode/bidsschematools/tests/test_render_tables.py::test_make_entity_table", "tools/schemacode/bidsschematools/tests/test_rules.py::test_regexify_all", "tools/schemacode/bidsschematools/tests/test_validator.py::test_write_report", "tools/schemacode/bidsschematools/tests/test_expressions.py::test_expression_associations[!", "tools/schemacode/bidsschematools/tests/test_render_text.py::test_define_allowed_top_directories", "tools/schemacode/bidsschematools/tests/test_render_text.py::test_make_entity_definitions", "tools/schemacode/bidsschematools/tests/test_expressions.py::test_expression_associations[a.b.c[0][1][2].d(3,", "tools/schemacode/bidsschematools/tests/test_render_text.py::test_append_filename_template_legend", "tools/schemacode/bidsschematools/tests/test_schema.py::test__get_bids_version", "tools/schemacode/bidsschematools/tests/test_schema.py::test_formats", "tools/schemacode/bidsschematools/tests/test_render_text.py::test_render_text_errors", "tools/schemacode/bidsschematools/data/tests/test_rules.py::test_entity_order", "tools/schemacode/bidsschematools/tests/test_rules.py::test_path_rule", "tools/schemacode/bidsschematools/tests/test_render_utils.py::test_resolve_metadata_type", "tools/schemacode/bidsschematools/tests/test_render_text.py::test_render_text", "tools/schemacode/bidsschematools/tests/test_render_text.py::test_define_common_principles", "tools/schemacode/bidsschematools/tests/test_validator.py::test_inheritance_examples", "tools/schemacode/bidsschematools/tests/test_expressions.py::test_schema_expressions", "tools/schemacode/bidsschematools/tests/test_rules.py::test_split_inheritance_rules", "tools/schemacode/bidsschematools/tests/test_validator.py::test_gitdir", "tools/schemacode/bidsschematools/tests/test_render_tables.py::test_make_metadata_table", "tools/schemacode/bidsschematools/tests/test_rules.py::test_entity_rule", "tools/schemacode/bidsschematools/tests/test_validator.py::test_bids_datasets[qmri_vfa]", "tools/schemacode/bidsschematools/tests/test_render_tables.py::test_make_columns_table", "tools/schemacode/bidsschematools/tests/test_validator.py::test_bids_datasets[ds000248]", "tools/schemacode/bidsschematools/tests/test_expressions.py::test_expression_associations[a", "tools/schemacode/bidsschematools/tests/test_validator.py::test_bids_datasets[micr_SPIM]", "tools/schemacode/bidsschematools/tests/test_validator.py::test_select_schema_path", "tools/schemacode/bidsschematools/tests/test_expressions.py::test_expression_associations[a*x**2", "tools/schemacode/bidsschematools/tests/test_validator.py::test_broken_json_dataset", "tools/schemacode/bidsschematools/tests/test_expressions.py::test_checks", "tools/schemacode/bidsschematools/tests/test_validator.py::test_bids_schema_versioncheck", "tools/schemacode/bidsschematools/tests/test_expressions.py::test_expected_failures[assignment", "tools/schemacode/bidsschematools/data/tests/test_rules.py::test_rule_objects", "tools/schemacode/bidsschematools/tests/test_validator.py::test_accept_non_bids_dir", "tools/schemacode/bidsschematools/tests/test_expressions.py::test_expression_associations[x.y", "tools/schemacode/bidsschematools/tests/test_rules.py::test_stem_rule", "tools/schemacode/bidsschematools/tests/test_render_tables.py::test_make_sidecar_table", "tools/schemacode/bidsschematools/tests/test_expressions.py::test_expected_failures[func(x,", "tools/schemacode/bidsschematools/tests/test_schema.py::test_load_schema", "tools/schemacode/bidsschematools/tests/test_validator.py::test_bids_datasets[eeg_cbm]", "tools/schemacode/bidsschematools/tests/test_validator.py::test_bids_datasets[pet003]", "tools/schemacode/bidsschematools/tests/test_validator.py::test_bids_datasets[asl003]", "tools/schemacode/bidsschematools/tests/test_expressions.py::test_expression_associations[nifti_header.pixdim[4]", "tools/schemacode/bidsschematools/tests/test_schema.py::test_object_definitions", "tools/schemacode/bidsschematools/tests/test_validator.py::test_validate_bids", "tools/schemacode/bidsschematools/tests/test_render_text.py::test_make_filename_template", "tools/schemacode/bidsschematools/tests/test_validator.py::test_exclude_files"], "language": "python", "test_command": "source /saved/ENV || source /saved/*/ENV && pytest --no-header -rA --tb=no -p no:cacheprovider --continue-on-collection-errors", "test_output_parser": "python/parse_log_pytest_v3", "image_storage_uri": "vmvm-registry.fbinfra.net/repomate_image_activ_pytest/bids-standard_bids-specification:f2cea0f43444b55c9885a9717b25272b27790959", "patch": "", "test_patch": "[\"diff --git a/tools/schemacode/bidsschematools/tests/test_schema.py b/tools/schemacode/bidsschematools/tests/test_schema.py\\nindex 73041b0..b070336 100644\\n--- a/tools/schemacode/bidsschematools/tests/test_schema.py\\n+++ b/tools/schemacode/bidsschematools/tests/test_schema.py\\n@@ -309,3 +309,36 @@ def test_dereferencing():\\n             }\\n         },\\n     }\\n+\\n+    orig = {\\n+        \\\"objects\\\": {\\n+            \\\"enums\\\": {\\n+                \\\"left\\\": {\\\"value\\\": \\\"L\\\"},\\n+                \\\"right\\\": {\\\"value\\\": \\\"R\\\"},\\n+            },\\n+            \\\"entities.hemisphere\\\": {\\n+                \\\"name\\\": \\\"hemi\\\",\\n+                \\\"enum\\\": [\\n+                    {\\\"$ref\\\": \\\"objects.enums.left.value\\\"},\\n+                    {\\\"$ref\\\": \\\"objects.enums.right.value\\\"},\\n+                ],\\n+            },\\n+        },\\n+    }\\n+\\n+    sch = types.Namespace.build(orig)\\n+    dereffed = schema.dereference(sch)\\n+    assert dereffed == {\\n+        \\\"objects\\\": {\\n+            \\\"enums\\\": {\\n+                \\\"left\\\": {\\\"value\\\": \\\"L\\\"},\\n+                \\\"right\\\": {\\\"value\\\": \\\"R\\\"},\\n+            },\\n+            \\\"entities\\\": {\\n+                \\\"hemisphere\\\": {\\n+                    \\\"name\\\": \\\"hemi\\\",\\n+                    \\\"enum\\\": [\\\"L\\\", \\\"R\\\"],\\n+                },\\n+            },\\n+        },\\n+    }\"]", "hints_text": ""}
