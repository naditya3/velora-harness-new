{"instance_id": "1045968757677548", "repo": "serverlessworkflow/sdk-python", "base_commit": "08666eaf53c0d6e185ab3d74fac6b201714b0f7e", "problem_statement": "Manage defaults values:\\n**What would you like to be added**:\\r\\nWhen a workflow object is created the object should be populated with the default values indicated in the specification if no value is provided. \\r\\n\\r\\nFor example, the following operation \\r\\n\\r\\n```\\r\\n    workflow = Workflow(\\r\\n        id_=\"greeting\",\\r\\n        name=\"Greeting Workflow\",\\r\\n        description=\"Greet Someone\",\\r\\n        version='1.0',\\r\\n        specVersion='0.8',\\r\\n        start=\"Greet\",\\r\\n        states=[\\r\\n        ],\\r\\n        functions=[\\r\\n        ]\\r\\n    )\\r\\n\\r\\n```\\r\\nshould create a workflow object with default values like `expressionLang`\\r\\n\\r\\n```\\r\\n        self.assertEqual(\"jq\", self.workflow.expressionLang)\\r\\n\\r\\n```\\r\\n\\r\\nwhen the workflow is serialized to json or yaml, the default values should be removed if they have been populated by the sdk.\\r\\n\\r\\n**Why is this needed**:", "FAIL_TO_PASS": ["tests/serverlessworkflow/sdk/test_workflow.py::TestWorkflow::test_workflow_to_json", "tests/serverlessworkflow/sdk/test_workflow.py::TestWorkflow::test_workflow_to_yaml", "tests/serverlessworkflow/sdk/test_workflow.py::TestWorkflow::test_workflow_from_source_yaml"], "PASS_TO_PASS": ["tests/serverlessworkflow/sdk/test_action.py::TestAction::test_load_retryable_errors", "tests/serverlessworkflow/sdk/test_event_based_switch_state.py::TestEventBasedSwitchState::test_programmatically_create_object", "tests/serverlessworkflow/sdk/test_action.py::TestAction::test_dinamic_load", "tests/serverlessworkflow/sdk/test_hydrate.py::TestHydrateUnionOfType::test_hydrate", "tests/serverlessworkflow/sdk/test_workflow.py::TestWorkflow::test_programmatically_create_workflow", "tests/serverlessworkflow/sdk/test_hydrate.py::TestHydrateArrayOf::test_hydrate", "tests/serverlessworkflow/sdk/test_workflow_validator.py::TestWorkflowValidator::test_invalid_wf", "tests/serverlessworkflow/sdk/test_workflow.py::TestWorkflow::test_workflow_from_source_json", "tests/serverlessworkflow/sdk/test_workflow_validator.py::TestWorkflowValidator::test_validate_examples", "tests/serverlessworkflow/sdk/test_action.py::TestAction::test_load_function_ref", "tests/serverlessworkflow/sdk/test_workflow.py::TestWorkflow::test_instance_workflow_class"], "language": "python", "test_command": "source /saved/ENV || source /saved/*/ENV && pytest --no-header -rA --tb=no -p no:cacheprovider --continue-on-collection-errors", "test_output_parser": "python/parse_log_pytest_v3", "image_storage_uri": "vmvm-registry.fbinfra.net/repomate_image_activ_pytest/serverlessworkflow_sdk-python:08666eaf53c0d6e185ab3d74fac6b201714b0f7e", "patch": "", "test_patch": "[\"diff --git a/README.md b/README.md\\nindex e110090..fb48981 100644\\n--- a/README.md\\n+++ b/README.md\\n@@ -7,6 +7,10 @@ With the SDK you can:\\n * Parse workflow JSON and YAML definitions\\n * Validate workflow definitions\\n \\n+### Status\\n+\\n+Current sdk version conforms to the [Serverless Workflow specification v0.8](https://github.com/serverlessworkflow/specification/tree/0.8.x).\\n+\\n \\n ## Install dependencies and run test \\n \\n@@ -26,7 +30,7 @@ python setup.py pytest\\n \\n ```\\n  workflow = Workflow(\\n-        id_=\\\"greeting\\\",\\n+        id=\\\"greeting\\\",\\n         name=\\\"Greeting Workflow\\\",\\n         description=\\\"Greet Someone\\\",\\n         version='1.0',\\n\",\"diff --git a/tests/serverlessworkflow/sdk/test_action.py b/tests/serverlessworkflow/sdk/test_action.py\\nindex 41ceed0..db07340 100644\\n--- a/tests/serverlessworkflow/sdk/test_action.py\\n+++ b/tests/serverlessworkflow/sdk/test_action.py\\n@@ -14,25 +14,23 @@ def test_load_function_ref(self):\\n         self.assertTrue(action.functionRef.refName, \\\"refNameTest\\\")\\n         self.assertTrue(isinstance(action.retryableErrors, list))\\n \\n-\\n     def test_load_retryable_errors(self):\\n         action_data = {\\n             'retryableErrors': ['err1', 'err2']}\\n         action = Action(**action_data)\\n         self.assertTrue(isinstance(action.retryableErrors, list))\\n \\n-\\n     def test_dinamic_load(self):\\n         action_data = {\\n-                                        \\\"functionRef\\\": {\\n-                                            \\\"refName\\\": \\\"greetingFunction\\\",\\n-                                            \\\"arguments\\\": {\\n-                                                \\\"name\\\": \\\"${ .person.name }\\\"\\n-                                            }\\n-                                        },\\n-                                        \\\"actionDataFilter\\\": {\\n-                                            \\\"results\\\": \\\"${ .greeting }\\\"\\n-                                        }\\n-                                    }\\n+            \\\"functionRef\\\": {\\n+                \\\"refName\\\": \\\"greetingFunction\\\",\\n+                \\\"arguments\\\": {\\n+                    \\\"name\\\": \\\"${ .person.name }\\\"\\n+                }\\n+            },\\n+            \\\"actionDataFilter\\\": {\\n+                \\\"results\\\": \\\"${ .greeting }\\\"\\n+            }\\n+        }\\n         action = Action(**action_data)\\n         self.assertTrue(isinstance(action.actionDataFilter, ActionDataFilter))\\n\",\"diff --git a/tests/serverlessworkflow/sdk/test_hydrate.py b/tests/serverlessworkflow/sdk/test_hydrate.py\\nindex ae42abb..b541a58 100644\\n--- a/tests/serverlessworkflow/sdk/test_hydrate.py\\n+++ b/tests/serverlessworkflow/sdk/test_hydrate.py\\n@@ -1,6 +1,6 @@\\n import unittest\\n \\n-from serverlessworkflow.sdk.hydration import ArrayTypeOf, ComplexTypeOf, UnionTypeOf, SimpleTypeOf\\n+from serverlessworkflow.sdk.swf_base import ArrayTypeOf, ComplexTypeOf, UnionTypeOf, SimpleTypeOf\\n \\n \\n class AnyClass:\\n\",\"diff --git a/tests/serverlessworkflow/sdk/test_workflow.json b/tests/serverlessworkflow/sdk/test_workflow.json\\nindex f946930..0a83319 100644\\n--- a/tests/serverlessworkflow/sdk/test_workflow.json\\n+++ b/tests/serverlessworkflow/sdk/test_workflow.json\\n@@ -1,34 +1,34 @@\\n {\\n-    \\\"id\\\": \\\"greeting\\\",\\n-    \\\"name\\\": \\\"Greeting Workflow\\\",\\n-    \\\"version\\\": \\\"1.0\\\",\\n-    \\\"description\\\": \\\"Greet Someone\\\",\\n-    \\\"specVersion\\\": \\\"0.8\\\",\\n-    \\\"start\\\": \\\"Greet\\\",\\n-    \\\"states\\\": [\\n+  \\\"id\\\": \\\"greeting\\\",\\n+  \\\"name\\\": \\\"Greeting Workflow\\\",\\n+  \\\"version\\\": \\\"1.0\\\",\\n+  \\\"description\\\": \\\"Greet Someone\\\",\\n+  \\\"specVersion\\\": \\\"0.8\\\",\\n+  \\\"start\\\": \\\"Greet\\\",\\n+  \\\"states\\\": [\\n+    {\\n+      \\\"name\\\": \\\"Greet\\\",\\n+      \\\"type\\\": \\\"operation\\\",\\n+      \\\"actions\\\": [\\n         {\\n-            \\\"name\\\": \\\"Greet\\\",\\n-            \\\"type\\\": \\\"operation\\\",\\n-            \\\"actions\\\": [\\n-                {\\n-                    \\\"functionRef\\\": {\\n-                        \\\"refName\\\": \\\"greetingFunction\\\",\\n-                        \\\"arguments\\\": {\\n-                            \\\"name\\\": \\\"${ .person.name }\\\"\\n-                        }\\n-                    },\\n-                    \\\"actionDataFilter\\\": {\\n-                        \\\"results\\\": \\\"${ .greeting }\\\"\\n-                    }\\n-                }\\n-            ],\\n-            \\\"end\\\": true\\n+          \\\"functionRef\\\": {\\n+            \\\"refName\\\": \\\"greetingFunction\\\",\\n+            \\\"arguments\\\": {\\n+              \\\"name\\\": \\\"${ .person.name }\\\"\\n+            }\\n+          },\\n+          \\\"actionDataFilter\\\": {\\n+            \\\"results\\\": \\\"${ .greeting }\\\"\\n+          }\\n         }\\n-    ],\\n-    \\\"functions\\\": [\\n-        {\\n-            \\\"name\\\": \\\"greetingFunction\\\",\\n-            \\\"operation\\\": \\\"file://myapis/greetingapis.json#greeting\\\"\\n-        }\\n-    ]\\n+      ],\\n+      \\\"end\\\": true\\n+    }\\n+  ],\\n+  \\\"functions\\\": [\\n+    {\\n+      \\\"name\\\": \\\"greetingFunction\\\",\\n+      \\\"operation\\\": \\\"file://myapis/greetingapis.json#greeting\\\"\\n+    }\\n+  ]\\n }\\n\\\\ No newline at end of file\\n\",\"diff --git a/tests/serverlessworkflow/sdk/test_workflow.py b/tests/serverlessworkflow/sdk/test_workflow.py\\nindex 0e956fb..d61d64c 100644\\n--- a/tests/serverlessworkflow/sdk/test_workflow.py\\n+++ b/tests/serverlessworkflow/sdk/test_workflow.py\\n@@ -1,4 +1,3 @@\\n-import json\\n import os\\n import unittest\\n from os import listdir\\n@@ -13,7 +12,7 @@\\n \\n class TestWorkflow(unittest.TestCase):\\n     workflow = Workflow(\\n-        id_=\\\"greeting\\\",\\n+        id=\\\"greeting\\\",\\n         name=\\\"Greeting Workflow\\\",\\n         description=\\\"Greet Someone\\\",\\n         version='1.0',\\n@@ -125,7 +124,7 @@ def test_workflow_from_source_json(self):\\n         for example in examples:\\n             with self.subTest(f\\\"test_{example}\\\"):\\n                 with open(examples_dir + \\\"/\\\" + example, \\\"r\\\") as swf_file:\\n-                    workflow = Workflow.from_source(swf_file)\\n+                    workflow = Workflow.from_source(swf_file.read())\\n                     self.assertTrue(isinstance(workflow, Workflow))\\n \\n     def test_instance_workflow_class(self):\\n@@ -136,7 +135,7 @@ def test_instance_workflow_class(self):\\n         for example in examples:\\n             with self.subTest(f\\\"test_{example}\\\"):\\n                 with open(examples_dir + \\\"/\\\" + example, \\\"r\\\") as swf_file:\\n-                    workflow = Workflow(**json.load(swf_file))\\n+                    workflow = Workflow.from_source(swf_file.read())\\n                     self.assertTrue(isinstance(workflow, Workflow))\\n \\n     def test_workflow_from_source_yaml(self):\\n@@ -145,13 +144,12 @@ def test_workflow_from_source_yaml(self):\\n \\n     def assert_test_workflow_file(self, wf_file):\\n         with open(wf_file, \\\"r\\\") as swf_file:\\n-            swf_content = swf_file.read()\\n-\\n-            workflow = Workflow.from_source(swf_content)\\n+            workflow = Workflow.from_source(swf_file.read())\\n \\n             self.assertEqual(\\\"greeting\\\", workflow.id)\\n             self.assertEqual(\\\"operation\\\", workflow.states[0].type)\\n             self.assertEqual(True, workflow.states[0].end)\\n+            self.assertEqual('jq', workflow.expressionLang)\\n             self.assertTrue(isinstance(workflow.states[0].actions[0], Action))\\n             self.assertTrue(isinstance(workflow.states[0].actions[0].functionRef, FunctionRef))\\n             self.assertTrue(isinstance(workflow.functions[0], Function))\\n\",\"diff --git a/tests/serverlessworkflow/sdk/test_workflow.yaml b/tests/serverlessworkflow/sdk/test_workflow.yaml\\nindex b2f1e6e..1d19a4a 100644\\n--- a/tests/serverlessworkflow/sdk/test_workflow.yaml\\n+++ b/tests/serverlessworkflow/sdk/test_workflow.yaml\\n@@ -5,16 +5,16 @@ description: Greet Someone\\n specVersion: '0.8'\\n start: Greet\\n states:\\n-- name: Greet\\n-  type: operation\\n-  actions:\\n-  - functionRef:\\n-      refName: greetingFunction\\n-      arguments:\\n-        name: ${ .person.name }\\n-    actionDataFilter:\\n-      results: ${ .greeting }\\n-  end: true\\n+  - name: Greet\\n+    type: operation\\n+    actions:\\n+      - functionRef:\\n+          refName: greetingFunction\\n+          arguments:\\n+            name: ${ .person.name }\\n+        actionDataFilter:\\n+          results: ${ .greeting }\\n+    end: true\\n functions:\\n-- name: greetingFunction\\n-  operation: file://myapis/greetingapis.json#greeting\\n\\\\ No newline at end of file\\n+  - name: greetingFunction\\n+    operation: file://myapis/greetingapis.json#greeting\\n\\\\ No newline at end of file\\n\",\"diff --git a/tests/serverlessworkflow/sdk/test_workflow_validator.py b/tests/serverlessworkflow/sdk/test_workflow_validator.py\\nindex 30f54b7..4a55068 100644\\n--- a/tests/serverlessworkflow/sdk/test_workflow_validator.py\\n+++ b/tests/serverlessworkflow/sdk/test_workflow_validator.py\\n@@ -1,4 +1,3 @@\\n-import json\\n import os\\n import unittest\\n from os import listdir\\n@@ -19,18 +18,21 @@ def test_validate_examples(self):\\n         for example in examples:\\n             with self.subTest(f\\\"test_{example}\\\"):\\n                 with open(examples_dir + \\\"/\\\" + example, \\\"r\\\") as swf_file:\\n-                    swf_file_content = json.load(swf_file)\\n-                    workflow = Workflow(**swf_file_content)\\n+                    workflow = Workflow.from_source(swf_file.read())\\n                     WorkflowValidator(workflow).validate()\\n \\n+    def test_valid_wf(self):\\n+        wf_file = os.path.join(os.path.dirname(__file__), '../../examples', 'applicantrequest.json')\\n+        with open(wf_file, \\\"r\\\") as swf_file:\\n+            workflow = Workflow.from_source(swf_file.read())\\n+\\n+            WorkflowValidator(workflow).validate()\\n+\\n     def test_invalid_wf(self):\\n         wf_file = os.path.join(os.path.dirname(__file__), '../../examples', 'applicantrequest.json')\\n \\n         with open(wf_file, \\\"r\\\") as swf_file:\\n-            swf_content = swf_file.read()\\n-\\n-            workflow = Workflow.from_source(swf_content)\\n+            workflow = Workflow.from_source(swf_file.read())\\n             workflow.specVersion = None\\n             with self.assertRaises(ValidationError):\\n                 WorkflowValidator(Workflow(workflow)).validate()\\n-\"]", "hints_text": ""}
