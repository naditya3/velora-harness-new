{"instance_id": "9597404870386584", "repo": "snowflake-labs/snowcli", "base_commit": "fb5442f4478578fee48af5b3b520bb8b30762515", "problem_statement": "SNOW-930025: Streamlit does not work with PuPr version:\\n### SnowCLI version\\n\\nmain\\n\\n### Python version\\n\\nN/A\\n\\n### Platform\\n\\n_No response_\\n\\n### What happened\\n\\nCurrent `streamlit create` commands is not working with official PuPr version:\\r\\nhttps://docs.snowflake.com/sql-reference/sql/create-streamlit\\r\\n\\r\\n\\n\\n### Console output\\n\\n```Shell\\n% snow streamlit create anurag\\r\\nAn unexpected exception occurred. Use --debug option to see the traceback.\\r\\nException message:\\r\\n002145 (42601): SQL compilation error:\\r\\nUnsupported statement type. correct syntax: 'CREATE STREAMLIT <name> ROOT_LOCATION=<stage> MAIN_FILE=<file_path>'.\\r\\n```\\n```\\n\\n\\n### How to reproduce\\n\\n_No response_", "FAIL_TO_PASS": ["tests/streamlit/test_commands.py::test_deploy_streamlit_main_and_environment_files", "tests/streamlit/test_commands.py::test_deploy_streamlit_main_and_pages_files", "tests/streamlit/test_commands.py::test_deploy_streamlit_nonexisting_file[opts0]", "tests/streamlit/test_commands.py::test_deploy_streamlit_single_file", "tests/streamlit/test_commands.py::test_deploy_streamlit_all_files_default_stage", "tests/streamlit/test_commands.py::test_deploy_streamlit_nonexisting_file[opts1]", "tests/streamlit/test_commands.py::test_deploy_streamlit_all_files_users_stage"], "PASS_TO_PASS": ["tests/project/test_definition_manager.py::DefinitionManagerTest::test_dash_p_parameter_provided", "tests/test_render.py::test_render_include_file_content", "tests/test_config.py::test_get_default_connection_from_config[[connections]\\n[connections.other_conn]\\n[options]\\ndefault_connection", "tests/test_cli.py::test_namespace[warehouse-Manages", "tests/test_connection.py::test_second_connection_not_update_default_connection", "tests/output/test_printing.py::test_print_with_no_response_json", "tests/test_connection.py::test_fails_if_existing_connection", "tests/test_utils.py::test_sql_to_python_return_type_mapper[argument5]", "tests/stage/test_diff.py::test_put_files_on_stage[False]", "tests/test_registry.py::test_list_tags", "tests/test_cli.py::test_namespace[streamlit-", "tests/test_common_decorators.py::test_global_options_with_connection_decorator_on_function_with_arguments", "tests/nativeapp/test_init.py::test_init_with_url_and_template_w_random_url_and_template", "tests/stage/test_stage.py::test_stage_put_star", "tests/nativeapp/test_manager.py::test_drop_object_no_show_object", "tests/test_utils.py::test_yes_no_ask_callback_with_correct_argument[ask]", "tests/snowpark/test_procedure.py::test_update_procedure_update_because_handler_changed", "tests/nativeapp/test_package_scripts.py::test_invalid_package_script[napp_project_1]", "tests/streamlit/test_commands.py::test_drop_streamlit", "tests/nativeapp/test_init.py::test_render_snowflake_yml_raises_exception", "tests/test_utils.py::test_anaconda_packages", "tests/test_utils.py::test_get_downloaded_packages", "tests/test_connection.py::test_temporary_connection[--temporary-connection]", "tests/stage/test_diff.py::test_put_files_on_stage[True]", "tests/snowpark/test_function.py::test_drop_function_from_name", "tests/test_config.py::test_get_default_connection_from_config[[connections]\\n[connections.conn]\\n-conn]", "tests/test_common_global_context.py::test_connection_details_callback", "tests/test_sql.py::test_sql_overrides_connection_configuration", "tests/streamlit/test_commands.py::test_list_streamlit", "tests/stage/test_stage.py::test_stage_remove", "tests/test_command_registration.py::test_exception_handling_if_single_command_has_multiple_commands", "tests/snowpark/test_procedure.py::test_describe_procedure_from_signature", "tests/snowpark/test_jobs.py::test_drop_job", "tests/project/test_config.py::test_fails_without_definition_version[no_definition_version]", "tests/nativeapp/test_manager.py::test_create_dev_app_bad_owner", "tests/stage/test_stage.py::test_stage_drop", "tests/snowpark/test_procedure.py::test_create_procedure_with_coverage", "tests/test_utils.py::test_generate_streamlit_file", "tests/nativeapp/test_artifacts.py::test_outside_deploy_root_three_ways[napp_project_1]", "tests/test_config.py::test_get_default_connection_from_config[[connections]\\n[connections.conn1]\\n[connections.conn2]\\n[options]\\n", "tests/test_utils.py::test_add_file_to_existing_zip", "tests/project/test_config.py::test_napp_project_1[napp_project_1]", "tests/test_common_decorators.py::test_global_options_with_connection_decorator_connection_options_passed", "tests/test_utils.py::test_get_package_name_from_metadata_using_correct_data", "tests/test_common_decorators.py::test_global_options_decorator_no_options_passed", "tests/nativeapp/test_manager.py::test_create_dev_app_bad_comment", "tests/output/test_printing.py::test_print_multi_results_table", "tests/nativeapp/test_init.py::test_replace_snowflake_yml_name_with_project_empty_file", "tests/test_utils.py::test_yes_no_ask_callback_with_incorrect_argument[Yes]", "tests/test_connection.py::test_new_connection_can_be_added", "tests/nativeapp/test_package_scripts.py::test_undefined_var_package_script[napp_project_1]", "tests/test_command_registration.py::test_not_existing_external_entrypoint_handling", "tests/snowpark/test_services.py::test_show", "tests/test_package.py::TestPackage::test_package_lookup[argument0]", "tests/test_connection.py::test_port_has_cannot_be_string", "tests/stage/test_diff.py::test_identical_stage", "tests/test_utils.py::test_anaconda_packages_with_incorrect_response", "tests/test_main.py::test_streamlit_help", "tests/test_command_registration.py::test_broken_external_entrypoint_handling", "tests/test_snow_connector.py::test_command_context_is_passed_to_snowflake_connection[snow", "tests/nativeapp/test_manager.py::test_create_dev_app_create_new", "tests/test_utils.py::test_yes_no_ask_callback_with_incorrect_argument[and_now_for_something_completely_different]", "tests/test_main.py::test_custom_config_path", "tests/snowpark/test_procedure_coverage.py::test_procedure_coverage_report_create_html_report", "tests/snowpark/test_snowpark_shared.py::test_snowpark_package", "tests/output/test_printing.py::test_print_with_no_data_table", "tests/output/test_printing.py::test_single_value_from_query", "tests/test_config.py::test_get_default_connection_if_not_present_in_config", "tests/snowpark/test_procedure.py::test_update_procedure_noting_to_be_updated", "tests/nativeapp/test_package_scripts.py::test_missing_package_script[napp_project_1]", "tests/test_config.py::test_empty_config_file_is_created_if_not_present", "tests/test_command_registration.py::test_duplicated_plugin_handling", "tests/nativeapp/test_manager.py::test_create_dev_app_bad_version", "tests/stage/test_stage.py::test_stage_internal_put", "tests/test_command_registration.py::test_conflicting_command_plugin_paths_handling", "tests/output/test_printing.py::test_single_object_result", "tests/nativeapp/test_artifacts.py::test_glob_matched_nothing[napp_project_1]", "tests/test_config.py::test_get_default_connection_from_config[[connections]\\n-dev]", "tests/test_utils.py::test_prepare_app_zip_if_exception_is_raised_if_no_source", "tests/test_command_registration.py::test_not_existing_command_group_handling", "tests/test_common_decorators.py::test_global_options_with_connection_decorator_on_function_with_arguments_without_typehints", "tests/test_utils.py::test_generate_streamlit_environment_file_with_excluded_dependencies", "tests/nativeapp/test_artifacts.py::test_napp_project_1_artifacts[napp_project_1]", "tests/test_connection.py::test_temporary_connection[-x]", "tests/test_utils.py::test_get_packages[-expected2]", "tests/nativeapp/test_init.py::test_render_snowflake_yml", "tests/output/test_printing.py::test_print_different_multi_results_table", "tests/test_utils.py::test_yes_no_ask_callback_with_incorrect_argument[Ask]", "tests/test_common_decorators.py::test_global_options_decorator_connection_options_passed", "tests/test_snow_connector.py::test_returns_nice_error_in_case_of_connectivity_error", "tests/test_sql.py::test_sql_fails_if_no_query_file_or_stdin", "tests/nativeapp/test_init.py::test_init_w_existing_directory", "tests/test_utils.py::test_recursive_zip_packages_with_env_variable", "tests/test_utils.py::test_parse_requirements", "tests/snowpark/test_services.py::test_create_service", "tests/test_sql.py::test_sql_execute_from_stdin", "tests/output/test_printing.py::test_single_collection_result", "tests/project/test_definition_manager.py::DefinitionManagerTest::test_find_definition_files_reached_home", "tests/test_utils.py::test_yes_no_ask_callback_with_correct_argument[yes]", "tests/test_utils.py::test_get_snowflake_packages_delta", "tests/test_connection.py::test_port_has_cannot_be_float", "tests/nativeapp/test_manager.py::test_drop_object", "tests/snowpark/test_procedure_coverage.py::test_procedure_coverage_report_create_lcov_report", "tests/snowpark/test_function.py::test_update_function_no_changes", "tests/nativeapp/test_artifacts.py::test_source_not_found[napp_project_1]", "tests/project/test_definition_manager.py::DefinitionManagerTest::test_no_project_parameter_provided", "tests/snowpark/test_function.py::test_update_function_needs_update_because_handler_changes", "tests/test_utils.py::test_parse_anaconda_packages", "tests/nativeapp/test_init.py::test_is_valid_project_name[_-True]", "tests/snowpark/test_procedure_coverage.py::test_procedure_coverage_report_store_as_comment", "tests/nativeapp/test_init.py::test_init_with_url_and_no_template_fail_on_validation", "tests/nativeapp/test_init.py::test_init_w_existing_yml", "tests/snowpark/test_procedure_coverage.py::test_procedure_coverage_report_create_json_report", "tests/test_command_registration.py::test_conflicting_commands_handling", "tests/snowpark/test_procedure.py::test_describe_procedure_from_name", "tests/stage/test_diff.py::test_empty_stage", "tests/test_sql.py::test_sql_execute_file", "tests/nativeapp/test_manager.py::test_create_dev_app_recreate", "tests/nativeapp/test_package_scripts.py::test_package_scripts[napp_project_1]", "tests/stage/test_diff.py::test_get_stage_path_from_file", "tests/test_utils.py::test_parse_requierements_with_correct_file", "tests/snowpark/test_function.py::test_update_function_needs_update_because_packages_changes", "tests/snowpark/test_compute_pool.py::TestComputePoolManager::test_show", "tests/test_utils.py::test_path_resolver[C:\\\\Something\\\\Something", "tests/snowpark/test_procedure_coverage.py::test_get_deploy_names_correct", "tests/stage/test_stage.py::test_stage_list", "tests/test_common_decorators.py::test_global_options_decorator_on_function_with_arguments", "tests/test_sql.py::test_sql_fails_for_both_query_and_file", "tests/test_registry.py::test_list_images", "tests/snowpark/test_services.py::test_status", "tests/project/test_config.py::test_na_minimal_project[minimal]", "tests/test_config.py::test_get_default_connection_from_config[[connections]\\n[options]\\ndefault_connection", "tests/test_connection.py::test_new_connection_add_prompt_handles_prompt_override", "tests/nativeapp/test_commands.py::test_init_no_template_success", "tests/test_utils.py::test_get_packages[toml", "tests/output/test_printing.py::test_print_with_no_data_in_single_value_query_json", "tests/test_utils.py::test_generate_streamlit_package_wrapper", "tests/output/test_printing.py::test_print_different_data_sources_table", "tests/streamlit/test_commands.py::test_describe_streamlit", "tests/snowpark/test_jobs.py::test_create_job", "tests/test_common_decorators.py::test_global_options_decorator_on_function_with_arguments_without_typehints", "tests/test_utils.py::test_prepare_app_zip", "tests/snowpark/test_services.py::test_drop", "tests/test_connection.py::test_new_connection_add_prompt_handles_default_values", "tests/test_utils.py::test_sql_to_python_return_type_mapper[argument0]", "tests/nativeapp/test_manager.py::test_sync_deploy_root_with_stage", "tests/test_common_decorators.py::test_global_options_with_connection_decorator_no_options_passed", "tests/test_utils.py::test_get_packages[#only", "tests/stage/test_diff.py::test_sync_local_diff_with_stage", "tests/project/test_definition_manager.py::DefinitionManagerTest::test_double_dash_project_parameter_provided", "tests/test_utils.py::test_standard_zip_dir", "tests/snowpark/test_function.py::test_list_function", "tests/nativeapp/test_manager.py::test_drop_object_no_special_comment", "tests/test_utils.py::test_recursive_zip_packages", "tests/output/test_printing.py::test_print_different_data_sources_json", "tests/stage/test_stage.py::test_stage_internal_remove_no_role_change", "tests/test_package.py::TestPackage::test_package_lookup[argument1]", "tests/stage/test_stage.py::test_stage_get", "tests/test_utils.py::test_prepare_app_zip_if_exception_is_raised_if_no_dst", "tests/stage/test_stage.py::test_stage_create", "tests/test_config.py::test_environment_variables_works_if_config_value_not_present", "tests/test_snow_connector.py::test_no_output_from_connection", "tests/test_main.py::test_help_option", "tests/test_command_registration.py::test_broken_command_spec_handling", "tests/test_cli.py::test_namespace[snowpark-Manages", "tests/stage/test_stage.py::test_stage_put", "tests/snowpark/test_services.py::test_logs", "tests/nativeapp/test_init.py::test_init_with_url_and_no_template_w_random_url", "tests/test_utils.py::test_sql_to_python_return_type_mapper[argument2]", "tests/snowpark/test_procedure_coverage.py::test_procedure_coverage_clear", "tests/test_utils.py::test_deduplicate_and_sort_reqs", "tests/test_connection.py::test_connection_test", "tests/test_command_options.py::test_format", "tests/test_utils.py::test_sql_to_python_return_type_mapper[argument1]", "tests/snowpark/test_function.py::test_execute_function", "tests/test_utils.py::test_yes_no_ask_callback_with_incorrect_argument[No]", "tests/output/test_printing.py::test_print_multi_db_cursor_json", "tests/test_config.py::test_get_default_connection_from_config[[connections]\\n[connections.conn]\\n[options]\\n-conn]", "tests/test_package.py::TestPackage::test_package_upload", "tests/test_config.py::test_if_default_connection_in_env_variable_overrides_config[[connections]\\n[connections.conn1]\\n[connections.conn2]\\n[options]\\n", "tests/test_render.py::test_render_template", "tests/snowpark/test_jobs.py::test_job_status", "tests/snowpark/test_services.py::test_desc", "tests/snowpark/test_jobs.py::test_desc_job", "tests/snowpark/test_procedure.py::test_drop_procedure_from_signature", "tests/test_utils.py::test_get_packages[pytest==1.0.0\\nDjango==3.2.1\\nawesome_lib==3.3.3-expected0]", "tests/nativeapp/test_init.py::test_is_valid_project_name[__-True]", "tests/snowpark/test_compute_pool.py::TestComputePoolManager::test_stop", "tests/snowpark/test_procedure.py::test_update_procedure_with_coverage", "tests/snowpark/test_procedure.py::test_execute_procedure", "tests/test_utils.py::test_yes_no_ask_callback_with_incorrect_argument[42]", "tests/snowpark/test_function.py::test_drop_function_from_signature", "tests/test_utils.py::test_yes_no_ask_callback_with_incorrect_argument[yse]", "tests/test_config.py::test_if_default_connection_in_env_variable_overrides_config[[connections]\\n[connections.conn1]\\n[connections.conn2]\\n[options]\\ndefault_connection", "tests/nativeapp/test_manager.py::test_create_dev_app_noop", "tests/test_registry.py::test_registry_get_token_2", "tests/snowpark/test_jobs.py::test_job_logs", "tests/nativeapp/test_init.py::test_is_valid_project_name[A-True]", "tests/nativeapp/test_init.py::test_validate_and_update_snowflake_yml_w_missing_yml", "tests/output/test_printing.py::test_print_with_no_data_in_query_json", "tests/test_utils.py::test_generate_streamlit_environment_file_with_no_requirements", "tests/test_utils.py::test_sql_to_python_return_type_mapper[argument3]", "tests/nativeapp/test_init.py::test_init_w_invalid_project_name", "tests/test_main.py::test_info_callback", "tests/test_config.py::test_get_connection_from_file", "tests/test_config.py::test_if_default_connection_in_env_variable_overrides_config[[connections]\\n[options]\\ndefault_connection", "tests/test_config.py::test_get_default_connection_from_env", "tests/test_render.py::test_render_metadata", "tests/project/test_config.py::test_accepts_unknown_fields[unknown_fields]", "tests/test_cli.py::test_global", "tests/nativeapp/test_artifacts.py::test_too_many_files[napp_project_1]", "tests/test_command_registration.py::test_builtin_plugins_registration", "tests/nativeapp/test_init.py::test_is_valid_project_name[_aB3_$-True]", "tests/test_utils.py::test_get_packages[pytest==1.0\\n#", "tests/test_command_registration.py::test_auto_empty_callback_for_new_groups_with_single_command", "tests/test_sql.py::test_sql_fails_for_both_stdin_and_other_query_source", "tests/test_utils.py::test_yes_no_ask_callback_with_correct_argument[no]", "tests/test_package.py::TestPackage::test_package_lookup_with_install_packages", "tests/snowpark/test_function.py::test_create_function", "tests/snowpark/test_services.py::test_create_service_with_invalid_spec", "tests/test_common_global_context.py::test_default_setup_of_global_context", "tests/test_config.py::test_environment_variables_override_configuration_value", "tests/test_utils.py::test_sql_to_python_return_type_mapper[argument4]", "tests/snowpark/test_snowpark_shared.py::test_replace_handler_in_zip_with_wrong_handler", "tests/test_config.py::test_get_all_connections", "tests/test_utils.py::test_generate_snowpark_coverage_wrapper", "tests/test_utils.py::test_parse_requirements_with_nonexistent_file", "tests/stage/test_diff.py::test_empty_dir", "tests/stage/test_diff.py::test_delete_only_on_stage_files", "tests/project/test_definition_manager.py::DefinitionManagerTest::test_dash_p_with_relative_parameter_provided", "tests/test_config.py::test_if_default_connection_in_env_variable_overrides_config[[connections]\\n[connections.conn1]\\n[connections.conn2]\\n[connections.dev]\\n[options]\\ndefault_connection", "tests/stage/test_diff.py::test_new_local_file", "tests/project/test_definition_manager.py::DefinitionManagerTest::test_find_definition_files_reached_root", "tests/test_package.py::TestPackage::test_package_create", "tests/snowpark/test_procedure.py::test_list_procedure", "tests/snowpark/test_procedure_coverage.py::test_procedure_coverage_report_error_when_no_report_on_stage", "tests/test_command_registration.py::test_multiple_use_of_test_runner", "tests/test_connection.py::test_lists_connection_information", "tests/nativeapp/test_init.py::test_is_valid_project_name[9-False]", "tests/snowpark/test_procedure.py::test_drop_procedure_from_name", "tests/streamlit/test_commands.py::test_share_streamlit", "tests/snowpark/test_procedure.py::test_create_procedure", "tests/test_utils.py::test_anaconda_packages_streamlit", "tests/test_utils.py::test_standard_zip_dir_with_env_variable", "tests/stage/test_stage.py::test_stage_internal_remove", "tests/nativeapp/test_init.py::test_init_with_url_and_no_template_w_native_app_url", "tests/snowpark/test_snowpark_shared.py::test_snowpark_package_with_packages_dir", "tests/snowpark/test_compute_pool.py::TestComputePoolManager::test_drop", "tests/test_warehouse.py::test_show_warehouses", "tests/snowpark/test_procedure.py::test_update_procedure_update_because_packages_changed", "tests/nativeapp/test_init.py::test_replace_snowflake_yml_name_with_project_populated_file", "tests/test_command_registration.py::test_exception_handling_if_single_command_has_callback", "tests/stage/test_diff.py::test_modified_file", "tests/project/test_config.py::test_underspecified_project[underspecified]", "tests/snowpark/test_procedure_coverage.py::test_procedure_coverage_report_create_default_report", "tests/snowpark/test_snowpark_shared.py::test_replace_handler_in_zip", "tests/test_main.py::test_all_commands_has_proper_documentation", "tests/nativeapp/test_init.py::test_init_with_url_and_template_w_native_app_url_and_template", "tests/snowpark/test_function.py::test_describe_function_from_name", "tests/test_utils.py::test_convert_resource_details_to_dict", "tests/test_render.py::test_render_js_proc", "tests/test_sql.py::test_sql_execute_query", "tests/test_utils.py::test_get_packages[some-package==1.2.3#incorrect_comment-expected3]", "tests/snowpark/test_compute_pool.py::TestComputePoolManager::test_create", "tests/test_utils.py::test_path_resolver[/var/folders/k8/3sdqh3nn4gg7lpr5fz0fjlqw0000gn/T/tmpja15jymq-/var/folders/k8/3sdqh3nn4gg7lpr5fz0fjlqw0000gn/T/tmpja15jymq]", "tests/stage/test_stage.py::test_stage_get_default_path", "tests/snowpark/test_function.py::test_describe_function_from_signature"], "language": "python", "test_command": "source /saved/ENV || source /saved/*/ENV && pytest --no-header -rA --tb=no -p no:cacheprovider --continue-on-collection-errors", "test_output_parser": "python/parse_log_pytest_v3", "image_storage_uri": "vmvm-registry.fbinfra.net/repomate_image_activ_pytest/snowflake-labs_snowcli:fb5442f4478578fee48af5b3b520bb8b30762515", "patch": "[\"diff --git a/RELEASE-NOTES.md b/RELEASE-NOTES.md\\nindex d7502b653..222577283 100644\\n--- a/RELEASE-NOTES.md\\n+++ b/RELEASE-NOTES.md\\n@@ -16,8 +16,10 @@\\n \\n ## New additions\\n * `--temporary-connection` flag, that allows you to connect, without anything declared in config file\\n+* `snow streamlit init` command that creates a new streamlit project.\\n \\n ## Fixes and improvements\\n+* Adjust streamlit commands to PuPr syntax\\n * Too long texts in table cells are now wrapped instead of cropped\\n * Split global options into separate section in `help`\\n * Avoiding unnecessary replace in function/procedure update\\n\",\"diff --git a/src/snowcli/cli/streamlit/commands.py b/src/snowcli/cli/streamlit/commands.py\\nindex d4effa13e..c39a88152 100644\\n--- a/src/snowcli/cli/streamlit/commands.py\\n+++ b/src/snowcli/cli/streamlit/commands.py\\n@@ -3,7 +3,7 @@\\n from pathlib import Path\\n from typing import Optional\\n \\n-from snowcli.cli.common.decorators import global_options_with_connection\\n+from snowcli.cli.common.decorators import global_options_with_connection, global_options\\n from snowcli.cli.common.flags import DEFAULT_CONTEXT_SETTINGS\\n from snowcli.cli.streamlit.manager import StreamlitManager\\n from snowcli.output.decorators import with_output\\n@@ -20,6 +20,7 @@\\n     MessageResult,\\n     MultipleResults,\\n )\\n+from snowcli.utils import create_project_template\\n \\n app = typer.Typer(\\n     context_settings=DEFAULT_CONTEXT_SETTINGS,\\n@@ -29,6 +30,22 @@\\n log = logging.getLogger(__name__)\\n \\n \\n+@app.command(\\\"init\\\")\\n+@with_output\\n+@global_options\\n+def streamlit_init(\\n+    project_name: str = typer.Argument(\\n+        \\\"example_streamlit\\\", help=\\\"Name of the streamlit project you want to create.\\\"\\n+    ),\\n+    **options,\\n+) -> CommandResult:\\n+    \\\"\\\"\\\"\\n+    Initializes this directory with a sample set of files for creating a streamlit dashboard.\\n+    \\\"\\\"\\\"\\n+    create_project_template(\\\"default_streamlit\\\", project_directory=project_name)\\n+    return MessageResult(f\\\"Initialized the new project in {project_name}/\\\")\\n+\\n+\\n @app.command(\\\"list\\\")\\n @with_output\\n @global_options_with_connection\\n@@ -66,10 +83,8 @@ def streamlit_create(\\n     name: str = typer.Argument(..., help=\\\"Name of streamlit to create.\\\"),\\n     file: Path = typer.Option(\\n         \\\"streamlit_app.py\\\",\\n-        exists=True,\\n-        readable=True,\\n         file_okay=True,\\n-        help=\\\"Path to the Streamlit Python application (`streamlit_app.py`) file.\\\",\\n+        help=\\\"Path on stage to the main file of Streamlit application.\\\",\\n     ),\\n     from_stage: Optional[str] = typer.Option(\\n         None,\\n@@ -84,13 +99,20 @@ def streamlit_create(\\n     \\\"\\\"\\\"\\n     Creates a new Streamlit application object in Snowflake. The streamlit is created in database and schema configured in the connection.\\n     \\\"\\\"\\\"\\n-    cursor = StreamlitManager().create(\\n+    sm = StreamlitManager()\\n+    results = MultipleResults()\\n+    create_result = sm.create(\\n         streamlit_name=name,\\n         file=file,\\n-        from_stage=from_stage,\\n+        stage=from_stage,\\n         use_packaging_workaround=use_packaging_workaround,\\n     )\\n-    return SingleQueryResult(cursor)\\n+    results.add(SingleQueryResult(create_result))\\n+\\n+    checkout_result = sm.checkout(streamlit_name=name)\\n+    results.add(SingleQueryResult(checkout_result))\\n+\\n+    return results\\n \\n \\n @app.command(\\\"share\\\")\\n\",\"diff --git a/src/snowcli/cli/streamlit/manager.py b/src/snowcli/cli/streamlit/manager.py\\nindex 9a99dec32..c651fbab0 100644\\n--- a/src/snowcli/cli/streamlit/manager.py\\n+++ b/src/snowcli/cli/streamlit/manager.py\\n@@ -33,30 +33,26 @@ def create(\\n         self,\\n         streamlit_name: str,\\n         file: Path,\\n-        from_stage: str,\\n+        stage: str,\\n         use_packaging_workaround: bool,\\n     ) -> SnowflakeCursor:\\n         connection = self._conn\\n-        if from_stage:\\n-            standard_page_name = StageManager.get_standard_stage_name(from_stage)\\n-            from_stage_command = f\\\"FROM {standard_page_name}\\\"\\n-        else:\\n-            from_stage_command = \\\"\\\"\\n+        standard_page_name = StageManager.get_standard_stage_name(stage)\\n         main_file = (\\n             \\\"streamlit_app_launcher.py\\\" if use_packaging_workaround else file.name\\n         )\\n \\n         return self._execute_query(\\n             f\\\"\\\"\\\"\\n-            create streamlit {streamlit_name}\\n-            {from_stage_command}\\n+            CREATE STREAMLIT {streamlit_name}\\n+            ROOT_LOCATION = '{standard_page_name}'\\n             MAIN_FILE = '{main_file}'\\n-            QUERY_WAREHOUSE = {connection.warehouse};\\n-\\n-            alter streamlit {streamlit_name} checkout;\\n         \\\"\\\"\\\"\\n         )\\n \\n+    def checkout(self, streamlit_name: str):\\n+        return self._execute_query(f\\\"alter streamlit {streamlit_name} checkout;\\\")\\n+\\n     def share(self, streamlit_name: str, to_role: str) -> SnowflakeCursor:\\n         return self._execute_query(\\n             f\\\"grant usage on streamlit {streamlit_name} to role {to_role}\\\"\\n\",\"diff --git a/src/snowcli/utils.py b/src/snowcli/utils.py\\nindex 1e506f75c..1b8548181 100644\\n--- a/src/snowcli/utils.py\\n+++ b/src/snowcli/utils.py\\n@@ -596,10 +596,11 @@ class File:\\n     relpath: Optional[str] = None\\n \\n \\n-def create_project_template(template_name: str):\\n+def create_project_template(template_name: str, project_directory: str | None = None):\\n+    target = project_directory or os.getcwd()\\n     shutil.copytree(\\n         Path(importlib.util.find_spec(\\\"templates\\\").origin).parent / template_name,  # type: ignore\\n-        f\\\"{os.getcwd()}\\\",\\n+        target,\\n         dirs_exist_ok=True,\\n     )\\n \\n\",\"diff --git a/src/templates/default_streamlit/environment.yml b/src/templates/default_streamlit/environment.yml\\nnew file mode 100644\\nindex 000000000..ac8feac3e\\n--- /dev/null\\n+++ b/src/templates/default_streamlit/environment.yml\\n@@ -0,0 +1,5 @@\\n+name: sf_env\\n+channels:\\n+  - snowflake\\n+dependencies:\\n+  - pandas\\n\",\"diff --git a/src/templates/default_streamlit/main.py b/src/templates/default_streamlit/main.py\\nnew file mode 100644\\nindex 000000000..b699538d7\\n--- /dev/null\\n+++ b/src/templates/default_streamlit/main.py\\n@@ -0,0 +1,3 @@\\n+import streamlit as st\\n+\\n+st.title(\\\"Example streamlit app\\\")\\n\",\"diff --git a/src/templates/default_streamlit/pages/my_page.py b/src/templates/default_streamlit/pages/my_page.py\\nnew file mode 100644\\nindex 000000000..bc3ecbccb\\n--- /dev/null\\n+++ b/src/templates/default_streamlit/pages/my_page.py\\n@@ -0,0 +1,3 @@\\n+import streamlit as st\\n+\\n+st.title(\\\"Example page\\\")\\n\",\"diff --git a/RELEASE-NOTES.md b/RELEASE-NOTES.md\\nindex 222577283..8ad2fd59b 100644\\n--- a/RELEASE-NOTES.md\\n+++ b/RELEASE-NOTES.md\\n@@ -13,10 +13,12 @@\\n * Update function or procedure will upload function/procedure code to new path on stage. Previous code will remain under old path on stage.\\n * Snowpark command `compute-pool` and its alias `cp` were replaced by `pool` command.\\n * `snow snowpark registry` was replaced with `snow registry` command.\\n+* Removed `snow streamlit create` command. Streamlit can be deployd using `snow streamlit deploy`\\n \\n ## New additions\\n * `--temporary-connection` flag, that allows you to connect, without anything declared in config file\\n * `snow streamlit init` command that creates a new streamlit project.\\n+* `snow streamlit deploy` support pages and environment.yml files.\\n \\n ## Fixes and improvements\\n * Adjust streamlit commands to PuPr syntax\\n\",\"diff --git a/src/snowcli/cli/common/sql_execution.py b/src/snowcli/cli/common/sql_execution.py\\nindex bf903e67f..4544ca064 100644\\n--- a/src/snowcli/cli/common/sql_execution.py\\n+++ b/src/snowcli/cli/common/sql_execution.py\\n@@ -3,6 +3,7 @@\\n \\n from textwrap import dedent\\n \\n+from click import ClickException\\n from snowflake.connector.errors import ProgrammingError\\n from snowcli.cli.common.snow_cli_global_context import snow_cli_global_context_manager\\n from snowflake.connector.cursor import DictCursor\\n@@ -89,3 +90,21 @@ def check_schema_exists(self, database: str, schema: str) -> None:\\n             Use `snow connection list` to list existing connections\\n             \\\"\\\"\\\"\\n             ) from e\\n+\\n+    def to_fully_qualified_name(self, name: str):\\n+        current_parts = name.split(\\\".\\\")\\n+        if len(current_parts) == 3:\\n+            # already fully qualified name\\n+            return name.upper()\\n+\\n+        if not self._conn.database:\\n+            raise ClickException(\\n+                \\\"Default database not specified in connection details.\\\"\\n+            )\\n+\\n+        if len(current_parts) == 2:\\n+            # we assume this is schema.object\\n+            return f\\\"{self._conn.database}.{name}\\\".upper()\\n+\\n+        schema = self._conn.schema or \\\"public\\\"\\n+        return f\\\"{self._conn.database}.{schema}.{name}\\\".upper()\\n\",\"diff --git a/src/snowcli/cli/stage/manager.py b/src/snowcli/cli/stage/manager.py\\nindex 2c2c7ae29..f20409afb 100644\\n--- a/src/snowcli/cli/stage/manager.py\\n+++ b/src/snowcli/cli/stage/manager.py\\n@@ -14,7 +14,7 @@ class StageManager(SqlExecutionMixin):\\n     @staticmethod\\n     def get_standard_stage_name(name: str) -> str:\\n         # Handle embedded stages\\n-        if name.startswith(\\\"snow://\\\"):\\n+        if name.startswith(\\\"snow://\\\") or name.startswith(\\\"@\\\"):\\n             return name\\n \\n         return f\\\"@{name}\\\"\\n\",\"diff --git a/src/snowcli/cli/streamlit/commands.py b/src/snowcli/cli/streamlit/commands.py\\nindex c39a88152..a6238d6dd 100644\\n--- a/src/snowcli/cli/streamlit/commands.py\\n+++ b/src/snowcli/cli/streamlit/commands.py\\n@@ -1,4 +1,5 @@\\n import logging\\n+\\n import typer\\n from pathlib import Path\\n from typing import Optional\\n@@ -7,15 +8,10 @@\\n from snowcli.cli.common.flags import DEFAULT_CONTEXT_SETTINGS\\n from snowcli.cli.streamlit.manager import StreamlitManager\\n from snowcli.output.decorators import with_output\\n-from snowcli.cli.snowpark_shared import (\\n-    CheckAnacondaForPyPiDependencies,\\n-    PackageNativeLibrariesOption,\\n-    PyPiDownloadOption,\\n-)\\n+\\n from snowcli.output.types import (\\n     CommandResult,\\n     QueryResult,\\n-    CollectionResult,\\n     SingleQueryResult,\\n     MessageResult,\\n     MultipleResults,\\n@@ -30,6 +26,13 @@\\n log = logging.getLogger(__name__)\\n \\n \\n+StageNameOption: str = typer.Option(\\n+    \\\"streamlit\\\",\\n+    \\\"--stage\\\",\\n+    help=\\\"Stage name where are Streamlit files.\\\",\\n+)\\n+\\n+\\n @app.command(\\\"init\\\")\\n @with_output\\n @global_options\\n@@ -76,45 +79,6 @@ def streamlit_describe(\\n     return result\\n \\n \\n-@app.command(\\\"create\\\")\\n-@with_output\\n-@global_options_with_connection\\n-def streamlit_create(\\n-    name: str = typer.Argument(..., help=\\\"Name of streamlit to create.\\\"),\\n-    file: Path = typer.Option(\\n-        \\\"streamlit_app.py\\\",\\n-        file_okay=True,\\n-        help=\\\"Path on stage to the main file of Streamlit application.\\\",\\n-    ),\\n-    from_stage: Optional[str] = typer.Option(\\n-        None,\\n-        help=\\\"Stage name from which to copy a Streamlit file.\\\",\\n-    ),\\n-    use_packaging_workaround: bool = typer.Option(\\n-        False,\\n-        help=\\\"Whether to package all code and dependencies into a zip file. Valid values: `true`, `false` (default). You should use this only for a temporary workaround until native support is available.\\\",\\n-    ),\\n-    **options,\\n-) -> CommandResult:\\n-    \\\"\\\"\\\"\\n-    Creates a new Streamlit application object in Snowflake. The streamlit is created in database and schema configured in the connection.\\n-    \\\"\\\"\\\"\\n-    sm = StreamlitManager()\\n-    results = MultipleResults()\\n-    create_result = sm.create(\\n-        streamlit_name=name,\\n-        file=file,\\n-        stage=from_stage,\\n-        use_packaging_workaround=use_packaging_workaround,\\n-    )\\n-    results.add(SingleQueryResult(create_result))\\n-\\n-    checkout_result = sm.checkout(streamlit_name=name)\\n-    results.add(SingleQueryResult(checkout_result))\\n-\\n-    return results\\n-\\n-\\n @app.command(\\\"share\\\")\\n @with_output\\n @global_options_with_connection\\n@@ -150,7 +114,7 @@ def streamlit_drop(\\n @with_output\\n @global_options_with_connection\\n def streamlit_deploy(\\n-    name: str = typer.Argument(..., help=\\\"Name of streamlit to deploy.\\\"),\\n+    streamlit_name: str = typer.Argument(..., help=\\\"Name of Streamlit to deploy.\\\"),\\n     file: Path = typer.Option(\\n         \\\"streamlit_app.py\\\",\\n         exists=True,\\n@@ -158,43 +122,53 @@ def streamlit_deploy(\\n         file_okay=True,\\n         help=\\\"Path of the Streamlit app file.\\\",\\n     ),\\n-    open_: bool = typer.Option(\\n-        False,\\n-        \\\"--open\\\",\\n-        \\\"-o\\\",\\n-        help=\\\"Whether to open Streamlit in a browser. Valid values: `true`, `false`. Default: `false`.\\\",\\n+    stage: Optional[str] = StageNameOption,\\n+    environment_file: Path = typer.Option(\\n+        \\\"environment.yml\\\",\\n+        \\\"--env-file\\\",\\n+        help=\\\"Environment file to use.\\\",\\n+        file_okay=True,\\n+        dir_okay=False,\\n     ),\\n-    use_packaging_workaround: bool = typer.Option(\\n-        False,\\n-        help=\\\"Whether to package all code and dependencies into a zip file. Valid values: `true`, `false` (default). You should use this only for a temporary workaround until native support is available.\\\",\\n+    pages_dir: Path = typer.Option(\\n+        \\\"pages\\\",\\n+        \\\"--pages-dir\\\",\\n+        help=\\\"Directory with Streamlit pages\\\",\\n+        file_okay=False,\\n+        dir_okay=True,\\n     ),\\n-    packaging_workaround_includes_content: bool = typer.Option(\\n+    query_warehouse: Optional[str] = typer.Option(\\n+        None, \\\"--query-warehouse\\\", help=\\\"Query warehouse for this Streamlit.\\\"\\n+    ),\\n+    replace: Optional[bool] = typer.Option(\\n         False,\\n-        help=\\\"Whether to package all code and dependencies into a zip file. Valid values: `true`, `false`. Default: `false`.\\\",\\n+        \\\"--replace\\\",\\n+        help=\\\"Replace the Streamlit if it already exists.\\\",\\n+        is_flag=True,\\n     ),\\n-    pypi_download: str = PyPiDownloadOption,\\n-    check_anaconda_for_pypi_deps: bool = CheckAnacondaForPyPiDependencies,\\n-    package_native_libraries: str = PackageNativeLibrariesOption,\\n-    excluded_anaconda_deps: str = typer.Option(\\n-        None,\\n-        help=\\\"List of comma-separated package names from `environment.yml` to exclude in the deployed app, particularly when Streamlit fails to import an Anaconda package at runtime. Be aware that excluding files might the risk of runtime errors).\\\",\\n+    open_: bool = typer.Option(\\n+        False, \\\"--open\\\", help=\\\"Whether to open Streamlit in a browser.\\\", is_flag=True\\n     ),\\n     **options,\\n ) -> CommandResult:\\n     \\\"\\\"\\\"\\n-    Creates a Streamlit app package for deployment.\\n+    Uploads local files to specified stage and creates a Streamlit dashboard using the files. You must specify the\\n+    main python file. By default, the command will upload environment.yml and pages/ folder  if present. If you\\n+    don't provide any stage name then 'streamlit' stage will be used. If provided stage will be created if it does\\n+    not exist.\\n+    You can modify the behaviour using flags. For details check help information.\\n     \\\"\\\"\\\"\\n-    result = StreamlitManager().deploy(\\n-        streamlit_name=name,\\n-        file=file,\\n-        open_in_browser=open_,\\n-        use_packaging_workaround=use_packaging_workaround,\\n-        packaging_workaround_includes_content=packaging_workaround_includes_content,\\n-        pypi_download=pypi_download,\\n-        check_anaconda_for_pypi_deps=check_anaconda_for_pypi_deps,\\n-        package_native_libraries=package_native_libraries,\\n-        excluded_anaconda_deps=excluded_anaconda_deps,\\n+    url = StreamlitManager().deploy(\\n+        streamlit_name=streamlit_name,\\n+        environment_file=environment_file,\\n+        pages_dir=pages_dir,\\n+        stage_name=stage,\\n+        main_file=file,\\n+        replace=replace,\\n+        warehouse=query_warehouse,\\n     )\\n-    if result is not None:\\n-        return MessageResult(result)\\n-    return MessageResult(\\\"Done\\\")\\n+\\n+    if open_:\\n+        typer.launch(url)\\n+\\n+    return MessageResult(f\\\"Streamlit successfully deployed and available under {url}\\\")\\n\",\"diff --git a/src/snowcli/cli/streamlit/manager.py b/src/snowcli/cli/streamlit/manager.py\\nindex c651fbab0..8175e8929 100644\\n--- a/src/snowcli/cli/streamlit/manager.py\\n+++ b/src/snowcli/cli/streamlit/manager.py\\n@@ -29,30 +29,6 @@ def describe(self, streamlit_name: str) -> Tuple[SnowflakeCursor, SnowflakeCurso\\n         )\\n         return description, url\\n \\n-    def create(\\n-        self,\\n-        streamlit_name: str,\\n-        file: Path,\\n-        stage: str,\\n-        use_packaging_workaround: bool,\\n-    ) -> SnowflakeCursor:\\n-        connection = self._conn\\n-        standard_page_name = StageManager.get_standard_stage_name(stage)\\n-        main_file = (\\n-            \\\"streamlit_app_launcher.py\\\" if use_packaging_workaround else file.name\\n-        )\\n-\\n-        return self._execute_query(\\n-            f\\\"\\\"\\\"\\n-            CREATE STREAMLIT {streamlit_name}\\n-            ROOT_LOCATION = '{standard_page_name}'\\n-            MAIN_FILE = '{main_file}'\\n-        \\\"\\\"\\\"\\n-        )\\n-\\n-    def checkout(self, streamlit_name: str):\\n-        return self._execute_query(f\\\"alter streamlit {streamlit_name} checkout;\\\")\\n-\\n     def share(self, streamlit_name: str, to_role: str) -> SnowflakeCursor:\\n         return self._execute_query(\\n             f\\\"grant usage on streamlit {streamlit_name} to role {to_role}\\\"\\n@@ -61,50 +37,57 @@ def share(self, streamlit_name: str, to_role: str) -> SnowflakeCursor:\\n     def drop(self, streamlit_name: str) -> SnowflakeCursor:\\n         return self._execute_query(f\\\"drop streamlit {streamlit_name}\\\")\\n \\n+    def get_url_from_name(self, streamlit_name: str):\\n+        return self._execute_query(\\n+            f\\\"call SYSTEM$GENERATE_STREAMLIT_URL_FROM_NAME('{streamlit_name}')\\\"\\n+        ).fetchone()[0]\\n+\\n     def deploy(\\n         self,\\n         streamlit_name: str,\\n-        file: Path,\\n-        open_in_browser: bool,\\n-        use_packaging_workaround: bool,\\n-        packaging_workaround_includes_content: bool,\\n-        pypi_download: str,\\n-        check_anaconda_for_pypi_deps: bool,\\n-        package_native_libraries: str,\\n-        excluded_anaconda_deps: str,\\n+        main_file: Path,\\n+        environment_file: Optional[Path] = None,\\n+        pages_dir: Optional[Path] = None,\\n+        stage_name: Optional[str] = None,\\n+        warehouse: Optional[str] = None,\\n+        replace: Optional[bool] = False,\\n     ):\\n         stage_manager = StageManager()\\n \\n-        # THIS WORKAROUND HAS NOT BEEN TESTED WITH THE NEW STREAMLIT SYNTAX\\n-        if use_packaging_workaround:\\n-            self._packaging_workaround(\\n-                streamlit_name,\\n-                file,\\n-                packaging_workaround_includes_content,\\n-                pypi_download,\\n-                check_anaconda_for_pypi_deps,\\n-                package_native_libraries,\\n-                excluded_anaconda_deps,\\n-                stage_manager,\\n-            )\\n+        stage_name = stage_name or \\\"streamlit\\\"\\n+        stage_name = stage_manager.to_fully_qualified_name(stage_name)\\n \\n-        qualified_name = self.qualified_name(streamlit_name)\\n-        streamlit_stage_name = f\\\"snow://streamlit/{qualified_name}/default_checkout\\\"\\n-        stage_manager.put(str(file), streamlit_stage_name, 4, True)\\n-        query_result = self._execute_query(\\n-            f\\\"call SYSTEM$GENERATE_STREAMLIT_URL_FROM_NAME('{streamlit_name}')\\\"\\n+        stage_manager.create(stage_name=stage_name)\\n+\\n+        root_location = stage_manager.get_standard_stage_name(\\n+            f\\\"{stage_name}/{streamlit_name}\\\"\\n         )\\n-        base_url = query_result.fetchone()[0]\\n-        url = self._get_url(base_url, qualified_name)\\n \\n-        if open_in_browser:\\n-            typer.launch(url)\\n-        else:\\n-            return url\\n+        stage_manager.put(main_file, root_location, 4, True)\\n+\\n+        if environment_file and environment_file.exists():\\n+            stage_manager.put(environment_file, root_location, 4, True)\\n+\\n+        if pages_dir and pages_dir.exists():\\n+            stage_manager.put(pages_dir / \\\"*\\\", f\\\"{root_location}/pages\\\", 4, True)\\n+\\n+        replace_stmt = \\\"OR REPLACE\\\" if replace else \\\"\\\"\\n+        use_warehouse_stmt = f\\\"QUERY_WAREHOUSE = {warehouse}\\\" if warehouse else \\\"\\\"\\n+        self._execute_query(\\n+            f\\\"\\\"\\\"\\n+            CREATE {replace_stmt} STREAMLIT {streamlit_name}\\n+            ROOT_LOCATION = '{root_location}'\\n+            MAIN_FILE = '{main_file.name}'\\n+            {use_warehouse_stmt}\\n+        \\\"\\\"\\\"\\n+        )\\n+\\n+        return self.get_url(streamlit_name)\\n \\n     def _packaging_workaround(\\n         self,\\n         streamlit_name: str,\\n+        stage_name: str,\\n         file: Path,\\n         packaging_workaround_includes_content: bool,\\n         pypi_download: str,\\n@@ -121,11 +104,11 @@ def _packaging_workaround(\\n         )\\n \\n         # upload the resulting app.zip file\\n-        stage_name = f\\\"{streamlit_name}_stage\\\"\\n+        stage_name = stage_name or f\\\"{streamlit_name}_stage\\\"\\n         stage_manager.put(\\\"app.zip\\\", stage_name, 4, True)\\n         main_module = str(file).replace(\\\".py\\\", \\\"\\\")\\n         file = generate_streamlit_package_wrapper(\\n-            stage_name=f\\\"{streamlit_name}_stage\\\",\\n+            stage_name=stage_name,\\n             main_module=main_module,\\n             extract_zip=packaging_workaround_includes_content,\\n         )\\n@@ -142,7 +125,10 @@ def _packaging_workaround(\\n         if env_file:\\n             stage_manager.put(str(env_file), stage_name, 4, True)\\n \\n-    def _get_url(self, base_url: str, qualified_name: str) -> str:\\n+    def get_url(self, streamlit_name: str) -> str:\\n+        qualified_name = self.qualified_name(streamlit_name)\\n+        base_url = self.get_url_from_name(streamlit_name)\\n+\\n         connection = self._conn\\n \\n         if not connection.host:\\n\",\"diff --git a/src/snowcli/cli/streamlit/commands.py b/src/snowcli/cli/streamlit/commands.py\\nindex a6238d6dd..d710518ac 100644\\n--- a/src/snowcli/cli/streamlit/commands.py\\n+++ b/src/snowcli/cli/streamlit/commands.py\\n@@ -29,7 +29,7 @@\\n StageNameOption: str = typer.Option(\\n     \\\"streamlit\\\",\\n     \\\"--stage\\\",\\n-    help=\\\"Stage name where are Streamlit files.\\\",\\n+    help=\\\"Stage name where Streamlit files will be uploaded.\\\",\\n )\\n \\n \\n@@ -38,12 +38,12 @@\\n @global_options\\n def streamlit_init(\\n     project_name: str = typer.Argument(\\n-        \\\"example_streamlit\\\", help=\\\"Name of the streamlit project you want to create.\\\"\\n+        \\\"example_streamlit\\\", help=\\\"Name of the Streamlit project you want to create.\\\"\\n     ),\\n     **options,\\n ) -> CommandResult:\\n     \\\"\\\"\\\"\\n-    Initializes this directory with a sample set of files for creating a streamlit dashboard.\\n+    Initializes this directory with a sample set of files for creating a Streamlit dashboard.\\n     \\\"\\\"\\\"\\n     create_project_template(\\\"default_streamlit\\\", project_directory=project_name)\\n     return MessageResult(f\\\"Initialized the new project in {project_name}/\\\")\\n\",\"diff --git a/src/snowcli/cli/streamlit/commands.py b/src/snowcli/cli/streamlit/commands.py\\nindex d710518ac..9c5cea395 100644\\n--- a/src/snowcli/cli/streamlit/commands.py\\n+++ b/src/snowcli/cli/streamlit/commands.py\\n@@ -4,6 +4,8 @@\\n from pathlib import Path\\n from typing import Optional\\n \\n+from click import ClickException\\n+\\n from snowcli.cli.common.decorators import global_options_with_connection, global_options\\n from snowcli.cli.common.flags import DEFAULT_CONTEXT_SETTINGS\\n from snowcli.cli.streamlit.manager import StreamlitManager\\n@@ -124,14 +126,14 @@ def streamlit_deploy(\\n     ),\\n     stage: Optional[str] = StageNameOption,\\n     environment_file: Path = typer.Option(\\n-        \\\"environment.yml\\\",\\n+        None,\\n         \\\"--env-file\\\",\\n         help=\\\"Environment file to use.\\\",\\n         file_okay=True,\\n         dir_okay=False,\\n     ),\\n     pages_dir: Path = typer.Option(\\n-        \\\"pages\\\",\\n+        None,\\n         \\\"--pages-dir\\\",\\n         help=\\\"Directory with Streamlit pages\\\",\\n         file_okay=False,\\n@@ -158,6 +160,16 @@ def streamlit_deploy(\\n     not exist.\\n     You can modify the behaviour using flags. For details check help information.\\n     \\\"\\\"\\\"\\n+    if environment_file and not environment_file.exists():\\n+        raise ClickException(f\\\"Provided file {environment_file} does not exist\\\")\\n+    else:\\n+        environment_file = Path(\\\"environment.yml\\\")\\n+\\n+    if pages_dir and not pages_dir.exists():\\n+        raise ClickException(f\\\"Provided file {pages_dir} does not exist\\\")\\n+    else:\\n+        pages_dir = Path(\\\"pages\\\")\\n+\\n     url = StreamlitManager().deploy(\\n         streamlit_name=streamlit_name,\\n         environment_file=environment_file,\\n\",\"diff --git a/src/snowcli/cli/streamlit/manager.py b/src/snowcli/cli/streamlit/manager.py\\nindex 8175e8929..54b9077a9 100644\\n--- a/src/snowcli/cli/streamlit/manager.py\\n+++ b/src/snowcli/cli/streamlit/manager.py\\n@@ -5,6 +5,7 @@\\n from pathlib import Path\\n from typing import List, Optional, Tuple\\n \\n+from click import ClickException\\n from snowflake.connector.cursor import SnowflakeCursor\\n \\n from snowcli.cli.common.sql_execution import SqlExecutionMixin\\n\"]", "test_patch": "[\"diff --git a/tests/streamlit/test_commands.py b/tests/streamlit/test_commands.py\\nindex 621176467..f272db100 100644\\n--- a/tests/streamlit/test_commands.py\\n+++ b/tests/streamlit/test_commands.py\\n@@ -11,219 +11,202 @@\\n \\n \\n @mock.patch(\\\"snowflake.connector.connect\\\")\\n-def test_create_streamlit(mock_connector, runner, mock_ctx):\\n+def test_list_streamlit(mock_connector, runner, mock_ctx):\\n     ctx = mock_ctx()\\n     mock_connector.return_value = ctx\\n \\n-    with NamedTemporaryFile(suffix=\\\".py\\\") as file:\\n-        result = runner.invoke_with_config(\\n-            [\\\"streamlit\\\", \\\"create\\\", STREAMLIT_NAME, \\\"--file\\\", file.name]\\n-        )\\n+    result = runner.invoke([\\\"streamlit\\\", \\\"list\\\"])\\n \\n-        assert result.exit_code == 0, result.output\\n-        assert ctx.get_query() == dedent(\\n-            f\\\"\\\"\\\"\\n-                create streamlit {STREAMLIT_NAME}\\n-            \\n-                MAIN_FILE = '{os.path.basename(file.name)}'\\n-                QUERY_WAREHOUSE = MockWarehouse;\\n-                \\n-                alter streamlit {STREAMLIT_NAME} checkout;\\n-            \\\"\\\"\\\"\\n-        )\\n+    assert result.exit_code == 0, result.output\\n+    assert ctx.get_query() == \\\"show streamlits\\\"\\n \\n \\n @mock.patch(\\\"snowflake.connector.connect\\\")\\n-def test_create_streamlit_with_use_packaging_workaround(\\n-    mock_connector, runner, mock_ctx\\n-):\\n+def test_describe_streamlit(mock_connector, runner, mock_ctx):\\n     ctx = mock_ctx()\\n     mock_connector.return_value = ctx\\n \\n-    with NamedTemporaryFile(suffix=\\\".py\\\") as file:\\n-        result = runner.invoke_with_config(\\n-            [\\n-                \\\"streamlit\\\",\\n-                \\\"create\\\",\\n-                STREAMLIT_NAME,\\n-                \\\"--file\\\",\\n-                file.name,\\n-                \\\"--use-packaging-workaround\\\",\\n-            ]\\n-        )\\n+    result = runner.invoke([\\\"streamlit\\\", \\\"describe\\\", STREAMLIT_NAME])\\n+\\n+    assert result.exit_code == 0, result.output\\n+    assert ctx.get_queries() == [\\n+        f\\\"describe streamlit {STREAMLIT_NAME}\\\",\\n+        f\\\"call SYSTEM$GENERATE_STREAMLIT_URL_FROM_NAME('{STREAMLIT_NAME}')\\\",\\n+    ]\\n \\n-        assert result.exit_code == 0, result.output\\n-        assert ctx.get_query() == dedent(\\n-            f\\\"\\\"\\\"\\n-                create streamlit {STREAMLIT_NAME}\\n-            \\n-                MAIN_FILE = 'streamlit_app_launcher.py'\\n-                QUERY_WAREHOUSE = MockWarehouse;\\n-                \\n-                alter streamlit {STREAMLIT_NAME} checkout;\\n-            \\\"\\\"\\\"\\n-        )\\n+\\n+def _put_query(source: str, dest: str):\\n+    return dedent(\\n+        f\\\"put file://{source} {dest} auto_compress=false parallel=4 overwrite=True\\\"\\n+    )\\n \\n \\n-@pytest.mark.parametrize(\\n-    \\\"stage, expected\\\",\\n-    [\\n-        (\\\"stage_name\\\", \\\"@stage_name\\\"),\\n-        (\\\"snow://stage_dots\\\", \\\"snow://stage_dots\\\"),\\n-    ],\\n-)\\n+@mock.patch(\\\"snowcli.cli.streamlit.commands.typer\\\")\\n @mock.patch(\\\"snowflake.connector.connect\\\")\\n-def test_create_streamlit_with_from_stage(\\n-    mock_connector, runner, mock_ctx, stage, expected\\n+def test_deploy_streamlit_single_file(\\n+    mock_connector, mock_typer, mock_cursor, runner, mock_ctx\\n ):\\n     ctx = mock_ctx()\\n     mock_connector.return_value = ctx\\n \\n     with NamedTemporaryFile(suffix=\\\".py\\\") as file:\\n         result = runner.invoke(\\n-            [\\n-                \\\"streamlit\\\",\\n-                \\\"create\\\",\\n-                STREAMLIT_NAME,\\n-                \\\"--file\\\",\\n-                file.name,\\n-                \\\"--from-stage\\\",\\n-                stage,\\n-            ]\\n+            [\\\"streamlit\\\", \\\"deploy\\\", STREAMLIT_NAME, \\\"--file\\\", file.name, \\\"--open\\\"]\\n         )\\n \\n-        assert result.exit_code == 0, result.output\\n-        assert ctx.get_query() == dedent(\\n+    assert result.exit_code == 0, result.output\\n+    assert ctx.get_queries() == [\\n+        \\\"create stage if not exists MOCKDATABASE.MOCKSCHEMA.STREAMLIT\\\",\\n+        _put_query(file.name, \\\"@MOCKDATABASE.MOCKSCHEMA.STREAMLIT/test_streamlit\\\"),\\n+        dedent(\\n             f\\\"\\\"\\\"\\n-                create streamlit {STREAMLIT_NAME}\\n-                FROM {expected}\\n-                MAIN_FILE = '{os.path.basename(file.name)}'\\n-                QUERY_WAREHOUSE = MockWarehouse;\\n-                \\n-                alter streamlit {STREAMLIT_NAME} checkout;\\n-            \\\"\\\"\\\"\\n-        )\\n+    CREATE  STREAMLIT {STREAMLIT_NAME}\\n+    ROOT_LOCATION = '@MOCKDATABASE.MOCKSCHEMA.STREAMLIT/{STREAMLIT_NAME}'\\n+    MAIN_FILE = '{Path(file.name).name}'\\n+\\n+    \\\"\\\"\\\"\\n+        ),\\n+        f\\\"call SYSTEM$GENERATE_STREAMLIT_URL_FROM_NAME('{STREAMLIT_NAME}')\\\",\\n+    ]\\n+\\n+    mock_typer.launch.assert_called_once_with(\\n+        f\\\"https://account.test.region.aws.snowflakecomputing.com/test.region.aws/account/#/streamlit-apps/MOCKDATABASE.MOCKSCHEMA.{STREAMLIT_NAME.upper()}\\\"\\n+    )\\n \\n \\n @mock.patch(\\\"snowflake.connector.connect\\\")\\n-def test_list_streamlit(mock_connector, runner, mock_ctx):\\n+def test_deploy_streamlit_all_files_default_stage(\\n+    mock_connector, mock_cursor, runner, mock_ctx, project_file\\n+):\\n     ctx = mock_ctx()\\n     mock_connector.return_value = ctx\\n \\n-    result = runner.invoke([\\\"streamlit\\\", \\\"list\\\"])\\n+    with project_file(\\\"example_streamlit\\\") as pdir:\\n+        result = runner.invoke(\\n+            [\\\"streamlit\\\", \\\"deploy\\\", STREAMLIT_NAME, \\\"--file\\\", \\\"main.py\\\"]\\n+        )\\n \\n+    root_path = f\\\"@MOCKDATABASE.MOCKSCHEMA.STREAMLIT/{STREAMLIT_NAME}\\\"\\n     assert result.exit_code == 0, result.output\\n-    assert ctx.get_query() == \\\"show streamlits\\\"\\n+    assert ctx.get_queries() == [\\n+        \\\"create stage if not exists MOCKDATABASE.MOCKSCHEMA.STREAMLIT\\\",\\n+        _put_query(\\\"main.py\\\", root_path),\\n+        _put_query(\\\"environment.yml\\\", root_path),\\n+        _put_query(\\\"pages/*\\\", f\\\"{root_path}/pages\\\"),\\n+        dedent(\\n+            f\\\"\\\"\\\"\\n+    CREATE  STREAMLIT {STREAMLIT_NAME}\\n+    ROOT_LOCATION = '@MOCKDATABASE.MOCKSCHEMA.STREAMLIT/{STREAMLIT_NAME}'\\n+    MAIN_FILE = 'main.py'\\n+\\n+    \\\"\\\"\\\"\\n+        ),\\n+        f\\\"call SYSTEM$GENERATE_STREAMLIT_URL_FROM_NAME('{STREAMLIT_NAME}')\\\",\\n+    ]\\n \\n \\n @mock.patch(\\\"snowflake.connector.connect\\\")\\n-def test_describe_streamlit(mock_connector, runner, mock_ctx):\\n+def test_deploy_streamlit_all_files_users_stage(\\n+    mock_connector, mock_cursor, runner, mock_ctx, project_file\\n+):\\n     ctx = mock_ctx()\\n     mock_connector.return_value = ctx\\n \\n-    result = runner.invoke([\\\"streamlit\\\", \\\"describe\\\", STREAMLIT_NAME])\\n+    with project_file(\\\"example_streamlit\\\") as pdir:\\n+        result = runner.invoke(\\n+            [\\n+                \\\"streamlit\\\",\\n+                \\\"deploy\\\",\\n+                STREAMLIT_NAME,\\n+                \\\"--file\\\",\\n+                \\\"main.py\\\",\\n+                \\\"--stage\\\",\\n+                \\\"MY_FANCY_STAGE\\\",\\n+            ]\\n+        )\\n \\n+    root_path = f\\\"@MOCKDATABASE.MOCKSCHEMA.MY_FANCY_STAGE/{STREAMLIT_NAME}\\\"\\n     assert result.exit_code == 0, result.output\\n     assert ctx.get_queries() == [\\n-        f\\\"describe streamlit {STREAMLIT_NAME}\\\",\\n+        \\\"create stage if not exists MOCKDATABASE.MOCKSCHEMA.MY_FANCY_STAGE\\\",\\n+        _put_query(\\\"main.py\\\", root_path),\\n+        _put_query(\\\"environment.yml\\\", root_path),\\n+        _put_query(\\\"pages/*\\\", f\\\"{root_path}/pages\\\"),\\n+        dedent(\\n+            f\\\"\\\"\\\"\\n+    CREATE  STREAMLIT {STREAMLIT_NAME}\\n+    ROOT_LOCATION = '@MOCKDATABASE.MOCKSCHEMA.MY_FANCY_STAGE/{STREAMLIT_NAME}'\\n+    MAIN_FILE = 'main.py'\\n+\\n+    \\\"\\\"\\\"\\n+        ),\\n         f\\\"call SYSTEM$GENERATE_STREAMLIT_URL_FROM_NAME('{STREAMLIT_NAME}')\\\",\\n     ]\\n \\n \\n-@mock.patch(\\\"snowcli.cli.streamlit.manager.typer\\\")\\n-@mock.patch(\\\"snowcli.cli.streamlit.manager.StageManager\\\")\\n @mock.patch(\\\"snowflake.connector.connect\\\")\\n-def test_deploy_streamlit(\\n-    mock_connector, mock_stage_manager, mock_typer, mock_cursor, runner, mock_ctx\\n+def test_deploy_streamlit_main_and_environment_files(\\n+    mock_connector, mock_cursor, runner, mock_ctx, project_file\\n ):\\n-    ctx = mock_ctx(\\n-        mock_cursor(\\n-            rows=[\\\"snowflake.com\\\"], columns=[\\\"SYSTEM$GENERATE_STREAMLIT_URL_FROM_NAME\\\"]\\n-        )\\n-    )\\n+    ctx = mock_ctx()\\n     mock_connector.return_value = ctx\\n \\n-    with NamedTemporaryFile(suffix=\\\".py\\\") as file:\\n+    with project_file(\\\"example_streamlit\\\") as pdir:\\n+\\n+        (pdir / \\\"pages\\\" / \\\"my_page.py\\\").unlink()\\n+        (pdir / \\\"pages\\\").rmdir()\\n+\\n         result = runner.invoke(\\n-            [\\\"streamlit\\\", \\\"deploy\\\", STREAMLIT_NAME, \\\"--file\\\", file.name, \\\"--open\\\"]\\n+            [\\\"streamlit\\\", \\\"deploy\\\", STREAMLIT_NAME, \\\"--file\\\", \\\"main.py\\\"]\\n         )\\n \\n-        assert result.exit_code == 0, result.output\\n-        assert (\\n-            ctx.get_query()\\n-            == f\\\"call SYSTEM$GENERATE_STREAMLIT_URL_FROM_NAME('{STREAMLIT_NAME}')\\\"\\n-        )\\n-        mock_stage_manager().put.assert_called_once_with(\\n-            file.name,\\n-            f\\\"snow://streamlit/MockDatabase.MockSchema.{STREAMLIT_NAME}/default_checkout\\\",\\n-            4,\\n-            True,\\n-        )\\n-        mock_typer.launch.assert_called_once_with(\\n-            f\\\"https://account.test.region.aws.snowflakecomputing.com/test.region.aws/account/#/streamlit-apps/MOCKDATABASE.MOCKSCHEMA.{STREAMLIT_NAME.upper()}\\\"\\n-        )\\n+    root_path = f\\\"@MOCKDATABASE.MOCKSCHEMA.STREAMLIT/{STREAMLIT_NAME}\\\"\\n+    assert result.exit_code == 0, result.output\\n+    assert ctx.get_queries() == [\\n+        \\\"create stage if not exists MOCKDATABASE.MOCKSCHEMA.STREAMLIT\\\",\\n+        _put_query(\\\"main.py\\\", root_path),\\n+        _put_query(\\\"environment.yml\\\", root_path),\\n+        dedent(\\n+            f\\\"\\\"\\\"\\n+    CREATE  STREAMLIT {STREAMLIT_NAME}\\n+    ROOT_LOCATION = '@MOCKDATABASE.MOCKSCHEMA.STREAMLIT/{STREAMLIT_NAME}'\\n+    MAIN_FILE = 'main.py'\\n+\\n+    \\\"\\\"\\\"\\n+        ),\\n+        f\\\"call SYSTEM$GENERATE_STREAMLIT_URL_FROM_NAME('{STREAMLIT_NAME}')\\\",\\n+    ]\\n \\n \\n-@mock.patch(\\\"snowcli.cli.streamlit.manager.snowpark_package\\\")\\n-@mock.patch(\\\"snowcli.cli.streamlit.manager.StageManager\\\")\\n @mock.patch(\\\"snowflake.connector.connect\\\")\\n-def test_deploy_streamlit_with_packaging_workaround(\\n-    mock_connector,\\n-    mock_stage_manager,\\n-    mock_snowpark_package,\\n-    mock_cursor,\\n-    runner,\\n-    mock_ctx,\\n-    temp_dir,\\n+def test_deploy_streamlit_main_and_pages_files(\\n+    mock_connector, mock_cursor, runner, mock_ctx, project_file\\n ):\\n-    ctx = mock_ctx(\\n-        mock_cursor(\\n-            rows=[\\\"snowflake.com\\\"], columns=[\\\"SYSTEM$GENERATE_STREAMLIT_URL_FROM_NAME\\\"]\\n-        )\\n-    )\\n+    ctx = mock_ctx()\\n     mock_connector.return_value = ctx\\n \\n-    with NamedTemporaryFile(suffix=\\\".py\\\") as file:\\n-        result = runner.invoke_with_config(\\n-            [\\n-                \\\"streamlit\\\",\\n-                \\\"deploy\\\",\\n-                STREAMLIT_NAME,\\n-                \\\"--file\\\",\\n-                file.name,\\n-                \\\"--use-packaging-workaround\\\",\\n-            ]\\n+    with project_file(\\\"example_streamlit\\\") as pdir:\\n+        (pdir / \\\"environment.yml\\\").unlink()\\n+        result = runner.invoke(\\n+            [\\\"streamlit\\\", \\\"deploy\\\", STREAMLIT_NAME, \\\"--file\\\", \\\"main.py\\\"]\\n         )\\n \\n-        assert result.exit_code == 0, result.output\\n-        assert (\\n-            ctx.get_query()\\n-            == f\\\"call SYSTEM$GENERATE_STREAMLIT_URL_FROM_NAME('{STREAMLIT_NAME}')\\\"\\n-        )\\n-        mock_snowpark_package.assert_called_once_with(\\\"ask\\\", True, \\\"ask\\\")\\n+    root_path = f\\\"@MOCKDATABASE.MOCKSCHEMA.STREAMLIT/{STREAMLIT_NAME}\\\"\\n+    assert result.exit_code == 0, result.output\\n+    assert ctx.get_queries() == [\\n+        \\\"create stage if not exists MOCKDATABASE.MOCKSCHEMA.STREAMLIT\\\",\\n+        _put_query(\\\"main.py\\\", root_path),\\n+        _put_query(\\\"pages/*\\\", f\\\"{root_path}/pages\\\"),\\n+        dedent(\\n+            f\\\"\\\"\\\"\\n+    CREATE  STREAMLIT {STREAMLIT_NAME}\\n+    ROOT_LOCATION = '@MOCKDATABASE.MOCKSCHEMA.STREAMLIT/{STREAMLIT_NAME}'\\n+    MAIN_FILE = 'main.py'\\n \\n-        mock_stage_manager().put.assert_has_calls(\\n-            [\\n-                call(\\n-                    \\\"app.zip\\\",\\n-                    f\\\"{STREAMLIT_NAME}_stage\\\",\\n-                    4,\\n-                    True,\\n-                ),\\n-                call(\\n-                    \\\"streamlit_app_launcher.py\\\",\\n-                    f\\\"{STREAMLIT_NAME}_stage\\\",\\n-                    4,\\n-                    True,\\n-                ),\\n-                call(\\n-                    file.name,\\n-                    f\\\"snow://streamlit/MockDatabase.MockSchema.{STREAMLIT_NAME}/default_checkout\\\",\\n-                    4,\\n-                    True,\\n-                ),\\n-            ]\\n-        )\\n+    \\\"\\\"\\\"\\n+        ),\\n+        f\\\"call SYSTEM$GENERATE_STREAMLIT_URL_FROM_NAME('{STREAMLIT_NAME}')\\\",\\n+    ]\\n \\n \\n @mock.patch(\\\"snowflake.connector.connect\\\")\\n\",\"diff --git a/tests/test_data/projects/example_streamlit/environment.yml b/tests/test_data/projects/example_streamlit/environment.yml\\nnew file mode 100644\\nindex 000000000..ac8feac3e\\n--- /dev/null\\n+++ b/tests/test_data/projects/example_streamlit/environment.yml\\n@@ -0,0 +1,5 @@\\n+name: sf_env\\n+channels:\\n+  - snowflake\\n+dependencies:\\n+  - pandas\\n\",\"diff --git a/tests/test_data/projects/example_streamlit/main.py b/tests/test_data/projects/example_streamlit/main.py\\nnew file mode 100644\\nindex 000000000..b699538d7\\n--- /dev/null\\n+++ b/tests/test_data/projects/example_streamlit/main.py\\n@@ -0,0 +1,3 @@\\n+import streamlit as st\\n+\\n+st.title(\\\"Example streamlit app\\\")\\n\",\"diff --git a/tests/test_data/projects/example_streamlit/pages/my_page.py b/tests/test_data/projects/example_streamlit/pages/my_page.py\\nnew file mode 100644\\nindex 000000000..bc3ecbccb\\n--- /dev/null\\n+++ b/tests/test_data/projects/example_streamlit/pages/my_page.py\\n@@ -0,0 +1,3 @@\\n+import streamlit as st\\n+\\n+st.title(\\\"Example page\\\")\\n\",\"diff --git a/tests/testing_utils/fixtures.py b/tests/testing_utils/fixtures.py\\nindex d409b853d..6988da271 100644\\n--- a/tests/testing_utils/fixtures.py\\n+++ b/tests/testing_utils/fixtures.py\\n@@ -1,4 +1,7 @@\\n import os\\n+import shutil\\n+from contextlib import contextmanager\\n+\\n import pytest\\n import tempfile\\n \\n@@ -200,3 +203,14 @@ def test_root_path():\\n def txt_file_in_a_subdir(temp_dir: str) -> Generator:\\n     subdir = tempfile.TemporaryDirectory(dir=temp_dir)\\n     yield create_temp_file(\\\".txt\\\", subdir.name, [])\\n+\\n+\\n+@pytest.fixture\\n+def project_file(temp_dir, test_root_path):\\n+    @contextmanager\\n+    def _temporary_project_file(project_name):\\n+        test_data_file = test_root_path / \\\"test_data\\\" / \\\"projects\\\" / project_name\\n+        shutil.copytree(test_data_file, temp_dir, dirs_exist_ok=True)\\n+        yield Path(temp_dir)\\n+\\n+    return _temporary_project_file\\n\",\"diff --git a/tests_integration/test_streamlit.py b/tests_integration/test_streamlit.py\\nindex 013b13b83..29c9b6458 100644\\n--- a/tests_integration/test_streamlit.py\\n+++ b/tests_integration/test_streamlit.py\\n@@ -20,11 +20,6 @@ def test_streamlit_create_and_deploy(\\n     streamlit_name = \\\"test_streamlit_create_and_deploy_snowcli\\\"\\n     streamlit_app_path = test_root_path / \\\"test_files/streamlit.py\\\"\\n \\n-    result = runner.invoke_integration(\\n-        [\\\"streamlit\\\", \\\"create\\\", streamlit_name, \\\"--file\\\", streamlit_app_path]\\n-    )\\n-    assert result.exit_code == 0\\n-\\n     result = runner.invoke_integration(\\n         [\\\"streamlit\\\", \\\"deploy\\\", streamlit_name, \\\"--file\\\", streamlit_app_path]\\n     )\\n@@ -69,6 +64,7 @@ def test_streamlit_create_and_deploy(\\n     assert row_from_snowflake_session(expect) == []\\n \\n \\n+@pytest.mark.skip(\\\"This a PrPr feature of Streamlit, this test can be reused in future\\\")\\n @pytest.mark.integration\\n def test_streamlit_create_from_stage(\\n     runner, snowflake_session, _new_streamlit_role, test_root_path\\n\",\"diff --git a/tests/streamlit/test_commands.py b/tests/streamlit/test_commands.py\\nindex f272db100..a1e88d45d 100644\\n--- a/tests/streamlit/test_commands.py\\n+++ b/tests/streamlit/test_commands.py\\n@@ -5,6 +5,8 @@\\n from unittest import mock\\n from unittest.mock import call\\n \\n+from click import ClickException\\n+\\n from tests.testing_utils.fixtures import *\\n \\n STREAMLIT_NAME = \\\"test_streamlit\\\"\\n@@ -209,6 +211,24 @@ def test_deploy_streamlit_main_and_pages_files(\\n     ]\\n \\n \\n+@pytest.mark.parametrize(\\n+    \\\"opts\\\", [(\\\"--pages-dir\\\", \\\"foo/bar\\\"), (\\\"--env-file\\\", \\\"foo.yml\\\")]\\n+)\\n+@mock.patch(\\\"snowflake.connector.connect\\\")\\n+def test_deploy_streamlit_nonexisting_file(\\n+    mock_connector, mock_cursor, runner, mock_ctx, project_file, opts\\n+):\\n+    ctx = mock_ctx()\\n+    mock_connector.return_value = ctx\\n+\\n+    with project_file(\\\"example_streamlit\\\") as pdir:\\n+        result = runner.invoke(\\n+            [\\\"streamlit\\\", \\\"deploy\\\", STREAMLIT_NAME, \\\"--file\\\", \\\"main.py\\\", *opts]\\n+        )\\n+\\n+        assert f\\\"Provided file {opts[1]} does not exist\\\" in result.output\\n+\\n+\\n @mock.patch(\\\"snowflake.connector.connect\\\")\\n def test_share_streamlit(mock_connector, runner, mock_ctx):\\n     ctx = mock_ctx()\\n\",\"diff --git a/tests_integration/test_streamlit.py b/tests_integration/test_streamlit.py\\nindex 29c9b6458..546c91bca 100644\\n--- a/tests_integration/test_streamlit.py\\n+++ b/tests_integration/test_streamlit.py\\n@@ -64,78 +64,6 @@ def test_streamlit_create_and_deploy(\\n     assert row_from_snowflake_session(expect) == []\\n \\n \\n-@pytest.mark.skip(\\\"This a PrPr feature of Streamlit, this test can be reused in future\\\")\\n-@pytest.mark.integration\\n-def test_streamlit_create_from_stage(\\n-    runner, snowflake_session, _new_streamlit_role, test_root_path\\n-):\\n-    stage_name = \\\"test_streamlit_create_from_stage\\\"\\n-    streamlit_name = \\\"test_streamlit_create_from_stage_snowcli\\\"\\n-    streamlit_filename = \\\"streamlit.py\\\"\\n-    streamlit_app_path = test_root_path / f\\\"test_files/{streamlit_filename}\\\"\\n-\\n-    expect = snowflake_session.execute_string(\\n-        f\\\"create stage {stage_name}; put file://{streamlit_app_path} @{stage_name} auto_compress=false overwrite=true;\\\"\\n-    )\\n-    assert contains_row_with(\\n-        rows_from_snowflake_session(expect)[1],\\n-        {\\n-            \\\"source\\\": streamlit_filename,\\n-            \\\"target\\\": streamlit_filename,\\n-            \\\"status\\\": \\\"UPLOADED\\\",\\n-        },\\n-    )\\n-\\n-    result = runner.invoke_integration(\\n-        [\\n-            \\\"streamlit\\\",\\n-            \\\"create\\\",\\n-            streamlit_name,\\n-            \\\"--file\\\",\\n-            streamlit_app_path,\\n-            \\\"--from-stage\\\",\\n-            stage_name,\\n-        ]\\n-    )\\n-    assert result.exit_code == 0\\n-\\n-    result = runner.invoke_integration([\\\"streamlit\\\", \\\"list\\\"])\\n-    expect = snowflake_session.execute_string(\\n-        f\\\"show streamlits like '{streamlit_name}'\\\"\\n-    )\\n-    assert contains_row_with(result.json, row_from_snowflake_session(expect)[0])\\n-\\n-    result = runner.invoke_integration([\\\"streamlit\\\", \\\"describe\\\", streamlit_name])\\n-    expect = snowflake_session.execute_string(f\\\"describe streamlit {streamlit_name}\\\")\\n-    assert contains_row_with(result.json[0], row_from_snowflake_session(expect)[0])\\n-    expect = snowflake_session.execute_string(\\n-        f\\\"call system$generate_streamlit_url_from_name('{streamlit_name}')\\\"\\n-    )\\n-    assert contains_row_with(result.json[1], row_from_snowflake_session(expect)[0])\\n-\\n-    result = runner.invoke_integration([\\\"streamlit\\\", \\\"share\\\", streamlit_name, \\\"public\\\"])\\n-    assert contains_row_with(\\n-        result.json,\\n-        {\\\"status\\\": \\\"Statement executed successfully.\\\"},\\n-    )\\n-    expect = snowflake_session.execute_string(\\n-        f\\\"use role {_new_streamlit_role}; show streamlits like '{streamlit_name}'; use role integration_tests;\\\"\\n-    )\\n-    assert contains_row_with(\\n-        rows_from_snowflake_session(expect)[1], {\\\"name\\\": streamlit_name.upper()}\\n-    )\\n-\\n-    result = runner.invoke_integration([\\\"streamlit\\\", \\\"drop\\\", streamlit_name])\\n-    assert contains_row_with(\\n-        result.json,\\n-        {\\\"status\\\": f\\\"{streamlit_name.upper()} successfully dropped.\\\"},\\n-    )\\n-    expect = snowflake_session.execute_string(\\n-        f\\\"show streamlits like '%{streamlit_name}%'\\\"\\n-    )\\n-    assert row_from_snowflake_session(expect) == []\\n-\\n-\\n @pytest.fixture\\n def _new_streamlit_role(snowflake_session, test_database):\\n     role_name = f\\\"snowcli_streamlit_role_{uuid.uuid4().hex}\\\"\"]", "hints_text": ""}
