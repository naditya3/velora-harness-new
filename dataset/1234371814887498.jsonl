{"instance_id": "1234371814887498", "repo": "jmbannon/ytdl-sub", "base_commit": "47890358218b658ced108e4ebe80f8a0c332cf5a", "problem_statement": "Create standardized music video prebuilt preset:\\nwith Kodi, Plex, JF support:\\r\\n\\r\\nreferences:\\r\\nhttps://support.plex.tv/articles/205568377-adding-local-artist-and-music-videos/", "FAIL_TO_PASS": ["tests/e2e/plugins/test_match_filters.py::TestFileConvert::test_match_filters_empty[True]", "tests/unit/cli/test_entrypoint.py::test_subscription_logs_write_to_file[False-False-False]", "tests/e2e/plugins/test_match_filters.py::TestFileConvert::test_match_filters_empty[False]", "tests/unit/cli/test_entrypoint.py::test_subscription_logs_write_to_file[False-True-False]", "tests/unit/config/test_subscription.py::test_music_video_subscriptions", "tests/unit/cli/test_entrypoint.py::test_subscription_logs_write_to_file[True-False-False]", "tests/e2e/plugins/test_regex.py::TestRegex::test_regex_fails_unequal_capture_group_names", "tests/unit/cli/test_entrypoint.py::test_subscription_logs_write_to_file[False-True-True]", "tests/unit/cli/test_output_transaction_log.py::test_transaction_log_to_file", "tests/unit/cli/test_entrypoint.py::test_subscription_logs_write_to_file[True-True-False]", "tests/e2e/plugins/test_regex.py::TestRegex::test_regex_fails_unequal_defaults", "tests/e2e/plugins/test_regex.py::TestRegex::test_regex_fails_capture_group_is_override_variable", "tests/e2e/plugins/test_regex.py::TestRegex::test_regex_fails_capture_group_is_source_variable", "tests/e2e/plugins/test_regex.py::TestRegex::test_regex_fails_capture_group_with_only_excludes", "tests/e2e/plugins/test_regex.py::TestRegex::test_regex_fails_source_variable_does_not_exist", "tests/unit/cli/test_output_transaction_log.py::test_suppress_transaction_log[output.log]", "tests/unit/cli/test_output_transaction_log.py::test_suppress_transaction_log[None]", "tests/e2e/plugins/test_match_filters.py::TestFileConvert::test_livestreams_download_filtered", "tests/e2e/plugins/test_regex.py::TestRegex::test_regex_fails_no_match_or_exclude", "tests/unit/cli/test_entrypoint.py::test_subscription_logs_write_to_file[True-True-True]", "tests/unit/cli/test_output_transaction_log.py::test_transaction_log_to_logger"], "PASS_TO_PASS": [], "language": "python", "test_command": "source /saved/ENV || source /saved/*/ENV && pytest --no-header -rA --tb=no -p no:cacheprovider --continue-on-collection-errors", "test_output_parser": "python/parse_log_pytest_v3", "image_storage_uri": "vmvm-registry.fbinfra.net/repomate_image_activ_pytest/jmbannon_ytdl-sub:47890358218b658ced108e4ebe80f8a0c332cf5a", "patch": "[\"diff --git a/src/ytdl_sub/prebuilt_presets/helpers/players.yaml b/src/ytdl_sub/prebuilt_presets/helpers/players.yaml\\nindex a0d62694d..a83fb213c 100644\\n--- a/src/ytdl_sub/prebuilt_presets/helpers/players.yaml\\n+++ b/src/ytdl_sub/prebuilt_presets/helpers/players.yaml\\n@@ -19,3 +19,8 @@ presets:\\n     overrides:\\n       file_uid: \\\"{uid_sanitized_plex}\\\"\\n       file_title: \\\"{title_sanitized_plex}\\\"\\n+\\n+  _plex_video_base:\\n+    preset:\\n+      - \\\"_plex_base\\\"\\n+    format: \\\"(bv*[ext=mp4][vcodec~='^((he|a)vc|h26[45])']+ba[ext=m4a]) / (bv[ext=mp4]*+ba[ext=m4a]/b)\\\"\\n\\\\ No newline at end of file\\n\",\"diff --git a/src/ytdl_sub/prebuilt_presets/music_videos/__init__.py b/src/ytdl_sub/prebuilt_presets/music_videos/__init__.py\\nnew file mode 100644\\nindex 000000000..35a9b0133\\n--- /dev/null\\n+++ b/src/ytdl_sub/prebuilt_presets/music_videos/__init__.py\\n@@ -0,0 +1,9 @@\\n+from ytdl_sub.prebuilt_presets import PrebuiltPresets\\n+\\n+\\n+class MusicVideoPresets(PrebuiltPresets):\\n+    preset_names = {\\n+        \\\"Kodi Music Videos\\\",\\n+        \\\"Jellyfin Music Videos\\\",\\n+        \\\"Plex Music Videos\\\",\\n+    }\\n\",\"diff --git a/src/ytdl_sub/prebuilt_presets/music_videos/kodi_music_videos.yaml b/src/ytdl_sub/prebuilt_presets/music_videos/kodi_music_videos.yaml\\ndeleted file mode 100644\\nindex 9de23e5c3..000000000\\n--- a/src/ytdl_sub/prebuilt_presets/music_videos/kodi_music_videos.yaml\\n+++ /dev/null\\n@@ -1,29 +0,0 @@\\n-presets:\\n-  # TODO: Update this\\n-  kodi_music_video:\\n-    download:\\n-      - \\\"{music_video_url}\\\"\\n-\\n-    output_options:\\n-      output_directory: \\\"{music_video_directory}\\\"\\n-      file_name: \\\"{music_video_file_name}.{ext}\\\"\\n-      thumbnail_name: \\\"{music_video_file_name}-thumb.jpg\\\"\\n-\\n-    nfo_tags:\\n-      nfo_name: \\\"{music_video_name}.nfo\\\"\\n-      nfo_root: \\\"musicvideo\\\"\\n-      kodi_safe: True\\n-      tags:\\n-        artist: \\\"{music_video_artist}\\\"\\n-        title: \\\"{music_video_title}\\\"\\n-        album: \\\"{music_video_album}\\\"\\n-        year: \\\"{music_video_year}\\\"\\n-\\n-    overrides:\\n-#   MUST DEFINE:\\n-#     music_video_artist\\n-#     music_video_directory\\n-      music_video_title: \\\"{title}\\\"\\n-      music_video_album: \\\"Music Videos\\\"\\n-      music_video_year: \\\"{upload_year}\\\"\\n-      music_video_file_name: \\\"{artist_sanitized}/{music_video_year} - {music_video_title_sanitized}\\\"\\n\",\"diff --git a/src/ytdl_sub/prebuilt_presets/music_videos/music_videos.yaml b/src/ytdl_sub/prebuilt_presets/music_videos/music_videos.yaml\\nnew file mode 100644\\nindex 000000000..641fcfef5\\n--- /dev/null\\n+++ b/src/ytdl_sub/prebuilt_presets/music_videos/music_videos.yaml\\n@@ -0,0 +1,71 @@\\n+presets:\\n+  _music_video_base:\\n+    download:\\n+      - \\\"{url}\\\"\\n+\\n+    output_options:\\n+      output_directory: \\\"{music_video_directory}\\\"\\n+      file_name: \\\"{music_video_file_name}.{ext}\\\"\\n+      thumbnail_name: \\\"{music_video_file_name}.jpg\\\"\\n+\\n+    overrides:\\n+#   MUST DEFINE:\\n+#     music_video_directory\\n+\\n+      # Defaults\\n+      music_video_genre_default: \\\"ytdl-sub\\\"\\n+      music_video_album_default: \\\"Music Videos\\\"\\n+\\n+      # Subscription overrides\\n+      subscription_indent_1: \\\"{music_video_genre_default}\\\"\\n+      url: \\\"{subscription_value}\\\"\\n+\\n+      # Music Video Overrides\\n+      music_video_title: \\\"{title}\\\"\\n+      music_video_album: \\\"{music_video_album_default}\\\"\\n+      music_video_artist: \\\"{subscription_name}\\\"\\n+      music_video_year: \\\"{upload_year}\\\"\\n+      music_video_date: \\\"{upload_date_standardized}\\\"\\n+      music_video_genre: \\\"{subscription_indent_1}\\\"\\n+\\n+      # Directory Overrides\\n+      music_video_file_name: \\\"{music_video_artist_sanitized}/{music_video_title_sanitized}\\\"\\n+\\n+  _music_video_nfo:\\n+    nfo_tags:\\n+      nfo_name: \\\"{music_video_file_name}.nfo\\\"\\n+      nfo_root: \\\"musicvideo\\\"\\n+      tags:\\n+        artist: \\\"{music_video_artist}\\\"\\n+        title: \\\"{music_video_title}\\\"\\n+        album: \\\"{music_video_album}\\\"\\n+        # Kodi v20 to not use year, so removing\\n+        premiered: \\\"{music_video_date}\\\"\\n+\\n+  _music_video_tags:\\n+    video_tags:\\n+      artist: \\\"{music_video_artist}\\\"\\n+      title: \\\"{music_video_title}\\\"\\n+      album: \\\"{music_video_album}\\\"\\n+      year: \\\"{music_video_year}\\\"\\n+      premiered: \\\"{music_video_date}\\\"\\n+\\n+  \\\"Jellyfin Music Videos\\\":\\n+    preset:\\n+      - \\\"_base\\\"\\n+      - \\\"_music_video_base\\\"\\n+      - \\\"_music_video_nfo\\\"\\n+      - \\\"_music_video_tags\\\"\\n+\\n+  \\\"Kodi Music Videos\\\":\\n+    preset:\\n+      - \\\"_kodi_base\\\"\\n+      - \\\"_music_video_base\\\"\\n+      - \\\"_music_video_nfo\\\"\\n+      - \\\"_music_video_tags\\\"\\n+\\n+  \\\"Plex Music Videos\\\":\\n+    preset:\\n+      - \\\"_plex_video_base\\\"\\n+      - \\\"_music_video_base\\\"\\n+      - \\\"_music_video_tags\\\"\\n\\\\ No newline at end of file\\n\",\"diff --git a/src/ytdl_sub/prebuilt_presets/tv_show/tv_show.yaml b/src/ytdl_sub/prebuilt_presets/tv_show/tv_show.yaml\\nindex 09e3cfe73..b64ed0806 100644\\n--- a/src/ytdl_sub/prebuilt_presets/tv_show/tv_show.yaml\\n+++ b/src/ytdl_sub/prebuilt_presets/tv_show/tv_show.yaml\\n@@ -3,10 +3,9 @@ presets:\\n \\n   _plex_tv_show: # Default Highest Resolution, No AV1, which is not currently supported by plex\\n     preset:\\n-      - \\\"_plex_base\\\"\\n+      - \\\"_plex_video_base\\\"\\n       - \\\"_episode_base\\\"\\n       - \\\"_episode_video_tags\\\"\\n-    format: \\\"(bv*[ext=mp4][vcodec~='^((he|a)vc|h26[45])']+ba[ext=m4a]) / (bv[ext=mp4]*+ba[ext=m4a]/b)\\\"\\n     overrides:\\n       tv_show_poster_file_name: \\\"poster.jpg\\\"\\n       tv_show_fanart_file_name: \\\"fanart.jpg\\\"\\n\",\"diff --git a/src/ytdl_sub/prebuilt_presets/music_videos/music_videos.yaml b/src/ytdl_sub/prebuilt_presets/music_videos/music_videos.yaml\\nindex 641fcfef5..84f780bda 100644\\n--- a/src/ytdl_sub/prebuilt_presets/music_videos/music_videos.yaml\\n+++ b/src/ytdl_sub/prebuilt_presets/music_videos/music_videos.yaml\\n@@ -39,6 +39,8 @@ presets:\\n         artist: \\\"{music_video_artist}\\\"\\n         title: \\\"{music_video_title}\\\"\\n         album: \\\"{music_video_album}\\\"\\n+        genre:\\n+          - \\\"{music_video_genre}\\\"\\n         # Kodi v20 to not use year, so removing\\n         premiered: \\\"{music_video_date}\\\"\\n \\n@@ -47,6 +49,7 @@ presets:\\n       artist: \\\"{music_video_artist}\\\"\\n       title: \\\"{music_video_title}\\\"\\n       album: \\\"{music_video_album}\\\"\\n+      genre: \\\"{music_video_genre}\\\"\\n       year: \\\"{music_video_year}\\\"\\n       premiered: \\\"{music_video_date}\\\"\\n \\n\",\"diff --git a/examples/music_subscriptions.yaml b/examples/music_subscriptions.yaml\\nindex d0c1a1842..4f6f07299 100644\\n--- a/examples/music_subscriptions.yaml\\n+++ b/examples/music_subscriptions.yaml\\n@@ -10,7 +10,7 @@\\n #         02 - Another Track.mp3\\n #         folder.jpg\\n \\n-# Overrides to the prebuilt presets\\n+# Override variables globally for all subscriptions\\n __preset__:\\n   overrides:\\n     music_directory: \\\"/music\\\"\\n\",\"diff --git a/examples/music_video_subscriptions.yaml b/examples/music_video_subscriptions.yaml\\nnew file mode 100644\\nindex 000000000..330d1ef99\\n--- /dev/null\\n+++ b/examples/music_video_subscriptions.yaml\\n@@ -0,0 +1,25 @@\\n+# Files will be stored in the form of:\\n+#\\n+#   music_videos/\\n+#     Elton John/\\n+#       Elton John - Rocketman.jpg\\n+#       Elton John - Rocketman.mp4\\n+#    System of a Down/\\n+#       System of a Down - Chop Suey.jpg\\n+#       System of a Down - Chop Suey.mp4\\n+#       ...\\n+\\n+# Override variables globally for all subscriptions\\n+__preset__:\\n+  overrides:\\n+    music_video_directory: \\\"/music_videos\\\"\\n+\\n+# Choose between Jellyfin/Kodi/Plex Music Videos\\n+# \\\"Jellyfin Music Videos\\\":\\n+# \\\"Kodi Music Videos\\\":\\n+\\\"Plex Music Videos\\\":\\n+  = Pop:  # Sets genre tag to \\\"Pop\\\"\\n+    \\\"Rick Astley\\\": \\\"https://www.youtube.com/playlist?list=PLlaN88a7y2_plecYoJxvRFTLHVbIVAOoc\\\"\\n+    \\\"Michael Jackson\\\": \\\"https://www.youtube.com/playlist?list=OLAK5uy_mnY03zP6abNWH929q2XhGzWD_2uKJ_n8E\\\"\\n+  = Blues:\\n+    \\\"Eric Clapton\\\": \\\"https://www.youtube.com/playlist?list=PLABGggHhsbEeaRtdzqnxYoEINsJE_4GF4\\\"\\n\",\"diff --git a/examples/music_videos_subscriptions.yaml b/examples/music_videos_subscriptions.yaml\\ndeleted file mode 100644\\nindex f147b487f..000000000\\n--- a/examples/music_videos_subscriptions.yaml\\n+++ /dev/null\\n@@ -1,24 +0,0 @@\\n-###############################################################################\\n-# DOWNLOAD MUSIC VIDEO PLAYLIST\\n-john_smith:\\n-  preset: \\\"music_video\\\"\\n-  overrides:\\n-    url: \\\"https://youtube.com/playlist?list=UCsvn_Po0SmunchJYtttWpOxMg\\\"\\n-    artist: \\\"John Smith and the Instrument Players\\\"\\n-\\n-###############################################################################\\n-# DOWNLOAD SINGLE MUSIC VIDEO VIA CLI\\n-\\n-# It is not always ideal to download all of an artist's music videos.\\n-# Maybe you only like one song of theirs. We can reuse our preset\\n-# to download a single video instead.\\n-#\\n-# Of course, defining yaml configuration to download a single video once\\n-# and never again seems weird. Instead, we can perform this download via\\n-# command-line:\\n-#\\n-#     ytdl-sub dl                                                        \\\\\\n-#         --preset \\\"music_video\\\"                                         \\\\\\n-#         --overrides.url \\\"https://youtube.com/watch?v=QhY6r6oAErg\\\"      \\\\\\n-#         --overrides.artist \\\"John Smith and the Instrument Players\\\"\\n-#\\n\",\"diff --git a/src/ytdl_sub/prebuilt_presets/music_videos/music_videos.yaml b/src/ytdl_sub/prebuilt_presets/music_videos/music_videos.yaml\\nindex 84f780bda..47c97996a 100644\\n--- a/src/ytdl_sub/prebuilt_presets/music_videos/music_videos.yaml\\n+++ b/src/ytdl_sub/prebuilt_presets/music_videos/music_videos.yaml\\n@@ -7,6 +7,10 @@ presets:\\n       output_directory: \\\"{music_video_directory}\\\"\\n       file_name: \\\"{music_video_file_name}.{ext}\\\"\\n       thumbnail_name: \\\"{music_video_file_name}.jpg\\\"\\n+      maintain_download_archive: True\\n+\\n+    ytdl_options:\\n+      break_on_existing: True\\n \\n     overrides:\\n #   MUST DEFINE:\\n\",\"diff --git a/src/ytdl_sub/config/config_validator.py b/src/ytdl_sub/config/config_validator.py\\nindex 3969ff8df..b2ed0aefa 100644\\n--- a/src/ytdl_sub/config/config_validator.py\\n+++ b/src/ytdl_sub/config/config_validator.py\\n@@ -178,7 +178,7 @@ def dl_aliases(self) -> Optional[Dict[str, str]]:\\n \\n         .. code-block:: bash\\n \\n-           ytdl-sub dl --preset \\\"music_video\\\" --download.url \\\"youtube.com/watch?v=a1b2c3\\\"\\n+           ytdl-sub dl --preset \\\"Jellyfin Music Videos\\\" --download.url \\\"youtube.com/watch?v=a1b2c3\\\"\\n \\n         to\\n \\n\",\"diff --git a/src/ytdl_sub/plugins/output_directory_nfo_tags.py b/src/ytdl_sub/plugins/output_directory_nfo_tags.py\\nindex d1e23ab1a..de8ae4cad 100644\\n--- a/src/ytdl_sub/plugins/output_directory_nfo_tags.py\\n+++ b/src/ytdl_sub/plugins/output_directory_nfo_tags.py\\n@@ -70,10 +70,7 @@ def tags(self) -> NfoTagsValidator:\\n                - tag: \\\"{source_title}\\\"\\n                  attributes:\\n                    number: \\\"{collection_index}\\\"\\n-                 behavior: \\\"merge\\\"\\n              genre:\\n-               - tag: \\\"Comedy\\\"\\n-                 behavior: \\\"overwrite\\\"\\n                - \\\"Comedy\\\"\\n                - \\\"Drama\\\"\\n \\n\",\"diff --git a/src/ytdl_sub/prebuilt_presets/music/music.yaml b/src/ytdl_sub/prebuilt_presets/music/music.yaml\\nindex e552946a8..ee1a290fc 100644\\n--- a/src/ytdl_sub/prebuilt_presets/music/music.yaml\\n+++ b/src/ytdl_sub/prebuilt_presets/music/music.yaml\\n@@ -40,6 +40,7 @@ presets:\\n \\n       # Subscription overrides\\n       subscription_indent_1: \\\"{track_genre_default}\\\"\\n+      subscription_value: \\\"\\\"\\n       url: \\\"{subscription_value}\\\"\\n \\n       # Track Overrides\\n\",\"diff --git a/src/ytdl_sub/prebuilt_presets/music_videos/music_videos.yaml b/src/ytdl_sub/prebuilt_presets/music_videos/music_videos.yaml\\nindex 47c97996a..dc93fc2e0 100644\\n--- a/src/ytdl_sub/prebuilt_presets/music_videos/music_videos.yaml\\n+++ b/src/ytdl_sub/prebuilt_presets/music_videos/music_videos.yaml\\n@@ -22,6 +22,7 @@ presets:\\n \\n       # Subscription overrides\\n       subscription_indent_1: \\\"{music_video_genre_default}\\\"\\n+      subscription_value: \\\"\\\"\\n       url: \\\"{subscription_value}\\\"\\n \\n       # Music Video Overrides\\n\",\"diff --git a/src/ytdl_sub/prebuilt_presets/tv_show/tv_show.yaml b/src/ytdl_sub/prebuilt_presets/tv_show/tv_show.yaml\\nindex b64ed0806..9ec8c5b8e 100644\\n--- a/src/ytdl_sub/prebuilt_presets/tv_show/tv_show.yaml\\n+++ b/src/ytdl_sub/prebuilt_presets/tv_show/tv_show.yaml\\n@@ -60,6 +60,7 @@ presets:\\n       - url: \\\"{url19}\\\"\\n       - url: \\\"{url20}\\\"\\n     overrides:\\n+      subscription_value: \\\"\\\"\\n       url: \\\"{subscription_value}\\\"\\n       url2: \\\"\\\"\\n       url3: \\\"\\\"\\n\",\"diff --git a/src/ytdl_sub/utils/ffmpeg.py b/src/ytdl_sub/utils/ffmpeg.py\\nindex a3aa75b3d..6d16814d3 100644\\n--- a/src/ytdl_sub/utils/ffmpeg.py\\n+++ b/src/ytdl_sub/utils/ffmpeg.py\\n@@ -202,7 +202,7 @@ def add_ffmpeg_metadata_key_values(file_path: str, key_values: Dict[str, str]) -\\n     ]\\n     for key, value in key_values.items():\\n         ffmpeg_args.extend([\\\"-metadata\\\", f\\\"{key}={value}\\\"])\\n-    ffmpeg_args.extend([\\\"-codec\\\", \\\"copy\\\", tmp_file_path])\\n+    ffmpeg_args.extend([\\\"-codec\\\", \\\"copy\\\", \\\"-bitexact\\\", tmp_file_path])\\n \\n     FFMPEG.run(ffmpeg_args)\\n     FileHandler.move(tmp_file_path, file_path)\\n\"]", "test_patch": "", "hints_text": ""}
