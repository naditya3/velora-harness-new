{"instance_id": "2856896824510013", "repo": "grindsa/acme2certifier", "base_commit": "49dbd4b377214ffc026259ab9b1a6db148d0b968", "problem_statement": "Suggestion for new CA handler: Windows Client Certificate Enrollment Protocol (MS-WCCE) via RPC/DCOM:\\nCurrently, `acme2certifier` supports the [Microsoft Certification Authority Web Enrollment Service](https://github.com/grindsa/acme2certifier/blob/master/docs/mscertsrv.md) via HTTPS. It would be great to also support the [Windows Client Certificate Enrollment Protocol](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-wcce) over DCOM.\\r\\n\\r\\nThe implementation could take the code from https://github.com/ly4k/Certipy as an inspiration, which itself uses [impacket](https://pypi.org/project/impacket/).\\r\\n\\r\\nI would be happy to create a PR for this handler.", "FAIL_TO_PASS": ["test/test_msca_handler.py::TestACMEHandler::test_030_config_load"], "PASS_TO_PASS": [], "language": "python", "test_command": "source /saved/ENV || source /saved/*/ENV && pytest --no-header -rA --tb=no -p no:cacheprovider --continue-on-collection-errors", "test_output_parser": "python/parse_log_pytest_v3", "image_storage_uri": "vmvm-registry.fbinfra.net/repomate_image_activ_pytest/grindsa_acme2certifier:49dbd4b377214ffc026259ab9b1a6db148d0b968", "patch": "", "test_patch": "[\"diff --git a/test/test_msca_handler.py b/test/test_msca_handler.py\\nindex 8ed21a66..65f3243a 100644\\n--- a/test/test_msca_handler.py\\n+++ b/test/test_msca_handler.py\\n@@ -319,7 +319,7 @@ def test_029_config_load(self, mock_load_cfg, mock_json, mock_chk):\\n     @patch('json.loads')\\n     @patch('examples.ca_handler.mscertsrv_ca_handler.load_config')\\n     def test_030_config_load(self, mock_load_cfg, mock_json, mock_chk):\\n-        \\\"\\\"\\\" test _config_load ca_handler configured load proxies \\\"\\\"\\\"\\n+        \\\"\\\"\\\" test _config_load ca_handler configured load proxies failed with exception in json.load \\\"\\\"\\\"\\n         mock_load_cfg.return_value = {'DEFAULT': {'proxy_server_list': 'foo'}}\\n         mock_json.side_effect = Exception('exc_load_config')\\n         mock_chk.side = 'proxy.bar.local'\\n@@ -328,7 +328,7 @@ def test_030_config_load(self, mock_load_cfg, mock_json, mock_chk):\\n         self.assertTrue(mock_json.called)\\n         self.assertFalse(mock_chk.called)\\n         self.assertFalse(self.cahandler.proxy )\\n-        self.assertIn('WARNING:test_a2c:Challenge._config_load() proxy_server_list failed with error: exc_load_config', lcm.output)\\n+        self.assertIn('WARNING:test_a2c:CAhandler._config_load() proxy_server_list failed with error: exc_load_config', lcm.output)\\n \\n     def test_031_revoke(self):\\n         \\\"\\\"\\\" test revocation \\\"\\\"\\\"\\n\",\"diff --git a/test/test_mswcce_ca_handler.py b/test/test_mswcce_ca_handler.py\\nnew file mode 100644\\nindex 00000000..d9369733\\n--- /dev/null\\n+++ b/test/test_mswcce_ca_handler.py\\n@@ -0,0 +1,526 @@\\n+#!/usr/bin/python\\n+# -*- coding: utf-8 -*-\\n+\\\"\\\"\\\" unittests for openssl_ca_handler \\\"\\\"\\\"\\n+# pylint: disable=C0415, R0904, R0913, W0212\\n+import sys\\n+import unittest\\n+from unittest.mock import patch, mock_open, Mock\\n+\\n+sys.path.insert(0, '.')\\n+sys.path.insert(1, '..')\\n+\\n+\\n+class TestACMEHandler(unittest.TestCase):\\n+    \\\"\\\"\\\" test class for mswcce_ca_handler \\\"\\\"\\\"\\n+    def setUp(self):\\n+        \\\"\\\"\\\" setup unittest \\\"\\\"\\\"\\n+        import logging\\n+        from examples.ca_handler.mswcce_ca_handler import CAhandler\\n+        logging.basicConfig(level=logging.CRITICAL)\\n+        self.logger = logging.getLogger('test_a2c')\\n+        self.cahandler = CAhandler(False, self.logger)\\n+\\n+    def tearDown(self):\\n+        \\\"\\\"\\\" teardown \\\"\\\"\\\"\\n+        pass\\n+\\n+    def test_001_default(self):\\n+        \\\"\\\"\\\" default test which always passes \\\"\\\"\\\"\\n+        self.assertEqual('foo', 'foo')\\n+\\n+    @patch('examples.ca_handler.mswcce_ca_handler.load_config')\\n+    def test_002_config_load(self, mock_load_cfg):\\n+        \\\"\\\"\\\" test _config_load no cahandler section \\\"\\\"\\\"\\n+        mock_load_cfg.return_value = {}\\n+        self.cahandler._config_load()\\n+        self.assertFalse(self.cahandler.host)\\n+        self.assertFalse(self.cahandler.user)\\n+        self.assertFalse(self.cahandler.password)\\n+        self.assertFalse(self.cahandler.template)\\n+        self.assertFalse(self.cahandler.proxy)\\n+        self.assertFalse(self.cahandler.target_domain)\\n+        self.assertFalse(self.cahandler.domain_controller)\\n+        self.assertFalse(self.cahandler.ca_name)\\n+        self.assertFalse(self.cahandler.ca_bundle)\\n+\\n+    @patch('examples.ca_handler.mswcce_ca_handler.load_config')\\n+    def test_003_config_load(self, mock_load_cfg):\\n+        \\\"\\\"\\\" test _config_load wrongly configured cahandler section \\\"\\\"\\\"\\n+        mock_load_cfg.return_value = {'CAhandler': {'foo': 'bar'}}\\n+        self.cahandler._config_load()\\n+        self.assertFalse(self.cahandler.host)\\n+        self.assertFalse(self.cahandler.user)\\n+        self.assertFalse(self.cahandler.password)\\n+        self.assertFalse(self.cahandler.template)\\n+        self.assertFalse(self.cahandler.proxy)\\n+        self.assertFalse(self.cahandler.target_domain)\\n+        self.assertFalse(self.cahandler.domain_controller)\\n+        self.assertFalse(self.cahandler.ca_name)\\n+        self.assertFalse(self.cahandler.ca_bundle)\\n+\\n+    @patch.dict('os.environ', {'host_var': 'host_var'})\\n+    @patch('examples.ca_handler.mswcce_ca_handler.load_config')\\n+    def test_004_config_load(self, mock_load_cfg):\\n+        \\\"\\\"\\\" test _config_load - load host from variable \\\"\\\"\\\"\\n+        mock_load_cfg.return_value = {'CAhandler': {'host_variable': 'host_var'}}\\n+        self.cahandler._config_load()\\n+        self.assertEqual('host_var', self.cahandler.host)\\n+        self.assertFalse(self.cahandler.user)\\n+        self.assertFalse(self.cahandler.password)\\n+        self.assertFalse(self.cahandler.template)\\n+        self.assertFalse(self.cahandler.proxy)\\n+        self.assertFalse(self.cahandler.target_domain)\\n+        self.assertFalse(self.cahandler.domain_controller)\\n+        self.assertFalse(self.cahandler.ca_name)\\n+        self.assertFalse(self.cahandler.ca_bundle)\\n+\\n+    @patch.dict('os.environ', {'host_var': 'host_var'})\\n+    @patch('examples.ca_handler.mswcce_ca_handler.load_config')\\n+    def test_005_config_load(self, mock_load_cfg):\\n+        \\\"\\\"\\\" test _config_load - load host from not_existing variable \\\"\\\"\\\"\\n+        mock_load_cfg.return_value = {'CAhandler': {'host_variable': 'unk'}}\\n+        with self.assertLogs('test_a2c', level='INFO') as lcm:\\n+            self.cahandler._config_load()\\n+        self.assertFalse(self.cahandler.host)\\n+        self.assertFalse(self.cahandler.user)\\n+        self.assertFalse(self.cahandler.password)\\n+        self.assertFalse(self.cahandler.template)\\n+        self.assertFalse(self.cahandler.proxy)\\n+        self.assertFalse(self.cahandler.target_domain)\\n+        self.assertFalse(self.cahandler.domain_controller)\\n+        self.assertFalse(self.cahandler.ca_name)\\n+        self.assertFalse(self.cahandler.ca_bundle)\\n+        self.assertIn(\\\"ERROR:test_a2c:CAhandler._config_load() could not load host_variable:'unk'\\\", lcm.output)\\n+\\n+    @patch.dict('os.environ', {'host_var': 'host_var'})\\n+    @patch('examples.ca_handler.mswcce_ca_handler.load_config')\\n+    def test_006_config_load(self, mock_load_cfg):\\n+        \\\"\\\"\\\" test _config_load - overwrite host variable \\\"\\\"\\\"\\n+        mock_load_cfg.return_value = {'CAhandler': {'host_variable': 'host_var', 'host': 'host_local'}}\\n+        with self.assertLogs('test_a2c', level='INFO') as lcm:\\n+            self.cahandler._config_load()\\n+        self.assertEqual('host_local', self.cahandler.host)\\n+        self.assertFalse(self.cahandler.user)\\n+        self.assertFalse(self.cahandler.password)\\n+        self.assertFalse(self.cahandler.template)\\n+        self.assertFalse(self.cahandler.proxy)\\n+        self.assertFalse(self.cahandler.target_domain)\\n+        self.assertFalse(self.cahandler.domain_controller)\\n+        self.assertFalse(self.cahandler.ca_name)\\n+        self.assertFalse(self.cahandler.ca_bundle)\\n+        self.assertIn('INFO:test_a2c:CAhandler._config_load() overwrite host', lcm.output)\\n+\\n+    @patch('examples.ca_handler.mswcce_ca_handler.load_config')\\n+    def test_007_config_load(self, mock_load_cfg):\\n+        \\\"\\\"\\\" test _config_load - load host from config file \\\"\\\"\\\"\\n+        mock_load_cfg.return_value = {'CAhandler': {'host': 'host_local'}}\\n+        self.cahandler._config_load()\\n+        self.assertEqual('host_local', self.cahandler.host)\\n+        self.assertFalse(self.cahandler.user)\\n+        self.assertFalse(self.cahandler.password)\\n+        self.assertFalse(self.cahandler.template)\\n+        self.assertFalse(self.cahandler.proxy)\\n+        self.assertFalse(self.cahandler.target_domain)\\n+        self.assertFalse(self.cahandler.domain_controller)\\n+        self.assertFalse(self.cahandler.ca_name)\\n+        self.assertFalse(self.cahandler.ca_bundle)\\n+\\n+    @patch.dict('os.environ', {'user_var': 'user_var'})\\n+    @patch('examples.ca_handler.mswcce_ca_handler.load_config')\\n+    def test_008_config_load(self, mock_load_cfg):\\n+        \\\"\\\"\\\" test _config_load - load user from variable \\\"\\\"\\\"\\n+        mock_load_cfg.return_value = {'CAhandler': {'user_variable': 'user_var'}}\\n+        self.cahandler._config_load()\\n+        self.assertFalse(self.cahandler.host)\\n+        self.assertEqual('user_var', self.cahandler.user)\\n+        self.assertFalse(self.cahandler.password)\\n+        self.assertFalse(self.cahandler.template)\\n+        self.assertFalse(self.cahandler.proxy)\\n+        self.assertFalse(self.cahandler.target_domain)\\n+        self.assertFalse(self.cahandler.domain_controller)\\n+        self.assertFalse(self.cahandler.ca_name)\\n+        self.assertFalse(self.cahandler.ca_bundle)\\n+\\n+    @patch.dict('os.environ', {'user_var': 'user_var'})\\n+    @patch('examples.ca_handler.mswcce_ca_handler.load_config')\\n+    def test_009_config_load(self, mock_load_cfg):\\n+        \\\"\\\"\\\" test _config_load - load user from not existing variable \\\"\\\"\\\"\\n+        mock_load_cfg.return_value = {'CAhandler': {'user_variable': 'unk'}}\\n+        with self.assertLogs('test_a2c', level='INFO') as lcm:\\n+            self.cahandler._config_load()\\n+        self.assertFalse(self.cahandler.host)\\n+        self.assertFalse(self.cahandler.user)\\n+        self.assertFalse(self.cahandler.password)\\n+        self.assertFalse(self.cahandler.template)\\n+        self.assertFalse(self.cahandler.proxy)\\n+        self.assertFalse(self.cahandler.target_domain)\\n+        self.assertFalse(self.cahandler.domain_controller)\\n+        self.assertFalse(self.cahandler.ca_name)\\n+        self.assertFalse(self.cahandler.ca_bundle)\\n+        self.assertIn(\\\"ERROR:test_a2c:CAhandler._config_load() could not load user_variable:'unk'\\\", lcm.output)\\n+\\n+    @patch.dict('os.environ', {'user_var': 'user_var'})\\n+    @patch('examples.ca_handler.mswcce_ca_handler.load_config')\\n+    def test_010_config_load(self, mock_load_cfg):\\n+        \\\"\\\"\\\" test _config_load - overwrite user variable \\\"\\\"\\\"\\n+        mock_load_cfg.return_value = {'CAhandler': {'user_variable': 'user_var', 'user': 'user_local'}}\\n+        with self.assertLogs('test_a2c', level='INFO') as lcm:\\n+            self.cahandler._config_load()\\n+        self.assertFalse(self.cahandler.host)\\n+        self.assertEqual('user_local', self.cahandler.user)\\n+        self.assertFalse(self.cahandler.password)\\n+        self.assertFalse(self.cahandler.template)\\n+        self.assertFalse(self.cahandler.proxy)\\n+        self.assertFalse(self.cahandler.target_domain)\\n+        self.assertFalse(self.cahandler.domain_controller)\\n+        self.assertFalse(self.cahandler.ca_name)\\n+        self.assertFalse(self.cahandler.ca_bundle)\\n+        self.assertIn('INFO:test_a2c:CAhandler._config_load() overwrite user', lcm.output)\\n+\\n+    @patch('examples.ca_handler.mswcce_ca_handler.load_config')\\n+    def test_011_config_load(self, mock_load_cfg):\\n+        \\\"\\\"\\\" test _config_load - load user from config file \\\"\\\"\\\"\\n+        mock_load_cfg.return_value = {'CAhandler': {'user': 'user_local'}}\\n+        self.cahandler._config_load()\\n+        self.assertFalse(self.cahandler.host)\\n+        self.assertEqual('user_local', self.cahandler.user)\\n+        self.assertFalse(self.cahandler.password)\\n+        self.assertFalse(self.cahandler.template)\\n+        self.assertFalse(self.cahandler.proxy)\\n+        self.assertFalse(self.cahandler.target_domain)\\n+        self.assertFalse(self.cahandler.domain_controller)\\n+        self.assertFalse(self.cahandler.ca_name)\\n+        self.assertFalse(self.cahandler.ca_bundle)\\n+\\n+    @patch.dict('os.environ', {'password_var': 'password_var'})\\n+    @patch('examples.ca_handler.mswcce_ca_handler.load_config')\\n+    def test_012_config_load(self, mock_load_cfg):\\n+        \\\"\\\"\\\" test _config_load - load password from variable \\\"\\\"\\\"\\n+        mock_load_cfg.return_value = {'CAhandler': {'password_variable': 'password_var'}}\\n+        self.cahandler._config_load()\\n+        self.assertFalse(self.cahandler.host)\\n+        self.assertFalse(self.cahandler.user)\\n+        self.assertEqual('password_var', self.cahandler.password)\\n+        self.assertFalse(self.cahandler.template)\\n+        self.assertFalse(self.cahandler.proxy)\\n+        self.assertFalse(self.cahandler.target_domain)\\n+        self.assertFalse(self.cahandler.domain_controller)\\n+        self.assertFalse(self.cahandler.ca_name)\\n+        self.assertFalse(self.cahandler.ca_bundle)\\n+\\n+    @patch.dict('os.environ', {'password_var': 'password_var'})\\n+    @patch('examples.ca_handler.mswcce_ca_handler.load_config')\\n+    def test_013_config_load(self, mock_load_cfg):\\n+        \\\"\\\"\\\" test _config_load - load password from not existing variable \\\"\\\"\\\"\\n+        mock_load_cfg.return_value = {'CAhandler': {'password_variable': 'unk'}}\\n+        with self.assertLogs('test_a2c', level='INFO') as lcm:\\n+            self.cahandler._config_load()\\n+        self.assertFalse(self.cahandler.host)\\n+        self.assertFalse(self.cahandler.user)\\n+        self.assertFalse(self.cahandler.password)\\n+        self.assertFalse(self.cahandler.template)\\n+        self.assertFalse(self.cahandler.proxy)\\n+        self.assertFalse(self.cahandler.target_domain)\\n+        self.assertFalse(self.cahandler.domain_controller)\\n+        self.assertFalse(self.cahandler.ca_name)\\n+        self.assertFalse(self.cahandler.ca_bundle)\\n+        self.assertIn(\\\"ERROR:test_a2c:CAhandler._config_load() could not load password_variable:'unk'\\\", lcm.output)\\n+\\n+    @patch.dict('os.environ', {'password_var': 'password_var'})\\n+    @patch('examples.ca_handler.mswcce_ca_handler.load_config')\\n+    def test_014_config_load(self, mock_load_cfg):\\n+        \\\"\\\"\\\" test _config_load - overwrite password variable \\\"\\\"\\\"\\n+        mock_load_cfg.return_value = {'CAhandler': {'password_variable': 'password_var', 'password': 'password_local'}}\\n+        with self.assertLogs('test_a2c', level='INFO') as lcm:\\n+            self.cahandler._config_load()\\n+        self.assertFalse(self.cahandler.host)\\n+        self.assertFalse(self.cahandler.user)\\n+        self.assertEqual('password_local', self.cahandler.password)\\n+        self.assertFalse(self.cahandler.template)\\n+        self.assertFalse(self.cahandler.proxy)\\n+        self.assertFalse(self.cahandler.target_domain)\\n+        self.assertFalse(self.cahandler.domain_controller)\\n+        self.assertFalse(self.cahandler.ca_name)\\n+        self.assertFalse(self.cahandler.ca_bundle)\\n+        self.assertIn('INFO:test_a2c:CAhandler._config_load() overwrite password', lcm.output)\\n+\\n+    @patch('examples.ca_handler.mswcce_ca_handler.load_config')\\n+    def test_015_config_load(self, mock_load_cfg):\\n+        \\\"\\\"\\\" test _config_load - load password from config file \\\"\\\"\\\"\\n+        mock_load_cfg.return_value = {'CAhandler': {'password': 'password_local'}}\\n+        self.cahandler._config_load()\\n+        self.assertFalse(self.cahandler.host)\\n+        self.assertFalse(self.cahandler.user)\\n+        self.assertEqual('password_local', self.cahandler.password)\\n+        self.assertFalse(self.cahandler.template)\\n+        self.assertFalse(self.cahandler.proxy)\\n+        self.assertFalse(self.cahandler.target_domain)\\n+        self.assertFalse(self.cahandler.domain_controller)\\n+        self.assertFalse(self.cahandler.ca_name)\\n+        self.assertFalse(self.cahandler.ca_bundle)\\n+\\n+    @patch('examples.ca_handler.mswcce_ca_handler.load_config')\\n+    def test_016_config_load(self, mock_load_cfg):\\n+        \\\"\\\"\\\" test _config_load - load target domain from config file \\\"\\\"\\\"\\n+        mock_load_cfg.return_value = {'CAhandler': {'target_domain': 'target_domain'}}\\n+        self.cahandler._config_load()\\n+        self.assertFalse(self.cahandler.host)\\n+        self.assertFalse(self.cahandler.user)\\n+        self.assertFalse(self.cahandler.password)\\n+        self.assertEqual('target_domain', self.cahandler.target_domain)\\n+        self.assertFalse(self.cahandler.template)\\n+        self.assertFalse(self.cahandler.proxy)\\n+        self.assertFalse(self.cahandler.domain_controller)\\n+        self.assertFalse(self.cahandler.ca_name)\\n+        self.assertFalse(self.cahandler.ca_bundle)\\n+\\n+    @patch('examples.ca_handler.mswcce_ca_handler.load_config')\\n+    def test_017_config_load(self, mock_load_cfg):\\n+        \\\"\\\"\\\" test _config_load - load domain_controller from config file \\\"\\\"\\\"\\n+        mock_load_cfg.return_value = {'CAhandler': {'domain_controller': 'domain_controller'}}\\n+        self.cahandler._config_load()\\n+        self.assertFalse(self.cahandler.host)\\n+        self.assertFalse(self.cahandler.user)\\n+        self.assertFalse(self.cahandler.password)\\n+        self.assertEqual('domain_controller', self.cahandler.domain_controller)\\n+        self.assertFalse(self.cahandler.template)\\n+        self.assertFalse(self.cahandler.proxy)\\n+        self.assertFalse(self.cahandler.target_domain)\\n+        self.assertFalse(self.cahandler.ca_name)\\n+        self.assertFalse(self.cahandler.ca_bundle)\\n+\\n+    @patch('examples.ca_handler.mswcce_ca_handler.load_config')\\n+    def test_018_config_load(self, mock_load_cfg):\\n+        \\\"\\\"\\\" test _config_load - load ca_name from config file \\\"\\\"\\\"\\n+        mock_load_cfg.return_value = {'CAhandler': {'ca_name': 'ca_name'}}\\n+        self.cahandler._config_load()\\n+        self.assertFalse(self.cahandler.host)\\n+        self.assertFalse(self.cahandler.user)\\n+        self.assertFalse(self.cahandler.password)\\n+        self.assertEqual('ca_name', self.cahandler.ca_name)\\n+        self.assertFalse(self.cahandler.template)\\n+        self.assertFalse(self.cahandler.proxy)\\n+        self.assertFalse(self.cahandler.target_domain)\\n+        self.assertFalse(self.cahandler.domain_controller)\\n+        self.assertFalse(self.cahandler.ca_bundle)\\n+\\n+    @patch('examples.ca_handler.mswcce_ca_handler.load_config')\\n+    def test_019_config_load(self, mock_load_cfg):\\n+        \\\"\\\"\\\" test _config_load - load ca_name from config file \\\"\\\"\\\"\\n+        mock_load_cfg.return_value = {'CAhandler': {'ca_bundle': 'ca_bundle'}}\\n+        self.cahandler._config_load()\\n+        self.assertFalse(self.cahandler.host)\\n+        self.assertFalse(self.cahandler.user)\\n+        self.assertFalse(self.cahandler.password)\\n+        self.assertEqual('ca_bundle', self.cahandler.ca_bundle)\\n+        self.assertFalse(self.cahandler.template)\\n+        self.assertFalse(self.cahandler.proxy)\\n+        self.assertFalse(self.cahandler.target_domain)\\n+        self.assertFalse(self.cahandler.domain_controller)\\n+        self.assertFalse(self.cahandler.ca_name)\\n+\\n+    @patch('examples.ca_handler.mswcce_ca_handler.load_config')\\n+    def test_020_config_load(self, mock_load_cfg):\\n+        \\\"\\\"\\\" test _config_load - load template from config file \\\"\\\"\\\"\\n+        mock_load_cfg.return_value = {'CAhandler': {'template': 'template'}}\\n+        self.cahandler._config_load()\\n+        self.assertFalse(self.cahandler.host)\\n+        self.assertFalse(self.cahandler.user)\\n+        self.assertFalse(self.cahandler.password)\\n+        self.assertEqual('template', self.cahandler.template)\\n+        self.assertFalse(self.cahandler.ca_bundle)\\n+        self.assertFalse(self.cahandler.proxy)\\n+        self.assertFalse(self.cahandler.target_domain)\\n+        self.assertFalse(self.cahandler.domain_controller)\\n+        self.assertFalse(self.cahandler.ca_name)\\n+\\n+    @patch('examples.ca_handler.mswcce_ca_handler.proxy_check')\\n+    @patch('json.loads')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.load_config')\\n+    def test_021_config_load(self, mock_load_cfg, mock_json, mock_chk):\\n+        \\\"\\\"\\\" test _config_load ca_handler configured load proxies \\\"\\\"\\\"\\n+        mock_load_cfg.return_value = {'DEFAULT': {'proxy_server_list': 'foo'}}\\n+        mock_json.return_value = 'foo.bar.local'\\n+        mock_chk.return_value = 'proxy.bar.local'\\n+        self.cahandler._config_load()\\n+        self.assertTrue(mock_json.called)\\n+        self.assertTrue(mock_chk.called)\\n+        self.assertEqual({'http': 'proxy.bar.local', 'https': 'proxy.bar.local'}, self.cahandler.proxy)\\n+        self.assertFalse(self.cahandler.host)\\n+        self.assertFalse(self.cahandler.user)\\n+        self.assertFalse(self.cahandler.password)\\n+        self.assertFalse(self.cahandler.template)\\n+        self.assertFalse(self.cahandler.ca_bundle)\\n+        self.assertFalse(self.cahandler.target_domain)\\n+        self.assertFalse(self.cahandler.domain_controller)\\n+        self.assertFalse(self.cahandler.ca_name)\\n+\\n+    @patch('examples.ca_handler.mswcce_ca_handler.proxy_check')\\n+    @patch('json.loads')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.load_config')\\n+    def test_022_config_load(self, mock_load_cfg, mock_json, mock_chk):\\n+        \\\"\\\"\\\" test _config_load ca_handler configured load proxies failed with exception in json.load \\\"\\\"\\\"\\n+        mock_load_cfg.return_value = {'DEFAULT': {'proxy_server_list': 'foo'}}\\n+        mock_json.side_effect = Exception('exc_load_config')\\n+        mock_chk.side = 'proxy.bar.local'\\n+        with self.assertLogs('test_a2c', level='INFO') as lcm:\\n+            self.cahandler._config_load()\\n+        self.assertTrue(mock_json.called)\\n+        self.assertFalse(mock_chk.called)\\n+        self.assertFalse(self.cahandler.proxy)\\n+        self.assertFalse(self.cahandler.host)\\n+        self.assertFalse(self.cahandler.user)\\n+        self.assertFalse(self.cahandler.password)\\n+        self.assertFalse(self.cahandler.template)\\n+        self.assertFalse(self.cahandler.ca_bundle)\\n+        self.assertFalse(self.cahandler.target_domain)\\n+        self.assertFalse(self.cahandler.domain_controller)\\n+        self.assertFalse(self.cahandler.ca_name)\\n+        self.assertIn('WARNING:test_a2c:CAhandler._config_load() proxy_server_list failed with error: exc_load_config', lcm.output)\\n+\\n+    @patch(\\\"builtins.open\\\", mock_open(read_data='foo'), create=True)\\n+    def test_023__file_load(self):\\n+        \\\"\\\"\\\" test _load file() \\\"\\\"\\\"\\n+        self.assertEqual('foo', self.cahandler._file_load('filename'))\\n+\\n+    @patch(\\\"builtins.open\\\")\\n+    def test_024__file_load(self, mock_op):\\n+        \\\"\\\"\\\" test _load file() \\\"\\\"\\\"\\n+        mock_op.side_effect = Exception('ex_mock_open')\\n+        with self.assertLogs('test_a2c', level='INFO') as lcm:\\n+            self.assertFalse(self.cahandler._file_load('filename'))\\n+        self.assertIn('ERROR:test_a2c:CAhandler._file_load(): could not load filename. Error: ex_mock_open', lcm.output)\\n+\\n+    def test_025_revoke(self):\\n+        \\\"\\\"\\\" test revocation \\\"\\\"\\\"\\n+        self.assertEqual((500, 'urn:ietf:params:acme:error:serverInternal', 'Revocation is not supported.'), self.cahandler.revoke('cert', 'rev_reason', 'rev_date'))\\n+\\n+    def test_026_poll(self):\\n+        \\\"\\\"\\\" test polling \\\"\\\"\\\"\\n+        self.assertEqual(('Method not implemented.', None, None, 'poll_identifier', False), self.cahandler.poll('cert_name', 'poll_identifier', 'csr'))\\n+\\n+    def test_027_trigger(self):\\n+        \\\"\\\"\\\" test trigger \\\"\\\"\\\"\\n+        self.assertEqual(('Method not implemented.', None, None), self.cahandler.trigger('payload'))\\n+\\n+    def test_028_enroll(self):\\n+        \\\"\\\"\\\" test enrollment - unconfigured \\\"\\\"\\\"\\n+        self.assertEqual(('Config incomplete', None, None, None), self.cahandler.enroll('csr'))\\n+\\n+    def test_029_enroll(self):\\n+        \\\"\\\"\\\" test enrollment - host unconfigured \\\"\\\"\\\"\\n+        self.cahandler.host = None\\n+        self.cahandler.user = 'user'\\n+        self.cahandler.password = 'password'\\n+        self.cahandler.template = 'template'\\n+        self.assertEqual(('Config incomplete', None, None, None), self.cahandler.enroll('csr'))\\n+\\n+    def test_30_enroll(self):\\n+        \\\"\\\"\\\" test enrollment - user unconfigured \\\"\\\"\\\"\\n+        self.cahandler.host = 'host'\\n+        self.cahandler.user = None\\n+        self.cahandler.password = 'password'\\n+        self.cahandler.template = 'template'\\n+        self.assertEqual(('Config incomplete', None, None, None), self.cahandler.enroll('csr'))\\n+\\n+    def test_031_enroll(self):\\n+        \\\"\\\"\\\" test enrollment - password unconfigured \\\"\\\"\\\"\\n+        self.cahandler.host = 'host'\\n+        self.cahandler.user = 'user'\\n+        self.cahandler.password = None\\n+        self.cahandler.template = 'template'\\n+        self.assertEqual(('Config incomplete', None, None, None), self.cahandler.enroll('csr'))\\n+\\n+    def test_032_enroll(self):\\n+        \\\"\\\"\\\" test enrollment - template unconfigured \\\"\\\"\\\"\\n+        self.cahandler.host = 'host'\\n+        self.cahandler.user = 'user'\\n+        self.cahandler.password = 'password'\\n+        self.cahandler.template = None\\n+        self.assertEqual(('Config incomplete', None, None, None), self.cahandler.enroll('csr'))\\n+\\n+    @patch('examples.ca_handler.mswcce_ca_handler.Request')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.Target')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.convert_string_to_byte')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.convert_byte_to_string')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.CAhandler._file_load')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.build_pem_file')\\n+    def test_033_enroll(self, mock_pem, mock_file, mock_b2s, mock_s2b, mock_target, mock_request):\\n+        \\\"\\\"\\\" test enrollment - ca_server.get_cert() triggers exception \\\"\\\"\\\"\\n+        self.cahandler.host = 'host'\\n+        self.cahandler.user = 'user'\\n+        self.cahandler.password = 'password'\\n+        self.cahandler.template = 'template'\\n+        mock_target.return_value = True\\n+        mock_request = Mock(return_value='raw_data')\\n+        mock_file.return_value = 'file_load'\\n+        mock_s2b.return_value = 's2b'\\n+        mock_b2s.side_effect = Exception('ex_b2s')\\n+        with self.assertLogs('test_a2c', level='INFO') as lcm:\\n+            self.assertEqual(('cert bundling failed', None, None, None), self.cahandler.enroll('csr'))\\n+        self.assertIn('ERROR:test_a2c:ca_server.get_cert() failed with error: ex_b2s', lcm.output)\\n+        self.assertIn('ERROR:test_a2c:cert bundling failed', lcm.output)\\n+\\n+    @patch('examples.ca_handler.mswcce_ca_handler.Request')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.Target')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.convert_string_to_byte')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.convert_byte_to_string')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.CAhandler._file_load')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.build_pem_file')\\n+    def test_034_enroll(self, mock_pem, mock_file, mock_b2s, mock_s2b, mock_target, mock_request):\\n+        \\\"\\\"\\\" test enrollment - no certificate returned by ca_server.get_cert() \\\"\\\"\\\"\\n+        self.cahandler.host = 'host'\\n+        self.cahandler.user = 'user'\\n+        self.cahandler.password = 'password'\\n+        self.cahandler.template = 'template'\\n+        mock_target.return_value = True\\n+        mock_request = Mock(return_value='raw_data')\\n+        mock_file.return_value = 'file_load'\\n+        mock_s2b.return_value = 's2b'\\n+        mock_b2s.return_value = None\\n+        with self.assertLogs('test_a2c', level='INFO') as lcm:\\n+            self.assertEqual(('cert bundling failed', None, None, None), self.cahandler.enroll('csr'))\\n+        self.assertIn('ERROR:test_a2c:cert bundling failed', lcm.output)\\n+\\n+    @patch('examples.ca_handler.mswcce_ca_handler.Request')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.Target')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.convert_string_to_byte')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.convert_byte_to_string')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.CAhandler._file_load')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.build_pem_file')\\n+    def test_035_enroll(self, mock_pem, mock_file, mock_b2s, mock_s2b, mock_target, mock_request):\\n+        \\\"\\\"\\\" test enrollment - certificate and bundling successful \\\"\\\"\\\"\\n+        self.cahandler.host = 'host'\\n+        self.cahandler.user = 'user'\\n+        self.cahandler.password = 'password'\\n+        self.cahandler.template = 'template'\\n+        mock_target.return_value = True\\n+        mock_request = Mock(return_value='raw_data')\\n+        mock_file.return_value = 'file_load'\\n+        mock_s2b.return_value = 's2b'\\n+        mock_b2s.return_value = 'b2s'\\n+        self.assertEqual((None, 'b2sfile_load', 'b2s', None), self.cahandler.enroll('csr'))\\n+\\n+    @patch('examples.ca_handler.mswcce_ca_handler.Request')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.Target')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.convert_string_to_byte')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.convert_byte_to_string')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.CAhandler._file_load')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.build_pem_file')\\n+    def test_036_enroll(self, mock_pem, mock_file, mock_b2s, mock_s2b, mock_target, mock_request):\\n+        \\\"\\\"\\\" test enrollment - certificate and bundling successful replacement test \\\"\\\"\\\"\\n+        self.cahandler.host = 'host'\\n+        self.cahandler.user = 'user'\\n+        self.cahandler.password = 'password'\\n+        self.cahandler.template = 'template'\\n+        mock_target.return_value = True\\n+        mock_request = Mock(return_value='raw_data')\\n+        mock_file.return_value = 'file_load'\\n+        mock_s2b.return_value = 's2b'\\n+        mock_b2s.return_value = '-----BEGIN CERTIFICATE-----\\\\nb2s_replacement\\\\n-----END CERTIFICATE-----\\\\n'\\n+        self.assertEqual((None, '-----BEGIN CERTIFICATE-----\\\\nb2s_replacement\\\\n-----END CERTIFICATE-----\\\\nfile_load', 'b2s_replacement', None), self.cahandler.enroll('csr'))\\n+\\n+\\n+if __name__ == '__main__':\\n+\\n+    unittest.main()\\n\",\"diff --git a/test/test_mswcce_ca_handler.py b/test/test_mswcce_ca_handler.py\\nindex d9369733..e04af597 100644\\n--- a/test/test_mswcce_ca_handler.py\\n+++ b/test/test_mswcce_ca_handler.py\\n@@ -403,56 +403,64 @@ def test_027_trigger(self):\\n         \\\"\\\"\\\" test trigger \\\"\\\"\\\"\\n         self.assertEqual(('Method not implemented.', None, None), self.cahandler.trigger('payload'))\\n \\n-    def test_028_enroll(self):\\n+    @patch('examples.ca_handler.mswcce_ca_handler.CAhandler.request_create')\\n+    def test_028_enroll(self, mock_rcr):\\n         \\\"\\\"\\\" test enrollment - unconfigured \\\"\\\"\\\"\\n         self.assertEqual(('Config incomplete', None, None, None), self.cahandler.enroll('csr'))\\n+        self.assertFalse(mock_rcr.called)\\n \\n-    def test_029_enroll(self):\\n+    @patch('examples.ca_handler.mswcce_ca_handler.CAhandler.request_create')\\n+    def test_029_enroll(self, mock_rcr):\\n         \\\"\\\"\\\" test enrollment - host unconfigured \\\"\\\"\\\"\\n         self.cahandler.host = None\\n         self.cahandler.user = 'user'\\n         self.cahandler.password = 'password'\\n         self.cahandler.template = 'template'\\n         self.assertEqual(('Config incomplete', None, None, None), self.cahandler.enroll('csr'))\\n+        self.assertFalse(mock_rcr.called)\\n \\n-    def test_30_enroll(self):\\n+    @patch('examples.ca_handler.mswcce_ca_handler.CAhandler.request_create')\\n+    def test_30_enroll(self, mock_rcr):\\n         \\\"\\\"\\\" test enrollment - user unconfigured \\\"\\\"\\\"\\n         self.cahandler.host = 'host'\\n         self.cahandler.user = None\\n         self.cahandler.password = 'password'\\n         self.cahandler.template = 'template'\\n         self.assertEqual(('Config incomplete', None, None, None), self.cahandler.enroll('csr'))\\n+        self.assertFalse(mock_rcr.called)\\n \\n-    def test_031_enroll(self):\\n+    @patch('examples.ca_handler.mswcce_ca_handler.CAhandler.request_create')\\n+    def test_031_enroll(self, mock_rcr):\\n         \\\"\\\"\\\" test enrollment - password unconfigured \\\"\\\"\\\"\\n         self.cahandler.host = 'host'\\n         self.cahandler.user = 'user'\\n         self.cahandler.password = None\\n         self.cahandler.template = 'template'\\n         self.assertEqual(('Config incomplete', None, None, None), self.cahandler.enroll('csr'))\\n+        self.assertFalse(mock_rcr.called)\\n \\n-    def test_032_enroll(self):\\n+    @patch('examples.ca_handler.mswcce_ca_handler.CAhandler.request_create')\\n+    def test_032_enroll(self, mock_rcr):\\n         \\\"\\\"\\\" test enrollment - template unconfigured \\\"\\\"\\\"\\n         self.cahandler.host = 'host'\\n         self.cahandler.user = 'user'\\n         self.cahandler.password = 'password'\\n         self.cahandler.template = None\\n         self.assertEqual(('Config incomplete', None, None, None), self.cahandler.enroll('csr'))\\n+        self.assertFalse(mock_rcr.called)\\n \\n-    @patch('examples.ca_handler.mswcce_ca_handler.Request')\\n-    @patch('examples.ca_handler.mswcce_ca_handler.Target')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.CAhandler.request_create')\\n     @patch('examples.ca_handler.mswcce_ca_handler.convert_string_to_byte')\\n     @patch('examples.ca_handler.mswcce_ca_handler.convert_byte_to_string')\\n     @patch('examples.ca_handler.mswcce_ca_handler.CAhandler._file_load')\\n     @patch('examples.ca_handler.mswcce_ca_handler.build_pem_file')\\n-    def test_033_enroll(self, mock_pem, mock_file, mock_b2s, mock_s2b, mock_target, mock_request):\\n+    def test_033_enroll(self, mock_pem, mock_file, mock_b2s, mock_s2b, mock_rcr):\\n         \\\"\\\"\\\" test enrollment - ca_server.get_cert() triggers exception \\\"\\\"\\\"\\n         self.cahandler.host = 'host'\\n         self.cahandler.user = 'user'\\n         self.cahandler.password = 'password'\\n         self.cahandler.template = 'template'\\n-        mock_target.return_value = True\\n-        mock_request = Mock(return_value='raw_data')\\n+        mock_rcr.return_value = Mock(return_value='raw_data')\\n         mock_file.return_value = 'file_load'\\n         mock_s2b.return_value = 's2b'\\n         mock_b2s.side_effect = Exception('ex_b2s')\\n@@ -460,66 +468,71 @@ def test_033_enroll(self, mock_pem, mock_file, mock_b2s, mock_s2b, mock_target,\\n             self.assertEqual(('cert bundling failed', None, None, None), self.cahandler.enroll('csr'))\\n         self.assertIn('ERROR:test_a2c:ca_server.get_cert() failed with error: ex_b2s', lcm.output)\\n         self.assertIn('ERROR:test_a2c:cert bundling failed', lcm.output)\\n+        self.assertTrue(mock_rcr.called)\\n \\n-    @patch('examples.ca_handler.mswcce_ca_handler.Request')\\n-    @patch('examples.ca_handler.mswcce_ca_handler.Target')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.CAhandler.request_create')\\n     @patch('examples.ca_handler.mswcce_ca_handler.convert_string_to_byte')\\n     @patch('examples.ca_handler.mswcce_ca_handler.convert_byte_to_string')\\n     @patch('examples.ca_handler.mswcce_ca_handler.CAhandler._file_load')\\n     @patch('examples.ca_handler.mswcce_ca_handler.build_pem_file')\\n-    def test_034_enroll(self, mock_pem, mock_file, mock_b2s, mock_s2b, mock_target, mock_request):\\n+    def test_034_enroll(self, mock_pem, mock_file, mock_b2s, mock_s2b, mock_rcr):\\n         \\\"\\\"\\\" test enrollment - no certificate returned by ca_server.get_cert() \\\"\\\"\\\"\\n         self.cahandler.host = 'host'\\n         self.cahandler.user = 'user'\\n         self.cahandler.password = 'password'\\n         self.cahandler.template = 'template'\\n-        mock_target.return_value = True\\n-        mock_request = Mock(return_value='raw_data')\\n+        mock_rcr.return_value = Mock(return_value='raw_data')\\n         mock_file.return_value = 'file_load'\\n         mock_s2b.return_value = 's2b'\\n         mock_b2s.return_value = None\\n         with self.assertLogs('test_a2c', level='INFO') as lcm:\\n             self.assertEqual(('cert bundling failed', None, None, None), self.cahandler.enroll('csr'))\\n         self.assertIn('ERROR:test_a2c:cert bundling failed', lcm.output)\\n+        self.assertTrue(mock_rcr.called)\\n \\n-    @patch('examples.ca_handler.mswcce_ca_handler.Request')\\n-    @patch('examples.ca_handler.mswcce_ca_handler.Target')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.CAhandler.request_create')\\n     @patch('examples.ca_handler.mswcce_ca_handler.convert_string_to_byte')\\n     @patch('examples.ca_handler.mswcce_ca_handler.convert_byte_to_string')\\n     @patch('examples.ca_handler.mswcce_ca_handler.CAhandler._file_load')\\n     @patch('examples.ca_handler.mswcce_ca_handler.build_pem_file')\\n-    def test_035_enroll(self, mock_pem, mock_file, mock_b2s, mock_s2b, mock_target, mock_request):\\n+    def test_035_enroll(self, mock_pem, mock_file, mock_b2s, mock_s2b, mock_rcr):\\n         \\\"\\\"\\\" test enrollment - certificate and bundling successful \\\"\\\"\\\"\\n         self.cahandler.host = 'host'\\n         self.cahandler.user = 'user'\\n         self.cahandler.password = 'password'\\n         self.cahandler.template = 'template'\\n-        mock_target.return_value = True\\n-        mock_request = Mock(return_value='raw_data')\\n+        mock_rcr.return_value = Mock(return_value='raw_data')\\n         mock_file.return_value = 'file_load'\\n         mock_s2b.return_value = 's2b'\\n         mock_b2s.return_value = 'b2s'\\n         self.assertEqual((None, 'b2sfile_load', 'b2s', None), self.cahandler.enroll('csr'))\\n+        self.assertTrue(mock_rcr.called)\\n \\n-    @patch('examples.ca_handler.mswcce_ca_handler.Request')\\n-    @patch('examples.ca_handler.mswcce_ca_handler.Target')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.CAhandler.request_create')\\n     @patch('examples.ca_handler.mswcce_ca_handler.convert_string_to_byte')\\n     @patch('examples.ca_handler.mswcce_ca_handler.convert_byte_to_string')\\n     @patch('examples.ca_handler.mswcce_ca_handler.CAhandler._file_load')\\n     @patch('examples.ca_handler.mswcce_ca_handler.build_pem_file')\\n-    def test_036_enroll(self, mock_pem, mock_file, mock_b2s, mock_s2b, mock_target, mock_request):\\n+    def test_036_enroll(self, mock_pem, mock_file, mock_b2s, mock_s2b, mock_rcr):\\n         \\\"\\\"\\\" test enrollment - certificate and bundling successful replacement test \\\"\\\"\\\"\\n         self.cahandler.host = 'host'\\n         self.cahandler.user = 'user'\\n         self.cahandler.password = 'password'\\n         self.cahandler.template = 'template'\\n-        mock_target.return_value = True\\n-        mock_request = Mock(return_value='raw_data')\\n+        mock_rcr.return_value = Mock(return_value='raw_data')\\n         mock_file.return_value = 'file_load'\\n         mock_s2b.return_value = 's2b'\\n         mock_b2s.return_value = '-----BEGIN CERTIFICATE-----\\\\nb2s_replacement\\\\n-----END CERTIFICATE-----\\\\n'\\n         self.assertEqual((None, '-----BEGIN CERTIFICATE-----\\\\nb2s_replacement\\\\n-----END CERTIFICATE-----\\\\nfile_load', 'b2s_replacement', None), self.cahandler.enroll('csr'))\\n+        self.assertTrue(mock_rcr.called)\\n \\n+    @patch('examples.ca_handler.mswcce_ca_handler.Request')\\n+    @patch('examples.ca_handler.mswcce_ca_handler.Target')\\n+    def test_037_request_create(self, mock_target, mock_request):\\n+        \\\"\\\"\\\" test request create \\\"\\\"\\\"\\n+        mock_target.return_value = True\\n+        mock_request.return_value ='foo'\\n+        self.assertEqual('foo', self.cahandler.request_create())\\n \\n if __name__ == '__main__':\\n \\n\",\"diff --git a/tools/mswcce_connection_test.py b/tools/mswcce_connection_test.py\\nnew file mode 100644\\nindex 00000000..21643779\\n--- /dev/null\\n+++ b/tools/mswcce_connection_test.py\\n@@ -0,0 +1,19 @@\\n+#!/usr/bin/python3\\n+# -*- coding: utf-8 -*-\\n+\\\"\\\"\\\" CA handler for Microsoft Windows Client Certificate Enrollment Protocol (MS-WCCE) \\\"\\\"\\\"\\n+from __future__ import print_function\\n+import sys\\n+import os\\n+sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), os.path.pardir)))\\n+sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), os.path.pardir, os.path.pardir)))\\n+# pylint: disable=E0401, E0611, C0209, C0413\\n+from acme_srv.helper import logger_setup  # nopep8\\n+from examples.ca_handler.mswcce_ca_handler import CAhandler\\n+\\n+if __name__ == '__main__':\\n+\\n+    # initialize logger\\n+    LOGGER = logger_setup(True)\\n+\\n+    with CAhandler(True, LOGGER) as ca_handler:\\n+        request = ca_handler.request_create()\\n\",\"diff --git a/docs/mswcce.md b/docs/mswcce.md\\nnew file mode 100644\\nindex 00000000..69b93b1b\\n--- /dev/null\\n+++ b/docs/mswcce.md\\n@@ -0,0 +1,51 @@\\n+<!-- markdownlint-disable  MD013 -->\\n+<!-- wiki-title CA handler for Microsoft Windows Client Certificate Enrollment Protocol (MS-WCCE) -->\\n+# CA handler for Microsoft Windows Client Certificate Enrollment Protocol (MS-WCCE)\\n+\\n+This CA handler uses the Microsoft [Windows Client Certificate Enrollment Protocol](https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-wcce/446a0fca-7f27-4436-965d-191635518466). The handler is using code from [Certipy](https://github.com/ly4k/Certipy) which is a kind of pentesting tool for AD-CS.\\n+\\n+When using the handler please be aware of the following limitations:\\n+\\n+- CA certificates cannot be fetched from CA server and must be loaded via `ca_bundle` option configured in `acme_srv.cfg`\\n+- Revocation operations are not (yet) supported\\n+\\n+## Preparation\\n+\\n+1. Active Directory Certificate Services (AD-CS) must be enabled and configured - of course :-)\\n+2. The CA handler is using RPC/DCOM to communicate with the CA server. That means that your CA-server must be reachable via TCP port 445.\\n+3. You need to have a set of credentials with permissions to access the service and enrollment templates\\n+\\n+## Installation\\n+\\n+- install the [impacket](https://github.com/SecureAuthCorp/impacket) via pip (the module is already part of the docker images)\\n+\\n+```bash\\n+root@rlh:~# pip install impacket\\n+```\\n+\\n+- modify the server configuration (acme_srv/acme_srv.cfg) and add the following parameters\\n+\\n+```config\\n+[CAhandler]\\n+handler_file: examples/ca_handler/mswcce_ca_handler.py\\n+host: <hostname>\\n+user: <username>\\n+password: <password>\\n+target_domain: <domain name>\\n+domain_controller: <ip address of domain controller>\\n+ca_name: <ca name>\\n+ca_bundle: <filename>\\n+template: <template name>\\n+```\\n+\\n+- host - hostname of the system providing the enrollment service\\n+- host_variable - *optional* - name of the environment variable containing host address (a configured `host` parameter in acme_srv.cfg takes precedence)\\n+- user - username used to access the service\\n+- user_variable - *optional* - name of the environment variable containing the username used for service access (a configured `user` parameter in acme_srv.cfg takes precedence)\\n+- password - password\\n+- password_variable - *optional* - name of the environment variable containing the password used for service access (a configured `password` parameter in acme_srv.cfg takes precedence)\\n+- target_domain - *optional* - ads domain name\\n+- domain_controller - *optional* - IP Address of the domain controller.\\n+- ca_name: - certificate authority name\\n+- ca_bundle - CA certificate chain in pem format delievered along with the client certificate\\n+- template - certificate template used for enrollment\\n\",\"diff --git a/tools/mswcce_connection_test.py b/tools/mswcce_connection_test.py\\nindex 21643779..a32eb609 100644\\n--- a/tools/mswcce_connection_test.py\\n+++ b/tools/mswcce_connection_test.py\\n@@ -8,7 +8,7 @@\\n sys.path.append(os.path.abspath(os.path.join(os.path.dirname(__file__), os.path.pardir, os.path.pardir)))\\n # pylint: disable=E0401, E0611, C0209, C0413\\n from acme_srv.helper import logger_setup  # nopep8\\n-from examples.ca_handler.mswcce_ca_handler import CAhandler\\n+from examples.ca_handler.mswcce_ca_handler import CAhandler  # nopep8\\n \\n if __name__ == '__main__':\\n \"]", "hints_text": ""}
