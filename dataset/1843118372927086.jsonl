{"instance_id": "1843118372927086", "repo": "equinor/komodo", "base_commit": "e9d9686cc72b5a1bda2c23b20e2bc3386d4275b4", "problem_statement": "Validate YAML config files as part of linting:\\nCurrently if I specify the version as (say) `3.1`, then attempting to build comes back with `missing version for networkx 3.1`, not something like `malformed version` or `you forgot to put quotes around it` -- or maybe even just deal with it because it should not matter. The problem is that the YAML parser mistakes `3.1` for a float, when we need it to be interpreted as a string. Two possible solutions I can think of:\\r\\n\\r\\n- Use a YAML schema and validate the YAML 'properly'. Maybe this approach can also just coerce the version into a string.\\r\\n- Get the linting to check for this mistake and report it more helpfully.", "FAIL_TO_PASS": ["tests/test_insert_proposals.py::test_duplicate_package_entry_handling[duplicate_packages_in_repository]", "tests/test_lint.py::test_integration_main[invalid_input_repository_duplicate_packages]", "tests/test_lint_maturity.py::test_argument_types[invalid_yaml__float_package_version]", "tests/test_lint.py::test_integration_main[invalid_input_repository_file_version_type_float]", "tests/test_lint_package_status.py::test_integration[invalid_yaml_package_status_file]", "tests/test_insert_proposals.py::test_insert_proposals[missing_proposal_heading]", "tests/test_lint_package_status.py::test_integration[valid_input_package_status_invalid_visibility_option]", "tests/test_insert_proposals.py::test_insert_proposals[mismatching_version_format]", "tests/test_lint_package_status.py::test_integration[invalid_yaml_repository_file]", "tests/test_lint.py::test_integration_main[invalid_input_release_file_duplicate_packages]", "tests/test_insert_proposals.py::test_insert_proposals[upgrade_proposal_new_version_not_present_in_repository]", "tests/test_lint_package_status.py::test_integration[valid_input_package_status_invalid_maturity_option]", "tests/test_lint_package_status.py::test_integration[valid_input_package_status_invalid_importance_option]", "tests/test_lint.py::test_integration_main[invalid_input_repository_file_format]", "tests/test_lint_package_status.py::test_integration[valid_input_package_status_missing_visibility]", "tests/test_lint_package_status.py::test_integration[invalid_repository_package_status_identifier_type]", "tests/test_lint_package_status.py::test_integration[valid_input_package_status_package_missing_maturity_and_importance]", "tests/test_lint.py::test_integration_main[invalid_input_release_file_version_type_float]", "tests/test_insert_proposals.py::test_insert_proposals[mismatching_casing_files]", "tests/test_lint.py::test_integration_main[invalid_input_repository_type]", "tests/test_lint_package_status.py::test_integration[valid_input_repository_missing_package]", "tests/test_lint_maturity.py::test_get_packages_info", "tests/test_lint_package_status.py::test_integration[valid_input_package_status_public_package_missing_importance]", "tests/test_lint_package_status.py::test_integration[invalid_repository_package_version_type]", "tests/test_insert_proposals.py::test_insert_proposals[float_version_number_in_repository]", "tests/test_lint_package_status.py::test_integration[valid_input_package_status_public_package_missing_maturity]", "tests/test_lint_maturity.py::test_argument_types[invalid_release_file__duplicate_packages]", "tests/test_lint.py::test_integration_main[invalid_input_release_type]", "tests/test_insert_proposals.py::test_insert_proposals[float_version_number_in_proposal]", "tests/test_insert_proposals.py::test_insert_proposals[upgrade_proposal_new_package_not_present_in_repository]", "tests/test_lint.py::test_lint", "tests/test_lint.py::test_integration_main[invalid_input_release_file_format]"], "PASS_TO_PASS": ["tests/test_post_messages.py::test_main_not_existing_release", "tests/test_lint_upgrade_proposals.py::test_lint[repository_file_missing_package]", "tests/test_yaml_file_types.py::test_repository_file_yaml_type[invalid_repository_file_None_package_version]", "tests/test_non_deployed.py::test_output_formatter[release_list0-False-a]", "tests/test_reverse_dep_graph.py::test_extract_reverse_list", "tests/test_release_transpiler.py::test_build_release_matrix_py_coords[py_coords_input0-2.3.4-py27]", "tests/test_release_transpiler_argument_types.py::test_combine_py_release_base_type[args0-expectation0]", "tests/test_yaml_file_types.py::test_package_status_file_type[invalid_package_status__float_package_name]", "tests/test_fetch.py::test_make_one_pip_package", "tests/test_lint_maturity.py::test_get_release_version[2020.02.01-py27.yml-stable]", "tests/test_build.py::test_make_one_pip_package", "tests/test_package_version.py::test_latest_pypi_version[ERROR:", "tests/test_lint_maturity.py::test_msg_packages_exception", "tests/test_fetch.py::test_fetch_pip_with_latest_version", "tests/test_extract_dep_graph.py::test_extract_dep_graph_repo_missing_pkg", "tests/test_matrix.py::test_get_matrix_base[1970.12.01-py38-rhel7-1970.12.01]", "tests/test_lint_upgrade_proposals.py::test_lint[repository_file_missing_package_version]", "tests/test_non_deployed.py::test_output_formatter[release_list2-False-a\\nb]", "tests/test_release_transpiler_argument_types.py::test_combine_py_coords_type[args6-expectation6]", "tests/test_snyk_reporting.py::test_no_api_token", "tests/test_release_transpiler.py::test_transpile_add_argument[matrix1]", "tests/test_release_transpiler_argument_types.py::test_transpile_py_output_folder_type[args4-expectation4]", "tests/test_release_transpiler_argument_types.py::test_combine_py_coords_type[args2-expectation2]", "tests/test_show_version.py::test_read_config_file", "tests/test_show_version.py::test_package_not_found_error", "tests/test_yaml_file_types.py::test_release_file_yaml_type[valid_release_file]", "tests/test_lint_maturity.py::test_get_release_version[invalid_tag-invalid]", "tests/test_yaml_file_types.py::test_repository_file_yaml_type[valid_repository_file_additional_unknown_properties]", "tests/test_release_transpiler_argument_types.py::test_combine_py_coords_type[args5-expectation5]", "tests/test_up_to_date_pypi.py::test_main_happy_path", "tests/test_prettier.py::test_duplicate_entries", "tests/test_lint_maturity.py::test_get_files_to_lint", "tests/test_link_io_structure.py::test_link_integrity", "tests/test_release_transpiler_argument_types.py::test_combine_py_coords_type[args3-expectation3]", "tests/test_snyk_reporting.py::test_snyk_reporting[packages0-pyaml==20.4.0-input_issue_ids0-expected_issue_ids0]", "tests/test_show_version.py::test_get_komodo_path", "tests/test_yaml_file_types.py::test_release_file_yaml_type[invalid_release_file_duplicate_packages]", "tests/test_link_io_structure.py::test_read_folder_structure", "tests/test_yaml_file_types.py::test_release_name_valid[myrelease-py310.yml]", "tests/test_suggester.py::test_release_from_file_name[releases/2019.12.00-py27.yml-2019.12.00-py27]", "tests/test_extract_dep_graph.py::test_extract_dep_graph_pkgs_file_faulty_version", "tests/test_yaml_file_types.py::test_release_name_valid[myrelease-py310-rhel8.yml]", "tests/test_lint_upgrade_proposals.py::test_lint[invalid_upgrade_proposals_file_format]", "tests/test_release_cleanup.py::test_cleanup_argparse", "tests/test_release_transpiler_argument_types.py::test_transpile_py_output_folder_type[args0-expectation0]", "tests/test_yaml_file_types.py::test_repository_file_yaml_type[invalid_repository_file_missing_make]", "tests/test_yaml_file_types.py::test_release_name_invalid[/home/anyuser/komodo-releases/releases/2020.01.00.yml]", "tests/test_lint_maturity.py::test_get_release_version[2020.02.a1-py27.yml-a]", "tests/test_suggester.py::test_path_is_release[foo.yml-False]", "tests/test_link_io_structure.py::test_integration", "tests/test_release_transpiler.py::test_transpile_add_argument[matrix0]", "tests/test_yaml_file_types.py::test_repository_file_yaml_type[invalid_repository_file_multiple_errors]", "tests/test_lint_maturity.py::test_integration_main", "tests/test_show_version.py::test_get_release", "tests/test_link_io_structure.py::test_overwrite_symlink_stdout", "tests/test_lint_upgrade_proposals.py::test_lint[invalid_repository_file_format]", "tests/test_yaml_file_types.py::test_package_status_file_type[invalid_package_status__public_visibility_missing_importance]", "tests/test_release_transpiler_argument_types.py::test_combine_py_release_folder_type[args5-expectation5]", "tests/test_build.py::test_make_with_empty_pkgs", "tests/test_release_transpiler.py::test_get_py_coords", "tests/test_link_io_structure.py::test_create_symlinks", "tests/test_release_transpiler_argument_types.py::test_combine_py_coords_type[args4-expectation4]", "tests/test_up_to_date_pypi.py::test_compatible_versions[Dev", "tests/test_snyk_reporting.py::test_snyk_reporting[packages2-pyaml==20.4.0\\nflask==1.2.0-input_issue_ids2-expected_issue_ids2]", "tests/test_release_transpiler.py::test_build_release_matrix_py_coords[None-packages_lib21-py_coords_not_in_lib31]", "tests/test_yaml_file_types.py::test_package_status_file_type[valid_package_status]", "tests/test_matrix.py::test_format_matrix", "tests/test_suggester.py::test_update[{\"links\":", "tests/test_link_io_structure.py::test_root_links", "tests/test_non_deployed.py::test_links_ignored", "tests/test_release_cleanup.py::test_write_to_file", "tests/test_up_to_date_pypi.py::test_insert_upgrade_proposals[Base", "tests/test_lint_upgrade_proposals.py::test_lint[upgrade_proposals_duplicate_packages_and_versions]", "tests/test_post_messages.py::test_main_no_db", "tests/test_fetch.py::test_fetch_with_empty_pypi_package_name", "tests/test_yaml_file_types.py::test_repository_file_yaml_type[invalid_repository_file_float_make]", "tests/test_lint_maturity.py::test_main", "tests/test_release_transpiler_argument_types.py::test_combine_py_release_folder_type[args1-expectation1]", "tests/test_suggester.py::test_noop_suggestion", "tests/test_yaml_file_types.py::test_repository_file_yaml_type[invalid_repository_file_float_source]", "tests/test_suggester.py::test_py_ver[2019.12.00-py2.7-py2.7]", "tests/test_show_version.py::test_get_version", "tests/test_yaml_file_types.py::test_repository_file_yaml_type[invalid_repository_file_invalid_make_value]", "tests/test_lint_upgrade_proposals.py::test_lint[upgrades_in_multiple_releases_in_upgrade_proposals]", "tests/test_up_to_date_pypi.py::test_insert_upgrade_proposals[Test", "tests/test_lint_maturity.py::test_define_tag_exceptions", "tests/test_release_transpiler_argument_types.py::test_transpile_py_output_folder_type[args2-expectation2]", "tests/test_yaml_file_types.py::test_repository_file_yaml_type[invalid_repository_file_additional_unknown_uppercase_properties]", "tests/test_yaml_file_types.py::test_repository_file_yaml_type[invalid_repository_file_format]", "tests/test_lint_maturity.py::test_count_invalid_tags[invalid_tags3-4]", "tests/test_fetch.py::test_allow_pre_release_with_dash", "tests/test_non_deployed.py::test_non_deployed", "tests/test_lint_upgrade_proposals.py::test_lint[no_upgrades_in_upgrade_proposals]", "tests/test_yaml_file_types.py::test_release_file_yaml_type[invalid_release_file_format]", "tests/test_show_version.py::test_get_komodo_path_fails", "tests/test_post_messages.py::test_main_success_no_release", "tests/test_suggester.py::test_get_concrete_release[conf0-unstable-py27-1349.01.a0-py27]", "tests/test_release_transpiler.py::test_check_version_exists_for_coordinates[Pass", "tests/test_yaml_file_types.py::test_release_name_invalid[bleeding-rhel6.yml]", "tests/test_suggester.py::test_suggest_symlink_configuration[foo_azure.json-azure-stable]", "tests/test_reverse_dep_graph.py::test_extract_reverse_graph", "tests/test_release_transpiler_argument_types.py::test_transpile_py_matrix_coordinates_type[args0-expectation0]", "tests/test_lint_maturity.py::test_get_release_version[bleeding-py27.yml-exception]", "tests/test_release_cleanup.py::test_load_all_releases", "tests/test_yaml_file_types.py::test_release_name_valid[myrelease-py36.yml]", "tests/test_release_transpiler_argument_types.py::test_combine_py_override_mapping_type[args4-expectation4]", "tests/test_suggester.py::test_suggest_symlink_configuration[foo.json-onprem-stable]", "tests/test_matrix.py::test_get_matrix_base[1970.12.05-rhel8-py27-1970.12.05-rhel8-py27]", "tests/test_lint_maturity.py::test_get_release_type[2020.02.01-stable]", "tests/test_build.py::test_make_pip_package_from_latest", "tests/test_switch.py::test_write_activator_switches_for_non_matrix_build", "tests/test_show_version.py::test_get_komodoenv_path", "tests/test_lint_maturity.py::test_count_invalid_tags[invalid_tags1-2]", "tests/test_release_cleanup.py::test_remove_unused_versions", "tests/test_release_transpiler_argument_types.py::test_transpile_py_output_folder_type[args1-expectation1]", "tests/test_snyk_reporting.py::test_snyk_reporting[packages1-pyaml==20.4.0-input_issue_ids1-expected_issue_ids1]", "tests/test_link_io_structure.py::test_create_symlink_stdout", "tests/test_non_deployed.py::test_non_deployed_empty", "tests/test_yaml_file_types.py::test_release_name_valid[myrelease-py36-rhel7.yml]", "tests/test_post_messages.py::test_main_success_symlinks", "tests/test_switch.py::test_write_activator_switches", "tests/test_release_transpiler_argument_types.py::test_combine_py_release_base_type[args1-expectation1]", "tests/test_fetch.py::test_expand_jinja2_templates_in_source", "tests/test_release_transpiler_argument_types.py::test_transpile_py_matrix_coordinates_type[args1-expectation1]", "tests/test_release_transpiler.py::test_check_version_exists_for_coordinates[Fail1]", "tests/test_release_transpiler_argument_types.py::test_transpile_py_matrix_file_type[args3-expectation3]", "tests/test_yaml_file_types.py::test_release_file_yaml_type[invalid_release_file_float_package_version]", "tests/test_lint_maturity.py::test_msg_release_exception", "tests/test_fetch.py::test_fetch_git_hash", "tests/test_yaml_file_types.py::test_release_name_invalid[bleeding.yml]", "tests/test_post_messages.py::test_get_messages", "tests/test_release_transpiler_argument_types.py::test_combine_py_override_mapping_type[args2-expectation2]", "tests/test_yaml_file_types.py::test_release_name_invalid[bleeding]", "tests/test_release_transpiler_argument_types.py::test_combine_py_release_folder_type[args2-expectation2]", "tests/test_suggester.py::test_release_from_file_name[releases/2019.12.rc0.yml-2019.12.rc0]", "tests/test_up_to_date_pypi.py::test_compatible_versions[Pre-release", "tests/test_lint_upgrade_proposals.py::test_lint[invalid_upgrade_proposals_float_package_name]", "tests/test_release_cleanup.py::test_unused_versions", "tests/test_yaml_file_types.py::test_repository_file_lint_maintainer[lint_maintainer_throws_on_missing_package0]", "tests/test_non_deployed.py::test_output_formatter[release_list1-True-[\"a\"]]", "tests/test_shebang_fixer.py::test_fixup_python_shebangs", "tests/test_build.py::test_make_one_pip_package_different_name", "tests/test_yaml_file_types.py::test_package_status_file_type[invalid_package_status__multiple_errors]", "tests/test_release_transpiler_argument_types.py::test_combine_py_override_mapping_type[args1-expectation1]", "tests/test_extract_dep_graph.py::test_extract_dep_graph", "tests/test_lint_upgrade_proposals.py::test_lint[upgrade_proposals_duplicate_packages]", "tests/test_up_to_date_pypi.py::test_insert_upgrade_proposals[Nothing", "tests/test_release_transpiler_argument_types.py::test_transpile_py_matrix_coordinates_type[args4-expectation4]", "tests/test_release_transpiler_argument_types.py::test_combine_py_release_folder_type[args0-expectation0]", "tests/test_yaml_file_types.py::test_repository_file_yaml_type[invalid_repository_file_float_maintainer]", "tests/test_enable_scipts.py::test_enable_bash_with_presets", "tests/test_yaml_file_types.py::test_package_status_file_type[invalid_package_status__invalid_visibility_value]", "tests/test_yaml_file_types.py::test_repository_file_lint_maintainer[lint_maintainer_throws_on_missing_package1]", "tests/test_link_io_structure.py::test_link_error", "tests/test_release_cleanup.py::test_return_values_of_prettier", "tests/test_fetch.py::test_version_plus_marker", "tests/test_suggester.py::test_monthly_diff_releases[2019.12.rc0-py27-2020.02.a0-py37--2]", "tests/test_release_transpiler_argument_types.py::test_transpile_py_matrix_file_type[args0-expectation0]", "tests/test_up_to_date_pypi.py::test_get_pypi_packages[Minimum", "tests/test_release_transpiler_argument_types.py::test_transpile_py_matrix_file_type[args4-expectation4]", "tests/test_release_transpiler_argument_types.py::test_combine_py_release_folder_type[args4-expectation4]", "tests/test_yaml_file_types.py::test_repository_file_yaml_type[invalid_repository_file_float_dependency]", "tests/test_yaml_file_types.py::test_repository_file_yaml_type[invalid_repository_file_missing_maintainer]", "tests/test_yaml_file_types.py::test_release_name_valid[bleeding-py36.yml]", "tests/test_yaml_file_types.py::test_repository_file_yaml_type[invalid_repository_file_float_package_name]", "tests/test_release_transpiler_argument_types.py::test_combine_py_override_mapping_type[args3-expectation3]", "tests/test_insert_proposals.py::test_insert_proposals[branch_already_exists]", "tests/test_prettier.py::test_release_prettifying", "tests/test_lint_maturity.py::test_read_yaml_file", "tests/test_insert_proposals.py::test_insert_proposals[with_upgrade_proposal]", "tests/test_lint_maturity.py::test_count_invalid_tags[invalid_tags0-1]", "tests/test_up_to_date_pypi.py::test_compatible_versions[Latest", "tests/test_release_transpiler_argument_types.py::test_transpile_py_matrix_coordinates_type[args3-expectation3]", "tests/test_yaml_file_types.py::test_repository_file_yaml_type[valid_repository_file]", "tests/test_non_deployed.py::test_output_formatter[release_list3-True-[\"a\",\"b\"]]", "tests/test_fetch.py::test_fetch_git_does_not_accept_pypi_package_name", "tests/test_suggester.py::test_monthly_diff_releases[2019.12.00-py27-2019.07.02-5]", "tests/test_up_to_date_pypi.py::test_run", "tests/test_show_version.py::test_get_release_fails_without_env_var", "tests/test_release_transpiler.py::test_check_version_exists_for_coordinates[Fail0]", "tests/test_lint_maturity.py::test_msg_packages_invalid[2020.02.rc1-py27.yml-rc-3]", "tests/test_data.py::test_non_existing_extra_data_dir", "tests/test_release_transpiler_argument_types.py::test_transpile_py_matrix_file_type[args1-expectation1]", "tests/test_lint_maturity.py::test_get_release_type[2020.02.b1-b]", "tests/test_matrix.py::test_get_matrix_base[1970.12.04-py38-rhel7-1970.12.04]", "tests/test_yaml_file_types.py::test_package_status_file_type[invalid_package_status__missing_visibility]", "tests/test_release_transpiler_argument_types.py::test_transpile_py_output_folder_type[args3-expectation3]", "tests/test_lint_maturity.py::test_msg_packages_invalid[2020.02.b1-py27.yml-b-2]", "tests/test_yaml_file_types.py::test_repository_file_lint_maintainer[lint_maintainer_returns_valid]", "tests/test_release_transpiler_argument_types.py::test_transpile_py_matrix_file_type[args5-expectation5]", "tests/test_lint_maturity.py::test_get_release_version[2020.02.rc1-py27.yml-rc]", "tests/test_link_io_structure.py::test_root_link_error", "tests/test_lint_maturity.py::test_count_invalid_tags[invalid_tags4-4]", "tests/test_lint_upgrade_proposals.py::test_lint[invalid_upgrade_proposals_float_package_version]", "tests/test_suggester.py::test_monthly_diff_releases[2019.12.00-py27-2019.12.rc0-0]", "tests/test_yaml_file_types.py::test_repository_file_yaml_type[invalid_repository_file_duplicate_packages]", "tests/test_release_transpiler_argument_types.py::test_transpile_py_matrix_coordinates_type[args2-expectation2]", "tests/test_yaml_file_types.py::test_release_name_invalid[bleeding-py36]", "tests/test_insert_proposals.py::test_insert_proposals[empty_upgrade_proposal]", "tests/test_lint_maturity.py::test_msg_packages_invalid[2020.02.a1-py27.yml-a-1]", "tests/test_link_io_structure.py::test_executables", "tests/test_up_to_date_pypi.py::test_get_pypi_packages[No", "tests/test_matrix.py::test_get_matrix_base[1970.12.03-1970.12.03]", "tests/test_post_messages.py::test_main_missing_message_file", "tests/test_yaml_file_types.py::test_release_name_valid[myrelease-py36-rhel6.yml]", "tests/test_link_io_structure.py::test_root_folder_error", "tests/test_yaml_file_types.py::test_package_status_file_type[invalid_package_status__public_visibility_invalid_maturity]", "tests/test_release_transpiler_argument_types.py::test_combine_py_release_folder_type[args3-expectation3]", "tests/test_enable_scipts.py::test_enable_bash_nopresets", "tests/test_yaml_file_types.py::test_release_name_invalid[2020.01.01]", "tests/test_lint_maturity.py::test_msg_packages_invalid[2020.02.01-py27.yml-stable-4]", "tests/test_cli.py::test_pyver_is_deprecated", "tests/test_yaml_file_types.py::test_release_name_invalid[2020.01.00.yml]", "tests/test_lint_maturity.py::test_get_release_type[2020.02.a1-a]", "tests/test_yaml_file_types.py::test_repository_file_yaml_type[invalid_repository_file_dependency_missing]", "tests/test_up_to_date_pypi.py::test_main_upgrade_proposal", "tests/test_lint_maturity.py::test_get_release_type[2020.02.rc1-rc]", "tests/test_yaml_file_types.py::test_release_file_yaml_type[invalid_release_file_None_package_version]", "tests/test_yaml_file_types.py::test_repository_file_yaml_type[invalid_repository_file_duplicate_versions]", "tests/test_yaml_file_types.py::test_repository_file_yaml_type[invalid_repository_file_float_package_version]", "tests/test_suggester.py::test_py_ver[2019.12.00-py3-py3]", "tests/test_post_messages.py::test_main_success", "tests/test_up_to_date_pypi.py::test_get_pypi_packages[Not", "tests/test_yaml_file_types.py::test_release_name_valid[/home/anyuser/komodo/2020.01.03-py36-rhel6.yml]", "tests/test_extract_dep_graph.py::test_extract_dep_graph_base_file_faulty_version", "tests/test_release_transpiler_argument_types.py::test_combine_py_override_mapping_type[args5-expectation5]", "tests/test_lint_maturity.py::test_lint_maturity_run", "tests/test_up_to_date_pypi.py::test_compatible_versions[Too", "tests/test_lint_maturity.py::test_count_invalid_tags[invalid_tags2-3]", "tests/test_lint_maturity.py::test_get_release_type[bleeding-invalid]", "tests/test_yaml_file_types.py::test_package_status_file_type[invalid_package_status__public_visibility_invalid_importance]", "tests/test_up_to_date_pypi.py::test_compatible_versions[Just", "tests/test_release_transpiler_argument_types.py::test_transpile_py_output_folder_type[args5-expectation5]", "tests/test_yaml_file_types.py::test_package_status_file_type[valid_package_status__private_visibility]", "tests/test_release_transpiler_argument_types.py::test_combine_py_coords_type[args1-expectation1]", "tests/test_lint_maturity.py::test_get_release_version[2020.02.b1-py27.yml-b]", "tests/test_show_version.py::test_get_version_with_filepath", "tests/test_build.py::test_make_sh_does_not_accept_pypi_package_name", "tests/test_suggester.py::test_path_is_release[releases/foo.yml-True]", "tests/test_yaml_file_types.py::test_release_file_yaml_type[invalid_release_file_float_package_name]", "tests/test_matrix.py::test_get_matrix_base[1970.12.rc0-foo-py38-rhel7-1970.12.rc0-foo]", "tests/test_prettier.py::test_repository_prettifying", "tests/test_reverse_dep_graph.py::test_extract_missing_pkg_in_repo", "tests/test_lint_upgrade_proposals.py::test_lint[valid_input_files]", "tests/test_show_version.py::test_package_not_found_error_using_manifest", "tests/test_suggester.py::test_path_is_release[foo/bar.yml-False]", "tests/test_yaml_file_types.py::test_package_status_file_type[invalid_package_status__public_visibility_missing_maturity]", "tests/test_extract_dep_graph.py::test_extract_dep_graph_base_file_missing_pkg", "tests/test_release_transpiler_argument_types.py::test_transpile_py_matrix_file_type[args2-expectation2]", "tests/test_lint_upgrade_proposals.py::test_lint[invalid_upgrade_proposals_multiple_errors]", "tests/test_release_transpiler_argument_types.py::test_combine_py_override_mapping_type[args0-expectation0]", "tests/test_release_transpiler_argument_types.py::test_combine_py_coords_type[args0-expectation0]"], "language": "python", "test_command": "source /saved/ENV || source /saved/*/ENV && pytest --no-header -rA --tb=no -p no:cacheprovider --continue-on-collection-errors", "test_output_parser": "python/parse_log_pytest_v3", "image_storage_uri": "vmvm-registry.fbinfra.net/repomate_image_activ_pytest/equinor_komodo:e9d9686cc72b5a1bda2c23b20e2bc3386d4275b4", "patch": "[\"diff --git a/komodo/yaml_file_types.py b/komodo/yaml_file_types.py\\nindex c910453f..076dfbeb 100644\\n--- a/komodo/yaml_file_types.py\\n+++ b/komodo/yaml_file_types.py\\n@@ -197,21 +197,36 @@ def validate_package_entry(\\n         self, package_name: str, package_version: str\\n     ) -> komodo_error:\\n         repository_entries = self.content\\n-        if package_name not in repository_entries:\\n+        if package_name not in repository_entries.keys():\\n+            for real_packagename in [\\n+                lowercase_pkg\\n+                for lowercase_pkg in repository_entries.keys()\\n+                if lowercase_pkg.lower() == package_name.lower()\\n+            ]:\\n+                raise KomodoException(\\n+                    f\\\"Package '{package_name}' not found in repository. Did you mean\\\"\\n+                    f\\\" '{real_packagename}'?\\\"\\n+                )\\n             raise KomodoException(f\\\"Package '{package_name}' not found in repository\\\")\\n         if package_version not in repository_entries[package_name]:\\n+            if f\\\"v{package_version}\\\" in repository_entries[package_name]:\\n+                raise KomodoException(\\n+                    f\\\"Version '{package_version}' of package '{package_name}' not found\\\"\\n+                    f\\\" in repository. Did you mean 'v{package_version}'?\\\"\\n+                )\\n             raise KomodoException(\\n                 f\\\"Version '{package_version}' of package '{package_name}' not found in\\\"\\n-                \\\" repository\\\"\\n+                \\\" repository. Did you mean\\\"\\n+                f\\\" '{list(repository_entries[package_name].keys())[0]}'?\\\"\\n             )\\n \\n     def lint_maintainer(self, package, version) -> komodo_error:\\n         repository_entries = self.content\\n-        if package not in repository_entries:\\n-            raise KomodoException(_komodo_error(package=package, err=MISSING_PACKAGE))\\n-        if version not in repository_entries[package]:\\n+        try:\\n+            self.validate_package_entry(package, version)\\n+        except KomodoException as e:\\n             raise KomodoException(\\n-                _komodo_error(package=package, version=version, err=MISSING_VERSION)\\n+                _komodo_error(package=package, version=version, err=e)\\n             )\\n         return _komodo_error(\\n             package=package,\\n@@ -457,9 +472,7 @@ class Package:\\n     @staticmethod\\n     def validate_package_name(package_name: str) -> None:\\n         if isinstance(package_name, str):\\n-            if str.islower(package_name):\\n-                return\\n-            raise ValueError(f\\\"Package name '{package_name}' should be lowercase.\\\")\\n+            return\\n         raise TypeError(f\\\"Package name ({package_name}) should be of type string\\\")\\n \\n     @staticmethod\\n@@ -653,13 +666,7 @@ def validate_package_property_type(\\n         package_property: str,\\n         package_property_value: str,\\n     ):\\n-        if isinstance(package_property, str):\\n-            if not package_property.islower():\\n-                raise ValueError(\\n-                    f\\\"Package '{package_name}' version '{package_version}' property\\\"\\n-                    f\\\" should be lowercase ({package_property})\\\"\\n-                )\\n-        else:\\n+        if not isinstance(package_property, str):\\n             raise TypeError(\\n                 f\\\"Package '{package_name}' version has invalid property type\\\"\\n                 f\\\" ({package_property})\\\"\\n\",\"diff --git a/komodo/cleanup.py b/komodo/cleanup.py\\nindex e839a6e1..7bae24d8 100755\\n--- a/komodo/cleanup.py\\n+++ b/komodo/cleanup.py\\n@@ -1,35 +1,33 @@\\n #!/usr/bin/env python\\n \\n-import yaml as yml\\n+import sys\\n+from typing import List\\n \\n+from komodo.yaml_file_types import ReleaseFile, RepositoryFile\\n \\n-def cleanup(repofile, releasefiles):\\n-    with open(repofile, \\\"r\\\", encoding=\\\"utf-8\\\") as r:\\n-        repo = yml.safe_load(r)\\n-    rels = []\\n-    for fname in releasefiles:\\n-        with open(fname, \\\"r\\\", encoding=\\\"utf-8\\\") as f:\\n-            rels.append(yml.safe_load(f))\\n \\n-    if not isinstance(repo, dict):\\n-        raise ValueError(f\\\"Malformed package file: {type(repo)}\\\")\\n-    for rel in rels:\\n-        if not isinstance(rel, dict):\\n-            raise ValueError(f\\\"Malformed repository file: {type(rel)}\\\")\\n+def cleanup(repository_file_path: str, release_files_path: List[str]):\\n+    repository_file = RepositoryFile()(repository_file_path)\\n+    repository = repository_file.content\\n \\n-    registered_versions = []\\n-    for pkg in repo:\\n-        for v in repo[pkg]:\\n-            registered_versions.append((pkg, v))\\n+    releases = []\\n+    for file_name in release_files_path:\\n+        release_file = ReleaseFile()(file_name)\\n+        releases.append(release_file.content)\\n \\n-    seen_versions = set()\\n-    for rel in rels:\\n-        for pkg in rel:\\n-            seen_versions.add((pkg, rel[pkg]))\\n+    registered_package_version_combinations = []\\n+    for package in repository:\\n+        for version in repository[package]:\\n+            registered_package_version_combinations.append((package, version))\\n+\\n+    seen_package_version_combinations = set()\\n+    for release in releases:\\n+        for package_name, package_version in release.items():\\n+            seen_package_version_combinations.add((package_name, package_version))\\n \\n     seen_all = True\\n-    for ver in registered_versions:\\n-        if ver not in seen_versions:\\n+    for ver in registered_package_version_combinations:\\n+        if ver not in seen_package_version_combinations:\\n             if seen_all:\\n                 print(\\\"unused:\\\")\\n                 seen_all = False\\n@@ -38,12 +36,14 @@ def cleanup(repofile, releasefiles):\\n         print(\\\"ok\\\")\\n \\n \\n-if __name__ == \\\"__main__\\\":\\n-    import sys\\n-\\n+def main():\\n     if len(sys.argv) < 3:\\n-        exit(\\\"usage: komodo.cleanup repo.yml rel1.yml rel2.yml ... reln.yml\\\")\\n+        exit(\\\"usage: komodo.cleanup repository.yml rel1.yml rel2.yml ... reln.yml\\\")\\n \\n-    repo = sys.argv[1]\\n+    repository = sys.argv[1]\\n     releases = sys.argv[2:]\\n-    cleanup(repo, releases)\\n+    cleanup(repository, releases)\\n+\\n+\\n+if __name__ == \\\"__main__\\\":\\n+    main()\\n\",\"diff --git a/komodo/deployed.py b/komodo/deployed.py\\nindex 538df2cb..cdc8338d 100644\\n--- a/komodo/deployed.py\\n+++ b/komodo/deployed.py\\n@@ -4,6 +4,7 @@\\n from typing import List, Optional\\n \\n from komodo.matrix import get_matrix_base\\n+from komodo.yaml_file_types import ReleaseDir\\n \\n \\n def _is_release(path):\\n@@ -46,25 +47,23 @@ def output_formatter(release_list: List[str], do_json: bool = False) -> str:\\n \\n def deployed_main():\\n     parser = argparse.ArgumentParser(\\n-        description=(\\n-            \\\"\\\"\\\"Outputs the name of undeployed matrices given an installation\\n+        description=\\\"\\\"\\\"Outputs the name of undeployed matrices given an installation\\n             root and a release folder. A partially deployed matrix is\\n-            considered deployed.\\\"\\\"\\\"\\n-        ),\\n+            considered deployed.\\\"\\\"\\\",\\n         formatter_class=argparse.ArgumentDefaultsHelpFormatter,\\n     )\\n     parser.add_argument(\\n         \\\"install_root\\\",\\n-        type=lambda arg: os.path.realpath(arg)\\n-        if os.path.isdir(arg)\\n-        else parser.error(f\\\"{arg} is not a directory\\\"),\\n+        type=lambda arg: (\\n+            os.path.realpath(arg)\\n+            if os.path.isdir(arg)\\n+            else parser.error(f\\\"{arg} is not a directory\\\")\\n+        ),\\n         help=\\\"The root folder of the deployed matrices\\\",\\n     )\\n     parser.add_argument(\\n         \\\"releases_folder\\\",\\n-        type=lambda arg: os.path.realpath(arg)\\n-        if os.path.isdir(arg)\\n-        else parser.error(f\\\"{arg} is not a directory\\\"),\\n+        type=ReleaseDir(),\\n         help=\\\"The folder containing the matrix files\\\",\\n     )\\n     parser.add_argument(\\n\",\"diff --git a/komodo/extract_dep_graph.py b/komodo/extract_dep_graph.py\\nindex 9b613aa5..1679fb7e 100644\\n--- a/komodo/extract_dep_graph.py\\n+++ b/komodo/extract_dep_graph.py\\n@@ -1,12 +1,19 @@\\n import argparse\\n import os\\n \\n-import yaml\\n+from ruamel.yaml import YAML\\n+\\n+from komodo.yaml_file_types import RepositoryFile\\n \\n \\n def run(pkgfile, base_pkgfile, repofile, outfile=None):\\n     with open(pkgfile) as p, open(base_pkgfile) as bp, open(repofile) as r:\\n-        pkgs, base_pkgs, repo = yaml.safe_load(p), yaml.safe_load(bp), yaml.safe_load(r)\\n+        yaml = YAML()\\n+        pkgs, base_pkgs, repo = (\\n+            yaml.load(p),\\n+            yaml.load(bp),\\n+            yaml.load(r),\\n+        )\\n \\n     result = _iterate_packages(pkgs, base_pkgs, repo)\\n \\n@@ -61,30 +68,30 @@ def main():\\n     )\\n     parser.add_argument(\\n         \\\"pkgs\\\",\\n-        type=lambda arg: arg\\n-        if os.path.isfile(arg)\\n-        else parser.error(f\\\"{arg} is not a file\\\"),\\n+        type=lambda arg: (\\n+            arg if os.path.isfile(arg) else parser.error(f\\\"{arg} is not a file\\\")\\n+        ),\\n         help=\\\"File with packages you want to resolve dependencies for.\\\",\\n     )\\n     parser.add_argument(\\n         \\\"base_pkgs\\\",\\n-        type=lambda arg: arg\\n-        if os.path.isfile(arg)\\n-        else parser.error(f\\\"{arg} is not a file\\\"),\\n+        type=lambda arg: (\\n+            arg if os.path.isfile(arg) else parser.error(f\\\"{arg} is not a file\\\")\\n+        ),\\n         help=\\\"Base file where all packages are listed with wanted versions specified.\\\",\\n     )\\n     parser.add_argument(\\n         \\\"repo\\\",\\n-        type=lambda arg: arg\\n-        if os.path.isfile(arg)\\n-        else parser.error(f\\\"{arg} is not a file\\\"),\\n+        type=RepositoryFile(),\\n         help=\\\"Repository file with all packages listed with dependencies.\\\",\\n     )\\n     parser.add_argument(\\n         \\\"--out\\\",\\n         \\\"-o\\\",\\n-        help=\\\"File to be written with resolved dependencies. \\\"\\n-        \\\"If not specified dump to stdout.\\\",\\n+        help=(\\n+            \\\"File to be written with resolved dependencies. \\\"\\n+            \\\"If not specified dump to stdout.\\\"\\n+        ),\\n     )\\n \\n     args = parser.parse_args()\\n\",\"diff --git a/komodo/fetch.py b/komodo/fetch.py\\nindex 67aceabf..331006f3 100644\\n--- a/komodo/fetch.py\\n+++ b/komodo/fetch.py\\n@@ -14,7 +14,7 @@\\n     strip_version,\\n )\\n from komodo.shell import pushd, shell\\n-from komodo.yaml_file_types import YamlFile\\n+from komodo.yaml_file_types import ReleaseFile, RepositoryFile\\n \\n \\n def eprint(*args, **kwargs):\\n@@ -38,10 +38,16 @@ def grab(path, filename=None, version=None, protocol=None, pip=\\\"pip\\\"):\\n         )\\n \\n     elif protocol in (\\\"nfs\\\", \\\"fs-ln\\\"):\\n-        shell(f\\\"cp --recursive --symbolic-link {path} {filename}\\\")\\n+        if sys.platform == \\\"darwin\\\":\\n+            shell(f\\\"cp -Rs {path} {filename}\\\")\\n+        else:\\n+            shell(f\\\"cp --recursive --symbolic-link {path} {filename}\\\")\\n \\n     elif protocol in (\\\"fs-cp\\\"):\\n-        shell(f\\\"cp --recursive {path} {filename}\\\")\\n+        if sys.platform == \\\"darwin\\\":\\n+            shell(f\\\"cp -R {path} {filename}\\\")\\n+        else:\\n+            shell(f\\\"cp --recursive {path} {filename}\\\")\\n \\n     elif protocol in (\\\"rsync\\\"):\\n         shell(f\\\"rsync -a {path}/ {filename}\\\")\\n@@ -62,7 +68,7 @@ def fetch(pkgs, repo, outdir, pip=\\\"pip\\\") -> dict:\\n     for pkg in missingver:\\n         eprint(\\n             f\\\"missingver: missing version for {pkg}: {pkgs[pkg]} requested, \\\"\\n-            f'found: {\\\",\\\".join(repo[pkg].keys())}'\\n+            f\\\"found: {','.join(repo[pkg].keys())}\\\"\\n         )\\n \\n     if missingpkg or missingver:\\n@@ -161,13 +167,12 @@ def fetch(pkgs, repo, outdir, pip=\\\"pip\\\") -> dict:\\n     )\\n     parser.add_argument(\\n         \\\"pkgfile\\\",\\n-        type=YamlFile(),\\n-        help=\\\"A Komodo release file mapping package name to version, \\\"\\n-        \\\"in YAML format.\\\",\\n+        type=ReleaseFile(),\\n+        help=\\\"A Komodo release file mapping package name to version, in YAML format.\\\",\\n     )\\n     parser.add_argument(\\n         \\\"repofile\\\",\\n-        type=YamlFile(),\\n+        type=RepositoryFile(),\\n         help=\\\"A Komodo repository file, in YAML format.\\\",\\n     )\\n     parser.add_argument(\\n@@ -175,8 +180,10 @@ def fetch(pkgs, repo, outdir, pip=\\\"pip\\\") -> dict:\\n         \\\"-o\\\",\\n         type=str,\\n         required=True,\\n-        help=\\\"The download destination for pip, cp, rsync and git. \\\"\\n-        \\\"Must be non-existing or empty.\\\",\\n+        help=(\\n+            \\\"The download destination for pip, cp, rsync and git. \\\"\\n+            \\\"Must be non-existing or empty.\\\"\\n+        ),\\n     )\\n     parser.add_argument(\\n         \\\"--pip\\\",\\n@@ -185,4 +192,9 @@ def fetch(pkgs, repo, outdir, pip=\\\"pip\\\") -> dict:\\n         help=\\\"The command to use for downloading pip packages.\\\",\\n     )\\n     args = parser.parse_args()\\n-    fetch(args.pkgfile, args.repofile, outdir=args.output, pip=args.pip)\\n+    fetch(\\n+        args.content.pkgfile,\\n+        args.content.repofile,\\n+        outdir=args.content.output,\\n+        pip=args.pip,\\n+    )\\n\",\"diff --git a/komodo/insert_proposals.py b/komodo/insert_proposals.py\\nindex b94d565c..2183bf79 100644\\n--- a/komodo/insert_proposals.py\\n+++ b/komodo/insert_proposals.py\\n@@ -6,13 +6,20 @@\\n from datetime import datetime\\n \\n import github\\n-import ruamel.yaml\\n-from github import Github, UnknownObjectException\\n+from github import Github, Repository, UnknownObjectException\\n \\n from komodo.prettier import write_to_string\\n+from komodo.yaml_file_types import (\\n+    KomodoException,\\n+    ReleaseFile,\\n+    RepositoryFile,\\n+    UpgradeProposalsFile,\\n+)\\n \\n \\n def recursive_update(left, right):\\n+    if right is None:\\n+        return None\\n     for k, v in right.items():\\n         if isinstance(v, collections.abc.Mapping):\\n             d_val = left.get(k)\\n@@ -46,68 +53,67 @@ def diff_file_and_string(file_contents, string, leftname, rightname):\\n     )\\n \\n \\n-def load_yaml_from_repo(filename, repo, ref):\\n-    ruamel_instance = ruamel.yaml.YAML()\\n-    ruamel_instance.indent(  # Komodo prefers two space indendation\\n-        mapping=2, sequence=4, offset=2\\n-    )\\n-    ruamel_instance.width = 1000  # Avoid ruamel wrapping long\\n-\\n-    try:\\n-        sym_conf_content = repo.get_contents(filename, ref=ref)\\n-\\n-        input_dict = ruamel_instance.load(b64decode(sym_conf_content.content))\\n-        return input_dict\\n-\\n-    except (\\n-        ruamel.yaml.scanner.ScannerError,\\n-        ruamel.yaml.constructor.DuplicateKeyError,\\n-    ) as e:\\n-        raise SystemExit(f\\\"The file: <{filename}> contains invalid YAML syntax:\\\\n {e}\\\")\\n+def load_yaml_from_repo(filename, repo, ref) -> bytes:\\n+    sym_conf_content = repo.get_contents(filename, ref=ref)\\n+    input_dict = b64decode(sym_conf_content.content)\\n+    return input_dict\\n \\n \\n def main():\\n     args = parse_args()\\n     repo = _get_repo(os.getenv(\\\"GITHUB_TOKEN\\\"), args.git_fork, args.git_repo)\\n     insert_proposals(\\n-        repo, args.base, args.target, args.git_ref, args.jobname, args.joburl\\n+        repo,\\n+        args.base,\\n+        args.target,\\n+        args.git_ref,\\n+        args.jobname,\\n+        args.joburl,\\n     )\\n \\n \\n+def verify_branch_does_not_exist(repo: Repository.Repository, branch_name: str) -> None:\\n+    try:\\n+        repo.get_branch(branch_name)\\n+    except github.GithubException:\\n+        pass\\n+    else:\\n+        raise ValueError(f\\\"Branch {branch_name} exists already\\\")\\n+\\n+\\n def insert_proposals(repo, base, target, git_ref, jobname, joburl) -> None:\\n     year = target.split(\\\".\\\")[0]\\n     month = target.split(\\\".\\\")[1]\\n     tmp_target = target + \\\".tmp\\\"\\n \\n     # check that the branches do not already exist\\n-    try:\\n-        repo.get_branch(target)\\n-    except github.GithubException:\\n-        pass\\n-    else:\\n-        raise ValueError(f\\\"Branch {target} exists already\\\")\\n-\\n-    try:\\n-        repo.get_branch(tmp_target)\\n-    except github.GithubException:\\n-        pass\\n-    else:\\n-        raise ValueError(f\\\"Branch {tmp_target} exists already\\\")\\n+    verify_branch_does_not_exist(repo, target)\\n+    verify_branch_does_not_exist(repo, tmp_target)\\n \\n     # create contents of new release\\n-    proposal_yaml = load_yaml_from_repo(\\\"upgrade_proposals.yml\\\", repo, git_ref)\\n+    proposals_yaml_string = load_yaml_from_repo(\\\"upgrade_proposals.yml\\\", repo, git_ref)\\n+    proposal_file = UpgradeProposalsFile().from_yaml_string(proposals_yaml_string)\\n     upgrade_key = f\\\"{year}-{month}\\\"\\n-    upgrade = proposal_yaml.get(upgrade_key)\\n-    if upgrade_key not in proposal_yaml:\\n-        raise ValueError(\\n-            f\\\"No section for this release ({upgrade_key}) in upgrade_proposals.yml\\\"\\n-        )\\n+    upgrade = proposal_file.content.get(upgrade_key)\\n+    proposal_file.validate_upgrade_key(upgrade_key)\\n+\\n     base_file = f\\\"releases/matrices/{base}.yml\\\"\\n     target_file = f\\\"releases/matrices/{target}.yml\\\"\\n-    base_dict = load_yaml_from_repo(base_file, repo, git_ref)\\n+    repofile_yaml_string = load_yaml_from_repo(\\\"repository.yml\\\", repo, git_ref)\\n+    repofile = RepositoryFile().from_yaml_string(repofile_yaml_string)\\n+    release_file_yaml_string = load_yaml_from_repo(base_file, repo, git_ref)\\n+    base_dict = ReleaseFile().from_yaml_string(release_file_yaml_string)\\n     if upgrade:\\n-        recursive_update(base_dict, upgrade)\\n-    result = write_to_string(base_dict)\\n+        errors = []\\n+        for package_name, package_version in upgrade.items():\\n+            try:\\n+                repofile.validate_package_entry(package_name, package_version)\\n+            except KomodoException as e:\\n+                errors.append(e.error)\\n+        if errors:\\n+            raise SystemExit(\\\"\\\\n\\\".join(errors))\\n+    recursive_update(base_dict.content, upgrade)\\n+    result = write_to_string(base_dict.content)\\n \\n     # create new release file\\n     from_sha = repo.get_branch(git_ref).commit.sha\\n@@ -120,8 +126,8 @@ def insert_proposals(repo, base, target, git_ref, jobname, joburl) -> None:\\n     )\\n \\n     # clean the proposal file\\n-    proposal_yaml[upgrade_key] = None\\n-    cleaned_upgrade = write_to_string(proposal_yaml, False)\\n+    proposal_file.content[upgrade_key] = None\\n+    cleaned_upgrade = write_to_string(proposal_file.content, False)\\n     upgrade_contents = repo.get_contents(\\\"upgrade_proposals.yml\\\", ref=git_ref)\\n     repo.update_file(\\n         \\\"upgrade_proposals.yml\\\",\\n@@ -189,8 +195,10 @@ def parse_args():\\n     parser.add_argument(\\n         \\\"base\\\",\\n         type=str,\\n-        help=\\\"The name of the release to base on. (E.g. 2021.06.b0). \\\"\\n-        \\\"A corresponding file must exist in releases/matrices\\\",\\n+        help=(\\n+            \\\"The name of the release to base on. (E.g. 2021.06.b0). \\\"\\n+            \\\"A corresponding file must exist in releases/matrices\\\"\\n+        ),\\n     )\\n     parser.add_argument(\\n         \\\"target\\\",\\n\",\"diff --git a/komodo/lint.py b/komodo/lint.py\\nindex 26856fa9..60ea7917 100755\\n--- a/komodo/lint.py\\n+++ b/komodo/lint.py\\n@@ -2,19 +2,22 @@\\n \\n import argparse\\n import logging\\n-import os\\n import warnings\\n from collections import namedtuple\\n \\n-import yaml as yml\\n from pkg_resources import PkgResourcesDeprecationWarning, parse_version\\n \\n-kerr = namedtuple(\\\"KomodoError\\\", [\\\"pkg\\\", \\\"version\\\", \\\"maintainer\\\", \\\"depends\\\", \\\"err\\\"])\\n+from komodo.yaml_file_types import KomodoException, ReleaseFile, RepositoryFile\\n+\\n+komodo_error = namedtuple(\\n+    \\\"KomodoError\\\", [\\\"package\\\", \\\"version\\\", \\\"maintainer\\\", \\\"depends\\\", \\\"err\\\"]\\n+)\\n \\n report = namedtuple(\\n     \\\"LintReport\\\", [\\\"release_name\\\", \\\"maintainers\\\", \\\"dependencies\\\", \\\"versions\\\"]\\n )\\n \\n+\\n MISSING_PACKAGE = \\\"missing package\\\"\\n MISSING_VERSION = \\\"missing version\\\"\\n MISSING_DEPENDENCY = \\\"missing dependency\\\"\\n@@ -26,129 +29,76 @@\\n FLOAT_VERSION = \\\"dangerous version (float interpretable)\\\"\\n \\n \\n-def _kerr(pkg=None, version=None, maintainer=None, depends=None, err=None):\\n-    return kerr(\\n-        pkg=pkg, version=version, maintainer=maintainer, depends=depends, err=err\\n+def _komodo_error(package=None, version=None, maintainer=None, depends=None, err=None):\\n+    return komodo_error(\\n+        package=package,\\n+        version=version,\\n+        maintainer=maintainer,\\n+        depends=depends,\\n+        err=err,\\n     )\\n \\n \\n-def _validate(pkg, ver, repo):\\n-    if pkg not in repo:\\n-        return _kerr(pkg=pkg, err=MISSING_PACKAGE)\\n-    if ver not in repo[pkg]:\\n-        return _kerr(pkg=pkg, version=ver, err=MISSING_VERSION)\\n-    if \\\"maintainer\\\" not in repo[pkg][ver]:\\n-        return _kerr(pkg=pkg, version=ver, err=MISSING_MAINTAINER)\\n-    if \\\"make\\\" not in repo[pkg][ver]:\\n-        return _kerr(pkg=pkg, version=ver, err=MISSING_MAKE)\\n-    return _kerr(pkg=pkg, version=ver, maintainer=repo[pkg][ver][\\\"maintainer\\\"])\\n-\\n-\\n-def lint_release_name(pkgfile):\\n-    relname = os.path.basename(pkgfile)\\n-    found = False\\n-    for py_suffix in \\\"-py27\\\", \\\"-py36\\\", \\\"-py38\\\", \\\"-py310\\\":\\n-        for rh_suffix in \\\"\\\", \\\"-rhel6\\\", \\\"-rhel7\\\", \\\"-rhel8\\\":\\n-            if relname.endswith(py_suffix + rh_suffix + \\\".yml\\\"):\\n-                found = True\\n-                break\\n-    if not found:\\n-        return [\\n-            _kerr(\\n-                pkg=pkgfile,\\n-                err=\\\"Invalid release name suffix. \\\"\\n-                \\\"Must be of the form -pyXX[X] or -pyXX[X]-rhelY\\\",\\n-            )\\n-        ]\\n-\\n-    return []\\n-\\n-\\n-def lint_maintainers(pkgs, repo):\\n-    return [_validate(pkg, ver, repo) for pkg, ver in pkgs.items()]\\n-\\n-\\n-def __reg_version_err(errs, pkg, ver, maintainer, err=MALFORMED_VERSION):\\n-    errs.append(_kerr(pkg=pkg, version=ver, maintainer=maintainer, err=err))\\n-\\n-\\n-def lint_version_numbers(pkgs, repo):\\n-    errs = []\\n-    for pkg, ver in pkgs.items():\\n-        if pkg not in repo or ver not in repo[pkg]:\\n-            continue  # error caught previously\\n-\\n-        pv = repo[pkg][ver]\\n-        maintainer = pv.get(\\\"maintainer\\\", MISSING_MAINTAINER)\\n-        if isinstance(ver, float):\\n-            __reg_version_err(errs, pkg, ver, maintainer, FLOAT_VERSION)\\n-            continue\\n+def lint_version_numbers(package, version, repo):\\n+    pv = repo[package][version]\\n+    maintainer = pv.get(\\\"maintainer\\\", MISSING_MAINTAINER)\\n \\n+    try:\\n+        logging.info(\\\"Using %s %s\\\" % (package, version))\\n+        if \\\"main\\\" in version:\\n+            return _komodo_error(package, version, maintainer, err=MAIN_VERSION)\\n+        if \\\"master\\\" in version:\\n+            return _komodo_error(package, version, maintainer, err=MASTER_VERSION)\\n+        with warnings.catch_warnings():\\n+            warnings.simplefilter(\\\"ignore\\\", PkgResourcesDeprecationWarning)\\n+            v = parse_version(version)\\n+            # A warning coincides with finding \\\"Legacy\\\" in repr(v)\\n+        if \\\"Legacy\\\" in repr(v):  # don't know if possible to check otherwise\\n+            return _komodo_error(package, version, maintainer)\\n+    except:  # pylint: disable=bare-except  # noqa\\n+        # Log any exception:\\n+        return _komodo_error(package, version, maintainer)\\n+    return None\\n+\\n+\\n+def lint(release_file: ReleaseFile, repository_file: RepositoryFile):\\n+    mns, deps, versions = [], [], []\\n+    for package_name, package_version in release_file.content.items():\\n         try:\\n-            logging.info(\\\"Using %s %s\\\" % (pkg, ver))\\n-            if \\\"main\\\" in ver:\\n-                __reg_version_err(errs, pkg, ver, maintainer, err=MAIN_VERSION)\\n-                continue\\n-            if \\\"master\\\" in ver:\\n-                __reg_version_err(errs, pkg, ver, maintainer, err=MASTER_VERSION)\\n-                continue\\n-            with warnings.catch_warnings():\\n-                warnings.simplefilter(\\\"ignore\\\", PkgResourcesDeprecationWarning)\\n-                v = parse_version(ver)\\n-                # A warning coincides with finding \\\"Legacy\\\" in repr(v)\\n-            if \\\"Legacy\\\" in repr(v):  # don't know if possible to check otherwise\\n-                __reg_version_err(errs, pkg, ver, maintainer)\\n-        except:  # pylint: disable=bare-except  # noqa\\n-            # Log any exception:\\n-            __reg_version_err(errs, pkg, ver, maintainer)\\n-    return errs\\n-\\n-\\n-def lint_dependencies(pkgs, repo):\\n-    errs = []\\n-    for pkg, ver in pkgs.items():\\n-        if pkg not in repo or ver not in repo[pkg]:\\n-            continue  # error caught previously\\n-        pv = repo[pkg][ver]\\n-        maintainer = pv.get(\\\"maintainer\\\", MISSING_MAINTAINER)\\n-        if \\\"depends\\\" not in pv:\\n-            continue\\n-        missing = [d for d in pv[\\\"depends\\\"] if d not in pkgs]\\n-        if missing:\\n-            errs.append(\\n-                _kerr(\\n-                    pkg=pkg,\\n-                    version=ver,\\n-                    maintainer=maintainer,\\n-                    depends=missing,\\n-                    err=MISSING_DEPENDENCY,\\n-                )\\n+            lint_maintainer = repository_file.lint_maintainer(\\n+                package_name, package_version\\n+            )  # throws komodoexception on missing package or version in repository\\n+            if lint_maintainer:\\n+                mns.append(lint_maintainer)\\n+\\n+            lint_version_number = lint_version_numbers(\\n+                package_name, package_version, repository_file.content\\n             )\\n-    return errs\\n-\\n+            if lint_version_number:\\n+                versions.append(lint_version_number)\\n+            missing = []\\n+            repository_file_package_version_data = repository_file.content.get(\\n+                package_name\\n+            ).get(package_version)\\n+            for dependency in repository_file_package_version_data.get(\\\"depends\\\", []):\\n+                if dependency not in release_file.content:\\n+                    missing.append(dependency)\\n+            if missing:\\n+                deps.append(\\n+                    _komodo_error(\\n+                        package=package_name,\\n+                        version=package_version,\\n+                        depends=missing,\\n+                        err=(\\n+                            f\\\"{MISSING_DEPENDENCY} for {package_name} {package_version}\\\"\\n+                        ),\\n+                    )\\n+                )\\n+        except KomodoException as e:\\n+            mns.append(e.error)\\n \\n-def lint(pkgfile, repofile):\\n-    if isinstance(pkgfile, dict) and isinstance(repofile, dict):\\n-        release_name = []\\n-        pkgs, repo = pkgfile, repofile\\n-    else:\\n-        release_name = lint_release_name(pkgfile)\\n-        try:\\n-            with open(pkgfile, \\\"r\\\") as p, open(repofile, \\\"r\\\") as r:\\n-                pkgs, repo = yml.safe_load(p), yml.safe_load(r)\\n-        except yml.scanner.ScannerError as err:\\n-            raise ValueError(\\\"Malformed YAML: %s\\\" % str(err))\\n-\\n-    if not isinstance(pkgs, dict):\\n-        raise ValueError(\\\"Malformed package file: %s \\\" % str(type(pkgs)))\\n-    if not isinstance(repo, dict):\\n-        raise ValueError(\\\"Malformed repository file: %s\\\" % str(type(repo)))\\n-\\n-    mns = lint_maintainers(pkgs, repo)\\n-    deps = lint_dependencies(pkgs, repo)\\n-    vers = lint_version_numbers(pkgs, repo)\\n     return report(\\n-        release_name=release_name, maintainers=mns, dependencies=deps, versions=vers\\n+        release_name=[], maintainers=mns, dependencies=deps, versions=versions\\n     )\\n \\n \\n@@ -158,14 +108,13 @@ def get_args():\\n         formatter_class=argparse.ArgumentDefaultsHelpFormatter,\\n     )\\n     parser.add_argument(\\n-        \\\"pkgfile\\\",\\n-        type=str,\\n-        help=\\\"A Komodo release file mapping package name to version, \\\"\\n-        \\\"in YAML format.\\\",\\n+        \\\"packagefile\\\",\\n+        type=ReleaseFile(),\\n+        help=\\\"A Komodo release file mapping package name to version, in YAML format.\\\",\\n     )\\n     parser.add_argument(\\n         \\\"repofile\\\",\\n-        type=str,\\n+        type=RepositoryFile(),\\n         help=\\\"A Komodo repository file, in YAML format.\\\",\\n     )\\n     parser.add_argument(\\n@@ -184,20 +133,19 @@ def lint_main():\\n     logging.basicConfig(format=\\\"%(message)s\\\", level=args.loglevel)\\n \\n     try:\\n-        report = lint(args.pkgfile, args.repofile)\\n-        mns, deps, vers = report.maintainers, report.dependencies, report.versions\\n+        report = lint(args.packagefile, args.repofile)\\n+        mns, deps, versions = report.maintainers, report.dependencies, report.versions\\n     except ValueError as err:\\n         exit(str(err))\\n     print(\\\"%d packages\\\" % len(mns))\\n-    if not any([err.err for err in mns + deps + vers]):\\n+    if not any([err.err for err in mns + deps + versions]):\\n         print(\\\"No errors found\\\")\\n         exit(0)\\n \\n-    for err in mns + deps + vers:\\n+    for err in mns + deps + versions:\\n         if err.err:\\n-            ver = err.version if err.version else \\\"\\\"\\n             dep = \\\": %s\\\" % \\\", \\\".join(err.depends) if err.depends else \\\"\\\"\\n-            print(\\\"%s for %s %s%s\\\" % (err.err, err.pkg, ver, dep))\\n+            print(\\\"%s%s\\\" % (err.err, dep))\\n \\n     if not any([err.err for err in mns + deps]):\\n         exit(0)  # currently we allow erronous version numbers\\n\",\"diff --git a/komodo/lint_maturity.py b/komodo/lint_maturity.py\\nindex fd3d98ae..4bfa5a20 100644\\n--- a/komodo/lint_maturity.py\\n+++ b/komodo/lint_maturity.py\\n@@ -3,10 +3,13 @@\\n import argparse\\n import os\\n import warnings\\n+from typing import List\\n \\n import yaml\\n from packaging.version import InvalidVersion, Version\\n \\n+from komodo.yaml_file_types import ReleaseFile\\n+\\n _INVALID_TAGS = {\\n     \\\"a\\\": [\\\"invalid\\\"],\\n     \\\"b\\\": [\\\"a\\\", \\\"invalid\\\"],\\n@@ -63,9 +66,9 @@ def count_invalid_tags(dict_tag_maturity, invalid_tags):\\n     return invalid_tags_count\\n \\n \\n-def get_release_type(version_string):\\n+def get_release_type(version: str):\\n     try:\\n-        version = Version(version_string)\\n+        version = Version(version)\\n         release_type = \\\"stable\\\" if version.pre is None else version.pre[0]\\n     except InvalidVersion:\\n         release_type = \\\"invalid\\\"\\n@@ -73,7 +76,7 @@ def get_release_type(version_string):\\n     return release_type\\n \\n \\n-def get_packages_info(packages_dict, tag_exceptions_package):\\n+def get_packages_info(release_file: ReleaseFile, tag_exceptions_package):\\n     dict_tag_maturity = {\\n         \\\"a\\\": [],\\n         \\\"b\\\": [],\\n@@ -83,7 +86,7 @@ def get_packages_info(packages_dict, tag_exceptions_package):\\n         \\\"invalid\\\": [],\\n     }\\n \\n-    for package_name, package_version in packages_dict.items():\\n+    for package_name, package_version in release_file.content.items():\\n         if package_name not in tag_exceptions_package:\\n             release_version_package = get_release_type(package_version)\\n         else:\\n@@ -124,7 +127,7 @@ def get_release_version(release_basename, tag_exceptions_release):\\n     return release_version\\n \\n \\n-def run(files_to_lint, tag_exceptions):\\n+def run(files_to_lint: List[str], tag_exceptions):\\n     system_exit_msg = \\\"\\\"\\n     system_warning_msg = \\\"\\\"\\n \\n@@ -140,9 +143,9 @@ def run(files_to_lint, tag_exceptions):\\n                 release_basename + \\\" is incompatible with version name.\\\\n\\\"\\n             )\\n         else:\\n-            packages_dict = read_yaml_file(file_path=file_to_lint)\\n+            release_file = read_yaml_file_and_convert_to_release_file(file_to_lint)\\n             dict_tag_maturity = get_packages_info(\\n-                packages_dict, tag_exceptions[\\\"package\\\"]\\n+                release_file, tag_exceptions[\\\"package\\\"]\\n             )\\n             count_tag_invalid = count_invalid_tags(\\n                 dict_tag_maturity, _INVALID_TAGS[release_version]\\n@@ -169,14 +172,21 @@ def run(files_to_lint, tag_exceptions):\\n     print_system_exit_message(system_exit_msg)\\n \\n \\n-def get_files_to_lint(release_folder, release_file):\\n+def read_yaml_file_and_convert_to_release_file(release_file_path: str) -> ReleaseFile:\\n+    with open(release_file_path, mode=\\\"r+\\\", encoding=\\\"utf-8\\\") as f:\\n+        release_file_yaml_string = f.read()\\n+    release_file = ReleaseFile().from_yaml_string(value=release_file_yaml_string)\\n+    return release_file\\n+\\n+\\n+def get_files_to_lint(release_folder: str, release_file: str) -> List[str]:\\n     if release_folder is None:\\n         files_to_lint = [release_file]\\n     else:\\n         files_to_lint = filter(\\n-            lambda file: os.path.isfile(file),\\n+            lambda file: os.path.isfile,\\n             map(\\n-                lambda file: os.path.join(release_folder, file),\\n+                lambda file_path: os.path.join(release_folder, file_path),\\n                 os.listdir(release_folder),\\n             ),\\n         )\\n@@ -195,7 +205,7 @@ def define_tag_exceptions(tag_exception_arg):\\n     return tag_exceptions\\n \\n \\n-def get_parser():\\n+def get_parser() -> argparse.ArgumentParser:\\n     parser = argparse.ArgumentParser(\\n         description=\\\"Lint the maturity of packages.\\\",\\n         formatter_class=argparse.ArgumentDefaultsHelpFormatter,\\n@@ -210,16 +220,18 @@ def get_parser():\\n     group = parser.add_mutually_exclusive_group(required=True)\\n     group.add_argument(\\n         \\\"--release_file\\\",\\n-        type=lambda arg: arg\\n-        if os.path.isfile(arg)\\n-        else parser.error(f\\\"{arg} is not a valid file\\\"),\\n+        type=lambda arg: (\\n+            arg if os.path.isfile(arg) else parser.error(f\\\"{arg} is not a valid file\\\")\\n+        ),\\n         help=\\\"Komodo release file in YAML format.\\\",\\n     )\\n     group.add_argument(\\n         \\\"--release_folder\\\",\\n-        type=lambda arg: arg\\n-        if os.path.isdir(arg)\\n-        else parser.error(f\\\"{arg} is not a valid directory\\\"),\\n+        type=lambda arg: (\\n+            arg\\n+            if os.path.isdir(arg)\\n+            else parser.error(f\\\"{arg} is not a valid directory\\\")\\n+        ),\\n         help=\\\"File with all package tags named as release version.\\\",\\n     )\\n \\n\",\"diff --git a/komodo/lint_package_status.py b/komodo/lint_package_status.py\\nindex 4e8593c4..7a11b6e4 100644\\n--- a/komodo/lint_package_status.py\\n+++ b/komodo/lint_package_status.py\\n@@ -2,49 +2,35 @@\\n \\n import argparse\\n \\n-from komodo.yaml_file_types import YamlFile\\n+from komodo.yaml_file_types import PackageStatusFile, RepositoryFile\\n \\n-VALID_VISIBILITY = [\\\"public\\\", \\\"private\\\"]\\n-VALID_IMPORTANCE = [\\\"low\\\", \\\"medium\\\", \\\"high\\\"]\\n-VALID_MATURITY = [\\\"experimental\\\", \\\"stable\\\", \\\"deprecated\\\"]\\n \\n+def run(package_status: PackageStatusFile, repository: RepositoryFile):\\n+    package_status_set = set(package_status.content.keys())\\n+    repository_set = set(repository.content.keys())\\n \\n-def run(package_status, repository):\\n-    package_status_set = set(package_status.keys())\\n-    repository_set = set(repository.keys())\\n-    if package_status_set.difference(repository_set):\\n-        raise SystemExit(\\n-            \\\"The following packages are specified in the \\\"\\n-            \\\"package status file, but not in the repository file: \\\"\\n-            + str(list(package_status_set.difference(repository_set)))\\n-        )\\n-    if repository_set.difference(package_status_set):\\n-        raise SystemExit(\\n-            \\\"The following packages are specified in the \\\"\\n-            \\\"repository file, but not in the package status file: \\\"\\n-            + str(list(repository_set.difference(package_status_set)))\\n-        )\\n+    compare_sets(\\n+        package_status_set,\\n+        repository_set,\\n+        message=(\\n+            \\\"The following packages are specified in the package status file but not\\\"\\n+            \\\" in the repository file: \\\"\\n+        ),\\n+    )\\n+\\n+    compare_sets(\\n+        repository_set,\\n+        package_status_set,\\n+        message=(\\n+            \\\"The following packages are specified in the repository file, but not in\\\"\\n+            \\\" the package status file: \\\"\\n+        ),\\n+    )\\n \\n-    errors = []\\n-    for package, status in package_status.items():\\n-        if status.get(\\\"visibility\\\") not in VALID_VISIBILITY:\\n-            errors.append(\\n-                (package, f\\\"Malformed visibility: {status.get('visibility')}\\\")\\n-            )\\n-            continue\\n \\n-        visibility = status[\\\"visibility\\\"]\\n-        if visibility == \\\"public\\\":\\n-            if status.get(\\\"maturity\\\") not in VALID_MATURITY:\\n-                errors.append(\\n-                    (package, f\\\"Malformed maturity: {status.get('maturity')}\\\")\\n-                )\\n-            if status.get(\\\"importance\\\") not in VALID_IMPORTANCE:\\n-                errors.append(\\n-                    (package, f\\\"Malformed importance: {status.get('importance')}\\\"),\\n-                )\\n-    if errors:\\n-        raise SystemExit(\\\"\\\\n\\\".join([f\\\"{package}: {msg}\\\" for package, msg in errors]))\\n+def compare_sets(set_a: set, set_b: set, message: str) -> None:\\n+    if set_a.difference(set_b):\\n+        raise SystemExit(message + str(list(set_a.difference(set_b))))\\n \\n \\n def get_parser():\\n@@ -54,14 +40,16 @@ def get_parser():\\n     )\\n     parser.add_argument(\\n         \\\"package_status\\\",\\n-        type=YamlFile(),\\n+        type=PackageStatusFile(),\\n         help=\\\"File with all package statuses.\\\",\\n     )\\n     parser.add_argument(\\n         \\\"repository\\\",\\n-        type=YamlFile(),\\n-        help=\\\"Komodo repository file with all packages listed with dependencies, \\\"\\n-        \\\"in YAML format.\\\",\\n+        type=RepositoryFile(),\\n+        help=(\\n+            \\\"Komodo repository file with all packages listed with dependencies, \\\"\\n+            \\\"in YAML format.\\\"\\n+        ),\\n     )\\n     return parser\\n \\n\",\"diff --git a/komodo/maintainer.py b/komodo/maintainer.py\\nindex 1ceb5961..215bd680 100755\\n--- a/komodo/maintainer.py\\n+++ b/komodo/maintainer.py\\n@@ -1,11 +1,14 @@\\n #!/usr/bin/env python\\n \\n-import yaml as yml\\n+from ruamel.yaml import YAML\\n+\\n+from komodo.yaml_file_types import ReleaseFile, RepositoryFile\\n \\n \\n def maintainers(pkgfile, repofile):\\n     with open(pkgfile) as p, open(repofile) as r:\\n-        pkgs, repo = yml.safe_load(p), yml.safe_load(r)\\n+        yml = YAML()\\n+        pkgs, repo = yml.load(p), yml.load(r)\\n \\n     maints = set()\\n     for pkg, ver in pkgs.items():\\n@@ -22,13 +25,12 @@ def maintainers(pkgfile, repofile):\\n     )\\n     parser.add_argument(\\n         \\\"pkgfile\\\",\\n-        type=str,\\n-        help=\\\"A Komodo release file mapping package name to version, \\\"\\n-        \\\"in YAML format.\\\",\\n+        type=ReleaseFile(),\\n+        help=\\\"A Komodo release file mapping package name to version, in YAML format.\\\",\\n     )\\n     parser.add_argument(\\n         \\\"repofile\\\",\\n-        type=str,\\n+        type=RepositoryFile(),\\n         help=\\\"A Komodo repository file, in YAML format.\\\",\\n     )\\n     args = parser.parse_args()\\n\",\"diff --git a/komodo/post_messages.py b/komodo/post_messages.py\\nindex 20c58559..ad435cab 100644\\n--- a/komodo/post_messages.py\\n+++ b/komodo/post_messages.py\\n@@ -4,7 +4,7 @@\\n import os\\n import shutil\\n \\n-import yaml as yml\\n+from ruamel.yaml import YAML\\n \\n \\n def get_messages_and_scripts(release_name, motd_db):\\n@@ -78,7 +78,8 @@ def main(args=None):\\n     if not os.path.isfile(args.motd_db):\\n         raise SystemExit(f\\\"ERROR: The message-database {args.motd_db} was not found\\\")\\n     with open(args.motd_db) as motd_db_file:\\n-        motd_db = yml.safe_load(motd_db_file)\\n+        yml = YAML()\\n+        motd_db = yml.load(motd_db_file)\\n     motd_path = os.path.dirname(args.motd_db)\\n \\n     if not os.path.isdir(args.komodo_prefix):\\n\",\"diff --git a/komodo/release_cleanup.py b/komodo/release_cleanup.py\\nindex 6653160f..dbf785f8 100644\\n--- a/komodo/release_cleanup.py\\n+++ b/komodo/release_cleanup.py\\n@@ -77,8 +77,9 @@ def _valid_path_or_files(path):\\n def add_cleanup_parser(subparsers):\\n     cleanup_parser = subparsers.add_parser(\\n         \\\"cleanup\\\",\\n-        description=\\\"Clean up unused versions the repository file \\\"\\n-        \\\"based on a set of releases\\\",\\n+        description=(\\n+            \\\"Clean up unused versions the repository file based on a set of releases\\\"\\n+        ),\\n     )\\n     cleanup_parser.set_defaults(func=run_cleanup)\\n     cleanup_parser.add_argument(\\n\",\"diff --git a/komodo/release_transpiler.py b/komodo/release_transpiler.py\\nindex c979c592..3a1d4138 100755\\n--- a/komodo/release_transpiler.py\\n+++ b/komodo/release_transpiler.py\\n@@ -205,8 +205,7 @@ def main():\\n \\n     subparsers = parser.add_subparsers(\\n         title=\\\"Commands\\\",\\n-        description=\\\"Combine - build matrix file\\\\n\\\"\\n-        \\\"Transpile - generate release files\\\",\\n+        description=\\\"Combine - build matrix file\\\\nTranspile - generate release files\\\",\\n         help=\\\"Available sub commands\\\",\\n         dest=\\\"mode\\\",\\n     )\\n\",\"diff --git a/komodo/reverse_dep_graph.py b/komodo/reverse_dep_graph.py\\nindex ab8fecd2..fb9c1166 100644\\n--- a/komodo/reverse_dep_graph.py\\n+++ b/komodo/reverse_dep_graph.py\\n@@ -2,12 +2,13 @@\\n \\n import argparse\\n import io\\n-import os\\n import subprocess\\n import sys\\n \\n import yaml\\n \\n+from komodo.yaml_file_types import ReleaseFile, RepositoryFile\\n+\\n \\n def run(base_pkgfile, repofile, dot, display_pkg, out):\\n     with open(base_pkgfile) as bp, open(repofile) as r:\\n@@ -94,19 +95,19 @@ def main():\\n     )\\n     parser.add_argument(\\n         \\\"base_pkgs\\\",\\n-        type=lambda arg: arg\\n-        if os.path.isfile(arg)\\n-        else parser.error(f\\\"{arg} is not a file\\\"),\\n-        help=\\\"Base Komodo release file where all packages are listed with \\\"\\n-        \\\"wanted versions specified, in YAML format.\\\",\\n+        type=ReleaseFile(),\\n+        help=(\\n+            \\\"Base Komodo release file where all packages are listed with \\\"\\n+            \\\"wanted versions specified, in YAML format.\\\"\\n+        ),\\n     )\\n     parser.add_argument(\\n         \\\"repo\\\",\\n-        type=lambda arg: arg\\n-        if os.path.isfile(arg)\\n-        else parser.error(f\\\"{arg} is not a file\\\"),\\n-        help=\\\"Komodo repository file with all packages listed with dependencies, \\\"\\n-        \\\"in YAML format.\\\",\\n+        type=RepositoryFile(),\\n+        help=(\\n+            \\\"Komodo repository file with all packages listed with dependencies, \\\"\\n+            \\\"in YAML format.\\\"\\n+        ),\\n     )\\n     parser.add_argument(\\n         \\\"--pkg\\\",\\n@@ -116,8 +117,10 @@ def main():\\n     parser.add_argument(\\n         \\\"--out\\\",\\n         \\\"-o\\\",\\n-        help=\\\"File to be written with reverse dependencies. \\\"\\n-        \\\"If not specified dump to stdout.\\\",\\n+        help=(\\n+            \\\"File to be written with reverse dependencies. \\\"\\n+            \\\"If not specified dump to stdout.\\\"\\n+        ),\\n     )\\n     parser.add_argument(\\n         \\\"--dot\\\",\\n@@ -129,9 +132,11 @@ def main():\\n         \\\"--display_dot\\\",\\n         \\\"-l\\\",\\n         action=\\\"store_true\\\",\\n-        help=\\\"Try to display graph with dot and display. \\\"\\n-        \\\"You need to have installed these tools, \\\"\\n-        \\\"distibuted with the Graphwiz and ImageMagick packages respectively\\\",\\n+        help=(\\n+            \\\"Try to display graph with dot and display. \\\"\\n+            \\\"You need to have installed these tools, \\\"\\n+            \\\"distibuted with the Graphwiz and ImageMagick packages respectively\\\"\\n+        ),\\n     )\\n \\n     args = parser.parse_args()\\n\",\"diff --git a/komodo/show_version.py b/komodo/show_version.py\\nindex f6c53375..6ac109ce 100644\\n--- a/komodo/show_version.py\\n+++ b/komodo/show_version.py\\n@@ -8,7 +8,7 @@\\n from pathlib import Path\\n from typing import Dict, List, Optional, Union\\n \\n-import yaml\\n+from ruamel.yaml import YAML\\n \\n from komodo.yaml_file_types import ManifestFile\\n \\n@@ -130,7 +130,8 @@ def get_version(pkg: str, manifest: Optional[Dict] = None) -> str:\\n         release_file = path.parts[-1]\\n \\n         with open(path / release_file, \\\"rt\\\", encoding=\\\"utf-8\\\") as stream:\\n-            manifest = yaml.safe_load(stream)\\n+            yaml = YAML()\\n+            manifest = yaml.load(stream)\\n \\n     package = manifest.get(pkg)\\n \\n@@ -154,8 +155,10 @@ def parse_args(args: List[str]) -> argparse.Namespace:\\n         The `argparse.Namespace`, a mapping of arg names to values.\\n     \\\"\\\"\\\"\\n     parser = argparse.ArgumentParser(\\n-        description=\\\"Return the version of a specified package in the active \\\"\\n-        \\\"release or in a given release manifest file.\\\",\\n+        description=(\\n+            \\\"Return the version of a specified package in the active \\\"\\n+            \\\"release or in a given release manifest file.\\\"\\n+        ),\\n         formatter_class=argparse.ArgumentDefaultsHelpFormatter,\\n     )\\n     parser.add_argument(\\\"package\\\", help=\\\"Package to find the version for.\\\")\\n@@ -163,10 +166,12 @@ def parse_args(args: List[str]) -> argparse.Namespace:\\n         \\\"--manifest-file\\\",\\n         type=ManifestFile(),\\n         required=False,\\n-        help=\\\"The full path to a release manifest file. This file is \\\"\\n-        \\\"produced by komodo when it builds an environment. If omitted, \\\"\\n-        \\\"komodo-show-version will try to find the file for the active \\\"\\n-        \\\"environment.\\\",\\n+        help=(\\n+            \\\"The full path to a release manifest file. This file is \\\"\\n+            \\\"produced by komodo when it builds an environment. If omitted, \\\"\\n+            \\\"komodo-show-version will try to find the file for the active \\\"\\n+            \\\"environment.\\\"\\n+        ),\\n     )\\n     return parser.parse_args(args)\\n \\n\",\"diff --git a/komodo/snyk_reporting.py b/komodo/snyk_reporting.py\\nindex bcc9f011..950b9e06 100644\\n--- a/komodo/snyk_reporting.py\\n+++ b/komodo/snyk_reporting.py\\n@@ -8,7 +8,7 @@\\n from snyk.managers import OrganizationManager\\n from snyk.models import Vulnerability\\n \\n-from komodo.yaml_file_types import ReleaseDir, ReleaseFile, YamlFile\\n+from komodo.yaml_file_types import ReleaseDir, ReleaseFile, RepositoryFile\\n \\n _CONSOLE_VULNERABILITY_FORMAT = \\\"\\\"\\\"\\\\t{id}\\n \\\\t\\\\tPackage: {package}\\n@@ -49,7 +49,7 @@ def parse_args(args: Dict[str, str]) -> argparse.Namespace:\\n     )\\n     parser.add_argument(\\n         \\\"--repo\\\",\\n-        type=YamlFile(),\\n+        type=RepositoryFile(),\\n         required=True,\\n         help=\\\"A Komodo repository file, in YAML format.\\\",\\n     )\\n@@ -57,8 +57,7 @@ def parse_args(args: Dict[str, str]) -> argparse.Namespace:\\n     group.add_argument(\\n         \\\"--release\\\",\\n         type=ReleaseFile(),\\n-        help=\\\"A Komodo release file mapping package name to version, \\\"\\n-        \\\"in YAML format.\\\",\\n+        help=\\\"A Komodo release file mapping package name to version, in YAML format.\\\",\\n     )\\n     group.add_argument(\\n         \\\"--release-folder\\\",\\n@@ -68,8 +67,9 @@ def parse_args(args: Dict[str, str]) -> argparse.Namespace:\\n     parser.add_argument(\\n         \\\"--format-github\\\",\\n         action=\\\"store_true\\\",\\n-        help=\\\"Flag to print vulnerabilities in GitHub-friendly format vs \\\"\\n-        \\\"console format.\\\",\\n+        help=(\\n+            \\\"Flag to print vulnerabilities in GitHub-friendly format vs console format.\\\"\\n+        ),\\n     )\\n \\n     return parser.parse_args(args)\\n\",\"diff --git a/komodo/symlink/sanity_check.py b/komodo/symlink/sanity_check.py\\nindex fc186e96..c42eb139 100644\\n--- a/komodo/symlink/sanity_check.py\\n+++ b/komodo/symlink/sanity_check.py\\n@@ -99,7 +99,7 @@ def _compare_dicts(d1, d2):\\n def sanity_main():\\n     parser = argparse.ArgumentParser(\\n         description=(\\n-            \\\"Verify symlinks for komodo versions are \\\" \\\"according to a given config.\\\"\\n+            \\\"Verify symlinks for komodo versions are according to a given config.\\\"\\n         )\\n     )\\n     parser.add_argument(\\n\"]", "test_patch": "", "hints_text": ""}
