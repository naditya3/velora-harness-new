{"instance_id": "805275652059332", "repo": "ornl-mdf/myna", "base_commit": "cec3fe535c159410ed21ea39513fe85763dc9074", "problem_statement": "OpenFOAM cannot handle spaces in file paths:\\nPeregrine file paths can contain spaces (see #38), but OpenFOAM cannot parse file paths with spaces. This leads to an incompatibility of OpenFOAM with the current Peregrine CLI. ", "FAIL_TO_PASS": ["tests/test_peregrine_cli.py::test_peregrine_cli"], "PASS_TO_PASS": ["tests/test_configure.py::test_configure", "tests/test_version.py::test_version", "tests/test_database.py::test_database_PeregrineHDF5", "tests/test_database.py::test_database_Peregrine"], "language": "python", "test_command": "source /saved/ENV || source /saved/*/ENV && pytest --no-header -rA --tb=no -p no:cacheprovider --continue-on-collection-errors", "test_output_parser": "python/parse_log_pytest_v3", "image_storage_uri": "vmvm-registry.fbinfra.net/repomate_image_activ_pytest/ornl-mdf_myna:cec3fe535c159410ed21ea39513fe85763dc9074", "patch": "[\"diff --git a/myna/application/additivefoam/solidification_region_reduced/execute.py b/myna/application/additivefoam/solidification_region_reduced/execute.py\\nindex e2136c0..e1e687d 100644\\n--- a/myna/application/additivefoam/solidification_region_reduced/execute.py\\n+++ b/myna/application/additivefoam/solidification_region_reduced/execute.py\\n@@ -68,7 +68,7 @@ def main(argv=None):\\n     args = parser.parse_args(argv)\\n     cores = args.cores\\n     batch = args.batch\\n-    settings = load_input(os.environ[\\\"MYNA_RUN_INPUT\\\"])\\n+    settings = load_input(os.environ[\\\"MYNA_INPUT\\\"])\\n     overwrite = args.overwrite\\n \\n     # Get expected Myna output files\\n\",\"diff --git a/myna/application/additivefoam/solidification_region_stl/execute.py b/myna/application/additivefoam/solidification_region_stl/execute.py\\nindex eb0bd12..e1ac7e6 100644\\n--- a/myna/application/additivefoam/solidification_region_stl/execute.py\\n+++ b/myna/application/additivefoam/solidification_region_stl/execute.py\\n@@ -68,7 +68,7 @@ def main(argv=None):\\n     args = parser.parse_args(argv)\\n     cores = args.cores\\n     batch = args.batch\\n-    settings = load_input(os.environ[\\\"MYNA_RUN_INPUT\\\"])\\n+    settings = load_input(os.environ[\\\"MYNA_INPUT\\\"])\\n     overwrite = args.overwrite\\n \\n     # Get expected Myna output files\\n\",\"diff --git a/myna/application/bnpy/cluster_solidification/execute.py b/myna/application/bnpy/cluster_solidification/execute.py\\nindex d4070f3..bb8fe3b 100644\\n--- a/myna/application/bnpy/cluster_solidification/execute.py\\n+++ b/myna/application/bnpy/cluster_solidification/execute.py\\n@@ -300,7 +300,7 @@ def main(argv=None):\\n \\n     # Parse command line arguments\\n     args = parser.parse_args(argv)\\n-    settings = load_input(os.environ[\\\"MYNA_RUN_INPUT\\\"])\\n+    settings = load_input(os.environ[\\\"MYNA_INPUT\\\"])\\n     train_model = args.train_model\\n     overwrite = args.overwrite\\n \\n\",\"diff --git a/myna/application/bnpy/cluster_supervoxel/execute.py b/myna/application/bnpy/cluster_supervoxel/execute.py\\nindex 7928073..f6d1011 100644\\n--- a/myna/application/bnpy/cluster_supervoxel/execute.py\\n+++ b/myna/application/bnpy/cluster_supervoxel/execute.py\\n@@ -337,7 +337,7 @@ def main(argv=None):\\n \\n     # Parse command line arguments\\n     args = parser.parse_args(argv)\\n-    settings = load_input(os.environ[\\\"MYNA_RUN_INPUT\\\"])\\n+    settings = load_input(os.environ[\\\"MYNA_INPUT\\\"])\\n     train_model = args.train_model\\n     overwrite = args.overwrite\\n     resolution = args.res\\n\",\"diff --git a/myna/application/exaca/microstructure_region/execute.py b/myna/application/exaca/microstructure_region/execute.py\\nindex 406228b..a4b00af 100644\\n--- a/myna/application/exaca/microstructure_region/execute.py\\n+++ b/myna/application/exaca/microstructure_region/execute.py\\n@@ -79,7 +79,7 @@ def main():\\n     overwrite = args.overwrite\\n     batch = args.batch\\n     ranks = args.ranks\\n-    settings = load_input(os.environ[\\\"MYNA_RUN_INPUT\\\"])\\n+    settings = load_input(os.environ[\\\"MYNA_INPUT\\\"])\\n \\n     # Get expected Myna output files\\n     step_name = os.environ[\\\"MYNA_STEP_NAME\\\"]\\n\",\"diff --git a/myna/application/exaca/microstructure_region/postprocess.py b/myna/application/exaca/microstructure_region/postprocess.py\\nindex 8b729a1..93a56ca 100644\\n--- a/myna/application/exaca/microstructure_region/postprocess.py\\n+++ b/myna/application/exaca/microstructure_region/postprocess.py\\n@@ -29,7 +29,7 @@ def main(argv=None):\\n     # Parse args\\n     args = parser.parse_args(argv)\\n     input = args.input\\n-    settings = load_input(os.environ[\\\"MYNA_RUN_INPUT\\\"])\\n+    settings = load_input(os.environ[\\\"MYNA_INPUT\\\"])\\n \\n     # Get expected Myna output files\\n     step_name = os.environ[\\\"MYNA_STEP_NAME\\\"]\\n\",\"diff --git a/myna/application/openfoam/mesh_part_vtk/configure.py b/myna/application/openfoam/mesh_part_vtk/configure.py\\nindex 4e69bf8..1a25946 100644\\n--- a/myna/application/openfoam/mesh_part_vtk/configure.py\\n+++ b/myna/application/openfoam/mesh_part_vtk/configure.py\\n@@ -44,7 +44,7 @@ def main(argv=None):\\n \\n     # Parse command line arguments and get Myna settings\\n     args = parser.parse_args(argv)\\n-    settings = load_input(os.environ[\\\"MYNA_RUN_INPUT\\\"])\\n+    settings = load_input(os.environ[\\\"MYNA_INPUT\\\"])\\n     template = args.template\\n \\n     # Get expected Myna output files to identify output directories\\n\",\"diff --git a/myna/application/openfoam/mesh_part_vtk/execute.py b/myna/application/openfoam/mesh_part_vtk/execute.py\\nindex 4c05daf..dfcd662 100644\\n--- a/myna/application/openfoam/mesh_part_vtk/execute.py\\n+++ b/myna/application/openfoam/mesh_part_vtk/execute.py\\n@@ -78,7 +78,7 @@ def main(argv=None):\\n     scale = args.scale\\n     coarse_res = args.coarse\\n     refinement_level = args.refine\\n-    settings = load_input(os.environ[\\\"MYNA_RUN_INPUT\\\"])\\n+    settings = load_input(os.environ[\\\"MYNA_INPUT\\\"])\\n \\n     # Get expected Myna output files\\n     step_name = os.environ[\\\"MYNA_STEP_NAME\\\"]\\n@@ -97,7 +97,7 @@ def main(argv=None):\\n         shutil.rmtree(os.path.join(case_dir, \\\"VTK\\\"), ignore_errors=True)\\n \\n         # Clean .obj files if they were created\\n-        input_dir = os.path.dirname(os.environ[\\\"MYNA_RUN_INPUT\\\"])\\n+        input_dir = os.path.dirname(os.environ[\\\"MYNA_INPUT\\\"])\\n         obj_files = glob.glob(os.path.join(input_dir, \\\"*.obj\\\"))\\n         for obj_file in obj_files:\\n             os.remove(obj_file)\\n\",\"diff --git a/myna/application/rve/rve_selection/execute.py b/myna/application/rve/rve_selection/execute.py\\nindex 493cf7b..10d975a 100644\\n--- a/myna/application/rve/rve_selection/execute.py\\n+++ b/myna/application/rve/rve_selection/execute.py\\n@@ -372,7 +372,7 @@ def main(argv=None):\\n     bid = args.bid\\n \\n     # Get input settings\\n-    input_file = os.environ[\\\"MYNA_RUN_INPUT\\\"]\\n+    input_file = os.environ[\\\"MYNA_INPUT\\\"]\\n     settings = load_input(input_file)\\n \\n     # Get expected Myna output files\\n\",\"diff --git a/myna/core/app/base.py b/myna/core/app/base.py\\nindex ea205bc..9fbaf6a 100644\\n--- a/myna/core/app/base.py\\n+++ b/myna/core/app/base.py\\n@@ -13,14 +13,14 @@ from myna.core.workflow.load_input import load_input\\n \\n \\n class MynaApp:\\n-    settings = \\\"MYNA_RUN_INPUT\\\"\\n+    settings = \\\"MYNA_INPUT\\\"\\n     path = \\\"MYNA_APP_PATH\\\"\\n     step_name = \\\"MYNA_STEP_NAME\\\"\\n     last_step_name = \\\"MYNA_LAST_STEP_NAME\\\"\\n \\n     def __init__(self, name):\\n         self.name = name\\n-        self.input_file = os.environ[\\\"MYNA_RUN_INPUT\\\"]\\n+        self.input_file = os.environ[\\\"MYNA_INPUT\\\"]\\n         self.settings = load_input(self.input_file)\\n         self.path = os.environ[\\\"MYNA_APP_PATH\\\"]\\n         self.step_name = os.environ[\\\"MYNA_STEP_NAME\\\"]\\n\",\"diff --git a/myna/core/components/component.py b/myna/core/components/component.py\\nindex 3d0ecf6..becca7b 100644\\n--- a/myna/core/components/component.py\\n+++ b/myna/core/components/component.py\\n@@ -186,6 +186,7 @@ class Component:\\n         files = []\\n \\n         # Get build name\\n+        input_dir = os.path.abspath(os.path.dirname(os.environ[\\\"MYNA_INPUT\\\"]))\\n         build = self.data[\\\"build\\\"][\\\"name\\\"]\\n \\n         # Get all other names that are set by the component\\n@@ -216,14 +217,25 @@ class Component:\\n                                 layers = r[\\\"layers\\\"]\\n                                 filelist = [\\n                                     os.path.join(\\n-                                        build, part, region, str(x), self.name, template\\n+                                        input_dir,\\n+                                        build,\\n+                                        part,\\n+                                        region,\\n+                                        str(x),\\n+                                        self.name,\\n+                                        template,\\n                                     )\\n                                     for x in layers\\n                                 ]\\n                             else:\\n                                 filelist = [\\n                                     os.path.join(\\n-                                        build, part, region, self.name, template\\n+                                        input_dir,\\n+                                        build,\\n+                                        part,\\n+                                        region,\\n+                                        self.name,\\n+                                        template,\\n                                     )\\n                                 ]\\n                             files.extend(filelist)\\n@@ -231,15 +243,21 @@ class Component:\\n                         if \\\"layer\\\" in vars:\\n                             layers = self.data[\\\"build\\\"][\\\"parts\\\"][part][\\\"layers\\\"]\\n                             filelist = [\\n-                                os.path.join(build, part, str(x), self.name, template)\\n+                                os.path.join(\\n+                                    input_dir, build, part, str(x), self.name, template\\n+                                )\\n                                 for x in layers\\n                             ]\\n                         else:\\n-                            filelist = [os.path.join(build, part, self.name, template)]\\n+                            filelist = [\\n+                                os.path.join(\\n+                                    input_dir, build, part, self.name, template\\n+                                )\\n+                            ]\\n                         files.extend(filelist)\\n \\n         elif len(self.types) == 1:\\n-            files.append(os.path.join(build, self.name, template))\\n+            files.append(os.path.join(input_dir, build, self.name, template))\\n \\n         else:\\n             print(\\n\",\"diff --git a/myna/core/metadata/file.py b/myna/core/metadata/file.py\\nindex c97208a..2435532 100644\\n--- a/myna/core/metadata/file.py\\n+++ b/myna/core/metadata/file.py\\n@@ -42,7 +42,10 @@ class BuildFile:\\n     def set_local_resource_dir(self):\\n         \\\"\\\"\\\"Get the local resource directory and make if it doesn't exist\\\"\\\"\\\"\\n \\n-        resource_dir = os.path.abspath(os.path.join(\\\".\\\", \\\"myna_resources\\\"))\\n+        input_dir = os.path.abspath(os.path.dirname(os.environ[\\\"MYNA_INPUT\\\"]))\\n+        if input_dir is None:\\n+            input_dir = \\\".\\\"\\n+        resource_dir = os.path.abspath(os.path.join(input_dir, \\\"myna_resources\\\"))\\n         os.makedirs(resource_dir, exist_ok=True)\\n         self.resource_dir = resource_dir\\n \\n\",\"diff --git a/myna/core/workflow/config.py b/myna/core/workflow/config.py\\nindex 79a59b3..8fe10a3 100644\\n--- a/myna/core/workflow/config.py\\n+++ b/myna/core/workflow/config.py\\n@@ -68,6 +68,13 @@ def config(input_file, output_file=None, show_avail=False, overwrite=False):\\n       show_avail: only shows available data files, but does not copy\\n       overwrite: flag to overwrite existing files in Myna resources\\\"\\\"\\\"\\n \\n+    # Set environmental variable for input file location\\n+    os.environ[\\\"MYNA_INPUT\\\"] = os.path.abspath(input_file)\\n+    os.environ[\\\"MYNA_CONFIG_INPUT\\\"] = os.path.abspath(\\n+        input_file\\n+    )  # MYNA_CONFIG_INPUT will be deprecated in future versions\\n+\\n+    # Set output file\\n     if output_file is None:\\n         output_file = input_file\\n \\n\",\"diff --git a/myna/core/workflow/launch_from_peregrine.py b/myna/core/workflow/launch_from_peregrine.py\\nindex 8039372..7c5f662 100644\\n--- a/myna/core/workflow/launch_from_peregrine.py\\n+++ b/myna/core/workflow/launch_from_peregrine.py\\n@@ -8,14 +8,13 @@\\n #\\n \\\"\\\"\\\"Defines myna launch_peregrine functionality\\\"\\\"\\\"\\n \\n-import sys\\n import os\\n import subprocess\\n import datetime\\n import contextlib\\n from pathlib import Path\\n import yaml\\n-import myna.core.utils\\n+import shutil\\n \\n \\n @contextlib.contextmanager\\n@@ -72,6 +71,12 @@ def launch_from_peregrine(parser):\\n         type=str,\\n         help=\\\"simulation mode to use\\\",\\n     )\\n+    parser.add_argument(\\n+        \\\"--tmp-dir\\\",\\n+        default=\\\"/mnt/peregrine\\\",\\n+        type=str,\\n+        help=\\\"directory to create Myna_Temporary_Files folder to store temporary files, cannot contain spaces\\\",\\n+    )\\n \\n     args = parser.parse_args()\\n \\n@@ -79,6 +84,7 @@ def launch_from_peregrine(parser):\\n     layers = args.layers\\n     exported_parts = args.parts\\n     mode = args.mode\\n+    tmp_dir = args.tmp_dir\\n \\n     # For paths, handle spaces by parsing as lists of arguments\\n     build_path = os.path.abspath(\\\" \\\".join(args.build))\\n@@ -90,11 +96,7 @@ def launch_from_peregrine(parser):\\n     if os.path.basename(build_path) == \\\"Peregrine\\\":\\n         build_path = os.path.dirname(build_path)\\n \\n-    # Create Myna directory if it doesn't already exist\\n-    myna_working_dir = os.path.join(build_path, \\\"Myna\\\")\\n-    os.makedirs(myna_working_dir, exist_ok=True)\\n-\\n-    # Write Peregrine input to log file\\n+    # Write Peregrine input to log file lines\\n     lines = []\\n     lines.append(f\\\"Peregrine inputs:\\\\n\\\")\\n     lines.append(f\\\"- {build_path=}\\\\n\\\")\\n@@ -109,6 +111,10 @@ def launch_from_peregrine(parser):\\n     now_str_id = now.strftime(\\\"%Y-%m-%d-%Hh-%Mm\\\")\\n     lines.append(f\\\"\\\\nSimulation started at {now_str_pretty}\\\\n\\\")\\n \\n+    # Create a temp Myna working directory in the tmp_dir if it doesn't already exist\\n+    myna_working_dir = os.path.join(tmp_dir, \\\"Myna_Temporary_Files\\\", now_str_id)\\n+    os.makedirs(myna_working_dir, exist_ok=True)\\n+\\n     # Set input file paths\\n     input_file = os.path.join(peregrine_launcher_path, f\\\"input_{mode}.yaml\\\")\\n     input_file_configured = os.path.join(\\n@@ -197,3 +203,10 @@ def launch_from_peregrine(parser):\\n         # Write log file\\n         with open(f\\\"launch_from_peregrine_{now_str_id}.log\\\", \\\"w\\\") as f:\\n             f.writelines(lines)\\n+\\n+    # Copy temporary files to the build directory\\n+    myna_build_dir = os.path.join(build_path, \\\"Myna\\\")\\n+    shutil.copytree(myna_working_dir, myna_build_dir, dirs_exist_ok=True)\\n+\\n+    # Clean the temporary directory\\n+    shutil.rmtree(myna_working_dir)\\n\",\"diff --git a/myna/core/workflow/run.py b/myna/core/workflow/run.py\\nindex 9c7bd10..b7f2713 100644\\n--- a/myna/core/workflow/run.py\\n+++ b/myna/core/workflow/run.py\\n@@ -48,7 +48,10 @@ def run(input_file, step=None):\\n     steps_to_run = myna.core.utils.str_to_list(step)\\n \\n     # Set environmental variable for input file location\\n-    os.environ[\\\"MYNA_RUN_INPUT\\\"] = os.path.abspath(input_file)\\n+    os.environ[\\\"MYNA_INPUT\\\"] = os.path.abspath(input_file)\\n+    os.environ[\\\"MYNA_RUN_INPUT\\\"] = os.path.abspath(\\n+        input_file\\n+    )  # MYNA_RUN_INPUT will be deprecated in future versions\\n \\n     # Load the initial input file to get the steps\\n     initial_settings = load_input(input_file)\\n\",\"diff --git a/myna/core/workflow/sync.py b/myna/core/workflow/sync.py\\nindex 5a5b3b8..72a1d6c 100644\\n--- a/myna/core/workflow/sync.py\\n+++ b/myna/core/workflow/sync.py\\n@@ -49,7 +49,10 @@ def sync(input_file, step=None):\\n     steps_to_sync = myna.core.utils.str_to_list(step)\\n \\n     # Set environmental variable for input file location\\n-    os.environ[\\\"MYNA_SYNC_INPUT\\\"] = os.path.abspath(input_file)\\n+    os.environ[\\\"MYNA_INPUT\\\"] = os.path.abspath(input_file)\\n+    os.environ[\\\"MYNA_SYNC_INPUT\\\"] = os.path.abspath(\\n+        input_file\\n+    )  # MYNA_SYNC_INPUT will be deprecated in future versions\\n \\n     # Load the initial input file to get the steps\\n     initial_settings = load_input(input_file)\\n\",\"diff --git a/myna/database/peregrine.py b/myna/database/peregrine.py\\nindex 633e8a8..4a20030 100644\\n--- a/myna/database/peregrine.py\\n+++ b/myna/database/peregrine.py\\n@@ -238,7 +238,7 @@ class PeregrineDB(Database):\\n             component_name = os.path.basename(os.path.dirname(files[0]))\\n             unique_regions = sorted(set(regions))\\n             unique_parts = sorted(set(parts))\\n-            settings = load_input(os.environ[\\\"MYNA_SYNC_INPUT\\\"])\\n+            settings = load_input(os.environ[\\\"MYNA_INPUT\\\"])\\n             for region in unique_regions:\\n                 for part in unique_parts:\\n                     part_dict = nested_get(settings, [\\\"data\\\", \\\"build\\\", \\\"parts\\\"]).get(\\n\"]", "test_patch": "[\"diff --git a/tests/test_peregrine_cli.py b/tests/test_peregrine_cli.py\\nindex 45b1555..d62cf9e 100644\\n--- a/tests/test_peregrine_cli.py\\n+++ b/tests/test_peregrine_cli.py\\n@@ -35,6 +35,8 @@ def test_peregrine_cli():\\n         f\\\"{myna_path}/cli/peregrine_launcher/peregrine_default_workspace.yaml\\\",\\n         \\\"--mode\\\",\\n         \\\"meltpool_geometry\\\",\\n+        \\\"--tmp-dir\\\",\\n+        \\\"~/myna_tmp\\\",\\n     ]\\n     myna.core.workflow.launch_from_peregrine(parser)\\n \"]", "hints_text": ""}
