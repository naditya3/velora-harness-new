{"instance_id": "1851158345669441", "repo": "redcap-tools/pycap", "base_commit": "5fb98f80427fc437cbdfed4e83d7e3dc46b9453f", "problem_statement": "PyCap 2.0 design thoughts:\\nWould love for @sburns @wibeasley @martinburchell @pbchase to chime in here if you can ‚ù§Ô∏è \\r\\n\\r\\nRight now we have the God class `Project` üëºüèª which is convenient for users, but tough for developers to get a grasp on what is going on.\\r\\n\\r\\nSince REDCap divides their API into sections, why don't we do that as well? Break out into smaller classes for each section of the API playground? Then we can still combine at the end to get the `Project` class to make life easier for the users.\\r\\n\\r\\n<img width=\"850\" alt=\"Screen Shot 2021-11-18 at 12 04 44 PM\" src=\"https://user-images.githubusercontent.com/35195136/142462906-49da2872-6d5e-45bb-8fc7-3edad30b08ec.png\">\\r\\n\\r\\n```python\\r\\nclass _BaseRedcapAPI:\\r\\n\\r\\n    def __init__(self, url, token) -> None:\\r\\n        self.url = url\\r\\n        self.token = token\\r\\n    \\r\\n\\r\\n    def call_api(self, request: str) -> str:\\r\\n        return f\"Request is {request}\"\\r\\n\\r\\n\\r\\nclass RecordsAPI(_BaseRedcapAPI):\\r\\n\\r\\n    def export_records(self):\\r\\n        res = self.call_api(\"export records\")\\r\\n        print(res)\\r\\n        return [\\r\\n            {\"record_id\": 1, \"field_1\": 1},\\r\\n            {\"record_id\": 2, \"field_1\": 2},\\r\\n        ]\\r\\n\\r\\n\\r\\nclass MetadataAPI(_BaseRedcapAPI):\\r\\n\\r\\n    def export_metadata(self):\\r\\n        res = self.call_api(\"export metadata\")\\r\\n        print(res)\\r\\n        return [\\r\\n            {\"field_name\": \"record_id\", \"type\": \"text\"},\\r\\n            {\"field_name\": \"field_1\", \"type\": \"number\"},\\r\\n        ]\\r\\n\\r\\n\\r\\nclass Project(RecordsAPI, MetadataAPI):\\r\\n    \\r\\n    def __init__(self, url, token):\\r\\n        self.metadata = super().export_metadata()\\r\\n\\r\\n\\r\\nrecords_api = RecordsAPI(url=\"https://redcap.chop.edu/api/\", token=\"mytoken\")\\r\\nmetadata_api = MetadataAPI(url=\"https://redcap.chop.edu/api/\", token=\"mytoken\")\\r\\nredcap_project = Project(url=\"https://redcap.chop.edu/api/\", token=\"mytoken\")\\r\\n\\r\\nassert redcap_project.export_records() == records_api.export_records()\\r\\nassert redcap_project.metadata == metadata_api.export_metadata()\\r\\n```", "FAIL_TO_PASS": ["tests/unit/test_long_project.py::test_fem_export_stricly_enforces_format", "tests/unit/test_simple_project.py::test_fem_export_passes_filters_as_arrays", "tests/unit/test_simple_project.py::test_reports_df_export", "tests/unit/test_simple_project.py::test_export_methods_handle_empty_data_error", "tests/unit/test_simple_project.py::test_reports_json_export", "tests/unit/test_simple_project.py::test_reports_export_stricly_enforces_format", "tests/unit/test_long_project.py::test_fem_export", "tests/unit/test_long_project.py::test_reports_df_export", "tests/unit/test_simple_project.py::test_life_goes_on_without_the_version"], "PASS_TO_PASS": ["docs/_themes/flask_theme_support.py::BLACK", "tests/unit/test_survey_project.py::BLACK", "tests/unit/test_simple_project.py::test_attrs", "tests/unit/test_simple_project.py::test_metadata_export_strictly_enforces_format", "tests/unit/test_simple_project.py::test_import_date_formatting[record1-DMY]", "tests/unit/test_simple_project.py::test_metadata_csv_export", "tests/unit/test_simple_project.py::test_bad_request_produces_redcap_error", "tests/unit/test_simple_project.py::test_df_export_handles_eav_type", "tests/unit/test_long_project.py::test_file_delete", "tests/unit/test_ssl_project.py::BLACK", "tests/unit/__init__.py::BLACK", "tests/integration/conftest.py::PYLINT", "redcap/request.py::PYLINT", "tests/unit/test_simple_project.py::test_file_import", "tests/unit/callback_utils.py::BLACK", "tests/unit/test_simple_project.py::test_csv_export", "tests/unit/callback_utils.py::PYLINT", "redcap/__init__.py::PYLINT", "tests/unit/test_ssl_project.py::test_verify_ssl_can_be_disabled", "tests/unit/test_simple_project.py::test_filter_metadata_enforces_strict_keys", "tests/unit/test_simple_project.py::test_verify_ssl_defaults_to_true", "tests/unit/test_ssl_project.py::PYLINT", "tests/integration/test_simple_project.py::BLACK", "tests/unit/test_simple_project.py::test_bad_creds", "tests/integration/conftest.py::BLACK", "tests/unit/test_simple_project.py::test_import_records", "tests/unit/test_long_project.py::test_init", "docs/conf.py::BLACK", "tests/unit/test_simple_project.py::test_bad_import_throws_exception", "tests/unit/test_long_project.py::test_is_longitudinal", "tests/unit/test_simple_project.py::test_export_records_strictly_enforces_format", "tests/unit/test_simple_project.py::test_export_field_names", "redcap/__init__.py::BLACK", "tests/unit/test_request.py::test_survey_participant_list_checks_content", "tests/unit/test_simple_project.py::test_export_field_names_strictly_enforces_format", "tests/unit/test_simple_project.py::test_import_date_formatting[record2-MDY]", "tests/unit/test_simple_project.py::test_metadata_df_export_correctly_uses_df_kwargs", "tests/integration/__init__.py::BLACK", "tests/unit/test_simple_project.py::test_user_export", "tests/unit/test_simple_project.py::test_export_always_include_def_field", "tests/unit/test_request.py::test_newlines_are_handled", "tests/unit/test_long_project.py::test_file_import", "tests/unit/test_simple_project.py::PYLINT", "tests/unit/test_simple_project.py::test_df_import", "tests/unit/test_simple_project.py::test_metadata_export_passes_filters_as_arrays", "tests/unit/test_simple_project.py::test_json_export", "tests/unit/test_long_project.py::BLACK", "redcap/request.py::BLACK", "tests/unit/test_simple_project.py::test_init", "tests/unit/test_simple_project.py::test_export_df_field_names_single_field", "tests/unit/test_simple_project.py::test_metadata_import", "tests/unit/conftest.py::BLACK", "tests/unit/test_long_project.py::test_import_dataframe", "tests/unit/test_simple_project.py::test_export_project_info", "tests/unit/test_simple_project.py::test_get_version", "tests/unit/test_simple_project.py::test_events_and_arms_attrs_are_empty", "tests/unit/test_survey_project.py::test_export_survey_fields", "tests/unit/test_simple_project.py::BLACK", "tests/unit/test_simple_project.py::test_export_survey_fields_doesnt_include_survey_fields", "tests/unit/test_simple_project.py::test_import_date_formatting[record0-YMD]", "tests/unit/test_long_project.py::test_file_export", "tests/unit/test_simple_project.py::test_metadata_csv_import", "tests/unit/test_simple_project.py::test_reduced_metadata_import", "tests/__init__.py::BLACK", "tests/integration/__init__.py::PYLINT", "tests/unit/test_simple_project.py::test_metadata_df_export", "tests/unit/test_request.py::test_rcrequest_checks_paylods", "tests/unit/test_ssl_project.py::test_init", "tests/unit/conftest.py::PYLINT", "tests/unit/test_simple_project.py::test_df_export", "redcap/project.py::BLACK", "tests/unit/test_survey_project.py::test_init", "tests/unit/test_simple_project.py::test_generate_next_record_name", "tests/unit/__init__.py::PYLINT", "tests/unit/test_request.py::BLACK", "tests/unit/test_simple_project.py::test_metadata_df_import", "tests/unit/test_simple_project.py::test_export_data_access_groups", "redcap/project.py::PYLINT", "tests/unit/test_simple_project.py::test_is_not_longitudinal", "tests/unit/test_simple_project.py::test_delete_records", "tests/unit/test_long_project.py::test_metadata_import_handles_api_error", "tests/unit/test_simple_project.py::test_df_export_correctly_uses_df_kwargs", "tests/unit/test_simple_project.py::test_file_export", "tests/unit/test_simple_project.py::test_export_with_date_filters", "tests/unit/test_simple_project.py::test_metadata_type_catches_non_existent_fields", "tests/unit/test_simple_project.py::test_export_checkbox_labels", "tests/unit/test_survey_project.py::PYLINT", "tests/unit/test_long_project.py::PYLINT", "tests/integration/test_simple_project.py::PYLINT", "tests/unit/test_long_project.py::test_export_survey_participants_list", "tests/unit/test_long_project.py::test_export_to_df_gives_multi_index", "tests/unit/test_simple_project.py::test_delete_records_passes_filters_as_arrays", "tests/unit/test_long_project.py::test_long_attrs_are_populated", "tests/unit/test_request.py::PYLINT", "tests/unit/test_long_project.py::test_export_with_events", "tests/unit/test_simple_project.py::test_server_error_produces_redcap_error", "tests/__init__.py::PYLINT"], "language": "python", "test_command": "source /saved/ENV || source /saved/*/ENV && pytest --no-header -rA --tb=no -p no:cacheprovider --continue-on-collection-errors", "test_output_parser": "python/parse_log_pytest_v3", "image_storage_uri": "vmvm-registry.fbinfra.net/repomate_image_activ_pytest/redcap-tools_pycap:5fb98f80427fc437cbdfed4e83d7e3dc46b9453f", "patch": "", "test_patch": "[\"diff --git a/tests/unit/test_long_project.py b/tests/unit/test_long_project.py\\nindex e2c931f..baa6c41 100644\\n--- a/tests/unit/test_long_project.py\\n+++ b/tests/unit/test_long_project.py\\n@@ -96,7 +96,7 @@ def test_export_with_events(long_project):\\n \\n \\n def test_fem_export(long_project):\\n-    fem = long_project.export_fem(format=\\\"json\\\")\\n+    fem = long_project.export_instrument_event_mappings(format=\\\"json\\\")\\n \\n     assert isinstance(fem, list)\\n \\n@@ -106,7 +106,7 @@ def test_fem_export(long_project):\\n \\n def test_fem_export_stricly_enforces_format(long_project):\\n     with pytest.raises(ValueError):\\n-        long_project.export_fem(format=\\\"unsupported\\\")\\n+        long_project.export_instrument_event_mappings(format=\\\"unsupported\\\")\\n \\n \\n def test_export_to_df_gives_multi_index(long_project):\\n@@ -124,6 +124,6 @@ def test_import_dataframe(long_project):\\n \\n \\n def test_reports_df_export(long_project):\\n-    report = long_project.export_reports(report_id=\\\"1\\\", format=\\\"df\\\")\\n+    report = long_project.export_report(report_id=\\\"1\\\", format=\\\"df\\\")\\n \\n     assert isinstance(report, pd.DataFrame)\\n\",\"diff --git a/tests/unit/test_simple_project.py b/tests/unit/test_simple_project.py\\nindex 3b14da4..8b95d60 100644\\n--- a/tests/unit/test_simple_project.py\\n+++ b/tests/unit/test_simple_project.py\\n@@ -95,7 +95,7 @@ def test_get_version(simple_project):\\n \\n \\n def test_life_goes_on_without_the_version(simple_project, mocker):\\n-    mocker.patch.object(simple_project, \\\"_Project__rcv\\\", side_effect=(Exception))\\n+    mocker.patch.object(simple_project, \\\"_rcv\\\", side_effect=(Exception))\\n \\n     with pytest.raises(RedcapError):\\n         simple_project.configure()\\n@@ -347,7 +347,7 @@ def test_fem_export_passes_filters_as_arrays(simple_project, mocker):\\n         simple_project, \\\"_call_api\\\", return_value=(None, None)\\n     )\\n \\n-    simple_project.export_fem(arms=[\\\"arm0\\\", \\\"arm1\\\", \\\"arm2\\\"])\\n+    simple_project.export_instrument_event_mappings(arms=[\\\"arm0\\\", \\\"arm1\\\", \\\"arm2\\\"])\\n \\n     args, _ = mocked_api_call.call_args\\n \\n@@ -424,7 +424,7 @@ def test_export_methods_handle_empty_data_error(simple_project, mocker):\\n     dataframe = simple_project.export_records(format=\\\"df\\\")\\n     assert dataframe.empty\\n \\n-    dataframe = simple_project.export_fem(format=\\\"df\\\")\\n+    dataframe = simple_project.export_instrument_event_mappings(format=\\\"df\\\")\\n     assert dataframe.empty\\n \\n     dataframe = simple_project.export_metadata(format=\\\"df\\\")\\n@@ -458,17 +458,17 @@ def test_df_import(simple_project):\\n \\n \\n def test_reports_json_export(simple_project):\\n-    report = simple_project.export_reports(report_id=\\\"1\\\")\\n+    report = simple_project.export_report(report_id=\\\"1\\\")\\n \\n     assert is_json(report)\\n \\n \\n def test_reports_df_export(simple_project):\\n-    report = simple_project.export_reports(report_id=\\\"1\\\", format=\\\"df\\\")\\n+    report = simple_project.export_report(report_id=\\\"1\\\", format=\\\"df\\\")\\n \\n     assert isinstance(report, pd.DataFrame)\\n \\n \\n def test_reports_export_stricly_enforces_format(simple_project):\\n     with pytest.raises(ValueError):\\n-        simple_project.export_reports(report_id=\\\"1\\\", format=\\\"unsupported\\\")\\n+        simple_project.export_report(report_id=\\\"1\\\", format=\\\"unsupported\\\")\"]", "hints_text": ""}
