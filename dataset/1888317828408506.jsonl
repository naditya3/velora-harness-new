{"instance_id": "1888317828408506", "repo": "bioforensics/microhapdb", "base_commit": "680389d863514d31ce164402cc455581c1716b87", "problem_statement": "Include coordinates for both GRCh37 and GRCh38:\\nCurrently only GRCh38 coordinates are provided for each marker. Many labs are still stuck using data with GRCh37 coordinates, and while it would be great if they could \"get with the program\" there are a lot of reasons why that isn't always practical.\\r\\n\\r\\nI'm hesitant to change the database layout too much, at least for now. The current schema strikes a good balance between extensibility and ease of access. For example, I not keen on creating a \"variant\" table with rsID, GRCh37, and GRCh38 coordinates for each variant, which would also require a table to map variants to markers.\\r\\n\\r\\n@rnmitchell suggested having two copies of the `marker.tsv` table, one with GRCh38 coordinates and one with GRCh37 coordinates. MicroHapDB is decidedly \"small data\" so this amount of duplication is a drop in the bucket. For the Python API, users could choose which table to query (`microhapdb.markers` vs `microhapdb.hg19_markers`). And for the CLI, include a `--hg37` or `--hg19` flag when appropriate for users that want coordinates from that build.", "FAIL_TO_PASS": ["microhapdb/tests/test_marker.py::test_set_reference", "microhapdb/tests/test_cli.py::test_hg37_detail"], "PASS_TO_PASS": ["microhapdb/tests/test_cli.py::test_version", "microhapdb/tests/test_frequency.py::test_allele_frequencies", "dbbuild/pearhash/test_pearhash.py::TestPearsonHasher::test_two_bytes", "microhapdb/tests/test_marker.py::test_marker_detail_multi", "microhapdb/tests/test_cli.py::test_main_frequency_by_pop[None---marker=mh14PK-72639-None-217]", "microhapdb/tests/test_population.py::test_pop_detail", "microhapdb/tests/test_frequency.py::test_assumptions", "microhapdb/tests/test_cli.py::test_main_frequency_by_pop[--population=SA000009J---marker=mh13KK-218-None-15]", "microhapdb/tests/test_marker.py::test_standardize_ids", "microhapdb/tests/test_marker.py::test_assumptions", "microhapdb/tests/test_cli.py::test_parser", "microhapdb/tests/test_retrieve.py::test_all_ids", "dbbuild/pearhash/test_pearhash.py::TestPearsonHasher::test_four_bytes", "microhapdb/tests/test_cli.py::test_main_panel[beta]", "microhapdb/tests/test_retrieve.py::test_retrieve_by_id", "microhapdb/tests/test_marker.py::test_amplicon_object", "microhapdb/tests/test_cli.py::test_main_frequency_by_pop[None---marker=mh13KK-218---allele=C,T,C,T-97]", "microhapdb/tests/test_cli.py::test_main_marker_noargs", "microhapdb/tests/test_cli.py::test_main_no_args", "microhapdb/tests/test_cli.py::test_main_pop_noargs", "microhapdb/tests/test_cli.py::test_main_pop_detail", "microhapdb/tests/test_cli.py::test_main_marker_fasta_default_delta", "microhapdb/tests/test_cli.py::test_main_frequency_by_pop[None-None-None-113477]", "microhapdb/tests/test_cli.py::test_help", "microhapdb/tests/test_retrieve.py::test_retrieve_by_region", "microhapdb/tests/test_retrieve.py::test_marker_ids", "dbbuild/pearhash/test_pearhash.py::TestPearsonHasher::test_two_bytes_custom_seed", "microhapdb/tests/test_cli.py::test_main_marker_panel_query_conflict", "dbbuild/pearhash/test_pearhash.py::TestPearsonHasher::test_table_is_a_permutation_of_range_256", "microhapdb/tests/test_population.py::test_pop_detail_multi", "microhapdb/tests/test_population.py::test_assumptions", "microhapdb/tests/test_cli.py::test_main_marker_detail", "microhapdb/tests/test_marker.py::test_markers", "microhapdb/tests/test_marker.py::test_marker_fasta_multi", "microhapdb/tests/test_cli.py::test_main_marker_region_mode", "microhapdb/tests/test_population.py::test_standardize_ids", "microhapdb/tests/test_marker.py::test_marker_detail", "microhapdb/tests/test_cli.py::test_main_marker_fasta_long_delta", "microhapdb/tests/test_marker.py::test_marker_fasta", "microhapdb/tests/test_cli.py::test_main_marker_region_mode_failure", "microhapdb/tests/test_cli.py::test_main_marker_panel_region_conflict", "microhapdb/tests/test_marker.py::test_marker_detail_short", "microhapdb/tests/test_population.py::test_populations", "microhapdb/tests/test_cli.py::test_ae_pop_bad_pop", "microhapdb/tests/test_cli.py::test_main_frequency_by_pop[--population=Swedish-None-None-138]", "microhapdb/tests/test_cli.py::test_main_panel[alpha]", "microhapdb/tests/test_cli.py::test_files", "microhapdb/tests/test_marker.py::test_marker_detail_long"], "language": "python", "test_command": "source /saved/ENV || source /saved/*/ENV && pytest --no-header -rA --tb=no -p no:cacheprovider --continue-on-collection-errors", "test_output_parser": "python/parse_log_pytest_v3", "image_storage_uri": "vmvm-registry.fbinfra.net/repomate_image_activ_pytest/bioforensics_microhapdb:680389d863514d31ce164402cc455581c1716b87", "patch": "", "test_patch": "[\"diff --git a/microhapdb/tests/test_cli.py b/microhapdb/tests/test_cli.py\\nindex fffd9187..2bfacb56 100644\\n--- a/microhapdb/tests/test_cli.py\\n+++ b/microhapdb/tests/test_cli.py\\n@@ -301,3 +301,37 @@ def test_ae_pop_bad_pop():\\n     args = get_parser().parse_args(arglist)\\n     with pytest.raises(ValueError, match=r'no Ae data for population \\\"ABC\\\"'):\\n         microhapdb.cli.main(args)\\n+\\n+\\n+def test_hg37(capsys):\\n+    arglist = ['marker', '--region=chr18:1-25000000', '--GRCh37']\\n+    args = get_parser().parse_args(arglist)\\n+    microhapdb.cli.main(args)\\n+    terminal = capsys.readouterr()\\n+    exp_out = '''\\n+         Name          PermID Reference  Chrom                                          Offsets      Ae      In     Fst                        Source\\n+ mh18PK-87558  MHDBM-1e5374f1    GRCh37  chr18  1960543,1960558,1960562,1960567,1960583,1960589  2.3659  0.1325  0.0494  10.1016/j.fsigen.2018.05.008\\n+ mh18USC-18pA  MHDBM-56dfa93b    GRCh37  chr18          5280016,5280019,5280069,5280070,5280092  3.4330  0.2130  0.1818  10.1016/j.fsigen.2019.102213\\n+   mh18CP-005  MHDBM-a85754d3    GRCh37  chr18                  8892862,8892891,8892894,8892905  3.6722  0.0904  0.0059                        ALFRED\\n+   mh18KK-285  MHDBM-ea520d26    GRCh37  chr18              22137318,22137395,22137411,22137453  2.7524  0.1721  0.0836                        ALFRED\\n+    mh18AT-38  MHDBM-db09ec41    GRCh37  chr18                       22137395,22137411,22137453  2.7093  0.1419  0.0837                 ISFG2019:P597\\n+   mh18CP-003  MHDBM-6fdf83f9    GRCh37  chr18                       23068395,23068425,23068433  3.1124  0.1061  0.0183                        ALFRED\\n+'''\\n+    obs_out = terminal.out\\n+    assert exp_out.strip() == obs_out.strip()\\n+\\n+\\n+def test_h37_ae_pop(capsys):\\n+    arglist = ['marker', '--region=chr18:50000000-80000000', '--GRCh37', '--ae-pop=PJL']\\n+    args = get_parser().parse_args(arglist)\\n+    microhapdb.cli.main(args)\\n+    terminal = capsys.readouterr()\\n+    exp_out = '''\\n+         Name          PermID Reference  Chrom                              Offsets      Ae      In     Fst                        Source\\n+ mh18USC-18qB  MHDBM-14fcada5    GRCh37  chr18           50547498,50547528,50547540  3.8565  0.1449  0.0500  10.1016/j.fsigen.2019.102213\\n+ mh18USC-18qC  MHDBM-6bf74efc    GRCh37  chr18  63842523,63842541,63842557,63842562  3.5570  0.1436 -0.0049  10.1016/j.fsigen.2019.102213\\n+   mh18KK-293  MHDBM-13ed6da8    GRCh37  chr18  76089885,76089906,76089944,76089967  2.6445  0.2495  0.0837                        ALFRED\\n+    mh18AT-39  MHDBM-13ed6da8    GRCh37  chr18  76089885,76089906,76089944,76089967  2.6445  0.2495  0.0837                 ISFG2019:P597\\n+'''\\n+    obs_out = terminal.out\\n+    assert exp_out.strip() == obs_out.strip()\\n\",\"diff --git a/microhapdb/tests/test_marker.py b/microhapdb/tests/test_marker.py\\nindex 337016bd..78a8daec 100644\\n--- a/microhapdb/tests/test_marker.py\\n+++ b/microhapdb/tests/test_marker.py\\n@@ -497,3 +497,23 @@ def test_all_sources(name, data, capsys):\\n     terminal = capsys.readouterr()\\n     print(terminal.out)\\n     assert data in terminal.out\\n+\\n+\\n+def test_set_reference():\\n+    coords37 = [\\n+        '22137318,22137395,22137411,22137453',\\n+        '22137395,22137411,22137453',\\n+        '23068395,23068425,23068433',\\n+    ]\\n+    coords38 = [\\n+        '24557354,24557431,24557447,24557489',\\n+        '24557431,24557447,24557489',\\n+    ]\\n+    # Make sure they can be swapped in & out multiple times without issues\\n+    for _ in range(4):\\n+        microhapdb.set_reference(37)\\n+        result = microhapdb.retrieve.by_region('chr18:20000000-25000000')\\n+        assert result.Offsets.tolist() == coords37\\n+        microhapdb.set_reference(38)\\n+        result = microhapdb.retrieve.by_region('chr18:20000000-25000000')\\n+        assert result.Offsets.tolist() == coords38\\n\",\"diff --git a/microhapdb/tests/test_cli.py b/microhapdb/tests/test_cli.py\\nindex 2bfacb56..a70b5477 100644\\n--- a/microhapdb/tests/test_cli.py\\n+++ b/microhapdb/tests/test_cli.py\\n@@ -321,6 +321,58 @@ def test_hg37(capsys):\\n     assert exp_out.strip() == obs_out.strip()\\n \\n \\n+def test_hg37_detail(capsys):\\n+    arglist = ['marker', '--format=detail', '--GRCh37', 'mh17USC-17pA']\\n+    args = get_parser().parse_args(arglist)\\n+    microhapdb.cli.main(args)\\n+    terminal = capsys.readouterr()\\n+    exp_out = '''\\n+--------------------------------------------------------------[ MicroHapDB ]----\\n+mh17USC-17pA    a.k.a MHDBM-d5646523\\n+\\n+Marker Definition (GRCh37)\\n+    Marker extent\\n+        - chr17:3821918-3821988 (70 bp)\\n+    Target amplicon\\n+        - chr17:3918614-3918704 (90 bp)\\n+    Constituent variants\\n+        - chromosome offsets: 3821918,3821952,3821987\\n+        - marker offsets: 0,34,69\\n+        - amplicon offsets: 10,44,79\\n+        - cross-references: rs4995289, rs4995288, rs9904113\\n+    Observed haplotypes\\n+        - C,C,A\\n+        - C,C,C\\n+        - C,T,A\\n+        - C,T,C\\n+        - T,C,A\\n+        - T,C,C\\n+        - T,T,A\\n+        - T,T,C\\n+\\n+\\n+--[ Core Marker Sequence ]--\\n+>mh17USC-17pA\\n+CGTCTCATTTGGGGATCTTATCATATCCACAGTGTACCCCAGGGACCTACATTTATTTTCCTGCTGCTGA\\n+\\n+\\n+--[ Target Amplicon Sequence with Haplotypes ]--\\n+          *                                 *                                  *\\n+CCTGGAGCACCGTCTCATTTGGGGATCTTATCATATCCACAGTGTACCCCAGGGACCTACATTTATTTTCCTGCTGCTGATAACTCCACA\\n+..........C.................................C..................................A..........\\n+..........C.................................C..................................C..........\\n+..........C.................................T..................................A..........\\n+..........C.................................T..................................C..........\\n+..........T.................................C..................................A..........\\n+..........T.................................C..................................C..........\\n+..........T.................................T..................................A..........\\n+..........T.................................T..................................C..........\\n+--------------------------------------------------------------------------------\\n+'''\\n+    obs_out = terminal.out\\n+    assert exp_out.strip() == obs_out.strip()\\n+\\n+\\n def test_h37_ae_pop(capsys):\\n     arglist = ['marker', '--region=chr18:50000000-80000000', '--GRCh37', '--ae-pop=PJL']\\n     args = get_parser().parse_args(arglist)\"]", "hints_text": ""}
