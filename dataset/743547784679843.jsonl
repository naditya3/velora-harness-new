{"instance_id": "743547784679843", "repo": "jmbannon/ytdl-sub", "base_commit": "82c9beb00acfd8b779961d8b888103368ffbb986", "problem_statement": "Continue downloading other subscriptions if one fails:\\nThe default behavior should be to move onto the next subscription if one fails instead of failing and ending execution\\nImprove output summary:\\n- [x] link to error log on subscription error\\r\\n- [ ] total size in GB/TB per subscription\\r\\n- [x] sum of values at bottom", "FAIL_TO_PASS": ["tests/unit/cli/test_entrypoint.py::test_subscription_logs_write_to_file[False-False-True]", "tests/unit/cli/test_entrypoint.py::test_subscription_logs_write_to_file[False-False-False]", "tests/unit/cli/test_entrypoint.py::test_subscription_logs_write_to_file[True-True-False]", "tests/unit/cli/test_output_summary.py::test_output_summary_multiple_errors", "tests/unit/cli/test_entrypoint.py::test_subscription_logs_write_to_file[True-True-True]", "tests/unit/cli/test_entrypoint.py::test_subscription_logs_write_to_file[False-True-True]", "tests/unit/cli/test_entrypoint.py::test_subscription_logs_write_to_file[True-False-True]", "tests/unit/cli/test_output_summary.py::test_output_summary_one_error", "tests/unit/utils/test_logger.py::TestLogger::test_logger_can_be_cleaned_during_execution[True]", "tests/unit/main/test_main.py::test_main_exit_code[0]", "tests/unit/cli/test_output_summary.py::test_output_summary_no_errors", "tests/unit/main/test_main.py::test_main_uncaught_error", "tests/unit/cli/test_entrypoint.py::test_subscription_logs_write_to_file[True-False-False]", "tests/unit/utils/test_logger.py::TestLogger::test_logger_can_be_cleaned_during_execution[False]", "tests/unit/cli/test_entrypoint.py::test_subscription_logs_write_to_file[False-True-False]", "tests/unit/main/test_main.py::test_main_exit_code[1]"], "PASS_TO_PASS": [], "language": "python", "test_command": "source /saved/ENV || source /saved/*/ENV && pytest --no-header -rA --tb=no -p no:cacheprovider --continue-on-collection-errors", "test_output_parser": "python/parse_log_pytest_v3", "image_storage_uri": "vmvm-registry.fbinfra.net/repomate_image_activ_pytest/jmbannon_ytdl-sub:82c9beb00acfd8b779961d8b888103368ffbb986", "patch": "[\"diff --git a/src/ytdl_sub/cli/entrypoint.py b/src/ytdl_sub/cli/entrypoint.py\\nindex c685fb6f2..d91d184df 100644\\n--- a/src/ytdl_sub/cli/entrypoint.py\\n+++ b/src/ytdl_sub/cli/entrypoint.py\\n@@ -5,7 +5,6 @@\\n from pathlib import Path\\n from typing import List\\n from typing import Optional\\n-from typing import Tuple\\n \\n from yt_dlp.utils import sanitize_filename\\n \\n@@ -20,7 +19,6 @@\\n from ytdl_sub.utils.exceptions import ExperimentalFeatureNotEnabled\\n from ytdl_sub.utils.exceptions import ValidationException\\n from ytdl_sub.utils.file_handler import FileHandler\\n-from ytdl_sub.utils.file_handler import FileHandlerTransactionLog\\n from ytdl_sub.utils.file_lock import working_directory_lock\\n from ytdl_sub.utils.logger import Logger\\n \\n@@ -67,7 +65,7 @@ def _maybe_write_subscription_log_file(\\n \\n def _download_subscriptions_from_yaml_files(\\n     config: ConfigFile, subscription_paths: List[str], update_with_info_json: bool, dry_run: bool\\n-) -> List[Tuple[Subscription, FileHandlerTransactionLog]]:\\n+) -> List[Subscription]:\\n     \\\"\\\"\\\"\\n     Downloads all subscriptions from one or many subscription yaml files.\\n \\n@@ -84,7 +82,7 @@ def _download_subscriptions_from_yaml_files(\\n \\n     Returns\\n     -------\\n-    List of (subscription, transaction_log)\\n+    List of subscriptions processed\\n \\n     Raises\\n     ------\\n@@ -92,7 +90,7 @@ def _download_subscriptions_from_yaml_files(\\n         Any exception during download\\n     \\\"\\\"\\\"\\n     subscriptions: List[Subscription] = []\\n-    output: List[Tuple[Subscription, FileHandlerTransactionLog]] = []\\n+    has_exception = False\\n \\n     # Load all the subscriptions first to perform all validation before downloading\\n     for path in subscription_paths:\\n@@ -106,31 +104,31 @@ def _download_subscriptions_from_yaml_files(\\n         )\\n         logger.debug(\\\"Subscription full yaml:\\\\n%s\\\", subscription.as_yaml())\\n \\n-        try:\\n+        with subscription.exception_handling():\\n             if update_with_info_json:\\n-                transaction_log = subscription.update_with_info_json(dry_run=dry_run)\\n+                subscription.update_with_info_json(dry_run=dry_run)\\n             else:\\n-                transaction_log = subscription.download(dry_run=dry_run)\\n-        except Exception as exc:  # pylint: disable=broad-except\\n-            _maybe_write_subscription_log_file(\\n-                config=config, subscription=subscription, dry_run=dry_run, exception=exc\\n-            )\\n-            raise\\n-        else:\\n-            output.append((subscription, transaction_log))\\n-            _maybe_write_subscription_log_file(\\n-                config=config, subscription=subscription, dry_run=dry_run\\n-            )\\n-            Logger.cleanup()  # Cleanup logger after each successful subscription download\\n-        finally:\\n-            gc.collect()  # Garbage collect after each subscription download\\n+                subscription.download(dry_run=dry_run)\\n+\\n+        has_exception = has_exception or subscription.exception is not None\\n+        _maybe_write_subscription_log_file(\\n+            config=config,\\n+            subscription=subscription,\\n+            dry_run=dry_run,\\n+            exception=subscription.exception,\\n+        )\\n+\\n+        if not has_exception:\\n+            Logger.cleanup()  # Cleanup logger if no exceptions occurred\\n \\n-    return output\\n+        gc.collect()  # Garbage collect after each subscription download\\n+\\n+    return subscriptions\\n \\n \\n def _download_subscription_from_cli(\\n     config: ConfigFile, dry_run: bool, extra_args: List[str]\\n-) -> Tuple[Subscription, FileHandlerTransactionLog]:\\n+) -> Subscription:\\n     \\\"\\\"\\\"\\n     Downloads a one-off subscription using the CLI\\n \\n@@ -158,12 +156,12 @@ def _download_subscription_from_cli(\\n     )\\n \\n     logger.info(\\\"Beginning CLI %s\\\", (\\\"dry run\\\" if dry_run else \\\"download\\\"))\\n-    return subscription, subscription.download(dry_run=dry_run)\\n+    subscription.download(dry_run=dry_run)\\n+\\n+    return subscription\\n \\n \\n-def _view_url_from_cli(\\n-    config: ConfigFile, url: str, split_chapters: bool\\n-) -> Tuple[Subscription, FileHandlerTransactionLog]:\\n+def _view_url_from_cli(config: ConfigFile, url: str, split_chapters: bool) -> Subscription:\\n     \\\"\\\"\\\"\\n     `ytdl-sub view` dry-runs a URL to print its source variables. Use the pre-built `_view` preset,\\n     inject the URL argument, and dry-run.\\n@@ -180,10 +178,12 @@ def _view_url_from_cli(\\n         url,\\n         \\\" with split chapters\\\" if split_chapters else \\\"\\\",\\n     )\\n-    return subscription, subscription.download(dry_run=True)\\n+    subscription.download(dry_run=True)\\n \\n+    return subscription\\n \\n-def main() -> List[Tuple[Subscription, FileHandlerTransactionLog]]:\\n+\\n+def main() -> List[Subscription]:\\n     \\\"\\\"\\\"\\n     Entrypoint for ytdl-sub, without the error handling\\n     \\\"\\\"\\\"\\n@@ -203,7 +203,7 @@ def main() -> List[Tuple[Subscription, FileHandlerTransactionLog]]:\\n         logger.info(\\\"No config specified, using defaults.\\\")\\n         config = ConfigFile(name=\\\"default_config\\\", value={})\\n \\n-    transaction_logs: List[Tuple[Subscription, FileHandlerTransactionLog]] = []\\n+    subscriptions: List[Subscription] = []\\n \\n     # If transaction log file is specified, make sure we can open it\\n     _maybe_validate_transaction_log_file(transaction_log_file_path=args.transaction_log)\\n@@ -222,7 +222,7 @@ def main() -> List[Tuple[Subscription, FileHandlerTransactionLog]]:\\n                     \\\"full backup before usage. You have been warned!\\\",\\n                 )\\n \\n-            transaction_logs = _download_subscriptions_from_yaml_files(\\n+            subscriptions = _download_subscriptions_from_yaml_files(\\n                 config=config,\\n                 subscription_paths=args.subscription_paths,\\n                 update_with_info_json=args.update_with_info_json,\\n@@ -231,13 +231,13 @@ def main() -> List[Tuple[Subscription, FileHandlerTransactionLog]]:\\n \\n         # One-off download\\n         elif args.subparser == \\\"dl\\\":\\n-            transaction_logs.append(\\n+            subscriptions.append(\\n                 _download_subscription_from_cli(\\n                     config=config, dry_run=args.dry_run, extra_args=extra_args\\n                 )\\n             )\\n         elif args.subparser == \\\"view\\\":\\n-            transaction_logs.append(\\n+            subscriptions.append(\\n                 _view_url_from_cli(config=config, url=args.url, split_chapters=args.split_chapters)\\n             )\\n         else:\\n@@ -245,10 +245,10 @@ def main() -> List[Tuple[Subscription, FileHandlerTransactionLog]]:\\n \\n     if not args.suppress_transaction_log:\\n         output_transaction_log(\\n-            transaction_logs=transaction_logs,\\n+            subscriptions=subscriptions,\\n             transaction_log_file_path=args.transaction_log,\\n         )\\n \\n-    output_summary(transaction_logs)\\n+    output_summary(subscriptions)\\n \\n-    return transaction_logs\\n+    return subscriptions\\n\",\"diff --git a/src/ytdl_sub/cli/output_summary.py b/src/ytdl_sub/cli/output_summary.py\\nindex 607f0bf6a..d08ff1bf0 100644\\n--- a/src/ytdl_sub/cli/output_summary.py\\n+++ b/src/ytdl_sub/cli/output_summary.py\\n@@ -1,10 +1,8 @@\\n from typing import List\\n-from typing import Tuple\\n \\n from colorama import Fore\\n \\n from ytdl_sub.subscriptions.subscription import Subscription\\n-from ytdl_sub.utils.file_handler import FileHandlerTransactionLog\\n from ytdl_sub.utils.logger import Logger\\n \\n logger = Logger.get()\\n@@ -37,12 +35,12 @@ def _color_int(value: int) -> str:\\n     return _no_color(str_int)\\n \\n \\n-def output_summary(transaction_logs: List[Tuple[Subscription, FileHandlerTransactionLog]]) -> str:\\n+def output_summary(subscriptions: List[Subscription]) -> str:\\n     \\\"\\\"\\\"\\n     Parameters\\n     ----------\\n-    transaction_logs\\n-        Transaction logs from downloaded subscriptions\\n+    subscriptions\\n+        Processed subscriptions\\n \\n     Returns\\n     -------\\n@@ -58,7 +56,7 @@ def output_summary(transaction_logs: List[Tuple[Subscription, FileHandlerTransac\\n     width_num_entries: int = 0\\n \\n     # Calculate min width needed\\n-    for subscription, _ in transaction_logs:\\n+    for subscription in subscriptions:\\n         width_sub_name = max(width_sub_name, len(subscription.name))\\n         width_num_entries_added = max(\\n             width_num_entries_added, len(_color_int(subscription.num_entries_added))\\n@@ -76,12 +74,12 @@ def output_summary(transaction_logs: List[Tuple[Subscription, FileHandlerTransac\\n     width_num_entries += 4\\n \\n     # Build the summary\\n-    for subscription, _ in transaction_logs:\\n+    for subscription in subscriptions:\\n         num_entries_added = _color_int(subscription.num_entries_added)\\n         num_entries_modified = _color_int(subscription.num_entries_modified)\\n         num_entries_removed = _color_int(subscription.num_entries_removed * -1)\\n         num_entries = str(subscription.num_entries)\\n-        status = _green(\\\"success\\\")\\n+        status = _red(\\\"error\\\") if subscription.exception else _green(\\\"success\\\")\\n \\n         summary.append(\\n             f\\\"{subscription.name:<{width_sub_name}} \\\"\\n\",\"diff --git a/src/ytdl_sub/cli/output_transaction_log.py b/src/ytdl_sub/cli/output_transaction_log.py\\nindex 6bf5e07b2..ce46de0c5 100644\\n--- a/src/ytdl_sub/cli/output_transaction_log.py\\n+++ b/src/ytdl_sub/cli/output_transaction_log.py\\n@@ -1,10 +1,8 @@\\n from typing import List\\n from typing import Optional\\n-from typing import Tuple\\n \\n from ytdl_sub.subscriptions.subscription import Subscription\\n from ytdl_sub.utils.exceptions import ValidationException\\n-from ytdl_sub.utils.file_handler import FileHandlerTransactionLog\\n from ytdl_sub.utils.logger import Logger\\n \\n logger = Logger.get()\\n@@ -23,7 +21,7 @@ def _maybe_validate_transaction_log_file(transaction_log_file_path: Optional[str\\n \\n \\n def output_transaction_log(\\n-    transaction_logs: List[Tuple[Subscription, FileHandlerTransactionLog]],\\n+    subscriptions: List[Subscription],\\n     transaction_log_file_path: Optional[str],\\n ) -> None:\\n     \\\"\\\"\\\"\\n@@ -31,19 +29,19 @@ def output_transaction_log(\\n \\n     Parameters\\n     ----------\\n-    transaction_logs\\n-        The transaction logs from downloaded subscriptions\\n+    subscriptions\\n+        Processed subscriptions\\n     transaction_log_file_path\\n         Optional file path to write to\\n     \\\"\\\"\\\"\\n     transaction_log_file_contents = \\\"\\\"\\n-    for subscription, transaction_log in transaction_logs:\\n-        if transaction_log.is_empty:\\n+    for subscription in subscriptions:\\n+        if subscription.transaction_log.is_empty:\\n             transaction_log_contents = f\\\"\\\\nNo files changed for {subscription.name}\\\"\\n         else:\\n             transaction_log_contents = (\\n                 f\\\"Transaction log for {subscription.name}:\\\\n\\\"\\n-                f\\\"{transaction_log.to_output_message(subscription.output_directory)}\\\"\\n+                f\\\"{subscription.transaction_log.to_output_message(subscription.output_directory)}\\\"\\n             )\\n \\n         if transaction_log_file_path:\\n\",\"diff --git a/src/ytdl_sub/subscriptions/base_subscription.py b/src/ytdl_sub/subscriptions/base_subscription.py\\nindex 28f9caa6b..0c61f7e14 100644\\n--- a/src/ytdl_sub/subscriptions/base_subscription.py\\n+++ b/src/ytdl_sub/subscriptions/base_subscription.py\\n@@ -9,6 +9,7 @@\\n from ytdl_sub.config.preset_options import Overrides\\n from ytdl_sub.config.preset_options import YTDLOptions\\n from ytdl_sub.downloaders.url.validators import MultiUrlValidator\\n+from ytdl_sub.utils.file_handler import FileHandlerTransactionLog\\n from ytdl_sub.utils.logger import Logger\\n from ytdl_sub.ytdl_additions.enhanced_download_archive import EnhancedDownloadArchive\\n \\n@@ -59,6 +60,8 @@ def __init__(\\n             migrated_file_name=migrated_file_name,\\n         )\\n \\n+        self._exception: Optional[Exception] = None\\n+\\n     @property\\n     def downloader_options(self) -> MultiUrlValidator:\\n         \\\"\\\"\\\"\\n@@ -167,6 +170,24 @@ def num_entries(self) -> int:\\n         \\\"\\\"\\\"\\n         return self._enhanced_download_archive.num_entries\\n \\n+    @property\\n+    def transaction_log(self) -> FileHandlerTransactionLog:\\n+        \\\"\\\"\\\"\\n+        Returns\\n+        -------\\n+        Transaction log from the subscription\\n+        \\\"\\\"\\\"\\n+        return self._enhanced_download_archive.get_file_handler_transaction_log()\\n+\\n+    @property\\n+    def exception(self) -> Optional[Exception]:\\n+        \\\"\\\"\\\"\\n+        Returns\\n+        -------\\n+        An exception if one occurred while processing the subscription\\n+        \\\"\\\"\\\"\\n+        return self._exception\\n+\\n     def as_yaml(self) -> str:\\n         \\\"\\\"\\\"\\n         Returns\\n\",\"diff --git a/src/ytdl_sub/subscriptions/subscription_download.py b/src/ytdl_sub/subscriptions/subscription_download.py\\nindex 4e6eebcc1..366b8a6e5 100644\\n--- a/src/ytdl_sub/subscriptions/subscription_download.py\\n+++ b/src/ytdl_sub/subscriptions/subscription_download.py\\n@@ -326,7 +326,9 @@ def download(self, dry_run: bool = False) -> FileHandlerTransactionLog:\\n             If true, do not download any video/audio files or move anything to the output\\n             directory.\\n         \\\"\\\"\\\"\\n+        self._exception = None\\n         self._enhanced_download_archive.reinitialize(dry_run=dry_run)\\n+\\n         plugins = self._initialize_plugins()\\n \\n         subscription_ytdl_options = SubscriptionYTDLOptions(\\n@@ -353,6 +355,19 @@ def download(self, dry_run: bool = False) -> FileHandlerTransactionLog:\\n             dry_run=dry_run,\\n         )\\n \\n+    @contextlib.contextmanager\\n+    def exception_handling(self) -> None:\\n+        \\\"\\\"\\\"\\n+        Try to perform something on the subscription.\\n+        Store the error if one occurs.\\n+        \\\"\\\"\\\"\\n+        try:\\n+            yield\\n+        except Exception as exc:  # pylint: disable=broad-except\\n+            self._exception = exc\\n+\\n+        return self.transaction_log\\n+\\n     def update_with_info_json(self, dry_run: bool = False) -> FileHandlerTransactionLog:\\n         \\\"\\\"\\\"\\n         Performs the subscription update using local info json files.\\n@@ -362,7 +377,9 @@ def update_with_info_json(self, dry_run: bool = False) -> FileHandlerTransaction\\n         dry_run\\n             If true, do not modify any video/audio files or move anything to the output directory.\\n         \\\"\\\"\\\"\\n+        self._exception = None\\n         self._enhanced_download_archive.reinitialize(dry_run=dry_run)\\n+\\n         plugins = self._initialize_plugins()\\n \\n         subscription_ytdl_options = SubscriptionYTDLOptions(\\n\",\"diff --git a/src/ytdl_sub/cli/entrypoint.py b/src/ytdl_sub/cli/entrypoint.py\\nindex d91d184df..8c6b3aabc 100644\\n--- a/src/ytdl_sub/cli/entrypoint.py\\n+++ b/src/ytdl_sub/cli/entrypoint.py\\n@@ -97,14 +97,14 @@ def _download_subscriptions_from_yaml_files(\\n         subscriptions += Subscription.from_file_path(config=config, subscription_path=path)\\n \\n     for subscription in subscriptions:\\n-        logger.info(\\n-            \\\"Beginning subscription %s for %s\\\",\\n-            (\\\"dry run\\\" if dry_run else \\\"download\\\"),\\n-            subscription.name,\\n-        )\\n-        logger.debug(\\\"Subscription full yaml:\\\\n%s\\\", subscription.as_yaml())\\n-\\n         with subscription.exception_handling():\\n+            logger.info(\\n+                \\\"Beginning subscription %s for %s\\\",\\n+                (\\\"dry run\\\" if dry_run else \\\"download\\\"),\\n+                subscription.name,\\n+            )\\n+            logger.debug(\\\"Subscription full yaml:\\\\n%s\\\", subscription.as_yaml())\\n+\\n             if update_with_info_json:\\n                 subscription.update_with_info_json(dry_run=dry_run)\\n             else:\\n\",\"diff --git a/src/ytdl_sub/cli/output_summary.py b/src/ytdl_sub/cli/output_summary.py\\nindex d08ff1bf0..e50701ca4 100644\\n--- a/src/ytdl_sub/cli/output_summary.py\\n+++ b/src/ytdl_sub/cli/output_summary.py\\n@@ -35,7 +35,7 @@ def _color_int(value: int) -> str:\\n     return _no_color(str_int)\\n \\n \\n-def output_summary(subscriptions: List[Subscription]) -> str:\\n+def output_summary(subscriptions: List[Subscription]) -> None:\\n     \\\"\\\"\\\"\\n     Parameters\\n     ----------\\n@@ -48,6 +48,14 @@ def output_summary(subscriptions: List[Subscription]) -> str:\\n     \\\"\\\"\\\"\\n     summary: List[str] = []\\n \\n+    # Initialize totals to 0\\n+    total_subs: int = 0\\n+    total_added: int = 0\\n+    total_modified: int = 0\\n+    total_removed: int = 0\\n+    total_entries: int = 0\\n+    total_errors: int = 0\\n+\\n     # Initialize widths to 0\\n     width_sub_name: int = 0\\n     width_num_entries_added: int = 0\\n@@ -90,5 +98,35 @@ def output_summary(subscriptions: List[Subscription]) -> str:\\n             f\\\"{status}\\\"\\n         )\\n \\n+        # Add total\\n+        total_subs += 1\\n+        total_added += subscription.num_entries_added\\n+        total_modified += subscription.num_entries_modified\\n+        total_removed -= subscription.num_entries_removed\\n+        total_entries += subscription.num_entries\\n+        total_errors += int(subscription.exception is not None)\\n+\\n+    total_subs_str = f\\\"Total: {total_subs} Subscriptions\\\"\\n+    total_errors_str = (\\n+        _green(\\\"All Successful\\\")\\n+        if total_errors == 0\\n+        else _red(f\\\"{total_errors} Error{'s' if total_errors > 1 else ''}\\\")\\n+    )\\n+\\n+    summary.append(\\\"\\\")  # new line\\n+    summary.append(\\n+        f\\\"{total_subs_str:<{width_sub_name}} \\\"\\n+        f\\\"{_color_int(total_added):>{width_num_entries_added}} \\\"\\n+        f\\\"{_color_int(total_modified):>{width_num_entries_modified}} \\\"\\n+        f\\\"{_color_int(total_removed):>{width_num_entries_removed}} \\\"\\n+        f\\\"{str(total_entries):>{width_num_entries}} \\\"\\n+        f\\\"{total_errors_str}\\\"\\n+    )\\n+\\n+    if total_errors > 0:\\n+        summary.append(\\\"\\\")\\n+        summary.append(f\\\"See `{Logger.debug_log_filename()}` for details on errors.\\\")\\n+        summary.append(\\\"Consider making a GitHub issue including the uploaded log file.\\\")\\n+\\n     # Hack to always show download summary, even if logs are set to quiet\\n     logger.warning(\\\"Download Summary:\\\\n%s\\\", \\\"\\\\n\\\".join(summary))\\n\",\"diff --git a/src/ytdl_sub/cli/entrypoint.py b/src/ytdl_sub/cli/entrypoint.py\\nindex 8c6b3aabc..ae89cf161 100644\\n--- a/src/ytdl_sub/cli/entrypoint.py\\n+++ b/src/ytdl_sub/cli/entrypoint.py\\n@@ -57,7 +57,7 @@ def _maybe_write_subscription_log_file(\\n     persist_log_path = Path(config.config_options.persist_logs.logs_directory) / log_filename\\n \\n     if not success:\\n-        Logger.log_exit_exception(exception=exception, log_filepath=persist_log_path)\\n+        Logger.log_exception(exception=exception, log_filepath=persist_log_path)\\n \\n     os.makedirs(os.path.dirname(persist_log_path), exist_ok=True)\\n     FileHandler.copy(Logger.debug_log_filename(), persist_log_path)\\n@@ -90,7 +90,6 @@ def _download_subscriptions_from_yaml_files(\\n         Any exception during download\\n     \\\"\\\"\\\"\\n     subscriptions: List[Subscription] = []\\n-    has_exception = False\\n \\n     # Load all the subscriptions first to perform all validation before downloading\\n     for path in subscription_paths:\\n@@ -110,7 +109,6 @@ def _download_subscriptions_from_yaml_files(\\n             else:\\n                 subscription.download(dry_run=dry_run)\\n \\n-        has_exception = has_exception or subscription.exception is not None\\n         _maybe_write_subscription_log_file(\\n             config=config,\\n             subscription=subscription,\\n@@ -118,9 +116,7 @@ def _download_subscriptions_from_yaml_files(\\n             exception=subscription.exception,\\n         )\\n \\n-        if not has_exception:\\n-            Logger.cleanup()  # Cleanup logger if no exceptions occurred\\n-\\n+        Logger.cleanup(cleanup_error_log=False)\\n         gc.collect()  # Garbage collect after each subscription download\\n \\n     return subscriptions\\n\",\"diff --git a/src/ytdl_sub/cli/output_summary.py b/src/ytdl_sub/cli/output_summary.py\\nindex e50701ca4..ea133bbb8 100644\\n--- a/src/ytdl_sub/cli/output_summary.py\\n+++ b/src/ytdl_sub/cli/output_summary.py\\n@@ -49,7 +49,8 @@ def output_summary(subscriptions: List[Subscription]) -> None:\\n     summary: List[str] = []\\n \\n     # Initialize totals to 0\\n-    total_subs: int = 0\\n+    total_subs: int = len(subscriptions)\\n+    total_subs_str = f\\\"Total: {total_subs}\\\"\\n     total_added: int = 0\\n     total_modified: int = 0\\n     total_removed: int = 0\\n@@ -57,7 +58,7 @@ def output_summary(subscriptions: List[Subscription]) -> None:\\n     total_errors: int = 0\\n \\n     # Initialize widths to 0\\n-    width_sub_name: int = 0\\n+    width_sub_name: int = len(total_subs_str)\\n     width_num_entries_added: int = 0\\n     width_num_entries_modified: int = 0\\n     width_num_entries_removed: int = 0\\n@@ -99,21 +100,18 @@ def output_summary(subscriptions: List[Subscription]) -> None:\\n         )\\n \\n         # Add total\\n-        total_subs += 1\\n         total_added += subscription.num_entries_added\\n         total_modified += subscription.num_entries_modified\\n         total_removed -= subscription.num_entries_removed\\n         total_entries += subscription.num_entries\\n         total_errors += int(subscription.exception is not None)\\n \\n-    total_subs_str = f\\\"Total: {total_subs} Subscriptions\\\"\\n     total_errors_str = (\\n-        _green(\\\"All Successful\\\")\\n+        _green(\\\"success!\\\")\\n         if total_errors == 0\\n-        else _red(f\\\"{total_errors} Error{'s' if total_errors > 1 else ''}\\\")\\n+        else _red(f\\\"{total_errors} error{'s' if total_errors > 1 else ''}\\\")\\n     )\\n \\n-    summary.append(\\\"\\\")  # new line\\n     summary.append(\\n         f\\\"{total_subs_str:<{width_sub_name}} \\\"\\n         f\\\"{_color_int(total_added):>{width_num_entries_added}} \\\"\\n@@ -125,7 +123,7 @@ def output_summary(subscriptions: List[Subscription]) -> None:\\n \\n     if total_errors > 0:\\n         summary.append(\\\"\\\")\\n-        summary.append(f\\\"See `{Logger.debug_log_filename()}` for details on errors.\\\")\\n+        summary.append(f\\\"See `{Logger.error_log_filename()}` for details on errors.\\\")\\n         summary.append(\\\"Consider making a GitHub issue including the uploaded log file.\\\")\\n \\n     # Hack to always show download summary, even if logs are set to quiet\\n\",\"diff --git a/src/ytdl_sub/main.py b/src/ytdl_sub/main.py\\nindex d522049a4..9b7dbff39 100644\\n--- a/src/ytdl_sub/main.py\\n+++ b/src/ytdl_sub/main.py\\n@@ -24,9 +24,9 @@ def main():\\n     \\\"\\\"\\\"\\n     try:\\n         _main()\\n-        Logger.cleanup()  # Ran successfully, so we can delete the debug file\\n+        Logger.cleanup(cleanup_error_log=True)  # Ran successfully, so we can delete the debug file\\n     except Exception as exc:  # pylint: disable=broad-except\\n-        Logger.log_exit_exception(exception=exc)\\n+        Logger.log_exception(exception=exc)\\n         sys.exit(1)\\n \\n     sys.exit(0)\\n\",\"diff --git a/src/ytdl_sub/utils/logger.py b/src/ytdl_sub/utils/logger.py\\nindex 70bde484f..263cd123e 100644\\n--- a/src/ytdl_sub/utils/logger.py\\n+++ b/src/ytdl_sub/utils/logger.py\\n@@ -91,11 +91,9 @@ class Logger:\\n     # Ignore 'using with' warning since this will be cleaned up later\\n     # pylint: disable=R1732\\n     _DEBUG_LOGGER_FILE = tempfile.NamedTemporaryFile(prefix=\\\"ytdl-sub.\\\", delete=False)\\n+    _ERROR_LOG_FILE = tempfile.NamedTemporaryFile(prefix=\\\"ytdl-sub.errors\\\", delete=False)\\n     # pylint: enable=R1732\\n \\n-    # Whether the final exception lines were added to the debug log\\n-    _LOGGED_EXIT_EXCEPTION: bool = False\\n-\\n     # Keep track of all Loggers created\\n     _LOGGERS: List[logging.Logger] = []\\n \\n@@ -108,6 +106,10 @@ def debug_log_filename(cls) -> str:\\n         \\\"\\\"\\\"\\n         return cls._DEBUG_LOGGER_FILE.name\\n \\n+    @classmethod\\n+    def error_log_filename(cls) -> str:\\n+        return cls._ERROR_LOG_FILE.name\\n+\\n     @classmethod\\n     def set_log_level(cls, log_level_name: str):\\n         \\\"\\\"\\\"\\n@@ -204,7 +206,7 @@ def handle_external_logs(cls, name: Optional[str] = None) -> None:\\n                 redirect_stream.flush()\\n \\n     @classmethod\\n-    def log_exit_exception(cls, exception: Exception, log_filepath: Optional[Path] = None):\\n+    def log_exception(cls, exception: Exception, log_filepath: Optional[Path] = None):\\n         \\\"\\\"\\\"\\n         Performs the final log before exiting from an error\\n \\n@@ -215,34 +217,37 @@ def log_exit_exception(cls, exception: Exception, log_filepath: Optional[Path] =\\n         log_filepath\\n             Optional. The filepath to the debug logs\\n         \\\"\\\"\\\"\\n-        if not cls._LOGGED_EXIT_EXCEPTION:\\n-            logger = cls.get()\\n-\\n-            # Log validation exceptions as-is\\n-            if isinstance(exception, ValidationException):\\n-                logger.error(str(exception))\\n-            # Log permission errors explicitly\\n-            elif isinstance(exception, PermissionError):\\n-                logger.error(\\n-                    \\\"A permission error occurred:\\\\n%s\\\\n\\\"\\n-                    \\\"The user running ytdl-sub must have permission to this file/directory.\\\",\\n-                    str(exception),\\n-                )\\n-            # For other uncaught errors, log as bug:\\n-            else:\\n-                logger.exception(\\\"An uncaught error occurred:\\\")\\n-                logger.error(\\n-                    \\\"Version %s\\\\nPlease upload the error log file '%s' and make a Github \\\"\\n-                    \\\"issue at https://github.com/jmbannon/ytdl-sub/issues with your config and \\\"\\n-                    \\\"command/subscription yaml file to reproduce. Thanks for trying ytdl-sub!\\\",\\n-                    __local_version__,\\n-                    log_filepath if log_filepath else Logger.debug_log_filename(),\\n-                )\\n-\\n-            cls._LOGGED_EXIT_EXCEPTION = True\\n+        logger = cls.get()\\n+\\n+        # Log validation exceptions as-is\\n+        if isinstance(exception, ValidationException):\\n+            logger.error(str(exception))\\n+        # Log permission errors explicitly\\n+        elif isinstance(exception, PermissionError):\\n+            logger.error(\\n+                \\\"A permission error occurred:\\\\n%s\\\\n\\\"\\n+                \\\"The user running ytdl-sub must have permission to this file/directory.\\\",\\n+                str(exception),\\n+            )\\n+        # For other uncaught errors, log as bug:\\n+        else:\\n+            logger.exception(\\\"An uncaught error occurred:\\\")\\n+            logger.error(\\n+                \\\"Version %s\\\\nPlease upload the error log file '%s' and make a Github \\\"\\n+                \\\"issue at https://github.com/jmbannon/ytdl-sub/issues with your config and \\\"\\n+                \\\"command/subscription yaml file to reproduce. Thanks for trying ytdl-sub!\\\",\\n+                __local_version__,\\n+                log_filepath if log_filepath else Logger.error_log_filename(),\\n+            )\\n+\\n+        # Any time an exception occurs, dump all debug logs into the error log\\n+        with open(cls.debug_log_filename(), mode=\\\"r\\\", encoding=\\\"utf-8\\\") as debug_logs, open(\\n+            cls.error_log_filename(), mode=\\\"a\\\", encoding=\\\"utf-8\\\"\\n+        ) as error_logs:\\n+            error_logs.writelines(debug_logs.readlines())\\n \\n     @classmethod\\n-    def cleanup(cls):\\n+    def cleanup(cls, cleanup_error_log: bool = False):\\n         \\\"\\\"\\\"\\n         Cleans up debug log file left behind\\n         \\\"\\\"\\\"\\n@@ -251,6 +256,8 @@ def cleanup(cls):\\n                 handler.close()\\n \\n         cls._DEBUG_LOGGER_FILE.close()\\n-\\n         FileHandler.delete(cls.debug_log_filename())\\n-        cls._LOGGED_EXIT_EXCEPTION = False\\n+\\n+        if cleanup_error_log:\\n+            cls._ERROR_LOG_FILE.close()\\n+            FileHandler.delete(cls.error_log_filename())\\n\",\"diff --git a/src/ytdl_sub/cli/output_summary.py b/src/ytdl_sub/cli/output_summary.py\\nindex ea133bbb8..0deb422f2 100644\\n--- a/src/ytdl_sub/cli/output_summary.py\\n+++ b/src/ytdl_sub/cli/output_summary.py\\n@@ -51,36 +51,18 @@ def output_summary(subscriptions: List[Subscription]) -> None:\\n     # Initialize totals to 0\\n     total_subs: int = len(subscriptions)\\n     total_subs_str = f\\\"Total: {total_subs}\\\"\\n-    total_added: int = 0\\n-    total_modified: int = 0\\n-    total_removed: int = 0\\n-    total_entries: int = 0\\n-    total_errors: int = 0\\n+    total_added: int = sum(sub.num_entries_added for sub in subscriptions)\\n+    total_modified: int = sum(sub.num_entries_modified for sub in subscriptions)\\n+    total_removed: int = sum(sub.num_entries_removed for sub in subscriptions)\\n+    total_entries: int = sum(sub.num_entries for sub in subscriptions)\\n+    total_errors: int = sum(sub.exception is not None for sub in subscriptions)\\n \\n     # Initialize widths to 0\\n-    width_sub_name: int = len(total_subs_str)\\n-    width_num_entries_added: int = 0\\n-    width_num_entries_modified: int = 0\\n-    width_num_entries_removed: int = 0\\n-    width_num_entries: int = 0\\n-\\n-    # Calculate min width needed\\n-    for subscription in subscriptions:\\n-        width_sub_name = max(width_sub_name, len(subscription.name))\\n-        width_num_entries_added = max(\\n-            width_num_entries_added, len(_color_int(subscription.num_entries_added))\\n-        )\\n-        width_num_entries_modified = max(\\n-            width_num_entries_modified, len(_color_int(subscription.num_entries_modified))\\n-        )\\n-        width_num_entries_removed = max(\\n-            width_num_entries_removed, len(_color_int(subscription.num_entries_removed * -1))\\n-        )\\n-        width_num_entries = max(width_num_entries, len(str(subscription.num_entries)))\\n-\\n-    # Add spacing for aesthetics\\n-    width_sub_name += 4\\n-    width_num_entries += 4\\n+    width_sub_name: int = max(len(sub.name) for sub in subscriptions) + 4  # aesthetics\\n+    width_num_entries_added: int = len(_color_int(total_added))\\n+    width_num_entries_modified: int = len(_color_int(total_modified))\\n+    width_num_entries_removed: int = len(_color_int(total_removed))\\n+    width_num_entries: int = len(str(total_entries)) + 4  # aesthetics\\n \\n     # Build the summary\\n     for subscription in subscriptions:\\n@@ -88,7 +70,11 @@ def output_summary(subscriptions: List[Subscription]) -> None:\\n         num_entries_modified = _color_int(subscription.num_entries_modified)\\n         num_entries_removed = _color_int(subscription.num_entries_removed * -1)\\n         num_entries = str(subscription.num_entries)\\n-        status = _red(\\\"error\\\") if subscription.exception else _green(\\\"success\\\")\\n+        status = (\\n+            _red(subscription.exception.__class__.__name__)\\n+            if subscription.exception\\n+            else _green(\\\"âœ”\\\")\\n+        )\\n \\n         summary.append(\\n             f\\\"{subscription.name:<{width_sub_name}} \\\"\\n@@ -99,17 +85,8 @@ def output_summary(subscriptions: List[Subscription]) -> None:\\n             f\\\"{status}\\\"\\n         )\\n \\n-        # Add total\\n-        total_added += subscription.num_entries_added\\n-        total_modified += subscription.num_entries_modified\\n-        total_removed -= subscription.num_entries_removed\\n-        total_entries += subscription.num_entries\\n-        total_errors += int(subscription.exception is not None)\\n-\\n     total_errors_str = (\\n-        _green(\\\"success!\\\")\\n-        if total_errors == 0\\n-        else _red(f\\\"{total_errors} error{'s' if total_errors > 1 else ''}\\\")\\n+        _green(\\\"Success\\\") if total_errors == 0 else _red(f\\\"Error{'s' if total_errors > 1 else ''}\\\")\\n     )\\n \\n     summary.append(\\n@@ -117,7 +94,7 @@ def output_summary(subscriptions: List[Subscription]) -> None:\\n         f\\\"{_color_int(total_added):>{width_num_entries_added}} \\\"\\n         f\\\"{_color_int(total_modified):>{width_num_entries_modified}} \\\"\\n         f\\\"{_color_int(total_removed):>{width_num_entries_removed}} \\\"\\n-        f\\\"{str(total_entries):>{width_num_entries}} \\\"\\n+        f\\\"{total_entries:>{width_num_entries}} \\\"\\n         f\\\"{total_errors_str}\\\"\\n     )\\n \\n\",\"diff --git a/src/ytdl_sub/cli/output_summary.py b/src/ytdl_sub/cli/output_summary.py\\nindex 0deb422f2..d57510a7a 100644\\n--- a/src/ytdl_sub/cli/output_summary.py\\n+++ b/src/ytdl_sub/cli/output_summary.py\\n@@ -46,6 +46,10 @@ def output_summary(subscriptions: List[Subscription]) -> None:\\n     -------\\n     Output summary to print\\n     \\\"\\\"\\\"\\n+    if len(subscriptions) == 0:\\n+        logger.info(\\\"No subscriptions ran\\\")\\n+        return\\n+\\n     summary: List[str] = []\\n \\n     # Initialize totals to 0\\n\",\"diff --git a/src/ytdl_sub/cli/output_summary.py b/src/ytdl_sub/cli/output_summary.py\\nindex d57510a7a..61cf2317f 100644\\n--- a/src/ytdl_sub/cli/output_summary.py\\n+++ b/src/ytdl_sub/cli/output_summary.py\\n@@ -46,6 +46,8 @@ def output_summary(subscriptions: List[Subscription]) -> None:\\n     -------\\n     Output summary to print\\n     \\\"\\\"\\\"\\n+    # many locals for proper output printing\\n+    # pylint: disable=too-many-locals\\n     if len(subscriptions) == 0:\\n         logger.info(\\\"No subscriptions ran\\\")\\n         return\\n\",\"diff --git a/src/ytdl_sub/utils/logger.py b/src/ytdl_sub/utils/logger.py\\nindex 263cd123e..0b531a32c 100644\\n--- a/src/ytdl_sub/utils/logger.py\\n+++ b/src/ytdl_sub/utils/logger.py\\n@@ -108,6 +108,11 @@ def debug_log_filename(cls) -> str:\\n \\n     @classmethod\\n     def error_log_filename(cls) -> str:\\n+        \\\"\\\"\\\"\\n+        Returns\\n+        -------\\n+        File name of the error log file\\n+        \\\"\\\"\\\"\\n         return cls._ERROR_LOG_FILE.name\\n \\n     @classmethod\\n@@ -208,7 +213,10 @@ def handle_external_logs(cls, name: Optional[str] = None) -> None:\\n     @classmethod\\n     def log_exception(cls, exception: Exception, log_filepath: Optional[Path] = None):\\n         \\\"\\\"\\\"\\n-        Performs the final log before exiting from an error\\n+        Logs an exception based on the exception type. Will transfer all\\n+        debug logs into the error log file. This allows for subscriptions to only write to the\\n+        error log if an error occurred - successful subscriptions will clean the debug log file\\n+        w/out any write to the error log.\\n \\n         Parameters\\n         ----------\\n\",\"diff --git a/src/ytdl_sub/cli/entrypoint.py b/src/ytdl_sub/cli/entrypoint.py\\nindex ae89cf161..442d04c34 100644\\n--- a/src/ytdl_sub/cli/entrypoint.py\\n+++ b/src/ytdl_sub/cli/entrypoint.py\\n@@ -29,6 +29,10 @@\\n _VIEW_EXTRA_ARGS_FORMATTER = \\\"--preset _view --overrides.url {}\\\"\\n \\n \\n+def _log_time() -> str:\\n+    return datetime.now().strftime(\\\"%Y-%m-%d-%H%M%S\\\")\\n+\\n+\\n def _maybe_write_subscription_log_file(\\n     config: ConfigFile,\\n     subscription: Subscription,\\n@@ -49,11 +53,10 @@ def _maybe_write_subscription_log_file(\\n     if success and not config.config_options.persist_logs.keep_successful_logs:\\n         return\\n \\n-    log_time = datetime.now().strftime(\\\"%Y-%m-%d-%H%M%S\\\")\\n     log_subscription_name = sanitize_filename(subscription.name).lower().replace(\\\" \\\", \\\"_\\\")\\n     log_success = \\\"success\\\" if success else \\\"error\\\"\\n \\n-    log_filename = f\\\"{log_time}.{log_subscription_name}.{log_success}.log\\\"\\n+    log_filename = f\\\"{_log_time()}.{log_subscription_name}.{log_success}.log\\\"\\n     persist_log_path = Path(config.config_options.persist_logs.logs_directory) / log_filename\\n \\n     if not success:\\n\",\"diff --git a/src/ytdl_sub/main.py b/src/ytdl_sub/main.py\\nindex 9b7dbff39..b4e7e7768 100644\\n--- a/src/ytdl_sub/main.py\\n+++ b/src/ytdl_sub/main.py\\n@@ -4,7 +4,7 @@\\n from ytdl_sub.utils.logger import Logger\\n \\n \\n-def _main():\\n+def _main() -> int:\\n     # Set log level before any other ytdl-sub files are imported. That way, when loggers\\n     # get initialized, they will see the set log level\\n     args, _ = parser.parse_known_args()\\n@@ -15,7 +15,10 @@ def _main():\\n \\n     # pylint: enable=import-outside-toplevel\\n \\n-    ytdl_sub.cli.entrypoint.main()\\n+    subs = ytdl_sub.cli.entrypoint.main()\\n+    if any(sub.exception for sub in subs):\\n+        return 1  # Return error-code if any exceptions occurred\\n+    return 0\\n \\n \\n def main():\\n@@ -23,14 +26,13 @@ def main():\\n     Entrypoint for ytdl-sub\\n     \\\"\\\"\\\"\\n     try:\\n-        _main()\\n-        Logger.cleanup(cleanup_error_log=True)  # Ran successfully, so we can delete the debug file\\n+        return_code = _main()\\n+        Logger.cleanup(cleanup_error_log=return_code == 0)\\n+        sys.exit(return_code)\\n     except Exception as exc:  # pylint: disable=broad-except\\n         Logger.log_exception(exception=exc)\\n         sys.exit(1)\\n \\n-    sys.exit(0)\\n-\\n \\n if __name__ == \\\"__main__\\\":\\n     main()\\n\"]", "test_patch": "[\"diff --git a/tests/unit/cli/test_entrypoint.py b/tests/unit/cli/test_entrypoint.py\\nindex bc6cdb681..08ae5b87a 100644\\n--- a/tests/unit/cli/test_entrypoint.py\\n+++ b/tests/unit/cli/test_entrypoint.py\\n@@ -260,15 +260,15 @@ def test_transaction_log_to_logger(\\n \\n \\n def test_output_summary():\\n-    subscription_values: List[Tuple[str, int, int, int, int]] = [\\n-        (\\\"long_name_but_lil_values\\\", 0, 0, 0, 6),\\n-        (\\\"john_smith\\\", 1, 0, 0, 52),\\n-        (\\\"david_gore\\\", 0, 0, 0, 4),\\n-        (\\\"christopher_snoop\\\", 50, 0, 3, 518),\\n-        (\\\"beyond funk\\\", 0, 0, 0, 176),\\n+    subscription_values: List[Tuple[str, int, int, int, int, bool]] = [\\n+        (\\\"long_name_but_lil_values\\\", 0, 0, 0, 6, False),\\n+        (\\\"john_smith\\\", 1, 0, 0, 52, False),\\n+        (\\\"david_gore\\\", 0, 0, 0, 4, False),\\n+        (\\\"christopher_snoop\\\", 50, 0, 3, 518, False),\\n+        (\\\"beyond funk\\\", 0, 0, 0, 176, True),\\n     ]\\n \\n-    mock_subscriptions: List[Tuple[MagicMock, FileHandlerTransactionLog]] = []\\n+    mock_subscriptions: List[MagicMock] = []\\n     for values in subscription_values:\\n         sub = Mock()\\n         sub.name = values[0]\\n@@ -276,10 +276,11 @@ def test_output_summary():\\n         sub.num_entries_modified = values[2]\\n         sub.num_entries_removed = values[3]\\n         sub.num_entries = values[4]\\n+        sub.exception = values[5]\\n \\n-        mock_subscriptions.append((sub, FileHandlerTransactionLog()))\\n+        mock_subscriptions.append(sub)\\n \\n-    _ = output_summary(transaction_logs=mock_subscriptions)\\n+    _ = output_summary(subscriptions=mock_subscriptions)\\n     assert True  # Test used for manual inspection - too hard to test ansi color codes\\n \\n \\n\",\"diff --git a/tests/unit/cli/test_entrypoint.py b/tests/unit/cli/test_entrypoint.py\\nindex 08ae5b87a..707eea10c 100644\\n--- a/tests/unit/cli/test_entrypoint.py\\n+++ b/tests/unit/cli/test_entrypoint.py\\n@@ -260,11 +260,11 @@ def test_transaction_log_to_logger(\\n \\n \\n def test_output_summary():\\n-    subscription_values: List[Tuple[str, int, int, int, int, bool]] = [\\n-        (\\\"long_name_but_lil_values\\\", 0, 0, 0, 6, False),\\n-        (\\\"john_smith\\\", 1, 0, 0, 52, False),\\n-        (\\\"david_gore\\\", 0, 0, 0, 4, False),\\n-        (\\\"christopher_snoop\\\", 50, 0, 3, 518, False),\\n+    subscription_values: List[Tuple[str, int, int, int, int, Optional[bool]]] = [\\n+        (\\\"long_name_but_lil_values\\\", 0, 0, 0, 6, None),\\n+        (\\\"john_smith\\\", 1, 0, 0, 52, None),\\n+        (\\\"david_gore\\\", 0, 0, 0, 4, None),\\n+        (\\\"christopher_snoop\\\", 50, 0, 3, 518, None),\\n         (\\\"beyond funk\\\", 0, 0, 0, 176, True),\\n     ]\\n \\n\",\"diff --git a/tests/unit/cli/test_entrypoint.py b/tests/unit/cli/test_entrypoint.py\\nindex 707eea10c..8a298f3bf 100644\\n--- a/tests/unit/cli/test_entrypoint.py\\n+++ b/tests/unit/cli/test_entrypoint.py\\n@@ -142,17 +142,17 @@ def test_subscription_logs_write_to_file(\\n     if dry_run or (mock_success_output and not keep_successful_logs):\\n         assert len(log_directory_files) == 0\\n         return\\n-    # If not success, expect 1 log file\\n+    # If not success, expect 2 log files for both sub errors\\n     elif not mock_success_output:\\n-        assert len(log_directory_files) == 1\\n-        log_path = log_directory_files[0]\\n-        assert bool(re.match(r\\\"\\\\d{4}-\\\\d{2}-\\\\d{2}-\\\\d{6}\\\\.john_smith\\\\.error\\\\.log\\\", log_path.name))\\n-        with open(log_path, \\\"r\\\", encoding=\\\"utf-8\\\") as log_file:\\n-            assert log_file.readlines()[-1] == (\\n-                f\\\"Please upload the error log file '{str(log_path)}' and make a Github issue \\\"\\n-                f\\\"at https://github.com/jmbannon/ytdl-sub/issues with your config and \\\"\\n-                f\\\"command/subscription yaml file to reproduce. Thanks for trying ytdl-sub!\\\\n\\\"\\n-            )\\n+        assert len(log_directory_files) == 2\\n+        for log_path in log_directory_files:\\n+            assert bool(re.match(r\\\"\\\\d{4}-\\\\d{2}-\\\\d{2}-\\\\d{6}\\\\.john_smith\\\\.error\\\\.log\\\", log_path.name))\\n+            with open(log_path, \\\"r\\\", encoding=\\\"utf-8\\\") as log_file:\\n+                assert log_file.readlines()[-1] == (\\n+                    f\\\"Please upload the error log file '{str(log_path)}' and make a Github issue \\\"\\n+                    f\\\"at https://github.com/jmbannon/ytdl-sub/issues with your config and \\\"\\n+                    f\\\"command/subscription yaml file to reproduce. Thanks for trying ytdl-sub!\\\\n\\\"\\n+                )\\n     # If success and success logging, expect 3 log files\\n     else:\\n         assert len(log_directory_files) == num_subscriptions\\n\",\"diff --git a/tests/unit/cli/test_entrypoint.py b/tests/unit/cli/test_entrypoint.py\\nindex 8a298f3bf..b242d0698 100644\\n--- a/tests/unit/cli/test_entrypoint.py\\n+++ b/tests/unit/cli/test_entrypoint.py\\n@@ -43,13 +43,16 @@ def _mock_download(self: Subscription, dry_run: bool) -> FileHandlerTransactionL\\n             time.sleep(1)\\n             if not mock_success_output:\\n                 raise ValueError(\\\"error\\\")\\n-            return (\\n-                FileHandlerTransactionLog()\\n+\\n+            (\\n+                self._enhanced_download_archive.get_file_handler_transaction_log()\\n                 .log_created_file(\\\"created_file.txt\\\", FileMetadata())\\n                 .log_modified_file(\\\"modified_file.txt\\\", FileMetadata())\\n                 .log_removed_file(\\\"deleted_file.txt\\\")\\n             )\\n \\n+            return self._enhanced_download_archive.get_file_handler_transaction_log()\\n+\\n         return _mock_download\\n \\n     return _mock_subscription_download_factory\\n@@ -228,8 +231,8 @@ def test_transaction_log_to_file(\\n             str(transaction_log_file_path),\\n         ],\\n     ):\\n-        transaction_logs = main()\\n-        assert transaction_logs\\n+        subscriptions = main()\\n+        assert subscriptions\\n \\n     with open(transaction_log_file_path, \\\"r\\\", encoding=\\\"utf-8\\\") as transaction_log_file:\\n         assert transaction_log_file.readlines()[0] == \\\"Transaction log for john_smith:\\\\n\\\"\\n\",\"diff --git a/tests/e2e/conftest.py b/tests/e2e/conftest.py\\nindex 8cb6b9cdf..b2a883f70 100644\\n--- a/tests/e2e/conftest.py\\n+++ b/tests/e2e/conftest.py\\n@@ -2,7 +2,6 @@\\n import sys\\n import tempfile\\n from typing import List\\n-from typing import Tuple\\n from unittest.mock import patch\\n \\n import pytest\\n@@ -10,7 +9,6 @@\\n from ytdl_sub.cli.entrypoint import main\\n from ytdl_sub.subscriptions.subscription import Subscription\\n from ytdl_sub.utils.file_handler import FileHandler\\n-from ytdl_sub.utils.file_handler import FileHandlerTransactionLog\\n \\n \\n @pytest.fixture()\\n@@ -46,7 +44,7 @@ def timestamps_file_path():\\n         FileHandler.delete(tmp.name)\\n \\n \\n-def mock_run_from_cli(args: str) -> List[Tuple[Subscription, FileHandlerTransactionLog]]:\\n+def mock_run_from_cli(args: str) -> List[Subscription]:\\n     args_list = [\\\"ytdl-sub\\\"] + args.split()\\n     with patch.object(sys, \\\"argv\\\", args_list):\\n         return main()\\n\",\"diff --git a/tests/e2e/plugins/internal/test_view.py b/tests/e2e/plugins/internal/test_view.py\\nindex e3838e6f0..dbfcd13b8 100644\\n--- a/tests/e2e/plugins/internal/test_view.py\\n+++ b/tests/e2e/plugins/internal/test_view.py\\n@@ -17,10 +17,10 @@ def test_view_from_cli(\\n         args = f\\\"view \\\"\\n         args += \\\"--split-chapters \\\" if split_chapters else \\\"\\\"\\n         args += f\\\"https://www.youtube.com/playlist?list=PLBsm_SagFMmdWnCnrNtLjA9kzfrRkto4i\\\"\\n-        subscription_transaction_log = mock_run_from_cli(args=args)\\n+        subscriptions = mock_run_from_cli(args=args)\\n \\n-        assert len(subscription_transaction_log) == 1\\n-        transaction_log = subscription_transaction_log[0][1]\\n+        assert len(subscriptions) == 1\\n+        transaction_log = subscriptions[0].transaction_log\\n \\n         # Ensure the video and thumbnail are recognized\\n         assert len(transaction_log.files_created) == 2\\n\",\"diff --git a/tests/e2e/youtube/test_playlist.py b/tests/e2e/youtube/test_playlist.py\\nindex 4ec810f96..fa9df4c48 100644\\n--- a/tests/e2e/youtube/test_playlist.py\\n+++ b/tests/e2e/youtube/test_playlist.py\\n@@ -163,10 +163,10 @@ def test_playlist_download_from_cli_sub_no_provided_config(\\n         ) as subscription_path:\\n             args = \\\"--dry-run \\\" if dry_run else \\\"\\\"\\n             args += f\\\"sub {subscription_path}\\\"\\n-            subscription_transaction_log = mock_run_from_cli(args=args)\\n+            subscriptions = mock_run_from_cli(args=args)\\n \\n-            assert len(subscription_transaction_log) == 1\\n-            transaction_log = subscription_transaction_log[0][1]\\n+            assert len(subscriptions) == 1\\n+            transaction_log = subscriptions[0].transaction_log\\n \\n             assert_transaction_log_matches(\\n                 output_directory=output_directory,\\n@@ -186,7 +186,7 @@ def test_playlist_download_from_cli_sub_no_provided_config(\\n                     expected_message=\\\"ExistingVideoReached, stopping additional downloads\\\",\\n                     log_level=\\\"debug\\\",\\n                 ):\\n-                    transaction_log = mock_run_from_cli(args=args)[0][1]\\n+                    transaction_log = mock_run_from_cli(args=args)[0].transaction_log\\n \\n                 assert transaction_log.is_empty\\n                 assert_expected_downloads(\\n\",\"diff --git a/tests/e2e/youtube/test_video.py b/tests/e2e/youtube/test_video.py\\nindex f9fd9e330..8dd295839 100644\\n--- a/tests/e2e/youtube/test_video.py\\n+++ b/tests/e2e/youtube/test_video.py\\n@@ -187,14 +187,12 @@ def test_single_video_download_from_cli_dl(\\n         args = \\\"--dry-run \\\" if dry_run else \\\"\\\"\\n         args += f\\\"--config {music_video_config_path} \\\"\\n         args += f\\\"dl {single_video_preset_dict_dl_args}\\\"\\n-        subscription_transaction_log = mock_run_from_cli(args=args)\\n-\\n-        assert len(subscription_transaction_log) == 1\\n-        transaction_log = subscription_transaction_log[0][1]\\n+        subscriptions = mock_run_from_cli(args=args)\\n \\n+        assert len(subscriptions) == 1\\n         assert_transaction_log_matches(\\n             output_directory=output_directory,\\n-            transaction_log=transaction_log,\\n+            transaction_log=subscriptions[0].transaction_log,\\n             transaction_log_summary_file_name=\\\"youtube/test_video_cli.txt\\\",\\n         )\\n         assert_expected_downloads(\\n\",\"diff --git a/tests/unit/cli/test_entrypoint.py b/tests/unit/cli/test_entrypoint.py\\nindex b242d0698..9a11b6445 100644\\n--- a/tests/unit/cli/test_entrypoint.py\\n+++ b/tests/unit/cli/test_entrypoint.py\\n@@ -263,12 +263,12 @@ def test_transaction_log_to_logger(\\n \\n \\n def test_output_summary():\\n-    subscription_values: List[Tuple[str, int, int, int, int, Optional[bool]]] = [\\n+    subscription_values: List[Tuple[str, int, int, int, int, Optional[Exception]]] = [\\n         (\\\"long_name_but_lil_values\\\", 0, 0, 0, 6, None),\\n         (\\\"john_smith\\\", 1, 0, 0, 52, None),\\n         (\\\"david_gore\\\", 0, 0, 0, 4, None),\\n         (\\\"christopher_snoop\\\", 50, 0, 3, 518, None),\\n-        (\\\"beyond funk\\\", 0, 0, 0, 176, True),\\n+        (\\\"beyond funk\\\", 0, 0, 0, 176, ValueError(\\\"lol\\\")),\\n     ]\\n \\n     mock_subscriptions: List[MagicMock] = []\\n\",\"diff --git a/tests/unit/main/test_main.py b/tests/unit/main/test_main.py\\nindex cea929014..a2148aa61 100644\\n--- a/tests/unit/main/test_main.py\\n+++ b/tests/unit/main/test_main.py\\n@@ -70,7 +70,7 @@ def test_main_uncaught_error(capsys, mock_sys_exit, expected_uncaught_error_mess\\n     assert mock_error.call_count == 1\\n     assert mock_error.call_args.args[0] == expected_uncaught_error_message\\n     assert mock_error.call_args.args[1] == __local_version__\\n-    assert mock_error.call_args.args[2] == Logger.debug_log_filename()\\n+    assert mock_error.call_args.args[2] == Logger.error_log_filename()\\n \\n \\n def test_main_permission_error(capsys, mock_sys_exit, expected_uncaught_error_message):\\n\",\"diff --git a/tests/unit/utils/test_logger.py b/tests/unit/utils/test_logger.py\\nindex 64415a60f..a66411b22 100644\\n--- a/tests/unit/utils/test_logger.py\\n+++ b/tests/unit/utils/test_logger.py\\n@@ -111,11 +111,12 @@ def test_logger_always_outputs_to_debug_file(self, log_level):\\n         Logger.cleanup()\\n         assert not os.path.isfile(Logger._DEBUG_LOGGER_FILE.name)\\n \\n-    def test_logger_can_be_cleaned_during_execution(self):\\n+    @pytest.mark.parametrize(\\\"clean_error_log\\\", [True, False])\\n+    def test_logger_can_be_cleaned_during_execution(self, clean_error_log: bool):\\n         Logger._LOGGER_LEVEL = LoggerLevels.INFO\\n         logger = Logger.get(name=\\\"name_test\\\")\\n \\n-        for _ in range(2):\\n+        for iteration in range(2):\\n             logger.info(\\\"info test\\\")\\n             logger.debug(\\\"debug test\\\")\\n \\n@@ -127,8 +128,32 @@ def test_logger_can_be_cleaned_during_execution(self):\\n                 \\\"[ytdl-sub:name_test] debug test\\\\n\\\",\\n             ]\\n \\n-            Logger.cleanup()\\n-            assert not os.path.isfile(Logger._DEBUG_LOGGER_FILE.name)\\n+            try:\\n+                raise ValueError(\\\"some error\\\")\\n+            except ValueError as exc:\\n+                Logger.log_exception(exception=exc)\\n+\\n+            Logger.cleanup(cleanup_error_log=clean_error_log)\\n+            assert not os.path.isfile(Logger.debug_log_filename())\\n+\\n+            assert clean_error_log == (not os.path.isfile(Logger.error_log_filename()))\\n+            if not clean_error_log:\\n+                with open(Logger.error_log_filename(), mode=\\\"r\\\", encoding=\\\"utf-8\\\") as err_file:\\n+                    err_logs = err_file.readlines()\\n+                    expected = [\\n+                        \\\"[ytdl-sub:name_test] info test\\\\n\\\",\\n+                        \\\"[ytdl-sub:name_test] debug test\\\\n\\\",\\n+                        \\\"[ytdl-sub] An uncaught error occurred:\\\\n\\\",\\n+                        \\\"Traceback (most recent call last):\\\\n\\\",\\n+                        '  File \\\"/home/j/workspace/ytdl-sub/tests/unit/utils/test_logger.py\\\", line 132, in test_logger_can_be_cleaned_during_execution\\\\n',\\n+                        '    raise ValueError(\\\"some error\\\")\\\\n',\\n+                        \\\"ValueError: some error\\\\n\\\",\\n+                        \\\"[ytdl-sub] Version 2023.03.24+14e4a4b\\\\n\\\",\\n+                        f\\\"Please upload the error log file '{Logger.error_log_filename()}' and make a Github issue at https://github.com/jmbannon/ytdl-sub/issues with your config and command/subscription yaml file to reproduce. Thanks for trying ytdl-sub!\\\\n\\\",\\n+                    ]\\n+                    if iteration == 1:\\n+                        expected.extend(expected)  # Two errors occurred, error log should contain 2\\n+                    assert err_logs == expected\\n \\n     @pytest.mark.parametrize(\\n         \\\"log_level, expected_stdout\\\",\\n\",\"diff --git a/tests/unit/cli/conftest.py b/tests/unit/cli/conftest.py\\nnew file mode 100644\\nindex 000000000..09a27d8c8\\n--- /dev/null\\n+++ b/tests/unit/cli/conftest.py\\n@@ -0,0 +1,87 @@\\n+import datetime\\n+import os\\n+import shutil\\n+import tempfile\\n+import time\\n+from typing import Callable\\n+from unittest.mock import patch\\n+\\n+import mergedeep\\n+import pytest\\n+\\n+from ytdl_sub.config.config_file import ConfigFile\\n+from ytdl_sub.subscriptions.subscription import Subscription\\n+from ytdl_sub.utils.file_handler import FileHandlerTransactionLog\\n+from ytdl_sub.utils.file_handler import FileMetadata\\n+from ytdl_sub.utils.logger import Logger\\n+\\n+\\n+@pytest.fixture\\n+def mock_subscription_download_factory():\\n+    def _mock_subscription_download_factory(mock_success_output: bool) -> Callable:\\n+        def _mock_download(self: Subscription, dry_run: bool) -> FileHandlerTransactionLog:\\n+            Logger.get().info(\\n+                \\\"name=%s success=%s dry_run=%s\\\", self.name, mock_success_output, dry_run\\n+            )\\n+\\n+            if not mock_success_output:\\n+                raise ValueError(\\\"error\\\")\\n+\\n+            (\\n+                self._enhanced_download_archive.get_file_handler_transaction_log()\\n+                .log_created_file(\\\"created_file.txt\\\", FileMetadata())\\n+                .log_modified_file(\\\"modified_file.txt\\\", FileMetadata())\\n+                .log_removed_file(\\\"deleted_file.txt\\\")\\n+            )\\n+\\n+            return self._enhanced_download_archive.get_file_handler_transaction_log()\\n+\\n+        return _mock_download\\n+\\n+    return _mock_subscription_download_factory\\n+\\n+\\n+@pytest.fixture\\n+def mock_subscription_download_success(mock_subscription_download_factory: Callable):\\n+    with patch.object(\\n+        Subscription,\\n+        \\\"download\\\",\\n+        new=mock_subscription_download_factory(mock_success_output=True),\\n+    ):\\n+        yield\\n+\\n+\\n+@pytest.fixture\\n+def persist_logs_directory() -> str:\\n+    # Delete the temp_dir on creation\\n+    with tempfile.TemporaryDirectory() as temp_dir:\\n+        pass\\n+\\n+    yield temp_dir\\n+\\n+    if os.path.isdir(temp_dir):\\n+        shutil.rmtree(temp_dir)\\n+\\n+\\n+@pytest.fixture\\n+def persist_logs_config_factory(\\n+    music_video_config: ConfigFile, persist_logs_directory: str\\n+) -> Callable:\\n+    def _persist_logs_config_factory(keep_successful_logs: bool) -> ConfigFile:\\n+        return ConfigFile.from_dict(\\n+            dict(\\n+                mergedeep.merge(\\n+                    music_video_config.as_dict(),\\n+                    {\\n+                        \\\"configuration\\\": {\\n+                            \\\"persist_logs\\\": {\\n+                                \\\"logs_directory\\\": persist_logs_directory,\\n+                                \\\"keep_successful_logs\\\": keep_successful_logs,\\n+                            },\\n+                        }\\n+                    },\\n+                )\\n+            )\\n+        )\\n+\\n+    return _persist_logs_config_factory\\n\",\"diff --git a/tests/unit/cli/test_entrypoint.py b/tests/unit/cli/test_entrypoint.py\\nindex 9a11b6445..13fb95694 100644\\n--- a/tests/unit/cli/test_entrypoint.py\\n+++ b/tests/unit/cli/test_entrypoint.py\\n@@ -1,113 +1,24 @@\\n-import os.path\\n import re\\n-import shutil\\n import sys\\n-import tempfile\\n-import time\\n from pathlib import Path\\n from typing import Callable\\n-from typing import List\\n-from typing import Optional\\n-from typing import Tuple\\n-from unittest.mock import MagicMock\\n-from unittest.mock import Mock\\n from unittest.mock import patch\\n \\n-import mergedeep\\n import pytest\\n-from conftest import assert_logs\\n \\n from ytdl_sub.cli.entrypoint import _download_subscriptions_from_yaml_files\\n from ytdl_sub.cli.entrypoint import main\\n-from ytdl_sub.cli.output_summary import output_summary\\n-from ytdl_sub.cli.output_transaction_log import logger as transaction_logger\\n-from ytdl_sub.config.config_file import ConfigFile\\n from ytdl_sub.subscriptions.subscription import Subscription\\n from ytdl_sub.utils.exceptions import ExperimentalFeatureNotEnabled\\n-from ytdl_sub.utils.file_handler import FileHandler\\n-from ytdl_sub.utils.file_handler import FileHandlerTransactionLog\\n-from ytdl_sub.utils.file_handler import FileMetadata\\n-from ytdl_sub.utils.logger import Logger\\n \\n ####################################################################################################\\n # SHARED FIXTURES\\n \\n \\n-@pytest.fixture\\n-def mock_subscription_download_factory():\\n-    def _mock_subscription_download_factory(mock_success_output: bool) -> Callable:\\n-        def _mock_download(self: Subscription, dry_run: bool) -> FileHandlerTransactionLog:\\n-            Logger.get().info(\\n-                \\\"name=%s success=%s dry_run=%s\\\", self.name, mock_success_output, dry_run\\n-            )\\n-            time.sleep(1)\\n-            if not mock_success_output:\\n-                raise ValueError(\\\"error\\\")\\n-\\n-            (\\n-                self._enhanced_download_archive.get_file_handler_transaction_log()\\n-                .log_created_file(\\\"created_file.txt\\\", FileMetadata())\\n-                .log_modified_file(\\\"modified_file.txt\\\", FileMetadata())\\n-                .log_removed_file(\\\"deleted_file.txt\\\")\\n-            )\\n-\\n-            return self._enhanced_download_archive.get_file_handler_transaction_log()\\n-\\n-        return _mock_download\\n-\\n-    return _mock_subscription_download_factory\\n-\\n-\\n-@pytest.fixture\\n-def mock_subscription_download_success(mock_subscription_download_factory: Callable):\\n-    with patch.object(\\n-        Subscription,\\n-        \\\"download\\\",\\n-        new=mock_subscription_download_factory(mock_success_output=True),\\n-    ):\\n-        yield\\n-\\n-\\n ####################################################################################################\\n # PERSIST LOGS FIXTURES + TESTS\\n \\n \\n-@pytest.fixture\\n-def persist_logs_directory() -> str:\\n-    # Delete the temp_dir on creation\\n-    with tempfile.TemporaryDirectory() as temp_dir:\\n-        pass\\n-\\n-    yield temp_dir\\n-\\n-    if os.path.isdir(temp_dir):\\n-        shutil.rmtree(temp_dir)\\n-\\n-\\n-@pytest.fixture\\n-def persist_logs_config_factory(\\n-    music_video_config: ConfigFile, persist_logs_directory: str\\n-) -> Callable:\\n-    def _persist_logs_config_factory(keep_successful_logs: bool) -> ConfigFile:\\n-        return ConfigFile.from_dict(\\n-            dict(\\n-                mergedeep.merge(\\n-                    music_video_config.as_dict(),\\n-                    {\\n-                        \\\"configuration\\\": {\\n-                            \\\"persist_logs\\\": {\\n-                                \\\"logs_directory\\\": persist_logs_directory,\\n-                                \\\"keep_successful_logs\\\": keep_successful_logs,\\n-                            },\\n-                        }\\n-                    },\\n-                )\\n-            )\\n-        )\\n-\\n-    return _persist_logs_config_factory\\n-\\n-\\n @pytest.mark.parametrize(\\\"dry_run\\\", [True, False])\\n @pytest.mark.parametrize(\\\"mock_success_output\\\", [True, False])\\n @pytest.mark.parametrize(\\\"keep_successful_logs\\\", [True, False])\\n@@ -128,7 +39,8 @@ def test_subscription_logs_write_to_file(\\n         Subscription,\\n         \\\"download\\\",\\n         new=mock_subscription_download_factory(mock_success_output=mock_success_output),\\n-    ):\\n+        # mock datetime to be an index to be able to run instantly\\n+    ), patch(\\\"ytdl_sub.cli.entrypoint._log_time\\\", side_effect=[str(idx) for idx in range(10)]):\\n         try:\\n             _download_subscriptions_from_yaml_files(\\n                 config=config,\\n@@ -149,7 +61,7 @@ def test_subscription_logs_write_to_file(\\n     elif not mock_success_output:\\n         assert len(log_directory_files) == 2\\n         for log_path in log_directory_files:\\n-            assert bool(re.match(r\\\"\\\\d{4}-\\\\d{2}-\\\\d{2}-\\\\d{6}\\\\.john_smith\\\\.error\\\\.log\\\", log_path.name))\\n+            assert bool(re.match(r\\\"\\\\d\\\\.john_smith\\\\.error\\\\.log\\\", log_path.name))\\n             with open(log_path, \\\"r\\\", encoding=\\\"utf-8\\\") as log_file:\\n                 assert log_file.readlines()[-1] == (\\n                     f\\\"Please upload the error log file '{str(log_path)}' and make a Github issue \\\"\\n@@ -160,9 +72,7 @@ def test_subscription_logs_write_to_file(\\n     else:\\n         assert len(log_directory_files) == num_subscriptions\\n         for log_file_path in log_directory_files:\\n-            assert bool(\\n-                re.match(r\\\"\\\\d{4}-\\\\d{2}-\\\\d{2}-\\\\d{6}\\\\.john_smith\\\\.success\\\\.log\\\", log_file_path.name)\\n-            )\\n+            assert bool(re.match(r\\\"\\\\d\\\\.john_smith\\\\.success\\\\.log\\\", log_file_path.name))\\n             with open(log_file_path, \\\"r\\\", encoding=\\\"utf-8\\\") as log_file:\\n                 assert (\\n                     log_file.readlines()[-1]\\n@@ -170,123 +80,6 @@ def test_subscription_logs_write_to_file(\\n                 )\\n \\n \\n-####################################################################################################\\n-# TRANSACTION LOGS FIXTURES + TESTS\\n-\\n-\\n-@pytest.fixture\\n-def transaction_log_file_path() -> str:\\n-    # Delete the temp_file on creation\\n-    with tempfile.NamedTemporaryFile() as temp_file:\\n-        pass\\n-\\n-    yield temp_file.name\\n-\\n-    if os.path.isfile(temp_file.name):\\n-        FileHandler.delete(temp_file.name)\\n-\\n-\\n-@pytest.mark.parametrize(\\\"file_transaction_log\\\", [None, \\\"output.log\\\"])\\n-def test_suppress_transaction_log(\\n-    mock_subscription_download_success,\\n-    music_video_config_path: Path,\\n-    music_video_subscription_path: Path,\\n-    file_transaction_log: Optional[str],\\n-) -> None:\\n-    with patch.object(\\n-        sys,\\n-        \\\"argv\\\",\\n-        [\\n-            \\\"ytdl-sub\\\",\\n-            \\\"--config\\\",\\n-            str(music_video_config_path),\\n-            \\\"sub\\\",\\n-            str(music_video_subscription_path),\\n-            \\\"--suppress-transaction-log\\\",\\n-        ]\\n-        + ([\\\"--transaction-log\\\", file_transaction_log] if file_transaction_log else []),\\n-    ), patch(\\\"ytdl_sub.cli.output_transaction_log.output_transaction_log\\\") as mock_transaction_log:\\n-        transaction_logs = main()\\n-\\n-        assert transaction_logs\\n-        assert mock_transaction_log.call_count == 0\\n-\\n-\\n-def test_transaction_log_to_file(\\n-    mock_subscription_download_success,\\n-    music_video_config_path: Path,\\n-    music_video_subscription_path: Path,\\n-    transaction_log_file_path: Path,\\n-) -> None:\\n-    with patch.object(\\n-        sys,\\n-        \\\"argv\\\",\\n-        [\\n-            \\\"ytdl-sub\\\",\\n-            \\\"--config\\\",\\n-            str(music_video_config_path),\\n-            \\\"sub\\\",\\n-            str(music_video_subscription_path),\\n-            \\\"--transaction-log\\\",\\n-            str(transaction_log_file_path),\\n-        ],\\n-    ):\\n-        subscriptions = main()\\n-        assert subscriptions\\n-\\n-    with open(transaction_log_file_path, \\\"r\\\", encoding=\\\"utf-8\\\") as transaction_log_file:\\n-        assert transaction_log_file.readlines()[0] == \\\"Transaction log for john_smith:\\\\n\\\"\\n-\\n-\\n-def test_transaction_log_to_logger(\\n-    mock_subscription_download_success,\\n-    music_video_config_path: Path,\\n-    music_video_subscription_path: Path,\\n-) -> None:\\n-    with patch.object(\\n-        sys,\\n-        \\\"argv\\\",\\n-        [\\n-            \\\"ytdl-sub\\\",\\n-            \\\"--config\\\",\\n-            str(music_video_config_path),\\n-            \\\"sub\\\",\\n-            str(music_video_subscription_path),\\n-        ],\\n-    ), assert_logs(\\n-        logger=transaction_logger,\\n-        expected_message=\\\"Transaction log for john_smith:\\\\n\\\",\\n-        log_level=\\\"info\\\",\\n-    ):\\n-        transaction_logs = main()\\n-        assert transaction_logs\\n-\\n-\\n-def test_output_summary():\\n-    subscription_values: List[Tuple[str, int, int, int, int, Optional[Exception]]] = [\\n-        (\\\"long_name_but_lil_values\\\", 0, 0, 0, 6, None),\\n-        (\\\"john_smith\\\", 1, 0, 0, 52, None),\\n-        (\\\"david_gore\\\", 0, 0, 0, 4, None),\\n-        (\\\"christopher_snoop\\\", 50, 0, 3, 518, None),\\n-        (\\\"beyond funk\\\", 0, 0, 0, 176, ValueError(\\\"lol\\\")),\\n-    ]\\n-\\n-    mock_subscriptions: List[MagicMock] = []\\n-    for values in subscription_values:\\n-        sub = Mock()\\n-        sub.name = values[0]\\n-        sub.num_entries_added = values[1]\\n-        sub.num_entries_modified = values[2]\\n-        sub.num_entries_removed = values[3]\\n-        sub.num_entries = values[4]\\n-        sub.exception = values[5]\\n-\\n-        mock_subscriptions.append(sub)\\n-\\n-    _ = output_summary(subscriptions=mock_subscriptions)\\n-    assert True  # Test used for manual inspection - too hard to test ansi color codes\\n-\\n-\\n def test_update_with_info_json_requires_experimental_flag(\\n     music_video_config_path: Path,\\n     music_video_subscription_path: Path,\\n\",\"diff --git a/tests/unit/cli/test_output_summary.py b/tests/unit/cli/test_output_summary.py\\nnew file mode 100644\\nindex 000000000..0b77a5d2f\\n--- /dev/null\\n+++ b/tests/unit/cli/test_output_summary.py\\n@@ -0,0 +1,32 @@\\n+from typing import List\\n+from typing import Optional\\n+from typing import Tuple\\n+from unittest.mock import MagicMock\\n+from unittest.mock import Mock\\n+\\n+from ytdl_sub.cli.output_summary import output_summary\\n+\\n+\\n+def test_output_summary_one_error():\\n+    subscription_values: List[Tuple[str, int, int, int, int, Optional[Exception]]] = [\\n+        (\\\"long_name_but_lil_values\\\", 0, 0, 0, 6, None),\\n+        (\\\"john_smith\\\", 1, 0, 0, 52, None),\\n+        (\\\"david_gore\\\", 0, 0, 0, 4, None),\\n+        (\\\"christopher_snoop\\\", 50, 0, 3, 518, None),\\n+        (\\\"beyond funk\\\", 0, 0, 0, 176, ValueError(\\\"lol\\\")),\\n+    ]\\n+\\n+    mock_subscriptions: List[MagicMock] = []\\n+    for values in subscription_values:\\n+        sub = Mock()\\n+        sub.name = values[0]\\n+        sub.num_entries_added = values[1]\\n+        sub.num_entries_modified = values[2]\\n+        sub.num_entries_removed = values[3]\\n+        sub.num_entries = values[4]\\n+        sub.exception = values[5]\\n+\\n+        mock_subscriptions.append(sub)\\n+\\n+    _ = output_summary(subscriptions=mock_subscriptions)\\n+    assert True  # Test used for manual inspection - too hard to test ansi color codes\\n\",\"diff --git a/tests/unit/cli/test_output_transaction_log.py b/tests/unit/cli/test_output_transaction_log.py\\nnew file mode 100644\\nindex 000000000..b3abeb349\\n--- /dev/null\\n+++ b/tests/unit/cli/test_output_transaction_log.py\\n@@ -0,0 +1,101 @@\\n+import os\\n+import sys\\n+import tempfile\\n+from pathlib import Path\\n+from typing import Optional\\n+from unittest.mock import patch\\n+\\n+import pytest\\n+from conftest import assert_logs\\n+\\n+from ytdl_sub.cli.entrypoint import main\\n+from ytdl_sub.cli.output_transaction_log import logger as transaction_logger\\n+from ytdl_sub.utils.file_handler import FileHandler\\n+\\n+\\n+@pytest.fixture\\n+def transaction_log_file_path() -> str:\\n+    # Delete the temp_file on creation\\n+    with tempfile.NamedTemporaryFile() as temp_file:\\n+        pass\\n+\\n+    yield temp_file.name\\n+\\n+    if os.path.isfile(temp_file.name):\\n+        FileHandler.delete(temp_file.name)\\n+\\n+\\n+@pytest.mark.parametrize(\\\"file_transaction_log\\\", [None, \\\"output.log\\\"])\\n+def test_suppress_transaction_log(\\n+    mock_subscription_download_success,\\n+    music_video_config_path: Path,\\n+    music_video_subscription_path: Path,\\n+    file_transaction_log: Optional[str],\\n+) -> None:\\n+    with patch.object(\\n+        sys,\\n+        \\\"argv\\\",\\n+        [\\n+            \\\"ytdl-sub\\\",\\n+            \\\"--config\\\",\\n+            str(music_video_config_path),\\n+            \\\"sub\\\",\\n+            str(music_video_subscription_path),\\n+            \\\"--suppress-transaction-log\\\",\\n+        ]\\n+        + ([\\\"--transaction-log\\\", file_transaction_log] if file_transaction_log else []),\\n+    ), patch(\\\"ytdl_sub.cli.output_transaction_log.output_transaction_log\\\") as mock_transaction_log:\\n+        transaction_logs = main()\\n+\\n+        assert transaction_logs\\n+        assert mock_transaction_log.call_count == 0\\n+\\n+\\n+def test_transaction_log_to_file(\\n+    mock_subscription_download_success,\\n+    music_video_config_path: Path,\\n+    music_video_subscription_path: Path,\\n+    transaction_log_file_path: Path,\\n+) -> None:\\n+    with patch.object(\\n+        sys,\\n+        \\\"argv\\\",\\n+        [\\n+            \\\"ytdl-sub\\\",\\n+            \\\"--config\\\",\\n+            str(music_video_config_path),\\n+            \\\"sub\\\",\\n+            str(music_video_subscription_path),\\n+            \\\"--transaction-log\\\",\\n+            str(transaction_log_file_path),\\n+        ],\\n+    ):\\n+        subscriptions = main()\\n+        assert subscriptions\\n+\\n+    with open(transaction_log_file_path, \\\"r\\\", encoding=\\\"utf-8\\\") as transaction_log_file:\\n+        assert transaction_log_file.readlines()[0] == \\\"Transaction log for john_smith:\\\\n\\\"\\n+\\n+\\n+def test_transaction_log_to_logger(\\n+    mock_subscription_download_success,\\n+    music_video_config_path: Path,\\n+    music_video_subscription_path: Path,\\n+) -> None:\\n+    with patch.object(\\n+        sys,\\n+        \\\"argv\\\",\\n+        [\\n+            \\\"ytdl-sub\\\",\\n+            \\\"--config\\\",\\n+            str(music_video_config_path),\\n+            \\\"sub\\\",\\n+            str(music_video_subscription_path),\\n+        ],\\n+    ), assert_logs(\\n+        logger=transaction_logger,\\n+        expected_message=\\\"Transaction log for john_smith:\\\\n\\\",\\n+        log_level=\\\"info\\\",\\n+    ):\\n+        transaction_logs = main()\\n+        assert transaction_logs\\n\",\"diff --git a/tests/unit/cli/test_output_summary.py b/tests/unit/cli/test_output_summary.py\\nindex 0b77a5d2f..67422532e 100644\\n--- a/tests/unit/cli/test_output_summary.py\\n+++ b/tests/unit/cli/test_output_summary.py\\n@@ -7,15 +7,9 @@\\n from ytdl_sub.cli.output_summary import output_summary\\n \\n \\n-def test_output_summary_one_error():\\n-    subscription_values: List[Tuple[str, int, int, int, int, Optional[Exception]]] = [\\n-        (\\\"long_name_but_lil_values\\\", 0, 0, 0, 6, None),\\n-        (\\\"john_smith\\\", 1, 0, 0, 52, None),\\n-        (\\\"david_gore\\\", 0, 0, 0, 4, None),\\n-        (\\\"christopher_snoop\\\", 50, 0, 3, 518, None),\\n-        (\\\"beyond funk\\\", 0, 0, 0, 176, ValueError(\\\"lol\\\")),\\n-    ]\\n-\\n+def _to_mock_subscriptions(\\n+    subscription_values: List[Tuple[str, int, int, int, int, Optional[Exception]]]\\n+) -> List[MagicMock]:\\n     mock_subscriptions: List[MagicMock] = []\\n     for values in subscription_values:\\n         sub = Mock()\\n@@ -28,5 +22,46 @@ def test_output_summary_one_error():\\n \\n         mock_subscriptions.append(sub)\\n \\n-    _ = output_summary(subscriptions=mock_subscriptions)\\n-    assert True  # Test used for manual inspection - too hard to test ansi color codes\\n+    return mock_subscriptions\\n+\\n+\\n+def test_output_summary_no_errors():\\n+    mock_subscriptions = _to_mock_subscriptions(\\n+        [\\n+            (\\\"long_name_but_lil_values\\\", 0, 0, 0, 6, None),\\n+            (\\\"john_smith\\\", 1, 0, 0, 52, None),\\n+            (\\\"david_gore\\\", 0, 0, 0, 4, None),\\n+            (\\\"christopher_snoop\\\", 50, 0, 3, 518, None),\\n+            (\\\"beyond funk\\\", 352, 0, 0, 2342, None),\\n+        ]\\n+    )\\n+\\n+    output_summary(subscriptions=mock_subscriptions)\\n+\\n+\\n+def test_output_summary_one_error():\\n+    mock_subscriptions = _to_mock_subscriptions(\\n+        [\\n+            (\\\"long_name_but_lil_values\\\", 0, 0, 0, 6, None),\\n+            (\\\"john_smith\\\", 1, 0, 0, 52, None),\\n+            (\\\"david_gore\\\", 0, 0, 0, 4, None),\\n+            (\\\"christopher_snoop\\\", 50, 0, 3, 518, None),\\n+            (\\\"beyond funk\\\", 0, 0, 0, 176, ValueError(\\\"lol\\\")),\\n+        ]\\n+    )\\n+\\n+    output_summary(subscriptions=mock_subscriptions)\\n+\\n+\\n+def test_output_summary_multiple_errors():\\n+    mock_subscriptions = _to_mock_subscriptions(\\n+        [\\n+            (\\\"long_name_but_lil_values\\\", 0, 0, 0, 6, None),\\n+            (\\\"john_smith\\\", 1, 0, 0, 52, None),\\n+            (\\\"david_gore\\\", 0, 0, 0, 4, PermissionError(\\\"ack\\\")),\\n+            (\\\"christopher_snoop\\\", 50, 0, 3, 518, None),\\n+            (\\\"beyond funk\\\", 0, 0, 0, 176, ValueError(\\\"lol\\\")),\\n+        ]\\n+    )\\n+\\n+    output_summary(subscriptions=mock_subscriptions)\\n\",\"diff --git a/tests/unit/cli/test_output_transaction_log.py b/tests/unit/cli/test_output_transaction_log.py\\nindex b3abeb349..2bf8a39de 100644\\n--- a/tests/unit/cli/test_output_transaction_log.py\\n+++ b/tests/unit/cli/test_output_transaction_log.py\\n@@ -45,9 +45,9 @@ def test_suppress_transaction_log(\\n         ]\\n         + ([\\\"--transaction-log\\\", file_transaction_log] if file_transaction_log else []),\\n     ), patch(\\\"ytdl_sub.cli.output_transaction_log.output_transaction_log\\\") as mock_transaction_log:\\n-        transaction_logs = main()\\n+        subscriptions = main()\\n \\n-        assert transaction_logs\\n+        assert subscriptions\\n         assert mock_transaction_log.call_count == 0\\n \\n \\n@@ -97,5 +97,5 @@ def test_transaction_log_to_logger(\\n         expected_message=\\\"Transaction log for john_smith:\\\\n\\\",\\n         log_level=\\\"info\\\",\\n     ):\\n-        transaction_logs = main()\\n-        assert transaction_logs\\n+        subscriptions = main()\\n+        assert subscriptions\\n\",\"diff --git a/tests/unit/main/test_main.py b/tests/unit/main/test_main.py\\nindex a2148aa61..5f4b2d5a1 100644\\n--- a/tests/unit/main/test_main.py\\n+++ b/tests/unit/main/test_main.py\\n@@ -38,10 +38,18 @@ def _mock_sys_exit(expected_exit_code: int):\\n     return _mock_sys_exit\\n \\n \\n-def test_main_success(mock_sys_exit):\\n-    with mock_sys_exit(expected_exit_code=0):\\n-        with patch(\\\"src.ytdl_sub.main._main\\\"):\\n-            main()\\n+@pytest.mark.parametrize(\\\"return_code\\\", [0, 1])\\n+def test_main_exit_code(mock_sys_exit, return_code: int):\\n+    with mock_sys_exit(expected_exit_code=return_code), patch(\\n+        \\\"src.ytdl_sub.main._main\\\"\\n+    ) as mock_inner_main, patch.object(Logger, \\\"cleanup\\\") as mock_logger_cleanup:\\n+        mock_inner_main.return_value = return_code\\n+        main()\\n+\\n+        assert mock_logger_cleanup.call_count == 1\\n+        assert mock_logger_cleanup.call_args.kwargs[\\\"cleanup_error_log\\\"] == (\\n+            True if return_code == 0 else False\\n+        )\\n \\n \\n def test_main_validation_error(capsys, mock_sys_exit):\\n\",\"diff --git a/tests/unit/utils/test_logger.py b/tests/unit/utils/test_logger.py\\nindex a66411b22..5a75e5c3a 100644\\n--- a/tests/unit/utils/test_logger.py\\n+++ b/tests/unit/utils/test_logger.py\\n@@ -151,9 +151,16 @@ def test_logger_can_be_cleaned_during_execution(self, clean_error_log: bool):\\n                         \\\"[ytdl-sub] Version 2023.03.24+14e4a4b\\\\n\\\",\\n                         f\\\"Please upload the error log file '{Logger.error_log_filename()}' and make a Github issue at https://github.com/jmbannon/ytdl-sub/issues with your config and command/subscription yaml file to reproduce. Thanks for trying ytdl-sub!\\\\n\\\",\\n                     ]\\n+\\n+                    assert err_logs[0:4] == expected[0:4]\\n+                    assert err_logs[8] == expected[8]\\n+\\n                     if iteration == 1:\\n-                        expected.extend(expected)  # Two errors occurred, error log should contain 2\\n-                    assert err_logs == expected\\n+                        err_lines = len(expected)\\n+\\n+                        # Two errors occurred, error log should contain 2\\n+                        assert err_logs[err_lines : err_lines + 4] == expected[0:4]\\n+                        assert err_logs[err_lines + 8] == expected[8]\\n \\n     @pytest.mark.parametrize(\\n         \\\"log_level, expected_stdout\\\",\"]", "hints_text": ""}
