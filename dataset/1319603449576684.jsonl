{"instance_id": "1319603449576684", "repo": "12rambau/sepal_ui", "base_commit": "97371fbaed444727126a2969cd68f856db77221f", "problem_statement": "automatically detect the theme used and adapt the frontend accordingly :\\nI have seen it on several  zoom : it's so cool to display everything in dark but look so wrong when people are actually just developing in there own env in light theme. \\r\\n\\r\\nSeveral situation that I would like to handle : \\r\\n- voila theme\\r\\n- jupyterLab theme \\r\\n- jupyter notebook theme", "FAIL_TO_PASS": ["tests/test_ThemeSelect.py::TestThemeSelect::test_init", "tests/test_utils.py::TestUtils::test_set_config_theme", "tests/test_ThemeSelect.py::TestThemeSelect::test_change_language"], "PASS_TO_PASS": ["tests/test_LoadTableField.py::TestLoadTableField::test_reset", "tests/test_SepalWidget.py::TestSepalWidget::test_hide", "tests/test_utils.py::TestUtils::test_switch", "tests/test_Alert.py::TestAlert::test_bind", "tests/test_DatePicker.py::TestDatePicker::test_is_valid_date", "tests/test_DrawerItem.py::TestDrawerItem::test_display_tile", "tests/test_AppBar.py::TestAppBar::test_title", "tests/test_utils.py::TestUtils::test_hide_component", "tests/test_Btn.py::TestBtn::test_toggle_loading", "tests/test_Tile.py::TestTile::test_set_title", "tests/test_Btn.py::TestBtn::test_init", "tests/test_utils.py::TestUtils::test_next_string", "tests/test_TableView.py::TestTableView::test_init", "tests/test_AppBar.py::TestAppBar::test_init", "tests/test_Tile.py::TestTile::test_tile_disclaimer", "tests/test_Tile.py::TestTile::test_nest", "tests/test_SepalWidget.py::TestSepalWidget::test_show", "tests/test_App.py::TestApp::test_add_banner", "tests/test_Translator.py::TestTranslator::test_sanitize", "tests/test_NavDrawer.py::TestNavDrawer::test_init", "tests/test_utils.py::TestUtils::test_get_file_size", "tests/test_utils.py::TestUtils::test_is_absolute", "tests/test_utils.py::TestUtils::test_download_link", "tests/test_sepalwidgets.py::TestSepalWidgets::test_html", "tests/test_Tile.py::TestTile::test_toggle_inputs", "tests/test_Model.py::TestModel::test_str", "tests/test_Tile.py::TestTile::test_get_id", "tests/test_StateBar.py::TestStateBar::test_add_msg", "tests/test_StateBar.py::TestStateBar::test_init", "tests/test_utils.py::TestUtils::test_loading_button", "tests/test_utils.py::TestUtils::test_show_component", "tests/test_sepalwidgets.py::TestSepalWidgets::test_generated", "tests/test_Tile.py::TestTile::test_init", "tests/test_Translator.py::TestTranslator::test_find_target", "tests/test_DrawerItem.py::TestDrawerItem::test_init_cards", "tests/test_Alert.py::TestAlert::test_update_progress", "tests/test_FileInput.py::TestFileInput::test_on_file_select", "tests/test_App.py::TestApp::test_show_tile", "tests/test_utils.py::TestUtils::test_random_string", "tests/test_FileInput.py::TestFileInput::test_bind", "tests/test_Markdown.py::TestMarkdown::test_init", "tests/test_Tile.py::TestTile::test_show", "tests/test_FileInput.py::TestFileInput::test_reset", "tests/test_TableView.py::TestTableView::test_nest_tile", "tests/test_DownloadBtn.py::TestDownloadBtn::test_set_url", "tests/test_Footer.py::TestFooter::test_init", "tests/test_Btn.py::TestBtn::test_set_icon", "tests/test_Alert.py::TestAlert::test_append_msg", "tests/test_DrawerItem.py::TestDrawerItem::test_remove_notif", "tests/test_CopyToClip.py::TestClip::test_copy", "tests/test_DownloadBtn.py::TestDownloadBtn::test_create_download_link", "tests/test_DrawerItem.py::TestDrawerItem::test_add_notif", "tests/test_PasswordField.py::TestPasswordField::test_toogle_viz", "tests/test_Alert.py::TestAlert::test_add_live_msg", "tests/test_Alert.py::TestAlert::test_add_msg", "tests/test_Tile.py::TestTile::test_hide", "tests/test_NavDrawer.py::TestNavDrawer::test_on_item_click", "tests/test_VectorField.py::TestVectorField::test_init", "tests/test_TableView.py::TestTableView::test_get_class", "tests/test_NavDrawer.py::TestNavDrawer::test_display_drawer", "tests/test_Tile.py::TestTile::test_tile_about", "tests/test_utils.py::TestUtils::test_catch_errors", "tests/test_Alert.py::TestAlert::test_check_input", "tests/test_Alert.py::TestAlert::test_init", "tests/test_App.py::TestApp::test_init", "tests/test_Translator.py::TestTranslator::test_available_locales", "tests/test_NumberField.py::TestNumberField::test_init", "tests/test_SepalWidget.py::TestSepalWidget::test_set_viz", "tests/test_DatePicker.py::TestDatePicker::test_check_date", "tests/test_DatePicker.py::TestDatePicker::test_init", "tests/test_Model.py::TestModel::test_export", "tests/test_Markdown.py::TestMarkdown::test_init_link", "tests/test_DatePicker.py::TestDatePicker::test_bind", "tests/test_CopyToClip.py::TestClip::test_init", "tests/test_LoadTableField.py::TestLoadTableField::test_init", "tests/test_DatePicker.py::TestDatePicker::test_disable", "tests/test_PasswordField.py::TestPasswordField::test_init", "tests/test_NumberField.py::TestNumberField::test_decrement", "tests/test_utils.py::TestUtils::test_to_colors", "tests/test_Alert.py::TestAlert::test_rmv_last_msg", "tests/test_SepalWidget.py::TestSepalWidget::test_reset", "tests/test_SepalWidget.py::TestSepalWidget::test_init", "tests/test_Translator.py::TestTranslator::test_missing_keys", "tests/test_utils.py::TestUtils::test_set_config_locale", "tests/test_DownloadBtn.py::TestDownloadBtn::test_init", "tests/test_Tooltip.py::TestTooltip::test_init", "tests/test_LoadTableField.py::TestLoadTableField::test_on_file_input_change", "tests/test_Alert.py::TestAlert::test_reset", "tests/test_FileInput.py::TestFileInput::test_init", "tests/test_Translator.py::TestTranslator::test_search_key", "tests/test_Translator.py::TestTranslator::test_init", "tests/test_CopyToClip.py::TestClip::test_change", "tests/test_FileInput.py::TestFileInput::test_select_file", "tests/test_NumberField.py::TestNumberField::test_increment", "tests/test_Model.py::TestModel::test_import", "tests/test_FileInput.py::TestFileInput::test_on_reload", "tests/test_Tile.py::TestTile::test_set_content", "tests/test_SepalWidget.py::TestSepalWidget::test_toggle_viz", "tests/test_Markdown.py::TestMarkdown::test_init_exhaustive"], "language": "python", "test_command": "source /saved/ENV || source /saved/*/ENV && pytest --no-header -rA --tb=no -p no:cacheprovider --continue-on-collection-errors", "test_output_parser": "python/parse_log_pytest_v3", "image_storage_uri": "vmvm-registry.fbinfra.net/repomate_image_activ_pytest/12rambau_sepal_ui:97371fbaed444727126a2969cd68f856db77221f", "patch": "[\"diff --git a/docs/source/modules/sepal_ui.rst b/docs/source/modules/sepal_ui.rst\\nindex 366a3fb..2650327 100644\\n--- a/docs/source/modules/sepal_ui.rst\\n+++ b/docs/source/modules/sepal_ui.rst\\n@@ -24,3 +24,11 @@ Content\\n     sepal_ui.theme\\n     sepal_ui.color\\n     sepal_ui.config_file\\n+    \\n+.. rubric:: Attributes\\n+\\n+.. autosummary::\\n+    \\n+    sepal_ui.get_theme\\n+    \\n+.. autofunction:: sepal_ui.get_theme\\n\",\"diff --git a/docs/source/modules/sepal_ui.scripts.utils.rst b/docs/source/modules/sepal_ui.scripts.utils.rst\\nindex d4a30a1..6c404e8 100644\\n--- a/docs/source/modules/sepal_ui.scripts.utils.rst\\n+++ b/docs/source/modules/sepal_ui.scripts.utils.rst\\n@@ -23,6 +23,7 @@ sepal\\\\_ui.scripts.utils\\n         switch\\n         to_colors\\n         set_config_locale\\n+        set_config_theme\\n       \\n .. autofunction:: sepal_ui.scripts.utils.catch_errors\\n \\n@@ -54,6 +55,8 @@ sepal\\\\_ui.scripts.utils\\n \\n .. autofunction:: sepal_ui.scripts.utils.set_config_locale\\n \\n+.. autofunction:: sepal_ui.scripts.utils.set_config_theme\\n+\\n \\n       \\n \\n\",\"diff --git a/docs/source/modules/sepal_ui.sepalwidgets.AppBar.rst b/docs/source/modules/sepal_ui.sepalwidgets.AppBar.rst\\nindex 3787c44..011eae2 100644\\n--- a/docs/source/modules/sepal_ui.sepalwidgets.AppBar.rst\\n+++ b/docs/source/modules/sepal_ui.sepalwidgets.AppBar.rst\\n@@ -10,6 +10,7 @@ sepal\\\\_ui.sepalwidgets.AppBar\\n         ~AppBar.toogle_button\\n         ~AppBar.title\\n         ~AppBar.locale\\n+        ~AppBar.theme\\n     \\n     .. rubric:: Methods\\n     \\n\",\"diff --git a/docs/source/modules/sepal_ui.sepalwidgets.ThemeSelect.rst b/docs/source/modules/sepal_ui.sepalwidgets.ThemeSelect.rst\\nnew file mode 100644\\nindex 0000000..5c4e14d\\n--- /dev/null\\n+++ b/docs/source/modules/sepal_ui.sepalwidgets.ThemeSelect.rst\\n@@ -0,0 +1,21 @@\\n+sepal\\\\_ui.sepalwidgets.ThemeSelect\\n+==================================\\n+\\n+.. autoclass:: sepal_ui.sepalwidgets.ThemeSelect\\n+\\n+    .. rubric:: Attributes\\n+    \\n+    .. autosummary::\\n+    \\n+        ~ThemeSelect.THEME_ICONS\\n+        ~ThemeSelect.theme\\n+        \\n+    .. rubric:: Methods\\n+    \\n+    .. autosummary::\\n+        :nosignatures:\\n+        \\n+        ~ThemeSelect.toggle_theme\\n+        \\n+.. automethod:: sepal_ui.sepalwidgets.ThemeSelect.toggle_theme\\n+        \\n\\\\ No newline at end of file\\n\",\"diff --git a/docs/source/modules/sepal_ui.sepalwidgets.rst b/docs/source/modules/sepal_ui.sepalwidgets.rst\\nindex b1bc9ef..9d0c686 100644\\n--- a/docs/source/modules/sepal_ui.sepalwidgets.rst\\n+++ b/docs/source/modules/sepal_ui.sepalwidgets.rst\\n@@ -33,3 +33,4 @@ sepal\\\\_ui.sepalwidgets\\n    sepal_ui.sepalwidgets.Tooltip\\n    sepal_ui.sepalwidgets.VectorField \\n    sepal_ui.sepalwidgets.LocaleSelect\\n+   sepal_ui.sepalwidgets.ThemeSelect\\n\",\"diff --git a/sepal_ui/__init__.py b/sepal_ui/__init__.py\\nindex 69eccad..bf79e17 100644\\n--- a/sepal_ui/__init__.py\\n+++ b/sepal_ui/__init__.py\\n@@ -1,18 +1,49 @@\\n+from types import SimpleNamespace\\n+from pathlib import Path\\n+from configparser import ConfigParser\\n+\\n+import ipyvuetify as v\\n+\\n+from sepal_ui.frontend import styles\\n+\\n __author__ = \\\"\\\"\\\"Pierrick Rambaud\\\"\\\"\\\"\\n __email__ = \\\"pierrick.rambaud49@gmail.com\\\"\\n __version__ = \\\"2.6.2\\\"\\n \\n-# direct access to colors\\n-from sepal_ui.frontend import styles\\n-import ipyvuetify as v\\n-from types import SimpleNamespace\\n-from pathlib import Path\\n \\n-theme = v.theme.themes.dark if v.theme.dark else v.theme.themes.light\\n+def get_theme(config_file):\\n+    \\\"\\\"\\\"\\n+    get the theme from the config file (default to dark)\\n+\\n+    Return:\\n+        (str): the theme to use\\n+    \\\"\\\"\\\"\\n+\\n+    # init theme\\n+    theme = \\\"dark\\\"\\n+\\n+    # read the config file if existing\\n+    if config_file.is_file():\\n+        config = ConfigParser()\\n+        config.read(config_file)\\n+        theme = config.get(\\\"sepal-ui\\\", \\\"theme\\\", fallback=\\\"dark\\\")\\n+\\n+    # set vuetify theme\\n+    v.theme.dark = True if theme == \\\"dark\\\" else False\\n+\\n+    return theme\\n+\\n+\\n+config_file = Path.home() / \\\".sepal-ui-config\\\"\\n+\\\"Pathlib.Path: the configuration file generated by sepal-ui based application to save parameters as language or theme\\\"\\n+\\n+theme = getattr(v.theme.themes, get_theme(config_file))\\n \\\"traitlets: the theme used in sepal\\\"\\n \\n color = SimpleNamespace(\\n-    bg=styles.bg_color,\\n+    main=theme.main,\\n+    darker=theme.darker,\\n+    bg=theme.bg_color,\\n     primary=theme.primary,\\n     accent=theme.accent,\\n     secondary=theme.secondary,\\n@@ -20,8 +51,6 @@ color = SimpleNamespace(\\n     info=theme.info,\\n     warning=theme.warning,\\n     error=theme.error,\\n+    menu=theme.menu,\\n )\\n-'SimpleNamespace: the colors of sepal. members are in the following list: \\\"bg, primary, accent, secondary, success, info, warning, error\\\". They will render according to the selected theme.'\\n-\\n-config_file = Path.home() / \\\".sepal-ui-config\\\"\\n-\\\"Pathlib.Path: the configuration file generated by sepal-ui based application to save parameters as language or theme\\\"\\n+'SimpleNamespace: the colors of sepal. members are in the following list: \\\"main, darker, bg, primary, accent, secondary, success, info, warning, error, menu\\\". They will render according to the selected theme.'\\n\",\"diff --git a/sepal_ui/aoi/aoi_model.py b/sepal_ui/aoi/aoi_model.py\\nindex d713e7b..0ecfdd7 100644\\n--- a/sepal_ui/aoi/aoi_model.py\\n+++ b/sepal_ui/aoi/aoi_model.py\\n@@ -10,6 +10,7 @@ from ipyleaflet import GeoJSON\\n import geemap\\n import ee\\n \\n+from sepal_ui import color\\n from sepal_ui.frontend.styles import AOI_STYLE\\n from sepal_ui.scripts import utils as su\\n from sepal_ui.scripts import gee\\n@@ -626,9 +627,12 @@ class AoiModel(Model):\\n         for f in data[\\\"features\\\"]:\\n             f[\\\"properties\\\"][\\\"name\\\"] = self.name\\n \\n+        # adapt the style to the theme\\n+        style = {**AOI_STYLE, \\\"color\\\": color.success, \\\"fillColor\\\": color.success}\\n+\\n         # create a GeoJSON object\\n         self.ipygeojson = GeoJSON(\\n-            data=data, style=AOI_STYLE, name=\\\"aoi\\\", attribution=\\\"SEPA(c)\\\"\\n+            data=data, style=style, name=\\\"aoi\\\", attribution=\\\"SEPAL(c)\\\"\\n         )\\n \\n         return self.ipygeojson\\n\",\"diff --git a/sepal_ui/bin/module_theme b/sepal_ui/bin/module_theme\\nnew file mode 100755\\nindex 0000000..8d15333\\n--- /dev/null\\n+++ b/sepal_ui/bin/module_theme\\n@@ -0,0 +1,55 @@\\n+#!/usr/bin/python3\\n+\\n+from colorama import init, Fore, Style\\n+\\n+from sepal_ui.scripts import utils as su\\n+\\n+# init colors for all plateforms\\n+init()\\n+\\n+\\n+def check_theme(theme):\\n+    \\\"\\\"\\\"\\n+    Check if the theme is a legit name\\n+\\n+    Return:\\n+        (bool)\\n+    \\\"\\\"\\\"\\n+\\n+    themes = [\\\"dark\\\", \\\"light\\\"]\\n+\\n+    return theme in themes\\n+\\n+\\n+if __name__ == \\\"__main__\\\":\\n+\\n+    # welcome the user\\n+    print(Fore.YELLOW)\\n+    print(\\\"##########################################\\\")\\n+    print(\\\"#                                        #\\\")\\n+    print(\\\"#      SEPAL MODULE THEMING TOOL         #\\\")\\n+    print(\\\"#                                        #\\\")\\n+    print(\\\"##########################################\\\")\\n+    print(Fore.RESET)\\n+    print(f\\\"Welcome in the {Style.BRIGHT}module theming{Style.NORMAL} interface.\\\")\\n+\\n+    # select a language\\n+    is_theme = False\\n+    while is_theme is False:\\n+\\n+        theme = input(f\\\"{Fore.CYAN}Provide a theme name: \\\\n{Fore.RESET}\\\")\\n+        is_theme = check_theme(theme)\\n+\\n+        # display an error if the language does not exist\\n+        if is_theme is False:\\n+            print(\\n+                f'{Fore.RED} The provided theme name (\\\"{theme}\\\") is not a supported theme. {Fore.RESET}'\\n+            )\\n+\\n+    # write the new color code in the config file\\n+    su.set_config_theme(theme)\\n+\\n+    # display information\\n+    print(\\n+        f'{Fore.GREEN} The provided theme (\\\"{theme}\\\") has been set as default theme for all SEPAL applications.{Fore.RESET}'\\n+    )\\n\",\"diff --git a/sepal_ui/frontend/styles.py b/sepal_ui/frontend/styles.py\\nindex cf4b297..a48b3de 100644\\n--- a/sepal_ui/frontend/styles.py\\n+++ b/sepal_ui/frontend/styles.py\\n@@ -2,24 +2,28 @@ from traitlets import Unicode\\n from IPython.display import display\\n import ipyvuetify as v\\n \\n-# change vuetify theming\\n-v.theme.dark = True\\n-\\n # set the colors for the dark theme\\n-v.theme.themes.dark.primary = \\\"#B3842E\\\"\\n+v.theme.themes.dark.primary = \\\"#b3842e\\\"\\n v.theme.themes.dark.accent = \\\"#a1458e\\\"\\n v.theme.themes.dark.secondary = \\\"#324a88\\\"\\n-v.theme.themes.dark.success = \\\"#3F802A\\\"\\n-v.theme.themes.dark.info = \\\"#79B1C9\\\"\\n+v.theme.themes.dark.success = \\\"#3f802a\\\"\\n+v.theme.themes.dark.info = \\\"#79b1c9\\\"\\n v.theme.themes.dark.warning = \\\"#b8721d\\\"\\n-v.theme.themes.dark.error = \\\"#A63228\\\"\\n+v.theme.themes.dark.error = \\\"#a63228\\\"\\n \\n-# fixed colors\\n-sepal_main = \\\"#24221F\\\"\\n-sepal_darker = \\\"#1a1a1a\\\"\\n+# fixed colors for drawer and appbar\\n+v.theme.themes.dark.main = \\\"#24221f\\\"\\n+v.theme.themes.light.main = \\\"#2e7d32\\\"\\n+v.theme.themes.dark.darker = \\\"#1a1a1a\\\"\\n+v.theme.themes.light.darker = \\\"#005005\\\"\\n \\n # set the background\\n-bg_color = \\\"#121212\\\" if v.theme.dark else \\\"#fff\\\"\\n+v.theme.themes.dark.bg_color = \\\"#121212\\\"\\n+v.theme.themes.light.bg_color = \\\"#fff\\\"\\n+\\n+# set a specific color for menus\\n+v.theme.themes.dark.menu = \\\"#424242\\\"\\n+v.theme.themes.light.menu = \\\"#fff\\\"\\n \\n \\n class Styles(v.VuetifyTemplate):\\n@@ -49,30 +53,33 @@ class Styles(v.VuetifyTemplate):\\n styles = Styles()\\n display(styles)\\n \\n-COMPONENTS = {\\n-    \\\"PROGRESS_BAR\\\": {\\n-        \\\"color\\\": \\\"indigo\\\",\\n-    }\\n-}\\n-\\n # default styling of the aoi layer\\n AOI_STYLE = {\\n     \\\"stroke\\\": True,\\n-    \\\"color\\\": v.theme.themes.dark.success,\\n+    \\\"color\\\": \\\"grey\\\",\\n     \\\"weight\\\": 2,\\n     \\\"opacity\\\": 1,\\n     \\\"fill\\\": True,\\n-    \\\"fillColor\\\": v.theme.themes.dark.success,\\n+    \\\"fillColor\\\": \\\"grey\\\",\\n     \\\"fillOpacity\\\": 0.4,\\n }\\n \\n+# the colors are set as follow.\\n+# 1 (True): dark theme\\n+# 0 (false): light theme\\n+# This will need to be changed if we want to support more than 2 theme\\n+COMPONENTS = {\\n+    \\\"PROGRESS_BAR\\\": {\\n+        \\\"color\\\": [\\\"#2196f3\\\", \\\"#3f51b5\\\"],\\n+    }\\n+}\\n \\n-_folder = {\\\"color\\\": \\\"amber\\\", \\\"icon\\\": \\\"far fa-folder\\\"}\\n-_table = {\\\"color\\\": \\\"green accent-4\\\", \\\"icon\\\": \\\"far fa-table\\\"}\\n-_vector = {\\\"color\\\": \\\"deep-purple\\\", \\\"icon\\\": \\\"far fa-vector-square\\\"}\\n-_other = {\\\"color\\\": \\\"light-blue\\\", \\\"icon\\\": \\\"far fa-file\\\"}\\n-_parent = {\\\"color\\\": \\\"white\\\", \\\"icon\\\": \\\"far fa-folder-open\\\"}\\n-_image = {\\\"color\\\": \\\"deep-purple\\\", \\\"icon\\\": \\\"far fa-image\\\"}\\n+_folder = {\\\"color\\\": [\\\"#ffca28\\\", \\\"#ffc107\\\"], \\\"icon\\\": \\\"far fa-folder\\\"}\\n+_table = {\\\"color\\\": [\\\"#4caf50\\\", \\\"#00c853\\\"], \\\"icon\\\": \\\"far fa-table\\\"}\\n+_vector = {\\\"color\\\": [\\\"#9c27b0\\\", \\\"#673ab7\\\"], \\\"icon\\\": \\\"far fa-vector-square\\\"}\\n+_other = {\\\"color\\\": [\\\"#00bcd4\\\", \\\"#03a9f4\\\"], \\\"icon\\\": \\\"far fa-file\\\"}\\n+_parent = {\\\"color\\\": [\\\"#424242\\\", \\\"#ffffff\\\"], \\\"icon\\\": \\\"far fa-folder-open\\\"}\\n+_image = {\\\"color\\\": [\\\"#9c27b0\\\", \\\"#673ab7\\\"], \\\"icon\\\": \\\"far fa-image\\\"}\\n \\n ICON_TYPES = {\\n     \\\"\\\": _folder,\\n\",\"diff --git a/sepal_ui/mapping/mapping.py b/sepal_ui/mapping/mapping.py\\nindex ab44e84..1dae10f 100644\\n--- a/sepal_ui/mapping/mapping.py\\n+++ b/sepal_ui/mapping/mapping.py\\n@@ -100,7 +100,10 @@ class SepalMap(geemap.Map):\\n         if len(basemaps):\\n             [self.add_basemap(basemap) for basemap in set(basemaps)]\\n         else:\\n-            self.add_basemap(\\\"CartoDB.DarkMatter\\\")\\n+            default_basemap = (\\n+                \\\"CartoDB.DarkMatter\\\" if v.theme.dark is True else \\\"CartoDB.Positron\\\"\\n+            )\\n+            self.add_basemap(default_basemap)\\n \\n         # add the base controls\\n         self.clear_controls()\\n\",\"diff --git a/sepal_ui/message/en/locale.json b/sepal_ui/message/en/locale.json\\nindex da5c4ef..c96a485 100644\\n--- a/sepal_ui/message/en/locale.json\\n+++ b/sepal_ui/message/en/locale.json\\n@@ -155,7 +155,10 @@\\n \\t\\t}\\n \\t},\\n     \\\"locale\\\": {\\n-        \\\"change\\\": \\\"The locale \\\\\\\"{0}\\\\\\\" will now be used as default language in SEPAL apps. please restart the current application to take this change into account. Note that if \\\\\\\"{0}\\\\\\\" is not avalaible in another application, SEPAL will fallback to the closest possible language\\\",\\n+        \\\"change\\\": \\\"The locale \\\\\\\"{0}\\\\\\\" will now be used as default language in SEPAL apps. Please restart the current application to take this change into account. Note that if \\\\\\\"{0}\\\\\\\" is not avalaible in another application, SEPAL will fallback to the closest possible language\\\",\\n         \\\"fallback\\\": \\\"The \\\\\\\"{0}\\\\\\\" locale is not available for this application. We will be using \\\\\\\"{1}\\\\\\\" instead. Please report to the maintainer if you want to add \\\\\\\"{0}\\\\\\\" to the suported languages.\\\"\\n+    },\\n+    \\\"theme\\\": {\\n+        \\\"change\\\": \\\"The theme \\\\\\\"{0}\\\\\\\" will be used as default theme in SEPAL apps. Please restart the current application to take this change into account.\\\"\\n     }\\n }\\n\\\\ No newline at end of file\\n\",\"diff --git a/sepal_ui/scripts/utils.py b/sepal_ui/scripts/utils.py\\nindex adbce60..2cd55df 100644\\n--- a/sepal_ui/scripts/utils.py\\n+++ b/sepal_ui/scripts/utils.py\\n@@ -521,3 +521,31 @@ def set_config_locale(locale):\\n     config.write(config_file.open(\\\"w\\\"))\\n \\n     return\\n+\\n+\\n+@versionadded(version=\\\"2.7.0\\\")\\n+def set_config_theme(theme):\\n+    \\\"\\\"\\\"\\n+    Set the provided theme in the sepal-ui config file\\n+\\n+    Args:\\n+        theme (str): a theme name (currently supporting \\\"dark\\\" and \\\"light\\\")\\n+    \\\"\\\"\\\"\\n+\\n+    config = ConfigParser()\\n+\\n+    # read the existing file if available\\n+    if config_file.is_file():\\n+        config.read(config_file)\\n+\\n+    # set the section if needed\\n+    if \\\"sepal-ui\\\" not in config.sections():\\n+        config.add_section(\\\"sepal-ui\\\")\\n+\\n+    # set the value\\n+    config.set(\\\"sepal-ui\\\", \\\"theme\\\", theme)\\n+\\n+    # save back the file\\n+    config.write(config_file.open(\\\"w\\\"))\\n+\\n+    return\\n\",\"diff --git a/sepal_ui/sepalwidgets/app.py b/sepal_ui/sepalwidgets/app.py\\nindex 2d26b7e..15bcd5f 100644\\n--- a/sepal_ui/sepalwidgets/app.py\\n+++ b/sepal_ui/sepalwidgets/app.py\\n@@ -2,20 +2,29 @@ from traitlets import link, Bool, observe\\n from functools import partial\\n from datetime import datetime\\n from pathlib import Path\\n+from itertools import cycle\\n \\n import ipyvuetify as v\\n from deprecated.sphinx import versionadded\\n import pandas as pd\\n from ipywidgets import jsdlink\\n \\n+import sepal_ui\\n from sepal_ui.sepalwidgets.sepalwidget import SepalWidget\\n from sepal_ui import color\\n-from sepal_ui.frontend.styles import sepal_main, sepal_darker\\n from sepal_ui.frontend import js\\n from sepal_ui.scripts import utils as su\\n from sepal_ui.message import ms\\n \\n-__all__ = [\\\"AppBar\\\", \\\"DrawerItem\\\", \\\"NavDrawer\\\", \\\"Footer\\\", \\\"App\\\", \\\"LocaleSelect\\\"]\\n+__all__ = [\\n+    \\\"AppBar\\\",\\n+    \\\"DrawerItem\\\",\\n+    \\\"NavDrawer\\\",\\n+    \\\"Footer\\\",\\n+    \\\"App\\\",\\n+    \\\"LocaleSelect\\\",\\n+    \\\"ThemeSelect\\\",\\n+]\\n \\n \\n class AppBar(v.AppBar, SepalWidget):\\n@@ -37,6 +46,9 @@ class AppBar(v.AppBar, SepalWidget):\\n     locale = None\\n     \\\"sw.LocaleSelect: the locale selector of all apps\\\"\\n \\n+    theme = None\\n+    \\\"sw.ThemeSelect: the theme selector of all apps\\\"\\n+\\n     def __init__(self, title=\\\"SEPAL module\\\", translator=None, **kwargs):\\n \\n         self.toggle_button = v.Btn(\\n@@ -47,13 +59,20 @@ class AppBar(v.AppBar, SepalWidget):\\n         self.title = v.ToolbarTitle(children=[title])\\n \\n         self.locale = LocaleSelect(translator=translator)\\n+        self.theme = ThemeSelect()\\n \\n         # set the default parameters\\n-        kwargs[\\\"color\\\"] = kwargs.pop(\\\"color\\\", sepal_main)\\n+        kwargs[\\\"color\\\"] = kwargs.pop(\\\"color\\\", color.main)\\n         kwargs[\\\"class_\\\"] = kwargs.pop(\\\"class_\\\", \\\"white--text\\\")\\n         kwargs[\\\"dense\\\"] = kwargs.pop(\\\"dense\\\", True)\\n         kwargs[\\\"app\\\"] = True\\n-        kwargs[\\\"children\\\"] = [self.toggle_button, self.title, v.Spacer(), self.locale]\\n+        kwargs[\\\"children\\\"] = [\\n+            self.toggle_button,\\n+            self.title,\\n+            v.Spacer(),\\n+            self.locale,\\n+            self.theme,\\n+        ]\\n \\n         super().__init__(**kwargs)\\n \\n@@ -252,7 +271,7 @@ class NavDrawer(v.NavigationDrawer, SepalWidget):\\n         # set default parameters\\n         kwargs[\\\"v_model\\\"] = kwargs.pop(\\\"v_model\\\", True)\\n         kwargs[\\\"app\\\"] = True\\n-        kwargs[\\\"color\\\"] = kwargs.pop(\\\"color\\\", sepal_darker)\\n+        kwargs[\\\"color\\\"] = kwargs.pop(\\\"color\\\", color.darker)\\n         kwargs[\\\"children\\\"] = children\\n \\n         # call the constructor\\n@@ -313,7 +332,7 @@ class Footer(v.Footer, SepalWidget):\\n         text = text if text != \\\"\\\" else \\\"SEPAL \\\\u00A9 {}\\\".format(datetime.today().year)\\n \\n         # set default parameters\\n-        kwargs[\\\"color\\\"] = kwargs.pop(\\\"color\\\", sepal_main)\\n+        kwargs[\\\"color\\\"] = kwargs.pop(\\\"color\\\", color.main)\\n         kwargs[\\\"class_\\\"] = kwargs.pop(\\\"class_\\\", \\\"white--text\\\")\\n         kwargs[\\\"app\\\"] = True\\n         kwargs[\\\"children\\\"] = [text]\\n@@ -414,6 +433,7 @@ class App(v.App, SepalWidget):\\n \\n         # add js event\\n         self.appBar.locale.observe(self._locale_info, \\\"value\\\")\\n+        self.appBar.theme.observe(self._theme_info, \\\"v_model\\\")\\n \\n     def show_tile(self, name):\\n         \\\"\\\"\\\"\\n@@ -442,13 +462,14 @@ class App(v.App, SepalWidget):\\n         return self\\n \\n     @versionadded(version=\\\"2.4.1\\\", reason=\\\"New end user interaction method\\\")\\n-    def add_banner(self, msg, **kwargs):\\n+    def add_banner(self, msg, id_=None, **kwargs):\\n         \\\"\\\"\\\"\\n         Display an alert object on top of the app to communicate development information to end user (release date, known issues, beta version). The alert is dissmisable and prominent\\n \\n         Args:\\n             msg (str): the message to write in the Alert\\n             kwargs: any arguments of the v.Alert constructor. if set, 'children' will be overwritten.\\n+            id_ (str, optional): unique banner identificator to avoid multiple aggregations.\\n \\n         Return:\\n             self\\n@@ -457,16 +478,28 @@ class App(v.App, SepalWidget):\\n         kwargs[\\\"type\\\"] = kwargs.pop(\\\"type\\\", \\\"info\\\")\\n         kwargs[\\\"border\\\"] = kwargs.pop(\\\"border\\\", \\\"left\\\")\\n         kwargs[\\\"class_\\\"] = kwargs.pop(\\\"class_\\\", \\\"mt-5\\\")\\n-        kwargs[\\\"transition\\\"] = kwargs.pop(\\\"transition\\\", \\\"slide-x-transition\\\")\\n+        kwargs[\\\"transition\\\"] = kwargs.pop(\\\"transition\\\", \\\"scroll-x-transition\\\")\\n         kwargs[\\\"prominent\\\"] = kwargs.pop(\\\"prominent\\\", True)\\n         kwargs[\\\"dismissible\\\"] = kwargs.pop(\\\"dismissible\\\", True)\\n         kwargs[\\\"children\\\"] = [msg]  # cannot be overwritten\\n+        kwargs[\\\"attributes\\\"] = {\\\"id\\\": id_}\\n+        kwargs[\\\"v_model\\\"] = kwargs.pop(\\\"v_model\\\", False)\\n+\\n+        # Verify if alert is already in the app.\\n+        children = self.content.children.copy()\\n \\n-        # create the alert\\n+        # remove already existing alert\\n+        alert = next((c for c in children if c.attributes.get(\\\"id\\\") == id_), False)\\n+        alert is False or children.remove(alert)\\n+\\n+        # create alert\\n         alert = v.Alert(**kwargs)\\n \\n-        # add the alert to the app\\n-        self.content.children = [alert] + self.content.children.copy()\\n+        # add the alert to the app if not already there\\n+        self.content.children = [alert] + children\\n+\\n+        # Display the alert\\n+        alert.v_model = True\\n \\n         return self\\n \\n@@ -475,7 +508,16 @@ class App(v.App, SepalWidget):\\n \\n         if change[\\\"new\\\"] != \\\"\\\":\\n             msg = ms.locale.change.format(change[\\\"new\\\"])\\n-            self.add_banner(msg, type=\\\"success\\\")\\n+            self.add_banner(msg, id_=\\\"locale\\\")\\n+\\n+        return\\n+\\n+    def _theme_info(self, change):\\n+        \\\"\\\"\\\"display information about the theme change\\\"\\\"\\\"\\n+\\n+        if change[\\\"new\\\"] != \\\"\\\":\\n+            msg = ms.theme.change.format(change[\\\"new\\\"])\\n+            self.add_banner(msg, id_=\\\"theme\\\")\\n \\n         return\\n \\n@@ -535,7 +577,7 @@ class LocaleSelect(v.Menu, SepalWidget):\\n         self.language_list = v.List(\\n             dense=True,\\n             flat=True,\\n-            color=\\\"grey darken-3\\\",\\n+            color=color.menu,\\n             v_model=True,\\n             max_height=\\\"300px\\\",\\n             style_=\\\"overflow: auto; border-radius: 0 0 0 0;\\\",\\n@@ -600,3 +642,62 @@ class LocaleSelect(v.Menu, SepalWidget):\\n         su.set_config_locale(loc.code)\\n \\n         return\\n+\\n+\\n+class ThemeSelect(v.Btn, SepalWidget):\\n+    \\\"\\\"\\\"\\n+    A theme selector for sepal-ui based application.\\n+\\n+    It displays the currently requested theme (default to dark).\\n+    When value is changed, the sepal-ui config file is updated. It is designed to be used in a AppBar component.\\n+\\n+    .. versionadded:: 2.7.0\\n+\\n+    Args:\\n+        kwargs (dict, optional): any arguments for a Btn object, children and v_model will be override\\n+    \\\"\\\"\\\"\\n+\\n+    THEME_ICONS = {\\\"dark\\\": \\\"fas fa-moon\\\", \\\"light\\\": \\\"fas fa-sun\\\"}\\n+    \\\"dict: the dictionnry of icons to use for each theme (used as keys)\\\"\\n+\\n+    theme = \\\"dark\\\"\\n+    \\\"str: the current theme of the widget (default to dark)\\\"\\n+\\n+    def __init__(self, **kwargs):\\n+\\n+        # get the current theme name\\n+        self.theme = sepal_ui.get_theme(sepal_ui.config_file)\\n+\\n+        # set the btn parameters\\n+        kwargs[\\\"x_small\\\"] = kwargs.pop(\\\"x_small\\\", True)\\n+        kwargs[\\\"fab\\\"] = kwargs.pop(\\\"fab\\\", True)\\n+        kwargs[\\\"class_\\\"] = kwargs.pop(\\\"class_\\\", \\\"ml-2\\\")\\n+        kwargs[\\\"children\\\"] = [v.Icon(children=[self.THEME_ICONS[self.theme]])]\\n+        kwargs[\\\"v_model\\\"] = self.theme\\n+\\n+        # create the btn\\n+        super().__init__(**kwargs)\\n+\\n+        # add some js events\\n+        self.on_event(\\\"click\\\", self.toggle_theme)\\n+\\n+    def toggle_theme(self, widget, event, data):\\n+        \\\"\\\"\\\"\\n+        toggle the btn icon from dark to light and adapt the configuration file at the same time\\n+        \\\"\\\"\\\"\\n+        # use a cycle to go through the themes\\n+        theme_cycle = cycle(self.THEME_ICONS.keys())\\n+        next(t for t in theme_cycle if t == self.theme)\\n+        self.theme = next(t for t in theme_cycle)\\n+\\n+        # change icon\\n+        self.color = \\\"info\\\"\\n+        self.children[0].children = [self.THEME_ICONS[self.theme]]\\n+\\n+        # change the paramater file\\n+        su.set_config_theme(self.theme)\\n+\\n+        # trigger other events by changing v_model\\n+        self.v_model = self.theme\\n+\\n+        return\\n\",\"diff --git a/sepal_ui/sepalwidgets/inputs.py b/sepal_ui/sepalwidgets/inputs.py\\nindex bf1adf0..365d4f0 100644\\n--- a/sepal_ui/sepalwidgets/inputs.py\\n+++ b/sepal_ui/sepalwidgets/inputs.py\\n@@ -9,7 +9,7 @@ import ee\\n import geopandas as gpd\\n from natsort import humansorted\\n \\n-\\n+from sepal_ui import color\\n from sepal_ui.message import ms\\n from sepal_ui.frontend.styles import COMPONENTS, ICON_TYPES\\n from sepal_ui.scripts import utils as su\\n@@ -215,13 +215,13 @@ class FileInput(v.Flex, SepalWidget):\\n \\n         self.loading = v.ProgressLinear(\\n             indeterminate=False,\\n-            background_color=\\\"grey darken-3\\\",\\n-            color=COMPONENTS[\\\"PROGRESS_BAR\\\"][\\\"color\\\"],\\n+            background_color=color.menu,\\n+            color=COMPONENTS[\\\"PROGRESS_BAR\\\"][\\\"color\\\"][v.theme.dark],\\n         )\\n \\n         self.file_list = v.List(\\n             dense=True,\\n-            color=\\\"grey darken-3\\\",\\n+            color=color.menu,\\n             flat=True,\\n             v_model=True,\\n             max_height=\\\"300px\\\",\\n@@ -374,13 +374,13 @@ class FileInput(v.Flex, SepalWidget):\\n \\n             if el.is_dir():\\n                 icon = ICON_TYPES[\\\"\\\"][\\\"icon\\\"]\\n-                color = ICON_TYPES[\\\"\\\"][\\\"color\\\"]\\n+                color = ICON_TYPES[\\\"\\\"][\\\"color\\\"][v.theme.dark]\\n             elif el.suffix in ICON_TYPES.keys():\\n                 icon = ICON_TYPES[el.suffix][\\\"icon\\\"]\\n-                color = ICON_TYPES[el.suffix][\\\"color\\\"]\\n+                color = ICON_TYPES[el.suffix][\\\"color\\\"][v.theme.dark]\\n             else:\\n                 icon = ICON_TYPES[\\\"DEFAULT\\\"][\\\"icon\\\"]\\n-                color = ICON_TYPES[\\\"DEFAULT\\\"][\\\"color\\\"]\\n+                color = ICON_TYPES[\\\"DEFAULT\\\"][\\\"color\\\"][v.theme.dark]\\n \\n             children = [\\n                 v.ListItemAction(children=[v.Icon(color=color, children=[icon])]),\\n@@ -405,7 +405,7 @@ class FileInput(v.Flex, SepalWidget):\\n                 v.ListItemAction(\\n                     children=[\\n                         v.Icon(\\n-                            color=ICON_TYPES[\\\"PARENT\\\"][\\\"color\\\"],\\n+                            color=ICON_TYPES[\\\"PARENT\\\"][\\\"color\\\"][v.theme.dark],\\n                             children=[ICON_TYPES[\\\"PARENT\\\"][\\\"icon\\\"]],\\n                         )\\n                     ]\\n\"]", "test_patch": "[\"diff --git a/setup.py b/setup.py\\nindex d7f3d03..1b207b7 100644\\n--- a/setup.py\\n+++ b/setup.py\\n@@ -57,7 +57,7 @@ setup_params = {\\n             \\\"pytest\\\",\\n         ],\\n         \\\"doc\\\": [\\n-            \\\"jupyter-sphinx @ git+git://github.com/jupyter/jupyter-sphinx.git\\\",\\n+            \\\"jupyter-sphinx @ git+https://github.com/jupyter/jupyter-sphinx.git\\\",\\n             \\\"pydata-sphinx-theme\\\",\\n             \\\"sphinx-notfound-page\\\",\\n             \\\"Sphinx\\\",\\n\",\"diff --git a/tests/test_LocaleSelect.py b/tests/test_LocaleSelect.py\\nindex 5da8c6e..1813b58 100644\\n--- a/tests/test_LocaleSelect.py\\n+++ b/tests/test_LocaleSelect.py\\n@@ -6,7 +6,7 @@ from sepal_ui import sepalwidgets as sw\\n from sepal_ui import config_file\\n \\n \\n-class TestBtn:\\n+class TestLocalSelect:\\n     def test_init(self, locale_select):\\n \\n         # minimal btn\\n\",\"diff --git a/tests/test_SepalMap.py b/tests/test_SepalMap.py\\nindex 440ce97..43f3223 100644\\n--- a/tests/test_SepalMap.py\\n+++ b/tests/test_SepalMap.py\\n@@ -53,8 +53,8 @@ class TestSepalMap:\\n \\n         m.set_drawing_controls(True)\\n         assert isinstance(m.dc, geemap.DrawControl)\\n-        assert m.dc.rectangle == {\\\"shapeOptions\\\": {\\\"color\\\": \\\"#79B1C9\\\"}}\\n-        assert m.dc.polygon == {\\\"shapeOptions\\\": {\\\"color\\\": \\\"#79B1C9\\\"}}\\n+        assert m.dc.rectangle == {\\\"shapeOptions\\\": {\\\"color\\\": \\\"#79b1c9\\\"}}\\n+        assert m.dc.polygon == {\\\"shapeOptions\\\": {\\\"color\\\": \\\"#79b1c9\\\"}}\\n         assert m.dc.marker == {}\\n         assert m.dc.polyline == {}\\n \\n\",\"diff --git a/tests/test_ThemeSelect.py b/tests/test_ThemeSelect.py\\nnew file mode 100644\\nindex 0000000..0de07d2\\n--- /dev/null\\n+++ b/tests/test_ThemeSelect.py\\n@@ -0,0 +1,36 @@\\n+from configparser import ConfigParser\\n+\\n+import pytest\\n+\\n+from sepal_ui import sepalwidgets as sw\\n+from sepal_ui import config_file\\n+\\n+\\n+class TestThemeSelect:\\n+    def test_init(self, theme_select):\\n+\\n+        # minimal btn\\n+        assert isinstance(theme_select, sw.ThemeSelect)\\n+\\n+        return\\n+\\n+    def test_change_language(self, theme_select):\\n+\\n+        # change value\\n+        theme_select.fire_event(\\\"click\\\", None)\\n+        config = ConfigParser()\\n+        config.read(config_file)\\n+        assert \\\"sepal-ui\\\" in config.sections()\\n+        assert config[\\\"sepal-ui\\\"][\\\"theme\\\"] == \\\"light\\\"\\n+\\n+        return\\n+\\n+    @pytest.fixture\\n+    def theme_select(self):\\n+        \\\"\\\"\\\"Create a simple theme_select\\\"\\\"\\\"\\n+\\n+        # destroy any existing config file\\n+        if config_file.is_file():\\n+            config_file.unlink()\\n+\\n+        return sw.ThemeSelect()\\n\",\"diff --git a/tests/test_utils.py b/tests/test_utils.py\\nindex a648b46..05136ab 100644\\n--- a/tests/test_utils.py\\n+++ b/tests/test_utils.py\\n@@ -326,3 +326,29 @@ class TestUtils:\\n         config_file.unlink()\\n \\n         return\\n+\\n+    def test_set_config_theme(self):\\n+\\n+        # remove any config file that could exist\\n+        if config_file.is_file():\\n+            config_file.unlink()\\n+\\n+        # create a config_file with a set language\\n+        theme = \\\"dark\\\"\\n+        su.set_config_theme(theme)\\n+\\n+        config = ConfigParser()\\n+        config.read(config_file)\\n+        assert \\\"sepal-ui\\\" in config.sections()\\n+        assert config[\\\"sepal-ui\\\"][\\\"theme\\\"] == theme\\n+\\n+        # change an existing locale\\n+        theme = \\\"light\\\"\\n+        su.set_config_theme(theme)\\n+        config.read(config_file)\\n+        assert config[\\\"sepal-ui\\\"][\\\"theme\\\"] == theme\\n+\\n+        # destroy the file again\\n+        config_file.unlink()\\n+\\n+        return\"]", "hints_text": ""}
