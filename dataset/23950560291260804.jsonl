{"instance_id": "23950560291260804", "repo": "dag-hammarskjold-library/dlx-rest", "base_commit": "1d5b83ecb590eea0cd2898d7c06f03cfb20a6aa7", "problem_statement": "Speech review section:\\nThe following fields should be displayed in columns, and columns should be sortable, which will allow the reviser to apply primary, secondary, etc. sorting.\\r\\n\\r\\n- Meeting records symbol (791)\\r\\n- Speaker (700)\\r\\n- Country organization (710 and 711)\\r\\n- Meeting date (992)\\r\\n\\r\\nIn addition, agenda information (991 a b c and d) should be displayed but not sortable since the field might be repeated. \\r\\nFrom the screen, the reviser should be able to add records in their basket as it is possible in other sections. \\r\\n", "FAIL_TO_PASS": ["dlx_rest/tests/test_app.py::test_rpp", "dlx_rest/tests/test_app.py::test_admin", "dlx_rest/tests/test_app.py::test_session_timeout", "dlx_rest/tests/test_app.py::test_index", "dlx_rest/tests/test_app.py::test_login", "dlx_rest/tests/test_app.py::test_delete_role", "dlx_rest/tests/test_app.py::test_sort", "dlx_rest/tests/test_app.py::test_update_user", "dlx_rest/tests/test_app.py::test_create_role", "dlx_rest/tests/test_app.py::test_update_role", "dlx_rest/tests/test_app.py::test_pagination", "dlx_rest/tests/test_app.py::test_create_user", "dlx_rest/tests/test_app.py::test_list_roles", "dlx_rest/tests/test_app.py::test_delete_user", "dlx_rest/tests/test_app.py::test_logout", "dlx_rest/tests/test_app.py::test_list_users"], "PASS_TO_PASS": ["dlx_rest/tests/test_api.py::test_api_file", "dlx_rest/tests/test_api.py::test_testing", "dlx_rest/tests/test_api.py::test_api_record", "dlx_rest/tests/test_api.py::test_api_record_history", "dlx_rest/tests/test_api.py::test_api_record_update_local_admin", "dlx_rest/tests/test_api.py::test_api_records_list_browse", "dlx_rest/tests/test_api.py::test_api_record_subfield_list", "dlx_rest/tests/test_api.py::test_api_collections_list", "dlx_rest/tests/test_api.py::test_api_record_delete_location_admin", "dlx_rest/tests/test_api.py::test_api_collection", "dlx_rest/tests/test_api.py::test_api_auth_merge", "dlx_rest/tests/test_api.py::test_api_record_field_place_subfield_list", "dlx_rest/tests/test_api.py::test_api_record_field_place_subfield_place_list", "dlx_rest/tests/test_api.py::test_api_record_delete_collection_admin", "dlx_rest/tests/test_api.py::test_api_lookup_map", "dlx_rest/tests/test_api.py::test_api_record_field_place_list", "dlx_rest/tests/test_api.py::test_api_record_delete_global_admin", "dlx_rest/tests/test_api.py::test_api_workform_list", "dlx_rest/tests/test_api.py::test_api_userbasket", "dlx_rest/tests/test_api.py::test_api_userprofile", "dlx_rest/tests/test_api.py::test_api_lookup_field", "dlx_rest/tests/test_api.py::test_api_workform", "dlx_rest/tests/test_api.py::test_api_record_update_collection_admin", "dlx_rest/tests/test_api.py::test_api_records_list_count", "dlx_rest/tests/test_api.py::test_api_auth_use_count", "dlx_rest/tests/test_api.py::test_api_lookup_field_list", "dlx_rest/tests/test_api.py::test_api_records_list", "dlx_rest/tests/test_app.py::test_testing", "dlx_rest/tests/test_api.py::test_app", "dlx_rest/tests/test_api.py::test_api_bib_update_delete_local_indexer", "dlx_rest/tests/test_api.py::test_api_record_fields_list", "dlx_rest/tests/test_api.py::test_api_record_field_subfield_value", "dlx_rest/tests/test_api.py::test_api_files"], "language": "python", "test_command": "source /saved/ENV || source /saved/*/ENV && pytest --no-header -rA --tb=no -p no:cacheprovider --continue-on-collection-errors", "test_output_parser": "python/parse_log_pytest_v3", "image_storage_uri": "vmvm-registry.fbinfra.net/repomate_image_activ_pytest/dag-hammarskjold-library_dlx-rest:1d5b83ecb590eea0cd2898d7c06f03cfb20a6aa7", "patch": "[\"diff --git a/dlx_rest/api/utils.py b/dlx_rest/api/utils.py\\nindex 460632f..1447d7c 100644\\n--- a/dlx_rest/api/utils.py\\n+++ b/dlx_rest/api/utils.py\\n@@ -216,6 +216,24 @@ def brief_bib(record):\\n         'agendas': agendas\\n     }\\n \\n+def brief_speech(record):\\n+    # This is much more specific than the regular search results we're populating with brief_bib and brief_auth\\n+\\n+    return {\\n+        '_id': record.id,\\n+        'url': URL('api_record', collection='bibs', record_id=record.id).to_str(),\\n+        'symbol': '; '.join(record.get_values('791', 'a')),\\n+        'speaker': record.get_value('700', 'a'),\\n+        'speaker_country': record.get_value('700', 'g'),\\n+        'country_org': record.get_value('710', 'a') or record.get_value('711', 'a'),\\n+        'date': '; '.join(record.get_values('992', 'a') or record.get_values('269', 'a')),\\n+        'agendas': [' '.join(field.get_values('a', 'b', 'c','d')) for field in record.get_fields('991')],\\n+        # This item_locked function is running for each record returned in this API call\\n+        #'locked': item_locked(\\\"bibs\\\", record.id)[\\\"locked\\\"],\\n+        'locked': False,\\n+        #'myBasket': False\\n+    }\\n+\\n def brief_auth(record):\\n     digits = record.heading_field.tag[1:3]\\n     alt_tag = '4' + digits\\n@@ -276,7 +294,7 @@ def has_permission(user, action, record, collection):\\n                 bool_list.append(\\\"F\\\")\\n     else:\\n         bool_list.append(\\\"F\\\")\\n-    print(\\\"boolean list:\\\",bool_list)\\n+    #print(\\\"boolean list:\\\",bool_list)\\n     if \\\"F\\\" in bool_list:\\n         return False\\n     else:\\n\",\"diff --git a/dlx_rest/routes.py b/dlx_rest/routes.py\\nindex 91fb2a4..0177b35 100644\\n--- a/dlx_rest/routes.py\\n+++ b/dlx_rest/routes.py\\n@@ -166,7 +166,6 @@ def create_user():\\n         user.set_password(password)\\n         user.username = username\\n         for role in roles:\\n-            print(role)\\n             try:\\n                 r = Role.objects.get(name=role)\\n                 user.roles.append(r)\\n@@ -193,7 +192,6 @@ def create_user():\\n def update_user(id):\\n     try:\\n         user = User.objects.get(id=id)\\n-        print(\\\"default views:\\\", user.default_views)\\n     except IndexError:\\n         flash(\\\"The user was not found.\\\")\\n         return redirect(url_for('list_users'))\\n@@ -205,7 +203,6 @@ def update_user(id):\\n     form.views.process_data([v.id for v in user.default_views])\\n \\n     if request.method == 'POST':\\n-        print(request.form)\\n         user = User.objects.get(id=id)\\n         email = request.form.get('email', user.email)\\n         username = request.form.get('username', user.username)\\n@@ -219,7 +216,6 @@ def update_user(id):\\n             user.set_password(password)\\n         user.roles = []\\n         for role in roles:\\n-            print(role)\\n             try:\\n                 r = Role.objects.get(name=role)\\n                 user.roles.append(r)\\n@@ -231,8 +227,6 @@ def update_user(id):\\n             user.default_views.append(v)\\n         user.updated = datetime.now()\\n         \\n-        print(user.__str__())\\n-\\n         try:\\n             user.save(validate=True)\\n             flash(\\\"The user was updated successfully.\\\")\\n@@ -278,7 +272,6 @@ def create_role():\\n         role = Role(name=name)\\n         role.permissions = []\\n         for permission in permissions:\\n-            print(permission)\\n             try:\\n                 p = Permission.objects.get(action=permission)\\n                 role.permissions.append(p)\\n@@ -315,8 +308,6 @@ def update_role(id):\\n         name = request.form.get('name', role.name)\\n         permissions = request.form.getlist('permissions')\\n \\n-        print(permissions)\\n-\\n         role.permissions = []\\n         for permission in permissions:\\n             try:\\n@@ -326,9 +317,7 @@ def update_role(id):\\n                 pass\\n         \\n         try:\\n-            print(role.permissions)\\n             role.save(validate=True)\\n-            print(\\\"I am here\\\")\\n             flash(\\\"The role was updated successfully.\\\")\\n             return redirect(url_for('get_roles'), 302)\\n         except:\\n@@ -434,7 +423,6 @@ def get_index_list(record_type):\\n @app.route('/records/<coll>/search')\\n @login_required\\n def search_records(coll):\\n-    #print(session.get('_id')) # Returns id if authenticated, or None if not.\\n     api_prefix = url_for('doc', _external=True)\\n     limit = request.args.get('limit', 25)\\n     start = request.args.get('start', 1)\\n@@ -444,7 +432,6 @@ def search_records(coll):\\n     # if old_q contains anything at all, it returns a list, so let's make sure we're checking\\n     # for the first string in the list entry instead of assuming we got a string.\\n     old_q = parse_qs(urlparse(request.referrer).query).get('q', [''])\\n-    #print(f'Old: {old_q} | New: {q}')\\n     if q != old_q[0]:\\n         start = 1\\n \\n@@ -465,18 +452,15 @@ def search_records(coll):\\n         # Regardless of what's in the session already\\n         session[f\\\"sort_{vcoll}\\\"] = {\\\"field\\\": sort, \\\"direction\\\": direction}\\n         this_v = session[f\\\"sort_{vcoll}\\\"]\\n-        #print(f\\\"Got {this_v} from URL\\\")\\n     else:\\n         # See if something is in the session already\\n         try:\\n             # We have session values, so use those\\n             this_v = session[f\\\"sort_{vcoll}\\\"]\\n-            #print(f\\\"Got {this_v} from session\\\")\\n             sort = session[f\\\"sort_{vcoll}\\\"][\\\"field\\\"]\\n             direction = session[f\\\"sort_{vcoll}\\\"][\\\"direction\\\"]\\n         except KeyError:\\n             # There is nothing in the session, so fallback to defaults\\n-            #print(f\\\"No sort/dir for {vcoll} found, using defaults.\\\")\\n             sort = \\\"updated\\\"\\n             direction = \\\"desc\\\"\\n     \\n@@ -559,6 +543,13 @@ def review_auth():\\n \\n     return render_template('review_auths.html', api_prefix=api_prefix, search_url=search_url, collection=\\\"auths\\\", vcoll=\\\"auths\\\", title=\\\"AuthReview\\\")\\n \\n+@app.route('/records/speeches/review')\\n+@login_required\\n+def review_speeches():\\n+    api_prefix = url_for('doc', _external=True)\\n+    q = request.args.get('q')\\n+    return render_template('review_speeches.html', api_prefix=api_prefix, title=\\\"Speech Review\\\", q=q)\\n+\\n @app.route('/records/<coll>/<id>', methods=['GET'])\\n @login_required\\n def get_record_by_id(coll,id):\\n@@ -585,8 +576,6 @@ def upload_files():\\n @requires_permission('createFile')\\n def process_files():\\n     S3.connect(bucket=Config.bucket)\\n-\\n-    #print(Config.environment)\\n     \\n     fileInfo = request.form.get(\\\"fileText\\\")\\n     fileTxt = json.loads(fileInfo)\\n\",\"diff --git a/dlx_rest/static/css/search.css b/dlx_rest/static/css/search.css\\nindex 1f4eb40..1ee4ce5 100644\\n--- a/dlx_rest/static/css/search.css\\n+++ b/dlx_rest/static/css/search.css\\n@@ -24,4 +24,10 @@ span.preview-text {\\n /**/\\n div.hidden {\\n     display: none;\\n+}\\n+\\n+.prevent-select {\\n+    -webkit-user-select: none; /* Safari */\\n+    -ms-user-select: none; /* IE 10 and IE 11 */\\n+    user-select: none; /* Standard syntax */\\n }\\n\\\\ No newline at end of file\\n\",\"diff --git a/dlx_rest/static/js/auth_review.js b/dlx_rest/static/js/auth_review.js\\nindex 86305be..e4dae31 100644\\n--- a/dlx_rest/static/js/auth_review.js\\n+++ b/dlx_rest/static/js/auth_review.js\\n@@ -120,13 +120,11 @@ export let authreviewcomponent = {\\n                 myProps[thisParam[0]] = decodeURIComponent(thisParam[1]).replace(/\\\\+/g, ' ');\\n             }\\n         }\\n-        console.log(myProps[\\\"search\\\"])\\n \\n         // Get the date string we want to display\\n         let updated = myProps[\\\"search\\\"].split(/updated(>|<|=)/)[2].split(\\\" \\\")[0]\\n         \\n         let myUIBase = this.api_prefix.replace('/api/','');\\n-        //console.log(this.links)\\n         return {\\n             visible: true,\\n             results: [],\\n@@ -273,19 +271,14 @@ export let authreviewcomponent = {\\n             () => {\\n                 user.getProfile(component.api_prefix, 'my_profile').then(\\n                     myProfile => {\\n-                        //console.log(\\\"got my profile\\\")\\n                         if (myProfile) {\\n                             component.user = myProfile.data.email;\\n                         }\\n                     \\n                         if (typeof component.user !== \\\"undefined\\\") {\\n-                            //console.log(\\\"this user is not undefined\\\")\\n                             basket.getBasket(component.api_prefix).then(\\n                                 myBasket => {\\n-                                    //console.log(myBasket)\\n-                                    //console.log(\\\"got my basket contents\\\")\\n                                     for (let result of component.results) {\\n-                                        //console.log(\\\"processing result\\\")\\n                                         let myId = `icon-${component.collection}-${result._id}`;\\n                                         let iconEl = document.getElementById(myId);\\n                                     \\n@@ -317,7 +310,6 @@ export let authreviewcomponent = {\\n \\n                                         iconEl.addEventListener(\\\"click\\\", function() {\\n                                             if (iconEl.classList.contains(\\\"fa-folder-plus\\\")) {\\n-                                                //console.log(\\\"We're trying to create something.\\\")\\n                                                 basket.getBasket(component.api_prefix)\\n                                                 iconEl.classList.add(\\\"fa-spinner\\\");\\n                                                 // we can run an add\\n@@ -331,13 +323,11 @@ export let authreviewcomponent = {\\n                                                     }\\n                                                 )\\n                                             } else if (iconEl.classList.contains(\\\"fa-folder-minus\\\")) {\\n-                                                //console.log(\\\"We're trying to delete something.\\\")\\n                                                 basket.getBasket(component.api_prefix)\\n                                                 iconEl.classList.add(\\\"fa-spinner\\\");\\n                                                 // we can run a deletion\\n                                                 basket.deleteItem(component.api_prefix, 'userprofile/my_profile/basket', myBasket, component.collection, result._id).then(\\n                                                     function() {\\n-                                                        //console.log(\\\"But did we do it?\\\")\\n                                                         iconEl.classList.remove(\\\"fa-spinner\\\");\\n                                                         iconEl.classList.remove(\\\"fa-folder-minus\\\");\\n                                                         iconEl.classList.add(\\\"fa-folder-plus\\\");\\n@@ -469,7 +459,6 @@ export let authreviewcomponent = {\\n                 // Next figure out if we're searching in a field or not\\n                 if (this.advancedParams[`searchField${i}`] == \\\"any\\\" ) {\\n                     if (term) {\\n-                        console.log(term)\\n                         anycount++\\n                     }\\n                     // What kind of search are we doing?\\n@@ -546,7 +535,6 @@ export let authreviewcomponent = {\\n             for (let i in expressions) {\\n                 let j = parseInt(i)+1\\n                 let accessor = `searchConnector${j.toString()}`\\n-                //console.log(i, expressions[i], accessor, this.advancedParams[accessor])\\n                 if (expressions[i] !== \\\"\\\") {\\n                     compiledExpr.push(expressions[i])\\n                 }\\n@@ -599,7 +587,6 @@ export let authreviewcomponent = {\\n             }\\n                 \\n             myParams[\\\"search\\\"] = newSearchParams.join(\\\" \\\")\\n-            console.log(myParams)\\n         \\n             const qs = Object.keys(myParams)\\n                 .map(key => `${key.replace('search','q')}=${encodeURIComponent(myParams[key])}`)\\n\",\"diff --git a/dlx_rest/static/js/basket.js b/dlx_rest/static/js/basket.js\\nindex 6af34f5..ae1424c 100644\\n--- a/dlx_rest/static/js/basket.js\\n+++ b/dlx_rest/static/js/basket.js\\n@@ -167,7 +167,6 @@ export let basketcomponent = {\\n                             } else if (rtype && rtype.getSubfield(\\\"b\\\").value === \\\"B23\\\") {\\n                                 data[\\\"vcoll\\\"] = \\\"votes\\\"\\n                             }\\n-                            console.log(data[\\\"vcoll\\\"])\\n \\n                             if (titleField) {\\n                                 data[\\\"title\\\"] = titleField.getSubfield(\\\"a\\\") ? titleField.getSubfield(\\\"a\\\").value || \\\"[No Title]\\\" : \\\"[No Title]\\\"\\n@@ -204,7 +203,6 @@ export let basketcomponent = {\\n                     }\\n                 ).catch(\\n                     error => {\\n-                        console.log(error)\\n                         // alert that debugging is needed\\n                         this.callChangeStyling(`Basket item ${element.collection} / ${element.record_id} failed to load`, \\\"d-flex w-100 alert-danger\\\")\\n                     }\\n\",\"diff --git a/dlx_rest/static/js/file.js b/dlx_rest/static/js/file.js\\nindex 1cb3dda..3d3ab5c 100644\\n--- a/dlx_rest/static/js/file.js\\n+++ b/dlx_rest/static/js/file.js\\n@@ -261,8 +261,6 @@ function createFileObjects() {\\n       i = i + 1;\\n     }\\n \\n-    // console.log(JSON.stringify(fileObjectArray));\\n-\\n     fileObjectArray.forEach((file) => {\\n     // const fileList = fileOjectArray.map((file) => {\\n       let fileEntry = document.createElement(\\\"tr\\\");\\n\",\"diff --git a/dlx_rest/static/js/history_two_files_display.js b/dlx_rest/static/js/history_two_files_display.js\\nindex 8d8cbcc..58ca715 100644\\n--- a/dlx_rest/static/js/history_two_files_display.js\\n+++ b/dlx_rest/static/js/history_two_files_display.js\\n@@ -121,7 +121,6 @@ let doubleRecordDisplay = {\\n                           }\\n                       } \\n                       vm.records.push(myRecord)\\n-                      console.log(myRecord)\\n                     }\\n             }\\n           }\\n\",\"diff --git a/dlx_rest/static/js/modals/agenda.js b/dlx_rest/static/js/modals/agenda.js\\nnew file mode 100644\\nindex 0000000..5ea5a50\\n--- /dev/null\\n+++ b/dlx_rest/static/js/modals/agenda.js\\n@@ -0,0 +1,35 @@\\n+export let agendamodal = {\\n+    template: `<div v-if=\\\"showModal\\\">\\n+    <transition name=\\\"modal\\\">\\n+      <div class=\\\"modal-mask\\\">\\n+        <div class=\\\"modal-wrapper\\\">\\n+          <div class=\\\"modal-dialog modal-xl\\\" role=\\\"document\\\">\\n+            <div class=\\\"modal-content\\\">\\n+              <div class=\\\"modal-header\\\">\\n+                <h5 class=\\\"modal-title\\\">Speeches / {{recordId}}: Agendas</h5>\\n+                <button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"modal\\\" aria-label=\\\"Close\\\">\\n+                  <span aria-hidden=\\\"true\\\" @click=\\\"showModal = false\\\">&times;</span>\\n+                </button>\\n+              </div>\\n+              <div id=\\\"preview-text\\\" class=\\\"modal-body\\\">\\n+                <ul>\\n+                    <li v-for=\\\"agenda in agendas\\\">{{agenda}}</li>\\n+                </ul>\\n+              </div>\\n+              <div class=\\\"modal-footer\\\">\\n+                <button type=\\\"button\\\" class=\\\"btn btn-secondary\\\" @click=\\\"showModal = false\\\">Close</button>\\n+              </div>\\n+            </div>\\n+          </div>\\n+        </div>\\n+      </div>\\n+    </transition>\\n+  </div>`,\\n+    data: function() {\\n+        return {\\n+            recordId: \\\"\\\",\\n+            agendas: [],\\n+            showModal: false\\n+        }\\n+    }\\n+}\\n\\\\ No newline at end of file\\n\",\"diff --git a/dlx_rest/static/js/modals/preview.js b/dlx_rest/static/js/modals/preview.js\\nnew file mode 100644\\nindex 0000000..93419a2\\n--- /dev/null\\n+++ b/dlx_rest/static/js/modals/preview.js\\n@@ -0,0 +1,64 @@\\n+import { Jmarc } from \\\"../jmarc.mjs\\\"\\n+\\n+export let previewmodal = {\\n+    props: {\\n+        api_prefix: {\\n+            type: String,\\n+            required: true\\n+        }\\n+    },\\n+    template: `<div v-if=\\\"showModal\\\">\\n+    <transition name=\\\"modal\\\">\\n+      <div class=\\\"modal-mask\\\">\\n+        <div class=\\\"modal-wrapper\\\">\\n+          <div class=\\\"modal-dialog modal-xl\\\" role=\\\"document\\\">\\n+            <div class=\\\"modal-content\\\">\\n+              <div class=\\\"modal-header\\\">\\n+                <h5 class=\\\"modal-title\\\">Speeches / {{recordId}}</h5>\\n+                <button type=\\\"button\\\" class=\\\"close\\\" data-dismiss=\\\"modal\\\" aria-label=\\\"Close\\\">\\n+                  <span aria-hidden=\\\"true\\\" @click=\\\"showModal = false\\\">&times;</span>\\n+                </button>\\n+              </div>\\n+              <div id=\\\"results-spinner\\\" class=\\\"col d-flex justify-content-center\\\">\\n+                    <div class=\\\"spinner-border\\\" role=\\\"status\\\" v-show=\\\"showSpinner\\\">\\n+                        <span class=\\\"sr-only\\\">Loading...</span>\\n+                    </div>\\n+                </div>\\n+              <div id=\\\"preview-text\\\" class=\\\"modal-body\\\"></div>\\n+              <div class=\\\"modal-footer\\\">\\n+                <button type=\\\"button\\\" class=\\\"btn btn-secondary\\\" @click=\\\"showModal = false\\\">Close</button>\\n+              </div>\\n+            </div>\\n+          </div>\\n+        </div>\\n+      </div>\\n+    </transition>\\n+  </div>`,\\n+    data: function() {\\n+        return {\\n+            collection: null,\\n+            recordId: null,\\n+            showModal: false,\\n+            record: null,\\n+            showSpinner: false\\n+        }\\n+    },\\n+    methods: {\\n+        show: async function() {\\n+            Jmarc.apiUrl = this.api_prefix\\n+            if (this.collection && this.recordId) {\\n+                this.showSpinner = true\\n+                Jmarc.get(this.collection, this.recordId).then(jmarc => {\\n+                    // The normal way to set things like this is to use a reactive data property\\n+                    // But we can also just set the innerText to what we get here, which preserves\\n+                    // the newline characters\\n+                    let previewText = document.getElementById(\\\"preview-text\\\")\\n+                    previewText.innerText = jmarc.toStr()\\n+                }).then( () => {this.showSpinner = false})\\n+            } else {\\n+                this.showModal = false\\n+            }\\n+            this.showModal = true\\n+        }\\n+    }\\n+}\\n\\\\ No newline at end of file\\n\",\"diff --git a/dlx_rest/static/js/record.js b/dlx_rest/static/js/record.js\\nindex 282d129..1903e15 100644\\n--- a/dlx_rest/static/js/record.js\\n+++ b/dlx_rest/static/js/record.js\\n@@ -392,7 +392,6 @@ export let multiplemarcrecordcomponent = {\\n         },\\n         toggleSelectField(e, jmarc, field) {\\n             // We automatically add the contents of a checked field to the copy stack\\n-            // console.log(`Toggling ${field.toStr()} at ${this.copiedFields.indexOf(field)}`)\\n             if (e.target.checked) {\\n                 if (!field.row.className.includes(\\\"hidden-field\\\")) {\\n                     if (jmarc.recordId == this.selectedJmarc.recordId) {\\n@@ -2108,7 +2107,6 @@ export let multiplemarcrecordcomponent = {\\n                     controlButton.title = control[\\\"title\\\"];\\n                     jmarc[control[\\\"name\\\"]] = controlButton;\\n                     if (control[\\\"name\\\"] == \\\"batchButton\\\") {\\n-                        console.log(\\\"batch button\\\")\\n                         controlButton.setAttribute(\\\"data-toggle\\\", \\\"modal\\\")\\n                         controlButton.setAttribute(\\\"data-target\\\", \\\"#batchActions\\\")\\n                     }\\n@@ -2480,7 +2478,6 @@ export let multiplemarcrecordcomponent = {\\n             // Activate\\n             // call when user clicks or tabs into tag field\\n             function tagActivate(e) {\\n-                //console.log(e)\\n                 let renderingPolicy = renderingData[jmarc.collection][field.tag];\\n \\n                 if (renderingPolicy && renderingPolicy[\\\"editable\\\"] === false) {\\n@@ -2531,7 +2528,6 @@ export let multiplemarcrecordcomponent = {\\n \\n                     }\\n                 });\\n-                //console.log(\\\"foo\\\")\\n             }\\n             \\n             // Tag update actions\\n@@ -3155,7 +3151,7 @@ export let multiplemarcrecordcomponent = {\\n             }\\n \\n             const observer = new MutationObserver(function() {\\n-                console.log('callback that runs when observer is triggered');\\n+\\n             });\\n \\n             observer.observe(valSpan, {subtree: true, childList: true});\\n\",\"diff --git a/dlx_rest/static/js/search/browse.js b/dlx_rest/static/js/search/browse.js\\nindex 0addb21..6ce42ce 100644\\n--- a/dlx_rest/static/js/search/browse.js\\n+++ b/dlx_rest/static/js/search/browse.js\\n@@ -289,7 +289,6 @@ export let browsecomponent = {\\n                 spinner.remove()\\n             })\\n             .catch(error => {\\n-                console.log(error)\\n                 let spinner = document.getElementById(url === beforeBrowse ? 'before-spinner' : 'after-spinner');\\n                 spinner.remove()\\n             });\\n\",\"diff --git a/dlx_rest/static/js/search/search.js b/dlx_rest/static/js/search/search.js\\nindex 8bcf570..e6a8426 100644\\n--- a/dlx_rest/static/js/search/search.js\\n+++ b/dlx_rest/static/js/search/search.js\\n@@ -154,6 +154,7 @@ export let searchcomponent = {\\n             <a class=\\\"mx-1 result-link\\\" href=\\\"#\\\" @click=\\\"selectAll\\\">All</a>\\n             <a class=\\\"mx-1 result-link\\\" href=\\\"#\\\" @click=\\\"selectNone\\\">None</a>\\n             <a class=\\\"mx-1 result-link\\\" href=\\\"#\\\" @click=\\\"sendToBasket\\\">Send Selected to Basket (limit: 100)</a>\\n+            <a v-if=\\\"collectionTitle=='speeches'\\\" class=\\\"ml-auto result-link\\\" :href=\\\"uibase + '/records/speeches/review'\\\">Speech Review</a>\\n         </div>\\n         <div id=\\\"results-list\\\" v-for=\\\"result in this.results\\\" :key=\\\"result._id\\\">\\n             <div class=\\\"row mt-1 bg-light border-bottom\\\">\\n@@ -227,7 +228,6 @@ export let searchcomponent = {\\n             }\\n         }\\n         let myUIBase = this.api_prefix.replace('/api/','');\\n-        //console.log(this.links)\\n         return {\\n             visible: true,\\n             results: [],\\n@@ -279,7 +279,8 @@ export let searchcomponent = {\\n             headFilters: ['100','110','111', '130', '150','190','191'],\\n             abortController: new AbortController(),\\n             myBasket: {},\\n-            user: null\\n+            user: null,\\n+            collectionTitle: null,\\n         }\\n     },\\n     created: async function() {\\n@@ -287,7 +288,7 @@ export let searchcomponent = {\\n     },\\n     mounted: async function() {\\n         let component = this;\\n-        let collectionTitle = component.collection;\\n+        this.collectionTitle = component.collection;\\n         Jmarc.apiUrl = component.api_prefix;\\n \\n         // cancel record preview if clicking anywhere besides the preview\\n@@ -328,15 +329,14 @@ export let searchcomponent = {\\n         // todo: remove the type cretieria from the search input; update criteria\\n         if (this.params.search.includes(\\\"089:'B22'\\\")) {\\n             this.vcoll = \\\"089:'B22'\\\"\\n-            collectionTitle = \\\"speeches\\\"\\n+            this.collectionTitle = \\\"speeches\\\"\\n         }\\n         // todo: remove the type cretieria from the search input, update criteria\\n         if (this.params.search.includes(\\\"089:'B23'\\\")) {\\n             this.vcoll = \\\"089:'B23'\\\"\\n-            collectionTitle = \\\"votes\\\"\\n+            this.collectionTitle = \\\"votes\\\"\\n         }\\n-\\n-        //document.title = document.title + `${title(collectionTitle)}`\\n+        console.log(this.collectionTitle)\\n \\n         let myEnd = component.params.start + component.params.limit -1;\\n         component.end = myEnd;\\n@@ -440,20 +440,15 @@ export let searchcomponent = {\\n             () => {\\n                 user.getProfile(component.api_prefix, 'my_profile').then(\\n                     myProfile => {\\n-                        //console.log(\\\"got my profile\\\")\\n                         if (myProfile) {\\n                             component.user = myProfile.data.email;\\n                         }\\n                     \\n                         if (typeof component.user !== \\\"undefined\\\") {\\n-                            //console.log(\\\"this user is not undefined\\\")\\n                             basket.getBasket(component.api_prefix).then(\\n                                 myBasket => {\\n                                     this.myBasket = myBasket\\n-                                    //console.log(myBasket)\\n-                                    //console.log(\\\"got my basket contents\\\")\\n                                     for (let result of component.results) {\\n-                                        //console.log(\\\"processing result\\\")\\n                                         let myId = `icon-${component.collection}-${result._id}`;\\n                                         let iconEl = document.getElementById(myId);\\n \\n@@ -554,6 +549,11 @@ export let searchcomponent = {\\n             }\\n             return false;\\n         },\\n+        refreshBasket() {\\n+            basket.getBasket(this.api_prefix).then( (b) => {\\n+                this.myBasket = b\\n+            })\\n+        },\\n         async handleIconClick(e) {\\n             let collection = e.target.id.split(\\\"-\\\")[1]\\n             let record_id = e.target.id.split(\\\"-\\\")[2]\\n@@ -580,6 +580,7 @@ export let searchcomponent = {\\n             else {\\n                 return false\\n             }\\n+            this.refreshBasket()\\n             return true\\n         },\\n         toggleAdvancedSearch() {\\n@@ -612,7 +613,6 @@ export let searchcomponent = {\\n             }\\n         },\\n         submitAdvancedSearch(e) {\\n-            //console.log(e)\\n             // Build the URL\\n             var expressions = []\\n             var anycount = 0\\n@@ -626,7 +626,6 @@ export let searchcomponent = {\\n                 // Next figure out if we're searching in a field or not\\n                 if (this.advancedParams[`searchField${i}`] == \\\"any\\\" ) {\\n                     if (term) {\\n-                        console.log(term)\\n                         anycount++\\n                     }\\n                     // What kind of search are we doing?\\n@@ -704,7 +703,6 @@ export let searchcomponent = {\\n             for (let i in expressions) {\\n                 let j = parseInt(i)+1\\n                 let accessor = `searchConnector${j.toString()}`\\n-                //console.log(i, expressions[i], accessor, this.advancedParams[accessor])\\n                 if (expressions[i] !== \\\"\\\") {\\n                     compiledExpr.push(expressions[i])\\n                 }\\n@@ -724,7 +722,6 @@ export let searchcomponent = {\\n             // ...\\n \\n             let url = `${this.action}?q=${encodeURIComponent(compiledExpr.join(\\\" \\\"))}`\\n-            //console.log(url)\\n             window.location = url\\n         },\\n         reportError(message) {\\n\",\"diff --git a/dlx_rest/static/js/search/sort.js b/dlx_rest/static/js/search/sort.js\\nindex 10f32d9..0a3a455 100644\\n--- a/dlx_rest/static/js/search/sort.js\\n+++ b/dlx_rest/static/js/search/sort.js\\n@@ -59,7 +59,6 @@ export let sortcomponent = {\\n         ];\\n         /* Once we have more fields to use for sorting, we can add them here */\\n         if (this.collection == \\\"bibs\\\") {\\n-            console.log(vcoll)\\n             if (vcoll == \\\"bibs\\\") {\\n                 mySortFields.push({'displayName':'publication date', 'searchString': 'date', 'sortDir': 'desc'});\\n                 mySortFields.push({'displayName':'symbol', 'searchString': 'symbol', 'sortDir': 'asc'});\\n@@ -103,7 +102,6 @@ export let sortcomponent = {\\n                 if (!el_href2.includes(\\\"&direction\\\")) {\\n                     el_href2 += `&direction=${el.getAttribute(\\\"data-defaultSortDir\\\")}`\\n                 }\\n-                console.log(\\\"hrefs\\\", el_href1, el_href2)\\n                 el.href = el_href2\\n             } else {\\n                 el.href = this.rebuildUrl(el.id, el.getAttribute(\\\"data-searchString\\\"));\\n\",\"diff --git a/dlx_rest/static/js/speech_review.js b/dlx_rest/static/js/speech_review.js\\nnew file mode 100644\\nindex 0000000..dfd497c\\n--- /dev/null\\n+++ b/dlx_rest/static/js/speech_review.js\\n@@ -0,0 +1,330 @@\\n+import { sortcomponent } from \\\"./search/sort.js\\\";\\n+import { countcomponent } from \\\"./search/count.js\\\";\\n+import basket from \\\"./api/basket.js\\\";\\n+import user from \\\"./api/user.js\\\";\\n+import { previewmodal } from \\\"./modals/preview.js\\\";\\n+import { agendamodal } from \\\"./modals/agenda.js\\\";\\n+\\n+export let speechreviewcomponent = {\\n+    props: {\\n+        api_prefix: {\\n+            type: String,\\n+            required: true\\n+        }\\n+    },\\n+    template: `<div class=\\\"col pt-2\\\" id=\\\"app1\\\" style=\\\"background-color:white;\\\">\\n+    <div class=\\\"col text-center\\\">\\n+        <h1>Speech Review</h1>\\n+        <form @submit.prevent=\\\"submitSearch\\\">\\n+            <label for=\\\"speechSearch\\\">Search Speeches</label>\\n+            <div class=\\\"input-group mb-3\\\">\\n+                <input id=\\\"speechSearch\\\" type=\\\"text\\\" class=\\\"form-control\\\" aria-label=\\\"Search Speeches\\\" v-model=\\\"searchTerm\\\" @keyup=\\\"updateSearchQuery\\\">\\n+                <div class=\\\"input-group-append\\\">\\n+                    <a class=\\\"btn btn-outline-secondary\\\" type=\\\"button\\\" @click=\\\"submitSearch\\\">Submit</a>\\n+                </div>\\n+            </div>\\n+        </form>\\n+    </div>\\n+    <div class=\\\"col\\\">\\n+        <div id=\\\"results-spinner\\\" class=\\\"col d-flex justify-content-center\\\" >\\n+            <div class=\\\"spinner-border\\\" role=\\\"status\\\" v-show=\\\"showSpinner\\\">\\n+                <span class=\\\"sr-only\\\">Loading...</span>\\n+            </div>\\n+        </div>\\n+        <div v-if=\\\"submitted\\\">{{speeches.length}} results returned in {{searchTime}} seconds</div>\\n+        <div v-if=\\\"speeches.length > 0\\\">\\n+            Select \\n+            <a class=\\\"mx-1 result-link\\\" href=\\\"#\\\" @click=\\\"selectAll\\\">All</a>\\n+            <a class=\\\"mx-1 result-link\\\" href=\\\"#\\\" @click=\\\"selectNone\\\">None</a>\\n+            <a v-if=\\\"selectedRecords.length > 0\\\" class=\\\"mx-1 result-link\\\" href=\\\"#\\\" @click=\\\"sendToBasket\\\">Send Selected to Basket</a>\\n+            <a v-else class=\\\"mx-1 result-link text-muted\\\" href=\\\"#\\\">Send Selected to Basket</a>\\n+            <br>\\n+            <div>Sorting:<span class=\\\"mx-1\\\" v-for=\\\"sc in sortColumns\\\">[{{sc.column}}: {{sc.direction}}]</span>\\n+            <a class=\\\"ml-auto float-right result-link\\\" :href=\\\"uibase + '/records/bibs/search?q=089%3A%27B22%27'\\\">Speeches</a>\\n+            </div>\\n+        </div>\\n+        <table class=\\\"table table-sm table-striped table-hover\\\" v-if=\\\"speeches.length > 0\\\">\\n+            <thead class=\\\"prevent-select\\\">\\n+                <tr>\\n+                    <th scope=\\\"col\\\"></th>\\n+                    <th scope=\\\"col\\\">#</th>\\n+                    <th scope=\\\"col\\\" @click=\\\"processSort($event, 'symbol')\\\">Meeting Record (791)\\n+                        <i data-target=\\\"symbol\\\" class=\\\"fas fa-sort-alpha-up text-secondary\\\"></i>\\n+                        <span id=\\\"symbol-badge\\\" class=\\\"badge badge-pill badge-dark\\\">0</span>\\n+                    </th>\\n+                    <th scope=\\\"col\\\" @click=\\\"processSort($event, 'date')\\\">Date (992)\\n+                        <i data-target=\\\"date\\\" class=\\\"fas fa-sort-alpha-up text-secondary\\\"></i>\\n+                        <span id=\\\"date-badge\\\" class=\\\"badge badge-pill badge-dark\\\">0</span>\\n+                    </th>\\n+                    <th scope=\\\"col\\\" @click=\\\"processSort($event, 'speaker')\\\">Speaker (700 a)\\n+                        <i data-target=\\\"speaker\\\" class=\\\"fas fa-sort-alpha-up text-secondary\\\"></i>\\n+                        <span id=\\\"speaker-badge\\\" class=\\\"badge badge-pill badge-dark\\\">0</span>\\n+                    </th>\\n+                    <th scope=\\\"col\\\" @click=\\\"processSort($event, 'speaker_country')\\\">Speaker (700 g)\\n+                        <i data-target=\\\"speaker_country\\\" class=\\\"fas fa-sort-alpha-up text-secondary\\\"></i>\\n+                        <span id=\\\"speaker_country-badge\\\" class=\\\"badge badge-pill badge-dark\\\">0</span>\\n+                    </th>\\n+                    <th scope=\\\"col\\\" @click=\\\"processSort($event, 'country_org')\\\">Country/Organization (710 or 711)\\n+                        <i data-target=\\\"country_org\\\" class=\\\"fas fa-sort-alpha-up text-secondary\\\"></i>\\n+                        <span id=\\\"country_org-badge\\\" class=\\\"badge badge-pill badge-dark\\\">0</span>\\n+                    </th>\\n+                    <th scope=\\\"col\\\">Agendas</th>\\n+                    <th scope=\\\"col\\\"></th>\\n+                </tr>\\n+            </thead>\\n+            <tbody>\\n+                <tr v-for=\\\"(speech, index) in sortedSpeeches\\\" :key=\\\"speech._id\\\">\\n+                    <td>\\n+                        <input v-if=\\\"speech.locked\\\" type=\\\"checkbox\\\" :data-recordid=\\\"speech._id\\\" @change=\\\"toggleSelect($event)\\\" disabled>\\n+                        <input v-else-if=\\\"speech.myBasket\\\" type=\\\"checkbox\\\" :data-recordid=\\\"speech._id\\\" @change=\\\"toggleSelect($event)\\\" disabled>\\n+                        <input v-else type=\\\"checkbox\\\" :data-recordid=\\\"speech._id\\\" @change=\\\"toggleSelect($event)\\\">\\n+                    </td>\\n+                    <td>{{index + 1}}</td>\\n+                    <td @click=\\\"togglePreview('bibs',speech._id)\\\" title=\\\"Toggle Record Preview\\\"><i class=\\\"fas fa-file mr-2\\\"></i>{{speech.symbol}}</td>\\n+                    <td>{{speech.date}}</td>\\n+                    <td>{{speech.speaker}}</td>\\n+                    <td>{{speech.speaker_country}}</td>\\n+                    <td>{{speech.country_org}}</td>\\n+                    <td title=\\\"Toggle Agenda View\\\">\\n+                        <i class=\\\"fas fa-file\\\" @click=\\\"toggleAgendas($event, speech._id, speech.agendas)\\\"></i>\\n+                    </td>\\n+                    <td>\\n+                        <i v-if=\\\"speech.locked\\\" :id=\\\"speech._id + '-basket'\\\" class=\\\"fas fa-lock\\\"></i>\\n+                        <i v-else-if=\\\"speech.myBasket\\\" :id=\\\"speech._id + '-basket'\\\" class=\\\"fas fa-folder-minus\\\" @click=\\\"toggleBasket($event, speech._id)\\\"></i>\\n+                        <i v-else :id=\\\"speech._id + '-basket'\\\" class=\\\"fas fa-folder-plus\\\" @click=\\\"toggleBasket($event, speech._id)\\\"></i>\\n+                    </td>\\n+                </tr>\\n+            </tbody>\\n+        </table>\\n+    </div>\\n+    <div v-if=\\\"showAgendaModal\\\" :agendas=\\\"agendas\\\">\\n+        <div class=\\\"modal fade\\\" ref=\\\"modal\\\">\\n+            <div v-for=\\\"agenda in agendas\\\">{{agenda}}</div>\\n+        </div>\\n+    </div>\\n+    <previewmodal ref=\\\"previewmodal\\\" :api_prefix=\\\"api_prefix\\\"></previewmodal>\\n+    <agendamodal ref=\\\"agendamodal\\\" :api_prefix=\\\"api_prefix\\\"></agendamodal>\\n+</div>`,\\n+    data: function() {\\n+        let myUIBase = this.api_prefix.replace('/api/','')\\n+        return {\\n+            speeches: [],\\n+            submitted: false,\\n+            sortColumns: [],\\n+            showAgendaModal: false,\\n+            showSpinner: false,\\n+            agendas: [],\\n+            hidden_qs: [\\\"089:B22\\\"],\\n+            searchTerm: \\\"\\\",\\n+            myBasket: {},\\n+            selectedRecords: [],\\n+            uibase: myUIBase,\\n+            searchTime: 0\\n+        }\\n+    },\\n+    computed: {\\n+        // This function performs multifield sort using the objects stored in the sortColumns array\\n+        // What goes in the sortColumns array, in what order, and how it gets there is handled by processSort() below\\n+        sortedSpeeches: function () {\\n+            return this.speeches.sort( (a, b) => {\\n+                // For each object in sortColumns, we want to perform the sort\\n+                // Each object is a defined column that exists in the incoming data\\n+                for (const i in this.sortColumns) {\\n+                    const column = this.sortColumns[i].column\\n+                    const direction = this.sortColumns[i].direction\\n+                    // localeCompare() is the acutal comparison function that performs the sort\\n+                    // It works on a broad range of text and can sort, e.g., 2 before 10, etc.\\n+                    let comparison = a[column].localeCompare(b[column])\\n+                    // And finally, this is how we change direction\\n+                    if (direction == \\\"desc\\\") {\\n+                        comparison *= -1\\n+                    }\\n+                    if (comparison !== 0) {\\n+                        return comparison\\n+                    }\\n+                }\\n+                return 0\\n+            })\\n+        }\\n+    },\\n+    created: function () {\\n+        const urlParams = new URLSearchParams(window.location.search)\\n+        const searchQuery = urlParams.get(\\\"q\\\")\\n+        if (searchQuery) {\\n+            this.searchTerm = searchQuery\\n+            this.updateSearchQuery()\\n+            this.submitSearch()\\n+        }\\n+        this.refreshBasket()\\n+    },\\n+    methods: {\\n+        async refreshBasket() {\\n+            basket.getBasket(this.api_prefix).then( (b) => {\\n+                this.myBasket = b\\n+            })\\n+        },\\n+        updateSearchQuery() {\\n+            const url = new URL(window.location)\\n+            url.searchParams.set(\\\"q\\\", this.searchTerm)\\n+            this.qs = [this.searchTerm, this.hidden_qs].join(\\\" AND \\\")\\n+            window.history.replaceState(null, \\\"\\\", url)\\n+        },\\n+        submitSearch() {\\n+            // Do the search and update this.speeches\\n+            let search_url = `${this.api_prefix}marc/bibs/records?search=${this.qs}&format=brief_speech&start=1&limit=50000`\\n+            let ui_url = `${this.api_prefix.replace(\\\"/api/\\\",\\\"\\\")}/records/speeches/review?q=${this.foundQ}`\\n+            let startTime = Date.now()\\n+            this.showSpinner = true\\n+            fetch(search_url).then(response => {\\n+                response.json().then(jsonData => {\\n+                    this.speeches = jsonData.data\\n+                }).then( () => {\\n+                    this.submitted = true\\n+                })\\n+            }).then( () => {this.showSpinner = false}).then(() => {\\n+                window.history.replaceState({},ui_url)\\n+            }).then( () => {\\n+                this.searchTime = (Date.now() - startTime) / 1000\\n+            })\\n+        },\\n+        toggleSelect(e) {\\n+            let recordId = e.target.dataset.recordid\\n+            if (this.selectedRecords.includes({\\\"collection\\\": \\\"bibs\\\", \\\"record_id\\\": recordId})) {\\n+                this.selectedRecords.splice(this.selectedRecords.indexOf({\\\"collection\\\": \\\"bibs\\\", \\\"record_id\\\": recordId}),1)\\n+            } else {\\n+                this.selectedRecords.push({\\\"collection\\\": \\\"bibs\\\", \\\"record_id\\\": recordId})\\n+            }\\n+            \\n+        },\\n+        selectAll() {\\n+            for (let i of document.querySelectorAll(\\\"input[type=checkbox]\\\")) {\\n+                i.disabled ? i.checked = false : i.checked = true\\n+                let recordId = i.dataset.recordid\\n+                if (i.checked) {\\n+                    this.selectedRecords.push({\\\"collection\\\": \\\"bibs\\\", \\\"record_id\\\": recordId})\\n+                }\\n+            }\\n+        },\\n+        selectNone() {\\n+            for (let i of document.querySelectorAll(\\\"input[type=checkbox]\\\")) {\\n+                i.checked = false\\n+            }\\n+            this.selectedRecords = []\\n+        },\\n+        processSort: function(e, column) {\\n+            // reset sort indicators\\n+            for (let i of document.getElementsByTagName(\\\"i\\\")) {\\n+                i.classList.replace(\\\"text-dark\\\", \\\"text-secondary\\\")\\n+            }\\n+            // reset badges\\n+            for (let b of document.getElementsByClassName(\\\"badge\\\")) {\\n+                b.innerText = \\\"0\\\"\\n+            }\\n+            // Figure out if we already have the indicated column in sortColumns\\n+            let existingColumn = this.sortColumns.find((sc) => sc.column === column)\\n+            if (existingColumn) {\\n+                // The column exists, but are we sorting it alone?\\n+                if (e.shiftKey) {\\n+                    let direction = \\\"\\\"\\n+                    existingColumn.direction == \\\"asc\\\" ? direction = \\\"desc\\\" : direction = \\\"asc\\\"\\n+                    if (existingColumn.direction === direction) {\\n+                        // This column and direction alreday exist in this.sortColumns, so we want to remove the object\\n+                        this.sortColumns.splice(existingColumn)\\n+                    } else {\\n+                        // Otherwise we are changing the sort direction\\n+                        existingColumn.direction = direction\\n+                    }\\n+                } else {                    \\n+                    existingColumn.direction == \\\"asc\\\" ? existingColumn.direction = \\\"desc\\\" : existingColumn.direction = \\\"asc\\\"\\n+                    this.sortColumns = [existingColumn]\\n+                }\\n+            } else {\\n+                if (e.shiftKey) {\\n+                    // There was no existing column, and we want to add this to our list of columns\\n+                    this.sortColumns.push({column: column, direction: \\\"asc\\\"})\\n+                } else {\\n+                    // There was no existing column, and we want to make this our only sort column\\n+                    this.sortColumns = [{column:column, direction:\\\"asc\\\"}]\\n+                }\\n+            }\\n+            // Finally, go through the DOM and update the icons and badges according to the contents of sortColumns\\n+            var idx = 1\\n+            for (let sc of this.sortColumns) {\\n+                for (let i of document.getElementsByTagName(\\\"i\\\")) {\\n+                    if (i.getAttribute(\\\"data-target\\\") == sc.column) {\\n+                        sc.direction === \\\"desc\\\" ? i.classList.replace(\\\"fa-sort-alpha-up\\\", \\\"fa-sort-alpha-down\\\") : i.classList.replace(\\\"fa-sort-alpha-down\\\", \\\"fa-sort-alpha-up\\\")\\n+                        i.classList.replace(\\\"text-secondary\\\", \\\"text-dark\\\")\\n+                        let badge = document.getElementById(`${sc.column}-badge`)\\n+                        badge.innerText = idx\\n+                        idx++\\n+                    }\\n+                }\\n+            }\\n+        },\\n+        sendToBasket() {\\n+            /*  \\n+            Several things need to happen here\\n+            1. Send all the items to the basket that have checkmarks beside them\\n+            2. Uncheck the checked items\\n+            3. Disable the checkbox for each item sent to the basket\\n+            4. Update the folder icon for each item sent to the basket\\n+            5. Empty this.selectedRecords\\n+            */\\n+            basket.createItems(this.api_prefix, 'userprofile/my_profile/basket', JSON.stringify(this.selectedRecords)).then( () => {\\n+                for (let record of this.selectedRecords) {\\n+                    let checkbox = document.querySelector(`input[data-recordid=\\\"${record.record_id}\\\"]`)\\n+                    checkbox.checked = false\\n+                    checkbox.disabled = true\\n+                    let icon = document.querySelector(`i[id=\\\"${record.record_id}-basket\\\"]`)\\n+                    icon.classList.remove(\\\"fa-folder-plus\\\")\\n+                    icon.classList.add(\\\"fa-folder-minus\\\")\\n+                }\\n+                this.selectedRecords = []\\n+                this.refreshBasket()\\n+            })\\n+        },\\n+        toggleBasket: async function (e, speechId) {\\n+            if (e.target.classList.contains(\\\"fa-folder-plus\\\")) {\\n+                // add to basket\\n+                await basket.createItem(this.api_prefix, 'userprofile/my_profile/basket', \\\"bibs\\\", speechId).then( () => {\\n+                    let checkbox = document.querySelector(`input[data-recordid=\\\"${speechId}\\\"]`)\\n+                    checkbox.disabled = true\\n+                    e.target.classList.remove(\\\"fa-folder-plus\\\")\\n+                    e.target.classList.add(\\\"fa-folder-minus\\\")\\n+                })\\n+            } else {\\n+                // remove from basket\\n+                await basket.deleteItem(this.myBasket, \\\"bibs\\\", speechId).then( () => {\\n+                    let checkbox = document.querySelector(`input[data-recordid=\\\"${speechId}\\\"]`)\\n+                    checkbox.disabled = false\\n+                    e.target.classList.remove(\\\"fa-folder-minus\\\")\\n+                    e.target.classList.add(\\\"fa-folder-plus\\\")\\n+                })\\n+            }\\n+            this.refreshBasket()\\n+        },\\n+        togglePreview: async function (collection, speechId) {\\n+            this.$refs.previewmodal.collection = collection\\n+            this.$refs.previewmodal.recordId = speechId\\n+            this.$refs.previewmodal.show()\\n+        },\\n+        toggleAgendas: function (e, speechId, agendas) {\\n+            this.$refs.agendamodal.agendas = agendas\\n+            this.$refs.agendamodal.recordId = speechId\\n+            this.$refs.agendamodal.showModal = true\\n+        },\\n+        dismissPreview: function () {\\n+            for (let d of document.getElementsByClassName(\\\"preview\\\")) {\\n+                if (!d.classList.contains(\\\"hidden\\\")) {\\n+                    d.classList.toggle(\\\"hidden\\\")\\n+                }\\n+            }\\n+        },\\n+    },\\n+    components: {\\n+        'sortcomponent': sortcomponent, \\n+        'countcomponent': countcomponent,\\n+        'previewmodal': previewmodal,\\n+        'agendamodal': agendamodal\\n+    }\\n+}\\n\\\\ No newline at end of file\\n\",\"diff --git a/dlx_rest/static/js/speech_review_vm.js b/dlx_rest/static/js/speech_review_vm.js\\nnew file mode 100644\\nindex 0000000..1d1ae62\\n--- /dev/null\\n+++ b/dlx_rest/static/js/speech_review_vm.js\\n@@ -0,0 +1,19 @@\\n+/////////////////////////////////////////////////////////////////\\n+// Imports\\n+/////////////////////////////////////////////////////////////////\\n+\\n+//import { Jmarc } from \\\"./jmarc.mjs\\\";\\n+import { speechreviewcomponent } from \\\"./speech_review.js\\\";\\n+\\n+\\n+/////////////////////////////////////////////////////////////////\\n+// VIEW MODEL DEFINITION\\n+/////////////////////////////////////////////////////////////////\\n+export let speech_review_vm = new Vue({\\n+    el: '#speech_review_vm',\\n+    components: { speechreviewcomponent },\\n+    data: {\\n+      visible: false,\\n+    },\\n+    methods: {}\\n+})\\n\\\\ No newline at end of file\\n\",\"diff --git a/dlx_rest/static/js/workform.js b/dlx_rest/static/js/workform.js\\nindex e538fad..97c806e 100644\\n--- a/dlx_rest/static/js/workform.js\\n+++ b/dlx_rest/static/js/workform.js\\n@@ -38,7 +38,6 @@ export let workformcomponent = {\\n     created: async function() {\\n         Jmarc.apiUrl = this.api_prefix;\\n         \\n-        console.log(\\\"hello\\\")\\n         \\n         for (let col of [\\\"auths\\\", \\\"bibs\\\"]) {\\n             this[`${col}_workforms`] = await Jmarc.listWorkforms(col);\\n\",\"diff --git a/dlx_rest/templates/review_speeches.html b/dlx_rest/templates/review_speeches.html\\nnew file mode 100644\\nindex 0000000..9df506e\\n--- /dev/null\\n+++ b/dlx_rest/templates/review_speeches.html\\n@@ -0,0 +1,12 @@\\n+{% extends 'base.html' %} {% block content %}    \\n+\\n+    <div id=\\\"speech_review_vm\\\" v-show=\\\"true\\\" data-api_prefix=\\\"{{api_prefix}}\\\">\\n+        <messagecomponent prefix=\\\"{{api_prefix}}\\\"></messagecomponent>\\n+        <div class=\\\"row\\\">\\n+            <speechreviewcomponent api_prefix=\\\"{{api_prefix}}\\\"></speechreviewcomponent>\\n+        </div>\\n+    </div>\\n+\\n+<script type=\\\"module\\\" src=\\\"{{url_for('static', filename='js/speech_review_vm.js')}}\\\" ></script>\\n+\\n+{% endblock %}\\n\\\\ No newline at end of file\"]", "test_patch": "[\"diff --git a/dlx_rest/api/__init__.py b/dlx_rest/api/__init__.py\\nindex 8cc9a6d..d740410 100644\\n--- a/dlx_rest/api/__init__.py\\n+++ b/dlx_rest/api/__init__.py\\n@@ -29,7 +29,7 @@ from dlx.util import AsciiMap\\n from dlx_rest.config import Config\\n from dlx_rest.app import app, login_manager\\n from dlx_rest.models import RecordView, User, Basket, requires_permission, register_permission, DoesNotExist\\n-from dlx_rest.api.utils import ClassDispatch, URL, ApiResponse, Schemas, abort, brief_bib, brief_auth, item_locked, has_permission\\n+from dlx_rest.api.utils import ClassDispatch, URL, ApiResponse, Schemas, abort, brief_bib, brief_auth, brief_speech, item_locked, has_permission\\n \\n # Init\\n authorizations = {\\n@@ -45,7 +45,6 @@ ns = api.namespace('api', description='DLX MARC REST API')\\n @login_manager.request_loader\\n def request_loader(request):\\n     auth_header = request.headers.get('Authorization')\\n-    #print(f\\\"Auth header: {auth_header}\\\")\\n     if not auth_header:\\n         return None\\n \\n@@ -194,7 +193,7 @@ class RecordsList(Resource):\\n     args.add_argument(\\n         'format', \\n         type=str, \\n-        choices=['json', 'xml', 'mrk', 'mrc', 'brief'],\\n+        choices=['json', 'xml', 'mrk', 'mrc', 'brief', 'brief_speech'],\\n         help='Formats the list as a batch of records in the specified format'\\n     )\\n     args.add_argument(\\n@@ -215,6 +214,20 @@ class RecordsList(Resource):\\n         route_params.pop('self')\\n         cls = ClassDispatch.batch_by_collection(collection) or abort(404)\\n         args = RecordsList.args.parse_args()\\n+\\n+        # We can also note some things about the requesting user's basket here, since this route, and all others, require login\\n+        try:\\n+            this_u = User.objects.get(id=current_user['id'])\\n+            this_basket = Basket.objects(owner=this_u)[0]\\n+        except TypeError:\\n+            pass\\n+\\n+        # Get all of the baskets so we can speed up the fetch/render; note that we could just do a database search here...\\n+        all_basket_objects = []\\n+        for basket in Basket.objects:\\n+            for item in basket.items:\\n+                if item not in all_basket_objects:\\n+                    all_basket_objects.append(item)\\n         \\n         # search\\n         search = unquote(args.search) if args.search else None\\n@@ -230,11 +243,11 @@ class RecordsList(Resource):\\n         # limit  \\n         limit = int(args.limit or 100)\\n         \\n-        if limit > 1000:\\n-            abort(404, 'Maximum limit is 1000')\\n-        \\n         # format\\n         fmt = args['format'] or None\\n+\\n+        if fmt != 'brief_speech' and limit > 1000:\\n+            abort(404, 'Maximum limit is 1000')\\n         \\n         if fmt == 'brief':\\n             tags = ['191', '245', '269', '700', '710', '711', '791', '989', '991', '992'] if collection == 'bibs' \\\\\\n@@ -243,6 +256,12 @@ class RecordsList(Resource):\\n             # make sure logical fields are available for sorting\\n             tags += (list(DlxConfig.bib_logical_fields.keys()) + list(DlxConfig.auth_logical_fields.keys()))\\n             project = dict.fromkeys(tags, True)\\n+        elif fmt == 'brief_speech':\\n+            tags = ['269', '700', '710', '711', '791', '991', '992']\\n+           \\n+            # make sure logical fields are available for sorting\\n+            tags += (list(DlxConfig.bib_logical_fields.keys()) + list(DlxConfig.auth_logical_fields.keys()))\\n+            project = dict.fromkeys(tags, True)\\n         elif fmt:\\n             project = {}\\n         else:\\n@@ -281,6 +300,26 @@ class RecordsList(Resource):\\n             schema_name='api.brieflist'\\n             make_brief = brief_bib if recordset.record_class == Bib else brief_auth\\n             data = [make_brief(r) for r in recordset]\\n+        elif fmt == 'brief_speech':\\n+            schema_name='api.brieflist'\\n+            make_brief = brief_speech\\n+            #data = [make_brief(r) for r in recordset]\\n+            data = []\\n+            for r in recordset:\\n+                this_d = make_brief(r)\\n+                this_d[\\\"myBasket\\\"] = False\\n+                \\n+                # Determine lock status first, then resolve whether the item is in the current user's basket\\n+                lock_status = list(filter(lambda x: x['record_id'] == str(r.id) and x['collection'] == collection, all_basket_objects))\\n+                if len(lock_status) > 0:\\n+                    print(lock_status)\\n+                    this_d[\\\"locked\\\"] = True\\n+\\n+                basket_contains = list(filter(lambda x: x['record_id'] == str(r.id) and x['collection'] == 'bibs', this_basket.items))\\n+                if len(basket_contains) > 0:\\n+                    this_d[\\\"myBasket\\\"] = True\\n+                    this_d[\\\"locked\\\"] = False\\n+                data.append(this_d)\\n         else:\\n             schema_name='api.urllist'\\n             data = [URL('api_record', record_id=r.id, **route_params).to_str() for r in recordset]\\n@@ -319,8 +358,6 @@ class RecordsList(Resource):\\n     @ns.doc(description='Create a Bibliographic or Authority Record with the given data.', security='basic')\\n     @login_required\\n     def post(self, collection):\\n-        #user = 'testing' if current_user.is_anonymous else current_user.email\\n-        #print(user)\\n         cls = ClassDispatch.by_collection(collection) or abort(404)\\n         args = RecordsList.args.parse_args()\\n     \\n@@ -626,11 +663,7 @@ class Record(Resource):\\n     @ns.doc(description='Replace the record with the given data.', security='basic')\\n     @login_required\\n     def put(self, collection, record_id):\\n-        #user = 'testing' if current_user.is_anonymous else current_user.email\\n-        #print(user)\\n         user = current_user if request_loader(request) is None else request_loader(request)\\n-        #print(user)\\n-        #print(user, user.permissions_list())\\n         cls = ClassDispatch.by_collection(collection) or abort(404)\\n         record = cls.from_id(record_id) or abort(404)\\n         args = Record.args.parse_args()\\n@@ -821,7 +854,6 @@ class RecordFieldPlaceList(Resource):\\n             record_data[field_tag].append(field_data)\\n             record = cls(record_data, auth_control=True)\\n         except Exception as e:\\n-            print(record.to_dict())\\n             abort(400, str(e))\\n \\n         if not has_permission(user, \\\"updateRecord\\\", record, collection):\\n@@ -930,9 +962,6 @@ class RecordFieldPlace(Resource):\\n         cls = ClassDispatch.by_collection(collection) or abort(404)\\n         record = cls.from_id(record_id) or abort(404)\\n         \\n-        if record.get_field(field_tag, place=field_place) is None:\\n-            print(record.id)\\n-            print('???\\\\n' + record.to_mrk())\\n         \\n         record.get_field(field_tag, place=field_place) or abort(404)\\n \\n@@ -1409,7 +1438,6 @@ class WorkformsList(Resource):\\n         # interim implementation\\n         workform_collection = DB.handle[f'{collection}_templates'] # todo: change name in dlx\\n         workforms = workform_collection.find({})\\n-        #print(workforms)\\n         data = [URL('api_workform', collection=collection, workform_name=t['name']).to_str() for t in workforms]\\n         \\n         links = {\\n@@ -1567,7 +1595,6 @@ class FileRecord(Resource):\\n     @ns.expect(args)\\n     def get(self, record_id):\\n         args = FileRecord.args.parse_args()\\n-        print(args)\\n         record = File.from_id(str(record_id)) or abort(404)\\n             \\n         if record.filename is None:\\n@@ -1586,7 +1613,6 @@ class FileRecord(Resource):\\n             record.filename = File.encode_fn(ids, langs, extension)\\n         \\n         action = args.get('action', None)\\n-        print(action)\\n         \\n         if action == 'download':\\n             output_filename = record.filename\\n@@ -1595,7 +1621,6 @@ class FileRecord(Resource):\\n         \\n             try:\\n                 s3_file = s3.get_object(Bucket=bucket, Key=record_id)\\n-                print(s3_file)\\n             except Exception as e:\\n                 abort(500, str(e))\\n \\n@@ -1607,7 +1632,6 @@ class FileRecord(Resource):\\n         \\n             try:\\n                 s3_file = s3.get_object(Bucket=bucket, Key=record_id)\\n-                print(s3_file)\\n             except Exception as e:\\n                 abort(500, str(e))\\n \\n@@ -1711,9 +1735,7 @@ class MyBasketRecord(Resource):\\n         override = False\\n         if \\\"override\\\" in item.keys():\\n             override = item[\\\"override\\\"]\\n-        #print(item)\\n         lock_status = item_locked(item['collection'], item['record_id'])\\n-        #print(lock_status)\\n         this_u = User.objects.get(id=current_user.id)\\n         if lock_status[\\\"locked\\\"] == True:\\n             if lock_status[\\\"by\\\"] == this_u.email:\\n@@ -1724,10 +1746,7 @@ class MyBasketRecord(Resource):\\n                 if override:\\n                     # Remove it from the other user's basket\\n                     # Add it to this user's basket\\n-                    #print(lock_status[\\\"in\\\"])\\n                     for losing_basket in Basket.objects(name=lock_status[\\\"in\\\"]):\\n-                        #print(losing_basket)\\n-\\n                         losing_basket.remove_item(lock_status[\\\"item_id\\\"])\\n                     this_u.my_basket().add_item(item)\\n                     return {},201\\n@@ -1782,7 +1801,6 @@ class MyBasketItem(Resource):\\n             item_data = item_data_raw\\n             if isinstance(item_data_raw, list):\\n                 item_data = item_data_raw[0]\\n-            #print(item_data)\\n             if item_data['collection'] == 'bibs':\\n                 this_m = Bib.from_id(int(item_data['record_id']))\\n                 item_data['title'] = this_m.title() or '...'\\n@@ -1828,8 +1846,6 @@ class ViewList(Resource):\\n     def get(self, coll):\\n         try:\\n             view_list = RecordView.objects(collection=coll)\\n-            for v in view_list:\\n-                print(v.id, v.name)\\n         except:\\n             raise\\n         \\n@@ -1865,7 +1881,6 @@ class View(Resource):\\n     @ns.doc(\\\"Get the contents of a record view by collection and id.\\\")\\n     def get(self, coll, id):\\n         this_item = RecordView.objects.get(id=id)\\n-        print(this_item.name)\\n \\n         links = {\\n             '_self': URL('api_view', coll=coll, id=id).to_str(),\\n\"]", "hints_text": ""}
