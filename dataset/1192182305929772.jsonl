{"instance_id": "1192182305929772", "repo": "carnisj/bcdi", "base_commit": "e7fabdc71f958a82fe7f5f43fcce618955ae7b49", "problem_statement": "[FEAT]Merge correct_angles script into preprocessing:\\nWe could merge the bcdi_correct_angles.py and bcdi_preprocessing.py scripts, many parameters are shared, for the others, one could imagine a boolean parameter \"correct\" like the \"get_temperature\" parameter.", "FAIL_TO_PASS": ["experiment.test_detector.TestCreateRoi.test_center_roi_x_wrong_type_str", "experiment.test_detector.TestCreateRoi.test_center_roi_x_not_none", "experiment.test_detector.TestCreateRoi.test_center_roi_y_wrong_type_str", "experiment.test_detector.TestCreateRoi.test_center_roi_x_wrong_type_float", "experiment.test_detector.TestCreateRoi.test_center_roi_y_not_none", "experiment.test_detector.TestCreateRoi.test_center_roi_x_y_not_none", "experiment.test_detector.TestCreateRoi.test_center_roi_y_wrong_type_float"], "PASS_TO_PASS": ["utils.test_validation.TestValidContainer.test_validcontainer_container_maxlength_equal_minlength_zero", "utils.test_utilities.TestInRange.test_inrange_not_in_range_low_y", "utils.test_validation.TestValidContainer.test_validcontainer_container_max_excluded_complex", "experiment.test_detector.TestDetector.test_sum_roi_list_wrong_type", "experiment.test_detector.TestDetector.test_linearity_correction_correct", "utils.test_validation.TestValidKwargs.test_validkwargs_kwargs_type_dict", "experiment.test_detector.TestDetector.test_datadir_wrong_type", "utils.test_image_registration.TestGetShift3D.test_precision_min_allowed", "utils.test_validation.TestValid1dArray.test_length_wrong_type_float", "utils.test_validation.TestValid1dArray.test_invalid_name", "utils.test_validation.TestValidNdArray.test_fix_shape_wrong_none", "utils.test_validation.TestValidNdArray.test_incompatible_dim", "experiment.test_detector.TestTimepix.test_unbinned_pixel_size_default", "experiment.test_detector.TestCreateDetector.test_create_timepix", "utils.test_image_registration.TestShiftArray3D.test_output_dtype", "experiment.test_detector.TestDetector.test_pixelsize_y", "utils.test_utilities.TestInRange.test_inrange_larger_edge_y", "experiment.test_detector.TestDummy.test_unbinned_pixel_size_wrong_value", "experiment.test_detector.TestDetector.test_sum_roi_none_default_roi_defined", "experiment.test_detector.TestDetector.test_roi_list_wrong_type", "experiment.test_detector.TestDummy.test_unbinned_pixel_size_default", "utils.test_validation.TestValidContainer.test_validcontainer_container_itemtype_collection", "utils.test_validation.TestValidContainer.test_validcontainer_container_itemtype_int", "utils.test_validation.TestValid1dArray.test_minlength_None", "utils.test_validation.TestValidContainer.test_validcontainer_container_dict", "utils.test_validation.TestValidItem.test_validitem_min_included_complex", "experiment.test_detector.TestDetector.test_datadir_none", "experiment.test_detector.TestDetector.test_linearity_correction_none", "experiment.test_detector.TestDetector.test_background_subtraction_none", "experiment.test_detector.TestDetector.test_sample_name_wrong_length", "experiment.test_detector.TestDetector.test_sum_roi_list_wrong_value_decreasing_x", "utils.test_image_registration.TestInterpRgiTranslation2D.test_output_dtype", "utils.test_validation.TestValidNdArray.test_shape_item_none", "utils.test_validation.TestValidContainer.test_validcontainer_container_maxlength_equal_minlength", "utils.test_validation.TestValidItem.test_validitem_max_excluded_invalid", "utils.test_validation.TestValid1dArray.test_allow_none_false", "utils.test_utilities.TestIsFloat.test_string_none", "utils.test_validation.TestValidContainer.test_validcontainer_container_maxlength_negative", "utils.test_validation.TestValidKwargs.test_validkwargs_allowed_kwargs_items_none", "utils.test_utilities.TestInRange.test_inrange_larger_edge_x", "utils.test_validation.TestValidNdArray.test_arrays_None", "experiment.test_detector.TestDetector.test_sample_name_wrong_type", "experiment.test_detector.TestDummy.test_unbinned_pixel_number_wrong_type", "utils.test_image_registration.TestCalcNewPositions.test_wrong_shift_none", "utils.test_parser.TestConfigParser.test_init_file_path_not_existing", "experiment.test_detector.TestDummy.test_unbinned_pixel_number_wrong_value", "utils.test_validation.TestValidItem.test_validitem_allownone_int", "utils.test_image_registration.TestGetShift3D.test_method_support_none", "utils.test_image_registration.TestShiftArray3D.test_method_subpixel", "experiment.test_detector.TestDetector.test_sum_roi_number", "experiment.test_detector.TestDetector.test_roi_correct_tuple", "experiment.test_detector.TestDetector.test_scandir_datadir_defined", "utils.test_image_registration.TestGetShift3D.test_method_support", "utils.test_validation.TestValidContainer.test_validcontainer_container_itemtype_ndarray", "utils.test_parser.TestConfigParser.test_init_file_path_2", "utils.test_validation.TestValidContainer.test_validcontainer_container_wrong_type_real", "experiment.test_detector.TestDetector.test_roi_list_wrong_value_none", "experiment.test_detector.TestDetector.test_rootdir_wrong_length", "utils.test_validation.TestValidContainer.test_validcontainer_container_allownone_none", "experiment.test_detector.TestDetector.test_rootdir_exists", "experiment.test_detector.TestCreateRoi.test_roi_wrong_length", "experiment.test_detector.TestDetector.test_sample_name_None", "experiment.test_detector.TestMaxipix.test_unbinned_pixel_size_default", "experiment.test_detector.TestDetector.test_saturation_correction_shape_mismatch", "utils.test_validation.TestValidNdArray.test_incompatible_shape", "utils.test_validation.TestValidItem.test_validitem_allownone_none", "utils.test_validation.TestValidKwargs.test_validkwargs_valid_kwargs", "experiment.test_detector.TestDetector.test_binning_list_wrong_length", "utils.test_validation.TestValid1dArray.test_minlength_null", "utils.test_validation.TestValid1dArray.test_allowedtypes_float", "utils.test_validation.TestValidItem.test_validitem_min_included", "utils.test_parameters.TestParameters.test_true_expected_1", "utils.test_validation.TestValidNdArray.test_ndim_type_set", "experiment.test_detector.TestDetector.test_template_file_wrong_type", "utils.test_utilities.TestFindFile.test_full_path_to_file", "experiment.test_detector.TestDetector.test_roi_none_default", "experiment.test_detector.TestDummy.test_unbinned_pixel_size_none", "utils.test_validation.TestValidContainer.test_validcontainer_container_min_excluded", "utils.test_validation.TestValid1dArray.test_allowedvalues_correct", "utils.test_utilities.TestInRange.test_inrange_not_in_range_high_y", "utils.test_validation.TestValid1dArray.test_length_negative", "experiment.test_detector.TestDetector.test_saturation_correction_wrong_type", "utils.test_validation.TestValidContainer.test_validcontainer_container_none_not_allowed", "experiment.test_detector.TestDetector.test_mask_detector_linearity_correction", "experiment.test_detector.TestCreateDetector.test_name_wrong_type", "utils.test_validation.TestValidItem.test_validitem_min_excluded_valid", "utils.test_image_registration.TestShiftArray2D.test_method_subpixel", "utils.test_validation.TestValidItem.test_validitem_max_excluded_valid", "utils.test_validation.TestValid1dArray.test_length_null", "utils.test_image_registration.TestGetShift2D.test_precision_float", "utils.test_utilities.TestFindFile.test_filename_file_name_default_dir_inexisting", "experiment.test_detector.TestDetector.test_template_imagefile_correct", "utils.test_validation.TestValidItem.test_validitem_min_excluded_equal", "experiment.test_detector.TestDummy.test_unbinned_pixel_size_no_error", "utils.test_utilities.TestInRange.test_inrange_not_in_range_high_x", "experiment.test_detector.TestDetector.test_background_subtraction_float", "utils.test_utilities.TestInRange.test_inrange_lower_edge_z", "utils.test_parameters.TestParameters.test_none_str_unexpected", "postprocessing.test_facet_analysis.TestInitFacetsParams.test_init_pathdir_none", "utils.test_validation.TestValidContainer.test_validcontainer_minlength", "experiment.test_detector.TestDetector.test_linearity_function_wrong_type", "utils.test_image_registration.TestGetShift3D.test_precision_float", "utils.test_validation.TestValidKwargs.test_validkwargs_wrong_kwargs_type", "experiment.test_detector.TestEiger4M.test_mask_gaps", "utils.test_validation.TestValid1dArray.test_allowedvalues_wrong_type", "experiment.test_detector.TestDetector.test_preprocessing_binning_list_wrong_type", "experiment.test_detector.TestMerlin.test_mask_gaps", "utils.test_utilities.TestInRange.test_inrange_not_in_range_high_z", "utils.test_validation.TestValidKwargs.test_validkwargs_wrong_kwargs_none", "utils.test_validation.TestValidNdArray.test_ndim_shape_none", "experiment.test_detector.TestDetector.test_hotpixels_correction_wrong_value", "utils.test_image_registration.TestGetShift3D.test_wrong_method_name", "utils.test_validation.TestValidContainer.test_validcontainer_container_itemtype", "utils.test_validation.TestValidItem.test_validitem_max_included", "postprocessing.test_facet_analysis.TestInitFacetsParams.test_init_lattice_none", "experiment.test_detector.TestDetector.test_counter_beamline_wrong_type", "experiment.test_detector.TestDetector.test_scandir_datadir_none", "postprocessing.test_postprocessing_utils.Test.test_dummy", "utils.test_image_registration.TestShiftArray2D.test_output_dtype", "utils.test_image_registration.TestGetShift2D.test_precision_None", "utils.test_utilities.TestFindFile.test_filename_file_name_missing_backslash", "utils.test_validation.TestValidContainer.test_validcontainer_container_string_wrong_length", "utils.test_image_registration.TestShiftArray2D.test_method_roll", "experiment.test_detector.TestDummy.test_unbinned_pixel_number_partial_none", "utils.test_validation.TestValidNdArray.test_ndim_type_tuple", "experiment.test_detector.TestDetector.test_flatfield_correction_wrong_ndim", "experiment.test_detector.TestDetector.test_mask_gaps_base_class_wrong_ndim", "experiment.test_detector.TestDetector.test_nb_pixel_y", "experiment.test_detector.TestDetector.test_mask_detector_shape_mismatch", "utils.test_validation.TestValid1dArray.test_allowedtypes_not_type", "experiment.test_detector.TestDetector.test_sum_roi_list_wrong_value_decreasing_y", "experiment.test_detector.TestDetector.test_datadir_correct", "utils.test_utilities.TestIsFloat.test_array", "utils.test_validation.TestValidContainer.test_validcontainer_wrong_length", "experiment.test_detector.TestDetector.test_template_imagefile_wrong_type", "utils.test_validation.TestValidContainer.test_validcontainer_container_max_excluded", "utils.test_validation.TestValidItem.test_validitem_max_included_invalid", "postprocessing.test_facet_analysis.TestInitFacetsParams.test_init_savedir_wrong_type", "experiment.test_detector.TestDetector.test_saturation_correction_nbframes_wrong_value", "utils.test_parameters.TestParameters.test_data_dir_none", "experiment.test_detector.TestDetector.test_saturation_correction_nbframes_wrong_type", "postprocessing.test_facet_analysis.TestInitFacetsParams.test_init_savedir_empty", "utils.test_validation.TestValidNdArray.test_wrong_dim", "experiment.test_detector.TestDetector.test_linearity_correction_wrong_ndim", "graph.test_graph_utils.TestSaveToVti.test_savetovti_voxelsize_negative", "experiment.test_detector.TestCreateRoi.test_not_a_dict", "utils.test_validation.TestValidItem.test_validitem_min_excluded_invalid", "utils.test_validation.TestValidNdArray.test_ndim_null", "utils.test_image_registration.TestGetShift2D.test_precision_min_allowed", "xcca.test_xcca_utils.Test.test_dummy", "utils.test_utilities.TestFindFile.test_filename_file_name_inexisting_default_dir_existing", "experiment.test_detector.TestDetector.test_background_subtraction_wrong_ndim", "utils.test_validation.TestValidItem.test_validitem_min_included_string", "utils.test_validation.TestValidNdArray.test_incompatible_mixed_ndim", "utils.test_image_registration.TestShiftArray3D.test_method_roll", "simulation.test_supportMaker.Test.test_dummy", "experiment.test_detector.TestEiger2M.test_unbinned_pixel_size_default", "postprocessing.test_facet_analysis.TestInitFacetsParams.test_init_filename_wrong_type", "utils.test_validation.TestValidContainer.test_validcontainer_container_tuple", "experiment.test_detector.TestDetector.test_flatfield_correction_wrong_type", "utils.test_parameters.TestParameters.test_false_expected_1", "experiment.test_detector.TestDetector.test_flatfield_correction_correct", "experiment.test_detector.TestDetector.test_background_subtraction_wrong_shape", "utils.test_validation.TestValidItem.test_validitem_min_excluded", "utils.test_validation.TestValid1dArray.test_allowedvalues_wrong_value", "utils.test_validation.TestValidItem.test_validitem_max_included_equal", "utils.test_validation.TestValidContainer.test_validcontainer_container_string", "experiment.test_detector.TestDetector.test_rootdir_not_exist", "experiment.test_detector.TestDetector.test_preprocessing_binning_correct", "postprocessing.test_facet_analysis.TestInitFacetsParams.test_init_pathdir_wrong_type", "utils.test_validation.TestValid1dArray.test_allowedtypes_integral", "utils.test_validation.TestValidNdArray.test_shape_wrong_type_number", "experiment.test_detector.TestDetector.test_background_subtraction_wrong_type", "experiment.test_detector.TestCreateDetector.test_create_eiger2m", "utils.test_validation.TestValid1dArray.test_minlength_equal_length", "experiment.test_detector.TestDetector.test_roi_list_wrong_value_decreasing_y", "utils.test_validation.TestValidItem.test_validitem_max_excluded_complex", "utils.test_utilities.TestInRange.test_inrange_lower_edge_x", "experiment.test_detector.TestDetector.test_name", "experiment.test_detector.TestDetector.test_linearity_function_none", "experiment.test_detector.TestDetector.test_linearity_correction_zero", "utils.test_validation.TestValidNdArray.test_fix_shape_wrong_type", "utils.test_parameters.TestParameters.test_false_expected_2", "utils.test_validation.TestValidContainer.test_validcontainer_container_type", "experiment.test_detector.TestDetector.test_template_file_correct", "experiment.test_detector.TestCreateRoi.test_roi_none", "utils.test_validation.TestValidNdArray.test_arrays_mixed_types_int", "utils.test_validation.TestValidContainer.test_validcontainer_container_string_length", "graph.test_graph_utils.TestSaveToVti.test_savetovti_amp", "utils.test_validation.TestValid1dArray.test_allow_none_true", "utils.test_parser.TestConfigParser.test_filter_dict_filter_value", "experiment.test_detector.TestDetector.test_flatfield_correction_wrong_shape", "utils.test_validation.TestValidContainer.test_validcontainer_container_maxlength_smaller_than_minlength", "experiment.test_detector.TestCreateDetector.test_create_dummy", "utils.test_utilities.TestIsFloat.test_string_int", "experiment.test_detector.TestCreateDetector.test_create_unknown_detector", "utils.test_validation.TestValidNdArray.test_ndim_negative", "utils.test_validation.TestValidKwargs.test_validkwargs_invalid_kwargs", "utils.test_validation.TestValidContainer.test_validcontainer_allownone", "utils.test_validation.TestValidContainer.test_validcontainer_wrong_minlength", "utils.test_parser.TestConfigParser.test_init_command_line_args_none", "experiment.test_detector.TestDetector.test_repr", "experiment.test_detector.TestDetector.test_mask_gaps_base_class_wrong_type", "utils.test_validation.TestValidContainer.test_validcontainer_container_min_excluded_complex", "experiment.test_detector.TestDetector.test_mask_detector_wrong_type", "experiment.test_detector.TestDetector.test_linearity_correction_correct_3", "utils.test_validation.TestValidNdArray.test_ndim_type_list", "experiment.test_detector.TestDetector.test_roi_number", "utils.test_image_registration.TestInterpRgiTranslation3D.test_method_rgi", "utils.test_utilities.TestInRange.test_inrange_in_range", "utils.test_validation.TestValid1dArray.test_allowedtypes_none", "experiment.test_detector.TestDetector.test_hotpixels_correction_wrong_type", "utils.test_validation.TestValid1dArray.test_allow_none_wrong_type_float", "utils.test_validation.TestValidItem.test_validitem_max_included_complex", "utils.test_image_registration.TestInterpRgiTranslation3D.test_output_dtype", "experiment.test_detector.TestDetector.test_datadir_not_exist", "experiment.test_detector.TestDetector.test_preprocessing_binning_list_wrong_value", "utils.test_parser.TestConfigParser.test_filter_dict", "utils.test_validation.TestValidItem.test_validitem_max_excluded_equal", "utils.test_validation.TestValidKwargs.test_validkwargs_invalid_name", "experiment.test_detector.TestDetector.test_mask_detector_no_linearity_correction", "utils.test_validation.TestValidContainer.test_validcontainer_container_min_included_complex", "utils.test_validation.TestValidContainer.test_validcontainer_container_max_included_complex", "experiment.test_detector.TestDetector.test_sum_roi_list_wrong_value_none", "experiment.test_detector.TestEiger4M.test_unbinned_pixel_size_default", "experiment.test_detector.TestEiger2M.test_mask_gaps", "utils.test_validation.TestValidItem.test_validitem_allownone_true", "experiment.test_detector.TestDetector.test_mask_gaps_base_class_wrong_shape", "experiment.test_detector.TestDetector.test_hotpixels_correction_none", "utils.test_validation.TestValidItem.test_validitem_max_included_valid", "utils.test_validation.TestValidContainer.test_validcontainer_container_set", "experiment.test_detector.TestEiger4M.test_unbinned_pixel_number_default", "utils.test_validation.TestValid1dArray.test_allowedvalues_array", "utils.test_validation.TestValidContainer.test_validcontainer_container_minlength_negative", "utils.test_validation.TestValidKwargs.test_validkwargs_allowed_kwargs_items_length", "utils.test_parameters.TestParameters.test_true_expected_2", "utils.test_image_registration.TestCalcNewPositions.test_ndim_no_shift", "utils.test_image_registration.TestGetShift2D.test_method_raw", "experiment.test_detector.TestDetector.test_mask_detector_invalid_shape", "utils.test_validation.TestValidNdArray.test_arrays_is_ndarray", "experiment.test_detector.TestDetector.test_nb_pixel_x", "utils.test_image_registration.TestGetShift3D.test_method_raw", "utils.test_image_registration.TestInterpRgiTranslation2D.test_method_rgi", "experiment.test_detector.TestDetector.test_nb_pixel_y_truncated", "utils.test_parameters.TestParameters.test_false_expected_3", "utils.test_utilities.TestInRange.test_inrange_lower_edge_y", "utils.test_validation.TestValidKwargs.test_validkwargs_allowed_kwargs_dict", "postprocessing.test_facet_analysis.TestInitFacetsParams.test_init_filename_none", "experiment.test_detector.TestEiger2M.test_unbinned_pixel_number_default", "postprocessing.test_facet_analysis.TestInitFacetsParams.test_init_filename_empty", "simulation.test_simulation_utils.Test.test_dummy", "utils.test_parser.TestConfigParser.test_init_command_line_args", "utils.test_image_registration.TestGetShift2D.test_method_modulus", "utils.test_validation.TestValidContainer.test_validcontainer_container_dict_itemtype_int", "postprocessing.test_facet_analysis.TestInitFacetsParams.test_init_lattice_str", "utils.test_validation.TestValidContainer.test_validcontainer_container_maxlength_larger_than_minlength", "utils.test_validation.TestValidContainer.test_validcontainer_container_dict_wrong_length", "utils.test_validation.TestValidContainer.test_validcontainer_length", "utils.test_validation.TestValidNdArray.test_arrays_empty", "utils.test_validation.TestValidItem.test_validitem_allowedtypes_none", "experiment.test_detector.TestCreateDetector.test_create_eiger4m", "utils.test_image_registration.TestCalcNewPositions.test_ndim_with_shift", "utils.test_validation.TestValidContainer.test_validcontainer_container_list", "experiment.test_detector.TestDetector.test_preprocessing_binning_number", "experiment.test_detector.TestCreateDetector.test_name_missing", "graph.test_graph_utils.TestSaveToVti.test_savetovti_array_dim", "facet_recognition.test_facet_utils.Test.test_dummy", "utils.test_parameters.TestParameters.test_data_dir_not_existing", "experiment.test_detector.TestCreateRoi.test_roi_wrong_type", "utils.test_validation.TestValidNdArray.test_fix_ndim_wrong_type", "experiment.test_detector.TestDetector.test_binning_list_wrong_value_none", "utils.test_validation.TestValid1dArray.test_minlength_wrong_type_float", "utils.test_validation.TestValid1dArray.test_minlength_negative", "utils.test_validation.TestValidItem.test_validitem_allowedtypes_bool", "experiment.test_detector.TestDummy.test_unbinned_pixel_number_no_error", "experiment.test_detector.TestDetector.test_preprocessing_binning_none_default", "utils.test_validation.TestValidContainer.test_validcontainer_invalid_name", "utils.test_validation.TestValidContainer.test_validcontainer_container_length_float", "utils.test_validation.TestValid1dArray.test_length_None", "utils.test_validation.TestValid1dArray.test_allow_none_wrong_type_string", "experiment.test_detector.TestDummy.test_unbinned_pixel_number_default", "utils.test_validation.TestValidItem.test_validitem_allownone", "utils.test_validation.TestValidContainer.test_validcontainer_container_itemtype_none", "utils.test_validation.TestValidContainer.test_validcontainer_container_max_included", "experiment.test_detector.TestDetector.test_counter_beamline_supported", "experiment.test_detector.TestTimepix.test_unbinned_pixel_number_default", "utils.test_utilities.TestInRange.test_inrange_not_in_range_low_z", "utils.test_image_registration.TestShiftArray2D.test_method_rgi", "utils.test_validation.TestValid1dArray.test_allowedtypes_wrongtype", "graph.test_graph_utils.TestSaveToVti.test_savetovti_no_amp", "experiment.test_detector.TestDummy.test_unbinned_pixel_size_wrong_type", "utils.test_image_registration.TestShiftArray3D.test_method_rgi", "experiment.test_detector.TestDetector.test_rootdir_None", "graph.test_graph_utils.TestSaveToVti.test_savetovti_array_shape", "postprocessing.test_facet_analysis.TestInitFacetsParams.test_init_pathdir_empty", "utils.test_utilities.TestIsFloat.test_none", "utils.test_validation.TestValidContainer.test_validcontainer_container_length_null", "experiment.test_detector.TestMerlin.test_unbinned_pixel_number_default", "utils.test_validation.TestValidContainer.test_validcontainer_container_wrong_type", "utils.test_image_registration.TestGetShift3D.test_precision_null", "experiment.test_detector.TestDetector.test_counter_beamline_not_supported", "experiment.test_detector.TestDetector.test_saturation_correction_wrong_ndim", "utils.test_validation.TestValidContainer.test_validcontainer_container_maxlength_wrong_length", "experiment.test_detector.TestDetector.test_binning_number", "utils.test_validation.TestValidNdArray.test_invalid_name", "experiment.test_detector.TestDetector.test_sum_roi_empty_list", "utils.test_validation.TestValidContainer.test_validcontainer_container_minlength_float", "experiment.test_detector.TestMerlin.test_unbinned_pixel_size_default", "experiment.test_detector.TestDetector.test_binning_none", "utils.test_validation.TestValid1dArray.test_allowedvalues_set", "experiment.test_detector.TestDetector.test_preprocessing_binning_list_wrong_length", "experiment.test_detector.TestMaxipix.test_unbinned_pixel_number_default", "utils.test_parser.TestConfigParser.test_load_arguments", "experiment.test_detector.TestMaxipix.test_mask_gaps", "utils.test_utilities.TestFindFile.test_filename_file_name_default_dir_none", "experiment.test_detector.TestDetector.test_background_subtraction_correct", "utils.test_parameters.TestParameters.test_true_expected_3", "experiment.test_detector.TestDetector.test_sum_roi_list_wrong_length", "experiment.test_detector.TestDetector.test_template_file_None", "utils.test_validation.TestValidKwargs.test_validkwargs_allowed_kwargs_items_type", "utils.test_validation.TestValidNdArray.test_ndim_none", "utils.test_validation.TestValidNdArray.test_ndim_wrong_type_float", "experiment.test_detector.TestDetector.test_binning_list_wrong_value", "experiment.test_detector.TestDetector.test_roi_list_wrong_value_decreasing_x", "experiment.test_detector.TestDetector.test_mask_detector_wrong_ndim", "utils.test_validation.TestValidItem.test_validitem_min_included_valid", "utils.test_validation.TestValidItem.test_validitem_allowedtypes_not_type", "utils.test_validation.TestValidNdArray.test_arrays_mixed_types_none", "utils.test_parameters.TestParameters.test_data_dir_existing", "algorithms.test_algorithms_utils.Test.test_dummy", "utils.test_validation.TestValidItem.test_validitem_min_included_invalid", "utils.test_utilities.TestIsFloat.test_string_float", "experiment.test_detector.TestDetector.test_hotpixels_correction_wrong_ndim", "utils.test_validation.TestValidContainer.test_validcontainer_container_types_none", "utils.test_validation.TestValidKwargs.test_validkwargs_allowed_kwargs_empty", "experiment.test_detector.TestDetector.test_sample_name_correct", "utils.test_image_registration.TestGetShift2D.test_wrong_method_name", "utils.test_validation.TestValidNdArray.test_shape_none", "utils.test_validation.TestValidItem.test_validitem_min_excluded_complex", "experiment.test_detector.TestCreateDetector.test_name_wrong_none", "graph.test_graph_utils.TestSaveToVti.test_savetovti_fieldnames_wrongtype", "utils.test_image_registration.TestCalcNewPositions.test_empty_positions", "experiment.test_detector.TestDetector.test_hotpixels_correction_correct", "utils.test_validation.TestValidItem.test_validitem_allownone_false", "utils.test_validation.TestValid1dArray.test_allowedvalues_list", "utils.test_validation.TestValidItem.test_validitem_max_excluded", "experiment.test_detector.TestDetector.test_saturation_correction_edge_case", "experiment.test_detector.TestDetector.test_create_detector_from_abc", "utils.test_parser.TestConfigParser.test_init_file_path", "experiment.test_detector.TestCreateDetector.test_create_maxipix", "utils.test_validation.TestValidContainer.test_validcontainer_container_maxlength_float", "utils.test_utilities.TestInRange.test_inrange_not_in_range_low_x", "utils.test_validation.TestValidItem.test_validitem_invalid_name", "utils.test_parser.TestConfigParser.test_init_raw_config", "utils.test_validation.TestValidContainer.test_validcontainer_container_min_included", "experiment.test_detector.TestDetector.test_preprocessing_binning_list_wrong_value_none", "utils.test_validation.TestValidContainer.test_validcontainer_container_allownone", "utils.test_image_registration.TestCalcNewPositions.test_wrong_shift_length", "utils.test_image_registration.TestGetShift3D.test_method_modulus", "utils.test_parser.TestConfigParser.test_init_file_path_wrong_file_extension", "experiment.test_detector.TestDetector.test_template_imagefile_None", "utils.test_image_registration.TestGetShift2D.test_method_support_none", "utils.test_image_registration.TestGetShift3D.test_precision_None", "utils.test_validation.TestValidItem.test_validitem_min_included_equal", "experiment.test_detector.TestDetector.test_flatfield_correction_float", "experiment.test_detector.TestDetector.test_rootdir_wrong_type", "utils.test_utilities.TestInRange.test_inrange_larger_edge_z", "utils.test_utilities.TestFindFile.test_filename_file_name", "utils.test_validation.TestValidItem.test_validitem_allowedtypes_ndarray", "experiment.test_rotation_matrix.Test.test_instantiation_missing_parameter", "utils.test_validation.TestValidItem.test_validitem_allowedtypes_bool_wrongtype", "utils.test_validation.TestValidNdArray.test_compatible_mixed_ndim", "utils.test_parameters.TestParameters.test_none_str_expected", "experiment.test_detector.TestDetector.test_linearity_correction_correct_2", "experiment.test_detector.TestDetector.test_roi_list_wrong_length", "utils.test_validation.TestValidNdArray.test_fix_shape_false", "utils.test_validation.TestValidNdArray.test_fix_ndim_wrong_none", "graph.test_graph_utils.TestSaveToVti.test_savetovti_voxelsize_wrong_shape", "utils.test_parser.TestConfigParser.test_init_file_path_wrong_type", "utils.test_validation.TestValidContainer.test_validcontainer_notallownone", "utils.test_utilities.TestFindFile.test_filename_none", "utils.test_validation.TestValidContainer.test_validcontainer_container_allownone_int", "experiment.test_detector.TestDetector.test_mask_gaps_base_class", "experiment.test_detector.TestDetector.test_saturation_correction_above", "experiment.test_detector.TestDetector.test_params", "utils.test_image_registration.TestGetShift2D.test_precision_null", "utils.test_validation.TestValidKwargs.test_validkwargs_allowed_kwargs_length", "experiment.test_detector.TestDetector.test_binning_list_wrong_type", "utils.test_image_registration.TestGetShift2D.test_method_support", "utils.test_validation.TestValidContainer.test_validcontainer_container_none_allowed", "experiment.test_detector.TestCreateDetector.test_create_merlin", "experiment.test_detector.TestDetector.test_flatfield_correction_none", "postprocessing.test_facet_analysis.TestInitFacetsParams.test_init_lattice_int", "experiment.test_detector.TestDetector.test_saturation_correction_nbframes_2", "experiment.test_detector.TestDetector.test_binning_correct", "utils.test_utilities.TestIsFloat.test_string_complex", "experiment.test_detector.TestDetector.test_hotpixels_correction_wrong_shape", "utils.test_validation.TestValidContainer.test_validcontainer_container_length_negative", "experiment.test_detector.TestDetector.test_pixelsize_x", "utils.test_utilities.TestIsFloat.test_string_not_numeric", "experiment.test_detector.TestDetector.test_sum_roi_none_default"], "language": "python", "test_command": "source /saved/ENV || source /saved/*/ENV && /bin/python3 /app/repo/unittest_loader_no_traceback.py ./tests", "test_output_parser": "python/parse_log_unittest", "image_storage_uri": "vmvm-registry.fbinfra.net/repomate_image_activ_python_unittest/carnisj_bcdi:e7fabdc71f958a82fe7f5f43fcce618955ae7b49", "patch": "", "test_patch": "[\"diff --git a/bcdi/postprocessing/facet_analysis.py b/bcdi/postprocessing/facet_analysis.py\\nindex 7aec6c9..a71a2aa 100644\\n--- a/bcdi/postprocessing/facet_analysis.py\\n+++ b/bcdi/postprocessing/facet_analysis.py\\n@@ -18,7 +18,7 @@ import numpy as np\\n import pathlib\\n import pandas as pd\\n from pandas import DataFrame\\n-from typing import Any, Dict, List, Optional, Tuple, Union\\n+from typing import Any, Dict, List, no_type_check, Optional, Tuple, Union\\n import vtk\\n \\n from bcdi.utils import validation as valid\\n@@ -366,7 +366,7 @@ class Facets:\\n         inv_tensor1 = np.linalg.inv(tensor1)\\n         self.rotation_matrix = np.dot(np.transpose(tensor0), np.transpose(inv_tensor1))\\n \\n-    def rotate_particle(self) -> None:\\n+    def rotate_particle(self):\\n         \\\"\\\"\\\"\\n         Rotate the nanocrystal.\\n \\n@@ -402,6 +402,7 @@ class Facets:\\n                 [\\\"{:.2f}\\\".format(e) for e in v]\\n             )\\n \\n+    @no_type_check\\n     def fixed_reference(\\n         self,\\n         hkl_reference: Tuple[float, float, float] = (1, 1, 1),\\n@@ -529,14 +530,13 @@ class Facets:\\n \\n             ax.set_xticks(major_ticks)\\n             ax.set_xticks(minor_ticks, minor=True)\\n-            # ax.set_yticks(major_ticks)\\n-            # ax.set_yticks(minor_ticks, minor=True)\\n \\n             # Or if you want different settings for the grids:\\n             ax.grid(which=\\\"minor\\\", alpha=0.2)\\n             ax.grid(which=\\\"major\\\", alpha=0.5)\\n             plt.show()\\n \\n+    @no_type_check\\n     def test_vector(self, vec: np.ndarray) -> None:\\n         \\\"\\\"\\\"\\n         Computes value of a vector passed through the rotation matrix.\\n@@ -667,7 +667,6 @@ class Facets:\\n                 pass  # we are on the corners and edges\\n             except Exception as e:\\n                 raise e\\n-                # pass\\n \\n         if not output:\\n             return None\\n@@ -843,6 +842,7 @@ class Facets:\\n         plt.tight_layout()\\n         plt.show()\\n \\n+    @no_type_check\\n     def plot_strain(\\n         self,\\n         figsize: Tuple[float, float] = (12, 10),\\n@@ -953,6 +953,7 @@ class Facets:\\n             plt.savefig(self.pathsave + fig_name + \\\".png\\\", bbox_inches=\\\"tight\\\")\\n         plt.show()\\n \\n+    @no_type_check\\n     def plot_displacement(\\n         self,\\n         figsize: Tuple[float, float] = (12, 10),\\n\",\"diff --git a/conf/config_preprocessing.yml b/conf/config_preprocessing.yml\\nindex 02efe16..b478b6c 100644\\n--- a/conf/config_preprocessing.yml\\n+++ b/conf/config_preprocessing.yml\\n@@ -1,14 +1,14 @@\\n-scans: 622  # scan number or list of scan numbers\\n-root_folder: \\\"C:/Users/Jerome/Documents/data/dataset_34ID/IzrO/\\\"\\n+scans: 76  # scan number or list of scan numbers\\n+root_folder: \\\"C:/Users/Jerome/Documents/data/dataset_P10/\\\"\\n # folder of the experiment, where all scans are stored\\n-save_dir: \\\"C:/Users/Jerome/Documents/data/dataset_34ID/IzrO/test/\\\"\\n+save_dir: \\\"C:/Users/Jerome/Documents/data/dataset_P10/test/\\\"\\n # images will be saved here, leave it to None otherwise\\n data_dir: None  # leave None to use the beamline default,\\n # '' empty string when there is no subfolder\\n # (data directly in the scan folder), or a non-empty string for the subfolder name\\n # (default to scan_folder/pynx/ or scan_folder/pynxraw/\\n # depending on the setting of use_rawdata)\\n-sample_name: \\\"S\\\"  # str or list of str of sample names\\n+sample_name: \\\"B15_syn_S1_2\\\"  # str or list of str of sample names\\n # (string in front of the scan number in the folder name).\\n # If only one name is indicated, it will be repeated to match the number of scans.\\n comment: \\\"\\\"  # string, should start with \\\"_\\\"\\n@@ -16,17 +16,14 @@ debug: False  # set to True to see plots\\n ##############################\\n # parameters used in masking #\\n ##############################\\n-flag_interact: True  # True to interact with plots, False to close it automatically\\n+flag_interact: False  # True to interact with plots, False to close it automatically\\n background_plot: \\\"0.5\\\"  # in level of grey in [0,1], 0 being dark.\\n # For visual comfort during masking\\n #########################################################\\n # parameters related to data cropping/padding/centering #\\n #########################################################\\n centering_method: \\\"max\\\"  # Bragg peak determination: 'max' or 'com', 'max' is better usually.\\n-#  It will be overridden by 'fix_bragg' if not empty\\n-fix_bragg: None  # fix the Bragg peak position [z_bragg, y_bragg, x_bragg]\\n-# considering the full detector\\n-# It is useful if hotpixels or intense aliens. Leave None otherwise.\\n+#  It will be overridden by 'bragg_peak' if not empty\\n fix_size: None  # crop the array to predefined size considering the full detector,\\n # leave None otherwise [zstart, zstop, ystart, ystop, xstart, xstop].\\n # ROI will be defaulted to []\\n@@ -67,7 +64,7 @@ save_as_int: False\\n ######################################\\n # define beamline related parameters #\\n ######################################\\n-beamline: \\\"34ID\\\"\\n+beamline: \\\"P10\\\"\\n # name of the beamline, used for data loading and normalization by monitor\\n # supported beamlines: 'ID01', 'SIXS_2018', 'SIXS_2019', 'CRISTAL', 'P10',\\n # 'NANOMAX', '34ID'\\n@@ -76,9 +73,9 @@ actuators: None  # {'rocking_angle': 'actuator_1_1'}\\n # actuators in data files (useful at CRISTAL where the location of data keeps changing)\\n # e.g.  {'rocking_angle': 'actuator_1_3', 'detector': 'data_04', 'monitor': 'data_05'}\\n is_series: True  # specific to series measurement at P10\\n-rocking_angle: \\\"inplane\\\"  # \\\"outofplane\\\" for a sample rotation around x outboard,\\n+rocking_angle: \\\"outofplane\\\"  # \\\"outofplane\\\" for a sample rotation around x outboard,\\n # \\\"inplane\\\" for a sample rotation around y vertical up, \\\"energy\\\"\\n-specfile_name: \\\"Dmitry1120c.spec\\\"\\n+specfile_name: None\\n # template for ID01 and 34ID: name of the spec file if it is at the default location\\n # (in root_folder) or full path to the spec file\\n # template for SIXS: full path of the alias dictionnary or None to use the one in the\\n@@ -99,23 +96,23 @@ custom_monitor: None\\n ###############################\\n # detector related parameters #\\n ###############################\\n-detector: \\\"Timepix\\\"  # \\\"Eiger2M\\\", \\\"Maxipix\\\", \\\"Eiger4M\\\", \\\"Merlin\\\" or \\\"Timepix\\\"\\n-phasing_binning: [1, 1, 1]  # binning to apply to the data\\n+detector: \\\"Eiger4M\\\"  # \\\"Eiger2M\\\", \\\"Maxipix\\\", \\\"Eiger4M\\\", \\\"Merlin\\\" or \\\"Timepix\\\"\\n+phasing_binning: [1, 2, 2]  # binning to apply to the data\\n # (stacking dimension, detector vertical axis, detector horizontal axis)\\n linearity_func: None\\n # [a, b, c, d, e] tuple of 5 numbers corresponding to the coefficients of the 4th order\\n # polynomial ax^4 + bx^3 + cx^2 + dx + e which it used to correct the non-linearity of\\n # the detector at high intensities. Leave None otherwise.\\n-x_bragg: None  # horizontal pixel number of the Bragg peak,\\n-# can be used for the definition of the ROI\\n-y_bragg: None  # vertical pixel number of the Bragg peak,\\n-# can be used for the definition of the ROI\\n-roi_detector: None\\n-# [Vstart, Vstop, Hstart, Hstop]. If \\\"x_bragg\\\" or \\\"y_bragg\\\" are not None, it will\\n-# consider that the current values in roi_detector define a window around the Bragg\\n-# peak position and the final output will be\\n-# [y_bragg - roi_detector[0], y_bragg + roi_detector[1],\\n-# x_bragg - roi_detector[2], x_bragg + roi_detector[3]].\\n+center_roi_x: 1577  # horizontal pixel number of the center of the ROI for data\\n+# loading, leave None to use the full detector\\n+center_roi_y: 833  # vertical pixel number of the center of the ROI for data\\n+# loading, leave None to use the full detector\\n+roi_detector: [200, 200, 250, 250]\\n+# [Vstart, Vstop, Hstart, Hstop]. If \\\"center_roi_x\\\" or \\\"center_roi_y\\\" are not None,\\n+# it will consider that the current values in roi_detector define a window around the\\n+# pixel [center_roi_y, center_roi_x] and the final output will be\\n+# [center_roi_y - roi_detector[0], center_roi_y + roi_detector[1],\\n+# center_roi_x - roi_detector[2], center_roi_x + roi_detector[3]].\\n # leave None to use the full detector.\\n # Use with center_fft='skip' if you want this exact size.\\n normalize_flux: \\\"monitor\\\"  # 'skip'  # 'monitor' to normalize the intensity by\\n@@ -125,7 +122,7 @@ photon_filter: \\\"loading\\\"  # 'loading' or 'postprocessing',\\n # when the photon threshold should be applied\\n # if 'loading', it is applied before binning; if 'postprocessing',\\n # it is applied at the end of the script before saving\\n-bin_during_loading: False  # True to bin during loading, faster\\n+bin_during_loading: True  # True to bin during loading, faster\\n frames_pattern: None\\n # list of int, of length data.shape[0]. If frames_pattern is 0 at index,\\n # the frame at data[index] will be skipped, if 1 the frame will be added to the stack.\\n@@ -133,7 +130,7 @@ frames_pattern: None\\n background_file: None  # non-empty file path or None\\n hotpixels_file: None  # non-empty file path or None\\n flatfield_file: None  # non-empty file path or None\\n-template_imagefile: \\\"Dmitry1120c_S0622_%05d.tif\\\"\\n+template_imagefile: '_master.h5'\\n # template for ID01: 'data_mpx4_%05d.edf.gz' or 'align_eiger2M_%05d.edf.gz'\\n # template for SIXS_2018: 'align.spec_ascan_mu_%05d.nxs'\\n # template for SIXS_2019: 'spare_ascan_mu_%05d.nxs'\\n@@ -158,8 +155,8 @@ sample_offsets: None\\n # tuple of offsets in degrees of the sample for each sample circle (outer first).\\n # convention: the sample offsets will be subtracted to the motor values.\\n # Leave None if no offset.\\n-sdd: 0.50678  # in m, sample to detector distance in m\\n-energy: 9000  # np.linspace(11100, 10900, num=51)  # x-ray energy in eV\\n+sdd: 1.84 # in m, sample to detector distance in m\\n+energy: None  # np.linspace(11100, 10900, num=51)  # x-ray energy in eV\\n custom_motors: None\\n # {\\\"mu\\\": 0, \\\"phi\\\": -15.98, \\\"chi\\\": 90, \\\"theta\\\": 0, \\\"delta\\\": -0.5685, \\\"gamma\\\": 33.3147}\\n # use this to declare motor positions if there is not log file, None otherwise\\n@@ -180,10 +177,20 @@ align_q: True  # used only when interp_method is 'linearization',\\n # if True it rotates the crystal to align q\\n # along one axis of the array\\n ref_axis_q: \\\"y\\\"  # q will be aligned along that axis\\n-outofplane_angle: 42.6093\\n+bragg_peak: [73, 839, 1589]  # list of three integers, position of the Bragg peak on the unbinned\\n+# and full-sized detector. It will be used to calculate the real detector angles for the\\n+# and full-sized detector. It will be used to calculate the real detector angles for the\\n+# measured Bragg peak. Leave None to determine the Bragg peak position automatically.\\n+direct_beam: [1055, 1339.5]  # [vertical, horizontal]\\n+# direct beam position on the unbinned, full detector measured\\n+# with detector angles given by dirbeam_detector_angles. It will be used to calculate\\n+# the real detector angles for the measured Bragg peak. Leave None for no correction.\\n+dirbeam_detector_angles: [0, 0]  # [outofplane, inplane] detector angles in degrees\\n+# for the direct beam measurement. Leave None for no correction.\\n+outofplane_angle: None # 42.6093\\n # detector angle in deg (rotation around x outboard, typically delta),\\n # corrected for the direct beam position. Leave None to use the uncorrected position.\\n-inplane_angle: -0.5783\\n+inplane_angle: None # -0.5783\\n # detector angle in deg(rotation around y vertical up, typically gamma),\\n # corrected for the direct beam position. Leave None to use the uncorrected position.\\n ################################################################################\\n\",\"diff --git a/tests/experiment/test_detector.py b/tests/experiment/test_detector.py\\nindex 234dd67..147d8af 100644\\n--- a/tests/experiment/test_detector.py\\n+++ b/tests/experiment/test_detector.py\\n@@ -90,43 +90,46 @@ class TestCreateRoi(unittest.TestCase):\\n         with self.assertRaises(TypeError):\\n             create_roi({\\\"roi_detector\\\": \\\"[1, 2, 3, 4]\\\"})\\n \\n-    def test_xbragg_ybragg_none(self):\\n+    def test_center_roi_x_center_roi_y_none(self):\\n         roi = [10, 200, 20, 50]\\n         output = create_roi({\\\"roi_detector\\\": roi})\\n         self.assertTrue(all(out == roi[idx] for idx, out in enumerate(output)))\\n \\n-    def test_xbragg_not_none(self):\\n+    def test_center_roi_x_not_none(self):\\n         roi = [10, 200, 20, 50]\\n         correct = [10, 200, 130, 200]\\n-        output = create_roi({\\\"roi_detector\\\": roi, \\\"x_bragg\\\": 150})\\n+        output = create_roi({\\\"roi_detector\\\": roi, \\\"center_roi_x\\\": 150})\\n         self.assertTrue(all(out == correct[idx] for idx, out in enumerate(output)))\\n \\n-    def test_xbragg_wrong_type_str(self):\\n+    def test_center_roi_x_wrong_type_str(self):\\n         with self.assertRaises(TypeError):\\n-            create_roi({\\\"roi_detector\\\": [10, 200, 20, 50], \\\"x_bragg\\\": \\\"150\\\"})\\n+            create_roi({\\\"roi_detector\\\": [10, 200, 20, 50], \\\"center_roi_x\\\": \\\"150\\\"})\\n \\n-    def test_xbragg_wrong_type_float(self):\\n+    def test_center_roi_x_wrong_type_float(self):\\n         with self.assertRaises(TypeError):\\n-            create_roi({\\\"roi_detector\\\": [10, 200, 20, 50], \\\"x_bragg\\\": 1.5})\\n+            create_roi({\\\"roi_detector\\\": [10, 200, 20, 50], \\\"center_roi_x\\\": 1.5})\\n \\n-    def test_ybragg_wrong_type_str(self):\\n+    def test_center_roi_y_wrong_type_str(self):\\n         with self.assertRaises(TypeError):\\n-            create_roi({\\\"roi_detector\\\": [10, 200, 20, 50], \\\"y_bragg\\\": \\\"150\\\"})\\n+            create_roi({\\\"roi_detector\\\": [10, 200, 20, 50], \\\"center_roi_y\\\": \\\"150\\\"})\\n \\n-    def test_ybragg_wrong_type_float(self):\\n+    def test_center_roi_y_wrong_type_float(self):\\n         with self.assertRaises(TypeError):\\n-            create_roi({\\\"roi_detector\\\": [10, 200, 20, 50], \\\"y_bragg\\\": 1.5})\\n+            create_roi({\\\"roi_detector\\\": [10, 200, 20, 50], \\\"center_roi_y\\\": 1.5})\\n \\n-    def test_ybragg_not_none(self):\\n+    def test_center_roi_y_not_none(self):\\n         roi = [10, 200, 20, 50]\\n         correct = [140, 350, 20, 50]\\n-        output = create_roi({\\\"roi_detector\\\": roi, \\\"y_bragg\\\": 150})\\n+        output = create_roi({\\\"roi_detector\\\": roi, \\\"center_roi_y\\\": 150})\\n         self.assertTrue(all(out == correct[idx] for idx, out in enumerate(output)))\\n \\n-    def test_x_bragg_ybragg_not_none(self):\\n+    def test_center_roi_x_y_not_none(self):\\n         roi = [10, 200, 20, 50]\\n         correct = [140, 350, -10, 60]\\n-        output = create_roi({\\\"roi_detector\\\": roi, \\\"y_bragg\\\": 150, \\\"x_bragg\\\": 10})\\n+        output = create_roi(\\n+            {\\\"roi_detector\\\": roi, \\\"center_roi_y\\\": 150, \\\"center_roi_x\\\": 10}\\n+        )\\n+        print(output)\\n         self.assertTrue(all(out == correct[idx] for idx, out in enumerate(output)))\\n \\n \\n\",\"diff --git a/tests/experiment/test_setup.py b/tests/experiment/test_setup.py\\nindex d95abb4..992458f 100644\\n--- a/tests/experiment/test_setup.py\\n+++ b/tests/experiment/test_setup.py\\n@@ -156,6 +156,113 @@ class TestCheckSetup(unittest.TestCase):\\n         self.assertEqual(self.setup.grazing_angle, None)\\n \\n \\n+class TestCorrectDirectBeam(unittest.TestCase):\\n+    \\\"\\\"\\\"\\n+    Tests related to correct_direct_beam.\\n+\\n+    def correct_direct_beam(\\n+            self, direct_beam: Optional[List[Real]]\\n+    ) -> Optional[Tuple[Real, ...]]:\\n+    \\\"\\\"\\\"\\n+\\n+    def setUp(self) -> None:\\n+        self.setup = Setup(\\n+            beamline=\\\"ID01\\\",\\n+            direct_beam=[12, 324],\\n+            dirbeam_detector_angles=[-1, 1],\\n+            distance=1.23,\\n+        )\\n+\\n+    def test_direct_beam_none(self):\\n+        self.setup.direct_beam = None\\n+        self.assertTrue(self.setup.correct_direct_beam() is None)\\n+\\n+    def test_dirbeam_detector_angles_none(self):\\n+        self.setup.dirbeam_detector_angles = None\\n+        self.assertEqual(\\n+            self.setup.correct_direct_beam(), tuple(self.setup.direct_beam)\\n+        )\\n+\\n+    def test_dirbeam_detector_angles_not_none(self):\\n+        self.assertTrue(\\n+            np.allclose(\\n+                self.setup.correct_direct_beam(),\\n+                (402.3190872641864, -66.31908726418641),\\n+                rtol=1e-09,\\n+                atol=1e-09,\\n+            )\\n+        )\\n+\\n+\\n+class TestCorrectDetectorAngles(unittest.TestCase):\\n+    \\\"\\\"\\\"\\n+    Tests related to correct_direct_beam.\\n+\\n+    def correct_detector_angles(self, bragg_peak_position: Tuple[Real, Real]) -> None:\\n+    \\\"\\\"\\\"\\n+\\n+    def setUp(self) -> None:\\n+        self.setup = Setup(\\n+            beamline=\\\"ID01\\\",\\n+            direct_beam=[12, 324],\\n+            dirbeam_detector_angles=[0.5, 1],\\n+            distance=1.23,\\n+            inplane_angle=12.2,\\n+            outofplane_angle=34.5,\\n+        )\\n+\\n+    def test_direct_beam_none(self):\\n+        self.setup.direct_beam = None\\n+        output = self.setup.correct_detector_angles(bragg_peak_position=(165, 35))\\n+        self.assertTrue(\\n+            np.isclose(self.setup.inplane_angle, 12.2)\\n+            and np.isclose(self.setup.outofplane_angle, 34.5)\\n+            and output is None\\n+        )\\n+\\n+    def test_dirbeam_detector_angles_none(self):\\n+        self.setup.dirbeam_detector_angles = None\\n+        output = self.setup.correct_detector_angles(bragg_peak_position=(165, 35))\\n+        self.assertTrue(\\n+            np.isclose(self.setup.inplane_angle, 12.2)\\n+            and np.isclose(self.setup.outofplane_angle, 34.5)\\n+            and output is None\\n+        )\\n+\\n+    def test_distance_undefined(self):\\n+        self.setup.distance = None\\n+        with self.assertRaises(ValueError):\\n+            self.setup.correct_detector_angles(bragg_peak_position=(165, 35))\\n+\\n+    def test_inplane_undefined(self):\\n+        self.setup.inplane_angle = None\\n+        with self.assertRaises(ValueError):\\n+            self.setup.correct_detector_angles(bragg_peak_position=(165, 35))\\n+\\n+    def test_outofplane_undefined(self):\\n+        self.setup.outofplane_angle = None\\n+        with self.assertRaises(ValueError):\\n+            self.setup.correct_detector_angles(bragg_peak_position=(165, 35))\\n+\\n+    def test_bragg_peak_none(self):\\n+        output = self.setup.correct_detector_angles(bragg_peak_position=None)\\n+        self.assertTrue(\\n+            np.isclose(self.setup.inplane_angle, 12.2)\\n+            and np.isclose(self.setup.outofplane_angle, 34.5)\\n+            and output is None\\n+        )\\n+\\n+    def test_correct(self):\\n+        self.setup.correct_detector_angles(bragg_peak_position=(165, 35))\\n+        print(self.setup.inplane_angle, self.setup.outofplane_angle)\\n+        self.assertTrue(\\n+            np.isclose(self.setup.inplane_angle, 11.940419849886538)\\n+            and np.isclose(self.setup.outofplane_angle, 33.6080130206483)\\n+        )\\n+\\n+\\n if __name__ == \\\"__main__\\\":\\n     run_tests(Test)\\n     run_tests(TestCheckSetup)\\n+    run_tests(TestCorrectDirectBeam)\\n+    run_tests(TestCorrectDetectorAngles)\\n\",\"diff --git a/tests/preprocessing/test_bcdi_utils.py b/tests/preprocessing/test_bcdi_utils.py\\nindex a252e33..746035b 100644\\n--- a/tests/preprocessing/test_bcdi_utils.py\\n+++ b/tests/preprocessing/test_bcdi_utils.py\\n@@ -6,8 +6,12 @@\\n #       authors:\\n #         Jerome Carnis, carnis_jerome@yahoo.fr\\n \\n+import numpy as np\\n import unittest\\n \\n+from bcdi.preprocessing.bcdi_utils import find_bragg\\n+from bcdi.utils.utilities import gaussian_window\\n+\\n \\n def run_tests(test_class):\\n     suite = unittest.TestLoader().loadTestsFromTestCase(test_class)\\n@@ -15,12 +19,74 @@ def run_tests(test_class):\\n     return runner.run(suite)\\n \\n \\n-class Test(unittest.TestCase):\\n-    \\\"\\\"\\\"Tests.\\\"\\\"\\\"\\n+class TestFindBragg(unittest.TestCase):\\n+    \\\"\\\"\\\"\\n+    Tests related to the function find_bragg.\\n+\\n+    def find_bragg(\\n+            data: np.ndarray,\\n+            peak_method: str,\\n+            roi: Optional[Tuple[int, int, int, int]] = None,\\n+            binning: Optional[Tuple[int, ...]] = None,\\n+    ) -> Tuple[int, ...]:\\n+    \\\"\\\"\\\"\\n+\\n+    def setUp(self) -> None:\\n+        data = np.zeros((4, 32, 32))\\n+        data[:-1, -13:, 17:30] = gaussian_window(window_shape=(3, 13, 13))\\n+        self.data = data\\n+\\n+    def test_no_method(self):\\n+        with self.assertRaises(ValueError):\\n+            find_bragg(data=self.data, peak_method=\\\"wrong\\\")\\n+\\n+    def test_max(self):\\n+        peak = find_bragg(data=self.data, peak_method=\\\"max\\\")\\n+        self.assertTrue(peak == (1, 25, 23))\\n+\\n+    def test_com(self):\\n+        peak = find_bragg(data=self.data, peak_method=\\\"com\\\")\\n+        self.assertTrue(peak == (1, 25, 23))\\n+\\n+    def test_maxcom(self):\\n+        peak = find_bragg(data=self.data, peak_method=\\\"maxcom\\\")\\n+        self.assertTrue(peak == (1, 25, 23))\\n+\\n+    def test_binning_wrong_length(self):\\n+        with self.assertRaises(ValueError):\\n+            find_bragg(data=self.data, peak_method=\\\"max\\\", binning=(2, 2))\\n+\\n+    def test_binning_wrong_type(self):\\n+        with self.assertRaises(TypeError):\\n+            find_bragg(data=self.data, peak_method=\\\"max\\\", binning=(2, 2, 2.3))\\n+\\n+    def test_binning(self):\\n+        peak = find_bragg(data=self.data, peak_method=\\\"max\\\", binning=(2, 1, 1))\\n+        self.assertTrue(peak == (2, 25, 23))\\n+\\n+    def test_binning_2(self):\\n+        peak = find_bragg(data=self.data, peak_method=\\\"max\\\", binning=(3, 3, 4))\\n+        self.assertTrue(peak == (3, 75, 92))\\n+\\n+    def test_roi_wrong_length(self):\\n+        with self.assertRaises(ValueError):\\n+            find_bragg(data=self.data, peak_method=\\\"max\\\", roi=(2, 1, 1))\\n+\\n+    def test_roi_wrong_type(self):\\n+        with self.assertRaises(TypeError):\\n+            find_bragg(data=self.data, peak_method=\\\"max\\\", roi=(2, 1, 1, 1.2))\\n+\\n+    def test_roi(self):\\n+        peak = find_bragg(data=self.data, peak_method=\\\"max\\\", roi=(3, 3, 4, 2))\\n+        self.assertTrue(peak == (1, 28, 27))\\n \\n-    def test_dummy(self):\\n-        self.assertTrue(True)\\n+    def test_bin_roi(self):\\n+        peak = find_bragg(\\n+            data=self.data, peak_method=\\\"max\\\", roi=(3, 3, 4, 2), binning=(3, 3, 4)\\n+        )\\n+        print(peak)\\n+        self.assertTrue(peak == (3, 78, 96))\\n \\n \\n if __name__ == \\\"__main__\\\":\\n-    run_tests(Test)\\n+    run_tests(TestFindBragg)\\n\",\"diff --git a/tests/utils/test_utilities.py b/tests/utils/test_utilities.py\\nindex b2a432f..9cf08f2 100644\\n--- a/tests/utils/test_utilities.py\\n+++ b/tests/utils/test_utilities.py\\n@@ -147,7 +147,42 @@ class TestIsFloat(unittest.TestCase):\\n             util.is_float(np.ones(3))\\n \\n \\n+class TestGaussianWindow(unittest.TestCase):\\n+    \\\"\\\"\\\"\\n+    Tests on the function utilities.gaussian_window.\\n+\\n+    def gaussian_window(\\n+        window_shape,\\n+        sigma=0.3,\\n+        mu=0.0,\\n+        voxel_size=None,\\n+        debugging=False\\n+    )\\n+    \\\"\\\"\\\"\\n+\\n+    def test_2d(self):\\n+        window = util.gaussian_window(window_shape=(13, 13))\\n+        self.assertTrue(np.unravel_index(abs(window).argmax(), window.shape) == (6, 6))\\n+\\n+    def test_2d_pad(self):\\n+        data = np.zeros((32, 32))\\n+        data[-13:, 17:30] = util.gaussian_window(window_shape=(13, 13))\\n+        self.assertTrue(np.unravel_index(abs(data).argmax(), data.shape) == (25, 23))\\n+\\n+    def test_3d(self):\\n+        window = util.gaussian_window(window_shape=(3, 13, 13))\\n+        self.assertTrue(\\n+            np.unravel_index(abs(window).argmax(), window.shape) == (1, 6, 6)\\n+        )\\n+\\n+    def test_3d_pad(self):\\n+        data = np.zeros((4, 32, 32))\\n+        data[:-1, -13:, 17:30] = util.gaussian_window(window_shape=(3, 13, 13))\\n+        self.assertTrue(np.unravel_index(abs(data).argmax(), data.shape) == (1, 25, 23))\\n+\\n+\\n if __name__ == \\\"__main__\\\":\\n     run_tests(TestInRange)\\n     run_tests(TestIsFloat)\\n     run_tests(TestFindFile)\\n+    run_tests(TestGaussianWindow)\"]", "hints_text": ""}
