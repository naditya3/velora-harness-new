{"instance_id": "1808483006597235", "repo": "pypa/setuptools", "base_commit": "dbc6471dbacb5a43ed60625cda8b9fb4d8f0aa34", "problem_statement": "Bump pytest-mypy:\\nNo particular reason or blocker, other than updating (new checks, bugfixes, etc.) relevant tooling for https://github.com/pypa/setuptools/pull/3979#discussion_r1367961634\\r\\n\\r\\nLatest version as of writing this was https://pypi.org/project/pytest-mypy/0.10.3/ nearly a year ago.", "FAIL_TO_PASS": ["setuptools/tests/test_build_meta.py::TestBuildMetaBackend::test_build_wheel[build_backend4]", "setuptools/tests/test_build_meta.py::TestBuildMetaBackend::test_build_wheel[build_backend5]", "setuptools/tests/test_build_meta.py::TestBuildMetaBackend::test_build_wheel[build_backend3]", "setuptools/tests/test_build_meta.py::TestBuildMetaBackend::test_prepare_metadata_for_build_wheel[build_backend0]", "setuptools/tests/test_build_meta.py::TestBuildMetaBackend::test_build_wheel[build_backend1]", "setuptools/tests/test_build_meta.py::TestBuildMetaBackend::test_prepare_metadata_for_build_wheel[build_backend1]", "setuptools/tests/test_build_meta.py::TestBuildMetaBackend::test_static_metadata_in_pyproject_config", "setuptools/tests/test_build_meta.py::TestBuildMetaBackend::test_build_wheel[build_backend2]", "setuptools/tests/test_build_meta.py::TestBuildMetaBackend::test_build_with_existing_file_present[wheel]", "setuptools/tests/test_build_meta.py::TestBuildMetaBackend::test_build_wheel[build_backend0]"], "PASS_TO_PASS": [], "language": "python", "test_command": "source /saved/ENV || source /saved/*/ENV && tox -- --no-header -rA --tb=no -p no:cacheprovider --continue-on-collection-errors", "test_output_parser": "python/parse_log_pytest_v3", "image_storage_uri": "vmvm-registry.fbinfra.net/repomate_image_activ_pytest/pypa_setuptools:dbc6471dbacb5a43ed60625cda8b9fb4d8f0aa34", "patch": "[\"diff --git a/docs/conf.py b/docs/conf.py\\nindex 0a82ff2fe2..be8856849b 100644\\n--- a/docs/conf.py\\n+++ b/docs/conf.py\\n@@ -161,22 +161,23 @@\\n # Ref: https://stackoverflow.com/a/30624034/595220\\n nitpick_ignore = [\\n     ('c:func', 'SHGetSpecialFolderPath'),  # ref to MS docs\\n+    ('envvar', 'DIST_EXTRA_CONFIG'),  # undocumented\\n     ('envvar', 'DISTUTILS_DEBUG'),  # undocumented\\n     ('envvar', 'HOME'),  # undocumented\\n     ('envvar', 'PLAT'),  # undocumented\\n-    ('envvar', 'DIST_EXTRA_CONFIG'),  # undocumented\\n     ('py:attr', 'CCompiler.language_map'),  # undocumented\\n     ('py:attr', 'CCompiler.language_order'),  # undocumented\\n-    ('py:class', 'distutils.dist.Distribution'),  # undocumented\\n-    ('py:class', 'distutils.extension.Extension'),  # undocumented\\n     ('py:class', 'BorlandCCompiler'),  # undocumented\\n     ('py:class', 'CCompiler'),  # undocumented\\n     ('py:class', 'CygwinCCompiler'),  # undocumented\\n+    ('py:class', 'distutils.dist.Distribution'),  # undocumented\\n     ('py:class', 'distutils.dist.DistributionMetadata'),  # undocumented\\n+    ('py:class', 'distutils.extension.Extension'),  # undocumented\\n     ('py:class', 'FileList'),  # undocumented\\n     ('py:class', 'IShellLink'),  # ref to MS docs\\n     ('py:class', 'MSVCCompiler'),  # undocumented\\n     ('py:class', 'OptionDummy'),  # undocumented\\n+    ('py:class', 'setuptools.dist.Distribution'),  # undocumented\\n     ('py:class', 'UnixCCompiler'),  # undocumented\\n     ('py:exc', 'CompileError'),  # undocumented\\n     ('py:exc', 'DistutilsExecError'),  # undocumented\\n@@ -186,8 +187,7 @@\\n     ('py:exc', 'PreprocessError'),  # undocumented\\n     ('py:exc', 'setuptools.errors.PlatformError'),  # sphinx cannot find it\\n     ('py:func', 'distutils.CCompiler.new_compiler'),  # undocumented\\n-    # undocumented:\\n-    ('py:func', 'distutils.dist.DistributionMetadata.read_pkg_file'),\\n+    ('py:func', 'distutils.dist.DistributionMetadata.read_pkg_file'),  # undocumented\\n     ('py:func', 'distutils.file_util._copy_file_contents'),  # undocumented\\n     ('py:func', 'distutils.log.debug'),  # undocumented\\n     ('py:func', 'distutils.spawn.find_executable'),  # undocumented\\n\",\"diff --git a/setup.py b/setup.py\\nindex 075d7c405f..1a6074766a 100755\\n--- a/setup.py\\n+++ b/setup.py\\n@@ -88,5 +88,6 @@ def _restore_install_lib(self):\\n \\n if __name__ == '__main__':\\n     # allow setup.py to run from another directory\\n-    here and os.chdir(here)\\n+    # TODO: Use a proper conditonal statement here\\n+    here and os.chdir(here)  # type: ignore[func-returns-value]\\n     dist = setuptools.setup(**setup_params)\\n\",\"diff --git a/setuptools/__init__.py b/setuptools/__init__.py\\nindex 563ca1c4ba..7c88c7e19b 100644\\n--- a/setuptools/__init__.py\\n+++ b/setuptools/__init__.py\\n@@ -3,6 +3,7 @@\\n import functools\\n import os\\n import re\\n+from typing import TYPE_CHECKING\\n \\n import _distutils_hack.override  # noqa: F401\\n import distutils.core\\n@@ -105,8 +106,11 @@ def setup(**attrs):\\n \\n setup.__doc__ = distutils.core.setup.__doc__\\n \\n-\\n-_Command = monkey.get_unpatched(distutils.core.Command)\\n+if TYPE_CHECKING:\\n+    # Work around a mypy issue where type[T] can't be used as a base: https://github.com/python/mypy/issues/10962\\n+    _Command = distutils.core.Command\\n+else:\\n+    _Command = monkey.get_unpatched(distutils.core.Command)\\n \\n \\n class Command(_Command):\\n@@ -165,8 +169,9 @@ class Command(_Command):\\n     \\\"\\\"\\\"\\n \\n     command_consumes_arguments = False\\n+    distribution: Distribution  # override distutils.dist.Distribution with setuptools.dist.Distribution\\n \\n-    def __init__(self, dist, **kw):\\n+    def __init__(self, dist: Distribution, **kw):\\n         \\\"\\\"\\\"\\n         Construct the command for dist, updating\\n         vars(self) with any keyword parameters.\\n\",\"diff --git a/setuptools/command/_requirestxt.py b/setuptools/command/_requirestxt.py\\nindex 7b732b11ab..b0c2d7059a 100644\\n--- a/setuptools/command/_requirestxt.py\\n+++ b/setuptools/command/_requirestxt.py\\n@@ -35,7 +35,7 @@ def _prepare(\\n \\n \\n def _convert_extras_requirements(\\n-    extras_require: _StrOrIter,\\n+    extras_require: Mapping[str, _StrOrIter],\\n ) -> Mapping[str, _Ordered[Requirement]]:\\n     \\\"\\\"\\\"\\n     Convert requirements in `extras_require` of the form\\n\",\"diff --git a/setuptools/command/build_ext.py b/setuptools/command/build_ext.py\\nindex 780afe3aec..1301433a32 100644\\n--- a/setuptools/command/build_ext.py\\n+++ b/setuptools/command/build_ext.py\\n@@ -26,7 +26,9 @@\\n \\n # make sure _config_vars is initialized\\n get_config_var(\\\"LDSHARED\\\")\\n-from distutils.sysconfig import _config_vars as _CONFIG_VARS  # noqa\\n+# Not publicly exposed in typeshed distutils stubs, but this is done on purpose\\n+# See https://github.com/pypa/setuptools/pull/4228#issuecomment-1959856400\\n+from distutils.sysconfig import _config_vars as _CONFIG_VARS  # type: ignore # noqa\\n \\n \\n def _customize_compiler_for_shlib(compiler):\\n@@ -58,7 +60,7 @@ def _customize_compiler_for_shlib(compiler):\\n     use_stubs = True\\n elif os.name != 'nt':\\n     try:\\n-        import dl\\n+        import dl  # type: ignore[import-not-found] # https://github.com/python/mypy/issues/13002\\n \\n         use_stubs = have_rtld = hasattr(dl, 'RTLD_NOW')\\n     except ImportError:\\n@@ -378,7 +380,10 @@ def _compile_and_remove_stub(self, stub_file: str):\\n         optimize = self.get_finalized_command('install_lib').optimize\\n         if optimize > 0:\\n             byte_compile(\\n-                [stub_file], optimize=optimize, force=True, dry_run=self.dry_run\\n+                [stub_file],\\n+                optimize=optimize,\\n+                force=True,\\n+                dry_run=self.dry_run,\\n             )\\n         if os.path.exists(stub_file) and not self.dry_run:\\n             os.unlink(stub_file)\\n\",\"diff --git a/setuptools/command/dist_info.py b/setuptools/command/dist_info.py\\nindex f5061afaaf..52c0721903 100644\\n--- a/setuptools/command/dist_info.py\\n+++ b/setuptools/command/dist_info.py\\n@@ -9,8 +9,10 @@\\n from distutils import log\\n from distutils.core import Command\\n from pathlib import Path\\n+from typing import cast\\n \\n from .. import _normalization\\n+from .egg_info import egg_info as egg_info_cls\\n \\n \\n class dist_info(Command):\\n@@ -50,7 +52,7 @@ def finalize_options(self):\\n         project_dir = dist.src_root or os.curdir\\n         self.output_dir = Path(self.output_dir or project_dir)\\n \\n-        egg_info = self.reinitialize_command(\\\"egg_info\\\")\\n+        egg_info = cast(egg_info_cls, self.reinitialize_command(\\\"egg_info\\\"))\\n         egg_info.egg_base = str(self.output_dir)\\n \\n         if self.tag_date:\\n\",\"diff --git a/setuptools/command/easy_install.py b/setuptools/command/easy_install.py\\nindex cc0c409123..402355bd81 100644\\n--- a/setuptools/command/easy_install.py\\n+++ b/setuptools/command/easy_install.py\\n@@ -25,6 +25,7 @@\\n from distutils.command import install\\n import sys\\n import os\\n+from typing import Dict, List\\n import zipimport\\n import shutil\\n import tempfile\\n@@ -43,7 +44,6 @@\\n import configparser\\n import sysconfig\\n \\n-\\n from sysconfig import get_path\\n \\n from setuptools import Command\\n@@ -1765,7 +1765,7 @@ def _wrap_lines(cls, lines):\\n \\n \\n if os.environ.get('SETUPTOOLS_SYS_PATH_TECHNIQUE', 'raw') == 'rewrite':\\n-    PthDistributions = RewritePthDistributions\\n+    PthDistributions = RewritePthDistributions  # type: ignore[misc]  # Overwriting type\\n \\n \\n def _first_line_re():\\n@@ -2015,7 +2015,7 @@ def is_python_script(script_text, filename):\\n     from os import chmod as _chmod\\n except ImportError:\\n     # Jython compatibility\\n-    def _chmod(*args):\\n+    def _chmod(*args: object, **kwargs: object) -> None:  # type: ignore[misc] # Mypy re-uses the imported definition anyway\\n         pass\\n \\n \\n@@ -2033,8 +2033,8 @@ class CommandSpec(list):\\n     those passed to Popen.\\n     \\\"\\\"\\\"\\n \\n-    options = []\\n-    split_args = dict()\\n+    options: List[str] = []\\n+    split_args: Dict[str, bool] = dict()\\n \\n     @classmethod\\n     def best(cls):\\n\",\"diff --git a/setuptools/command/editable_wheel.py b/setuptools/command/editable_wheel.py\\nindex a81fcd5bf9..24980edcf4 100644\\n--- a/setuptools/command/editable_wheel.py\\n+++ b/setuptools/command/editable_wheel.py\\n@@ -33,6 +33,7 @@\\n     Protocol,\\n     Tuple,\\n     TypeVar,\\n+    cast,\\n )\\n \\n from .. import (\\n@@ -50,7 +51,12 @@\\n     SetuptoolsDeprecationWarning,\\n     SetuptoolsWarning,\\n )\\n+from .build import build as build_cls\\n from .build_py import build_py as build_py_cls\\n+from .dist_info import dist_info as dist_info_cls\\n+from .egg_info import egg_info as egg_info_cls\\n+from .install import install as install_cls\\n+from .install_scripts import install_scripts as install_scripts_cls\\n \\n if TYPE_CHECKING:\\n     from wheel.wheelfile import WheelFile  # noqa\\n@@ -155,7 +161,7 @@ def run(self):\\n \\n     def _ensure_dist_info(self):\\n         if self.dist_info_dir is None:\\n-            dist_info = self.reinitialize_command(\\\"dist_info\\\")\\n+            dist_info = cast(dist_info_cls, self.reinitialize_command(\\\"dist_info\\\"))\\n             dist_info.output_dir = self.dist_dir\\n             dist_info.ensure_finalized()\\n             dist_info.run()\\n@@ -202,12 +208,18 @@ def _configure_build(\\n         scripts = str(Path(unpacked_wheel, f\\\"{name}.data\\\", \\\"scripts\\\"))\\n \\n         # egg-info may be generated again to create a manifest (used for package data)\\n-        egg_info = dist.reinitialize_command(\\\"egg_info\\\", reinit_subcommands=True)\\n+        egg_info = cast(\\n+            egg_info_cls, dist.reinitialize_command(\\\"egg_info\\\", reinit_subcommands=True)\\n+        )\\n         egg_info.egg_base = str(tmp_dir)\\n         egg_info.ignore_egg_info_in_manifest = True\\n \\n-        build = dist.reinitialize_command(\\\"build\\\", reinit_subcommands=True)\\n-        install = dist.reinitialize_command(\\\"install\\\", reinit_subcommands=True)\\n+        build = cast(\\n+            build_cls, dist.reinitialize_command(\\\"build\\\", reinit_subcommands=True)\\n+        )\\n+        install = cast(\\n+            install_cls, dist.reinitialize_command(\\\"install\\\", reinit_subcommands=True)\\n+        )\\n \\n         build.build_platlib = build.build_purelib = build.build_lib = build_lib\\n         install.install_purelib = install.install_platlib = install.install_lib = wheel\\n@@ -215,12 +227,14 @@ def _configure_build(\\n         install.install_headers = headers\\n         install.install_data = data\\n \\n-        install_scripts = dist.get_command_obj(\\\"install_scripts\\\")\\n+        install_scripts = cast(\\n+            install_scripts_cls, dist.get_command_obj(\\\"install_scripts\\\")\\n+        )\\n         install_scripts.no_ep = True\\n \\n         build.build_temp = str(tmp_dir)\\n \\n-        build_py = dist.get_command_obj(\\\"build_py\\\")\\n+        build_py = cast(build_py_cls, dist.get_command_obj(\\\"build_py\\\"))\\n         build_py.compile = False\\n         build_py.existing_egg_info_dir = self._find_egg_info_dir()\\n \\n@@ -233,6 +247,7 @@ def _set_editable_mode(self):\\n         \\\"\\\"\\\"Set the ``editable_mode`` flag in the build sub-commands\\\"\\\"\\\"\\n         dist = self.distribution\\n         build = dist.get_command_obj(\\\"build\\\")\\n+        # TODO: Update typeshed distutils stubs to overload non-None return type by default\\n         for cmd_name in build.get_sub_commands():\\n             cmd = dist.get_command_obj(cmd_name)\\n             if hasattr(cmd, \\\"editable_mode\\\"):\\n@@ -269,7 +284,7 @@ def _run_build_commands(\\n         self._run_install(\\\"data\\\")\\n         return files, mapping\\n \\n-    def _run_build_subcommands(self):\\n+    def _run_build_subcommands(self) -> None:\\n         \\\"\\\"\\\"\\n         Issue #3501 indicates that some plugins/customizations might rely on:\\n \\n@@ -283,7 +298,7 @@ def _run_build_subcommands(self):\\n         # TODO: Once plugins/customisations had the chance to catch up, replace\\n         #       `self._run_build_subcommands()` with `self.run_command(\\\"build\\\")`.\\n         #       Also remove _safely_run, TestCustomBuildPy. Suggested date: Aug/2023.\\n-        build: Command = self.get_finalized_command(\\\"build\\\")\\n+        build = self.get_finalized_command(\\\"build\\\")\\n         for name in build.get_sub_commands():\\n             cmd = self.get_finalized_command(name)\\n             if name == \\\"build_py\\\" and type(cmd) != build_py_cls:\\n@@ -432,7 +447,8 @@ def __init__(\\n     ):\\n         self.auxiliary_dir = Path(auxiliary_dir)\\n         self.build_lib = Path(build_lib).resolve()\\n-        self._file = dist.get_command_obj(\\\"build_py\\\").copy_file\\n+        # TODO: Update typeshed distutils stubs to overload non-None return type by default\\n+        self._file = dist.get_command_obj(\\\"build_py\\\").copy_file  # type: ignore[union-attr]\\n         super().__init__(dist, name, [self.auxiliary_dir])\\n \\n     def __call__(self, wheel: \\\"WheelFile\\\", files: List[str], mapping: Dict[str, str]):\\n@@ -450,7 +466,9 @@ def _create_file(self, relative_output: str, src_file: str, link=None):\\n         dest = self.auxiliary_dir / relative_output\\n         if not dest.parent.is_dir():\\n             dest.parent.mkdir(parents=True)\\n-        self._file(src_file, dest, link=link)\\n+        # TODO: Update typeshed distutils stubs so distutils.cmd.Command.copy_file, accepts PathLike\\n+        # same with methods used by copy_file\\n+        self._file(src_file, dest, link=link)  # type: ignore[arg-type]\\n \\n     def _create_links(self, outputs, output_mapping):\\n         self.auxiliary_dir.mkdir(parents=True, exist_ok=True)\\n@@ -603,7 +621,8 @@ def _simple_layout(\\n     layout = {pkg: find_package_path(pkg, package_dir, project_dir) for pkg in packages}\\n     if not layout:\\n         return set(package_dir) in ({}, {\\\"\\\"})\\n-    parent = os.path.commonpath(starmap(_parent_path, layout.items()))\\n+    # TODO: has been fixed upstream, waiting for new mypy release https://github.com/python/typeshed/pull/11310\\n+    parent = os.path.commonpath(starmap(_parent_path, layout.items()))  # type: ignore[call-overload]\\n     return all(\\n         _path.same_path(Path(parent, *key.split('.')), value)\\n         for key, value in layout.items()\\n\",\"diff --git a/setuptools/command/install.py b/setuptools/command/install.py\\nindex b97a9b4713..56c1155b50 100644\\n--- a/setuptools/command/install.py\\n+++ b/setuptools/command/install.py\\n@@ -3,9 +3,11 @@\\n import glob\\n import platform\\n import distutils.command.install as orig\\n+from typing import cast\\n \\n import setuptools\\n from ..warnings import SetuptoolsDeprecationWarning, SetuptoolsWarning\\n+from .bdist_egg import bdist_egg as bdist_egg_cls\\n \\n # Prior to numpy 1.9, NumPy relies on the '_install' name, so provide it for\\n # now. See https://github.com/pypa/setuptools/issues/199/\\n@@ -135,7 +137,8 @@ def do_egg_install(self):\\n         cmd.package_index.scan(glob.glob('*.egg'))\\n \\n         self.run_command('bdist_egg')\\n-        args = [self.distribution.get_command_obj('bdist_egg').egg_output]\\n+        bdist_egg = cast(bdist_egg_cls, self.distribution.get_command_obj('bdist_egg'))\\n+        args = [bdist_egg.egg_output]\\n \\n         if setuptools.bootstrap_install_from:\\n             # Bootstrap self-installation of setuptools\\n\",\"diff --git a/setuptools/command/rotate.py b/setuptools/command/rotate.py\\nindex cfb78ce52d..6f73721c70 100644\\n--- a/setuptools/command/rotate.py\\n+++ b/setuptools/command/rotate.py\\n@@ -3,6 +3,7 @@\\n from distutils.errors import DistutilsOptionError\\n import os\\n import shutil\\n+from typing import List\\n \\n from setuptools import Command\\n \\n@@ -17,7 +18,7 @@ class rotate(Command):\\n         ('keep=', 'k', \\\"number of matching distributions to keep\\\"),\\n     ]\\n \\n-    boolean_options = []\\n+    boolean_options: List[str] = []\\n \\n     def initialize_options(self):\\n         self.match = None\\n\",\"diff --git a/setuptools/command/upload_docs.py b/setuptools/command/upload_docs.py\\nindex 32c9abd796..3fbbb62553 100644\\n--- a/setuptools/command/upload_docs.py\\n+++ b/setuptools/command/upload_docs.py\\n@@ -50,7 +50,7 @@ def has_sphinx(self):\\n             and metadata.entry_points(group='distutils.commands', name='build_sphinx')\\n         )\\n \\n-    sub_commands = [('build_sphinx', has_sphinx)]\\n+    sub_commands = [('build_sphinx', has_sphinx)]  # type: ignore[list-item] # TODO: Fix in typeshed distutils stubs\\n \\n     def initialize_options(self):\\n         upload.initialize_options(self)\\n\",\"diff --git a/setuptools/config/_apply_pyprojecttoml.py b/setuptools/config/_apply_pyprojecttoml.py\\nindex 7301bc65c1..3626282a79 100644\\n--- a/setuptools/config/_apply_pyprojecttoml.py\\n+++ b/setuptools/config/_apply_pyprojecttoml.py\\n@@ -34,6 +34,7 @@\\n from ..warnings import SetuptoolsWarning\\n \\n if TYPE_CHECKING:\\n+    from distutils.dist import _OptionsList\\n     from setuptools._importlib import metadata  # noqa\\n     from setuptools.dist import Distribution  # noqa\\n \\n@@ -293,7 +294,7 @@ def _normalise_cmd_option_key(name: str) -> str:\\n     return json_compatible_key(name).strip(\\\"_=\\\")\\n \\n \\n-def _normalise_cmd_options(desc: List[Tuple[str, Optional[str], str]]) -> Set[str]:\\n+def _normalise_cmd_options(desc: \\\"_OptionsList\\\") -> Set[str]:\\n     return {_normalise_cmd_option_key(fancy_option[0]) for fancy_option in desc}\\n \\n \\n\",\"diff --git a/setuptools/config/expand.py b/setuptools/config/expand.py\\nindex e23a762cf5..0d8d58add8 100644\\n--- a/setuptools/config/expand.py\\n+++ b/setuptools/config/expand.py\\n@@ -63,7 +63,7 @@ class StaticModule:\\n     \\\"\\\"\\\"Proxy to a module object that avoids executing arbitrary code.\\\"\\\"\\\"\\n \\n     def __init__(self, name: str, spec: ModuleSpec):\\n-        module = ast.parse(pathlib.Path(spec.origin).read_bytes())\\n+        module = ast.parse(pathlib.Path(spec.origin).read_bytes())  # type: ignore[arg-type] # Let it raise an error on None\\n         vars(self).update(locals())\\n         del self.self\\n \\n\",\"diff --git a/setuptools/config/pyprojecttoml.py b/setuptools/config/pyprojecttoml.py\\nindex 5eb9421f1f..ff97679895 100644\\n--- a/setuptools/config/pyprojecttoml.py\\n+++ b/setuptools/config/pyprojecttoml.py\\n@@ -24,6 +24,7 @@\\n \\n if TYPE_CHECKING:\\n     from setuptools.dist import Distribution  # noqa\\n+    from typing_extensions import Self\\n \\n _logger = logging.getLogger(__name__)\\n \\n@@ -271,7 +272,7 @@ def _ensure_previously_set(self, dist: \\\"Distribution\\\", field: str):\\n     def _expand_directive(\\n         self, specifier: str, directive, package_dir: Mapping[str, str]\\n     ):\\n-        from setuptools.extern.more_itertools import always_iterable  # type: ignore\\n+        from setuptools.extern.more_itertools import always_iterable\\n \\n         with _ignore_errors(self.ignore_option_errors):\\n             root_dir = self.root_dir\\n@@ -401,7 +402,7 @@ def __init__(\\n         self._project_cfg = project_cfg\\n         self._setuptools_cfg = setuptools_cfg\\n \\n-    def __enter__(self):\\n+    def __enter__(self) -> \\\"Self\\\":\\n         \\\"\\\"\\\"When entering the context, the values of ``packages``, ``py_modules`` and\\n         ``package_dir`` that are missing in ``dist`` are copied from ``setuptools_cfg``.\\n         \\\"\\\"\\\"\\n\",\"diff --git a/setuptools/config/setupcfg.py b/setuptools/config/setupcfg.py\\nindex cfa43a57b5..2912d3e143 100644\\n--- a/setuptools/config/setupcfg.py\\n+++ b/setuptools/config/setupcfg.py\\n@@ -108,7 +108,7 @@ def _apply(\\n     filenames = [*other_files, filepath]\\n \\n     try:\\n-        _Distribution.parse_config_files(dist, filenames=filenames)\\n+        _Distribution.parse_config_files(dist, filenames=filenames)  # type: ignore[arg-type] # TODO: fix in disutils stubs\\n         handlers = parse_configuration(\\n             dist, dist.command_options, ignore_option_errors=ignore_option_errors\\n         )\\n@@ -475,7 +475,7 @@ def parse_section(self, section_options):\\n                 # Keep silent for a new option may appear anytime.\\n                 self[name] = value\\n \\n-    def parse(self):\\n+    def parse(self) -> None:\\n         \\\"\\\"\\\"Parses configuration file items from one\\n         or more related sections.\\n \\n\",\"diff --git a/setuptools/dist.py b/setuptools/dist.py\\nindex d5787ed474..6350e38100 100644\\n--- a/setuptools/dist.py\\n+++ b/setuptools/dist.py\\n@@ -10,7 +10,7 @@\\n from contextlib import suppress\\n from glob import iglob\\n from pathlib import Path\\n-from typing import List, Optional, Set\\n+from typing import TYPE_CHECKING, Dict, List, MutableMapping, Optional, Set, Tuple\\n \\n import distutils.cmd\\n import distutils.command\\n@@ -202,7 +202,11 @@ def check_packages(dist, attr, value):\\n             )\\n \\n \\n-_Distribution = get_unpatched(distutils.core.Distribution)\\n+if TYPE_CHECKING:\\n+    # Work around a mypy issue where type[T] can't be used as a base: https://github.com/python/mypy/issues/10962\\n+    _Distribution = distutils.core.Distribution\\n+else:\\n+    _Distribution = get_unpatched(distutils.core.Distribution)\\n \\n \\n class Distribution(_Distribution):\\n@@ -283,12 +287,12 @@ def patch_missing_pkg_info(self, attrs):\\n                 dist._version = _normalization.safe_version(str(attrs['version']))\\n                 self._patched_dist = dist\\n \\n-    def __init__(self, attrs=None):\\n+    def __init__(self, attrs: Optional[MutableMapping] = None) -> None:\\n         have_package_data = hasattr(self, \\\"package_data\\\")\\n         if not have_package_data:\\n-            self.package_data = {}\\n+            self.package_data: Dict[str, List[str]] = {}\\n         attrs = attrs or {}\\n-        self.dist_files = []\\n+        self.dist_files: List[Tuple[str, str, str]] = []\\n         # Filter-out setuptools' specific options.\\n         self.src_root = attrs.pop(\\\"src_root\\\", None)\\n         self.patch_missing_pkg_info(attrs)\\n@@ -381,7 +385,7 @@ def _normalize_requires(self):\\n             k: list(map(str, _reqs.parse(v or []))) for k, v in extras_require.items()\\n         }\\n \\n-    def _finalize_license_files(self):\\n+    def _finalize_license_files(self) -> None:\\n         \\\"\\\"\\\"Compute names of all license files which should be included.\\\"\\\"\\\"\\n         license_files: Optional[List[str]] = self.metadata.license_files\\n         patterns: List[str] = license_files if license_files else []\\n@@ -394,7 +398,7 @@ def _finalize_license_files(self):\\n             # Default patterns match the ones wheel uses\\n             # See https://wheel.readthedocs.io/en/stable/user_guide.html\\n             # -> 'Including license files in the generated wheel file'\\n-            patterns = ('LICEN[CS]E*', 'COPYING*', 'NOTICE*', 'AUTHORS*')\\n+            patterns = ['LICEN[CS]E*', 'COPYING*', 'NOTICE*', 'AUTHORS*']\\n \\n         self.metadata.license_files = list(\\n             unique_everseen(self._expand_patterns(patterns))\\n\",\"diff --git a/setuptools/extension.py b/setuptools/extension.py\\nindex 58c023f6b4..8caad78d4b 100644\\n--- a/setuptools/extension.py\\n+++ b/setuptools/extension.py\\n@@ -3,6 +3,7 @@\\n import distutils.core\\n import distutils.errors\\n import distutils.extension\\n+from typing import TYPE_CHECKING\\n \\n from .monkey import get_unpatched\\n \\n@@ -23,8 +24,11 @@ def _have_cython():\\n \\n # for compatibility\\n have_pyrex = _have_cython\\n-\\n-_Extension = get_unpatched(distutils.core.Extension)\\n+if TYPE_CHECKING:\\n+    # Work around a mypy issue where type[T] can't be used as a base: https://github.com/python/mypy/issues/10962\\n+    _Extension = distutils.core.Extension\\n+else:\\n+    _Extension = get_unpatched(distutils.core.Extension)\\n \\n \\n class Extension(_Extension):\\n\",\"diff --git a/setuptools/monkey.py b/setuptools/monkey.py\\nindex da0993506c..fd07d91dec 100644\\n--- a/setuptools/monkey.py\\n+++ b/setuptools/monkey.py\\n@@ -8,11 +8,14 @@\\n import sys\\n import types\\n from importlib import import_module\\n+from typing import List, TypeVar\\n \\n import distutils.filelist\\n \\n \\n-__all__ = []\\n+_T = TypeVar(\\\"_T\\\")\\n+\\n+__all__: List[str] = []\\n \\\"\\\"\\\"\\n Everything is private. Contact the project team\\n if you think you need this functionality.\\n@@ -33,7 +36,7 @@ def _get_mro(cls):\\n     return inspect.getmro(cls)\\n \\n \\n-def get_unpatched(item):\\n+def get_unpatched(item: _T) -> _T:\\n     lookup = (\\n         get_unpatched_class\\n         if isinstance(item, type)\\n\",\"diff --git a/setuptools/msvc.py b/setuptools/msvc.py\\nindex 53fe7b0de1..b2a0f2bebb 100644\\n--- a/setuptools/msvc.py\\n+++ b/setuptools/msvc.py\\n@@ -20,9 +20,11 @@\\n import itertools\\n import subprocess\\n import distutils.errors\\n+from typing import Dict, TYPE_CHECKING\\n from setuptools.extern.more_itertools import unique_everseen\\n \\n-if platform.system() == 'Windows':\\n+# https://github.com/python/mypy/issues/8166\\n+if not TYPE_CHECKING and platform.system() == 'Windows':\\n     import winreg\\n     from os import environ\\n else:\\n@@ -34,7 +36,7 @@ class winreg:\\n         HKEY_LOCAL_MACHINE = None\\n         HKEY_CLASSES_ROOT = None\\n \\n-    environ = dict()\\n+    environ: Dict[str, str] = dict()\\n \\n \\n def _msvc14_find_vc2015():\\n\",\"diff --git a/setuptools/sandbox.py b/setuptools/sandbox.py\\nindex 7634b1320b..6c095e029e 100644\\n--- a/setuptools/sandbox.py\\n+++ b/setuptools/sandbox.py\\n@@ -9,6 +9,7 @@\\n import pickle\\n import textwrap\\n import builtins\\n+from typing import Union, List\\n \\n import pkg_resources\\n from distutils.errors import DistutilsError\\n@@ -19,7 +20,7 @@\\n else:\\n     _os = sys.modules[os.name]\\n try:\\n-    _file = file\\n+    _file = file  # type: ignore[name-defined] # Check for global variable\\n except NameError:\\n     _file = None\\n _open = open\\n@@ -298,7 +299,7 @@ def run(self, func):\\n         with self:\\n             return func()\\n \\n-    def _mk_dual_path_wrapper(name):\\n+    def _mk_dual_path_wrapper(name: str):  # type: ignore[misc] # https://github.com/pypa/setuptools/pull/4099\\n         original = getattr(_os, name)\\n \\n         def wrap(self, src, dst, *args, **kw):\\n@@ -312,7 +313,7 @@ def wrap(self, src, dst, *args, **kw):\\n         if hasattr(_os, name):\\n             locals()[name] = _mk_dual_path_wrapper(name)\\n \\n-    def _mk_single_path_wrapper(name, original=None):\\n+    def _mk_single_path_wrapper(name: str, original=None):  # type: ignore[misc] # https://github.com/pypa/setuptools/pull/4099\\n         original = original or getattr(_os, name)\\n \\n         def wrap(self, path, *args, **kw):\\n@@ -349,7 +350,7 @@ def wrap(self, path, *args, **kw):\\n         if hasattr(_os, name):\\n             locals()[name] = _mk_single_path_wrapper(name)\\n \\n-    def _mk_single_with_return(name):\\n+    def _mk_single_with_return(name: str):  # type: ignore[misc] # https://github.com/pypa/setuptools/pull/4099\\n         original = getattr(_os, name)\\n \\n         def wrap(self, path, *args, **kw):\\n@@ -364,7 +365,7 @@ def wrap(self, path, *args, **kw):\\n         if hasattr(_os, name):\\n             locals()[name] = _mk_single_with_return(name)\\n \\n-    def _mk_query(name):\\n+    def _mk_query(name: str):  # type: ignore[misc] # https://github.com/pypa/setuptools/pull/4099\\n         original = getattr(_os, name)\\n \\n         def wrap(self, *args, **kw):\\n@@ -424,7 +425,7 @@ class DirectorySandbox(AbstractSandbox):\\n         \\\"tempnam\\\",\\n     ])\\n \\n-    _exception_patterns = []\\n+    _exception_patterns: List[Union[str, re.Pattern]] = []\\n     \\\"exempt writing to paths that match the pattern\\\"\\n \\n     def __init__(self, sandbox, exceptions=_EXCEPTIONS):\\n\"]", "test_patch": "[\"diff --git a/mypy.ini b/mypy.ini\\nindex b6f972769e..e0fa8e5c47 100644\\n--- a/mypy.ini\\n+++ b/mypy.ini\\n@@ -1,5 +1,42 @@\\n [mypy]\\n-ignore_missing_imports = True\\n-# required to support namespace packages\\n-# https://github.com/python/mypy/issues/14057\\n+# CI should test for all versions, local development gets hints for oldest supported\\n+python_version = 3.8\\n+strict = False\\n+warn_unused_ignores = True\\n+# required to support namespace packages: https://github.com/python/mypy/issues/14057\\n explicit_package_bases = True\\n+exclude = (?x)(\\n+\\t^build/\\n+\\t| ^.tox/\\n+\\t| ^pkg_resources/tests/data/my-test-package-source/setup.py$ # Duplicate module name\\n+\\t| ^.+?/(_vendor|extern)/ # Vendored\\n+\\t| ^setuptools/_distutils/ # Vendored\\n+\\t| ^setuptools/config/_validate_pyproject/ # Auto-generated\\n+\\t)\\n+disable_error_code = \\n+\\t# TODO: Test environment is not yet properly configured to install all imported packages\\n+\\t# import-not-found, # This can be left commented out for local runs until we enforce running mypy in the CI\\n+\\t# TODO: Not all dependencies are typed. Namely: distutils._modified, wheel.wheelfile, and jaraco.*\\n+\\timport-untyped,\\n+\\t# Ignoring attr-defined because setuptools wraps a lot of distutils classes, adding new attributes,\\n+\\t# w/o updating all the attributes and return types from the base classes for type-checkers to understand\\n+\\t# Especially with setuptools.dist.command vs distutils.dist.command vs setuptools._distutils.dist.command\\n+\\t# *.extern modules that actually live in *._vendor will also cause attr-defined issues on import\\n+\\tattr-defined,\\n+\\n+# Avoid raising issues when importing from \\\"extern\\\" modules, as those are added to path dynamically.\\n+# https://github.com/pypa/setuptools/pull/3979#discussion_r1367968993\\n+[mypy-pkg_resources.extern.*,setuptools.extern.*]\\n+ignore_missing_imports = True\\n+\\n+[mypy-pkg_resources.tests.*,setuptools.tests.*]\\n+disable_error_code =\\n+\\t# Tests include creating dynamic modules that won't exists statically before the test is run.\\n+\\t# Let's ignore all \\\"import-not-found\\\", as if an import really wasn't found, then the test would fail.\\n+\\timport-not-found,\\n+\\t# mmany untyped \\\"jaraco\\\" modules\\n+\\timport-untyped,\\n+\\n+# Mypy issue, this vendored module is already excluded!\\n+[mypy-setuptools._vendor.packaging._manylinux]\\n+disable_error_code = import-not-found\\n\",\"diff --git a/pkg_resources/tests/test_pkg_resources.py b/pkg_resources/tests/test_pkg_resources.py\\nindex 0883642080..bfbf619c85 100644\\n--- a/pkg_resources/tests/test_pkg_resources.py\\n+++ b/pkg_resources/tests/test_pkg_resources.py\\n@@ -9,6 +9,7 @@\\n import stat\\n import distutils.dist\\n import distutils.command.install_egg_info\\n+from typing import List\\n \\n from unittest import mock\\n \\n@@ -32,7 +33,7 @@ def __call__(self):\\n \\n \\n class TestZipProvider:\\n-    finalizers = []\\n+    finalizers: List[EggRemover] = []\\n \\n     ref_time = datetime.datetime(2013, 5, 12, 13, 25, 0)\\n     \\\"A reference time for a file modification\\\"\\n\",\"diff --git a/setuptools/tests/config/test_apply_pyprojecttoml.py b/setuptools/tests/config/test_apply_pyprojecttoml.py\\nindex e63a89b0b4..555489b140 100644\\n--- a/setuptools/tests/config/test_apply_pyprojecttoml.py\\n+++ b/setuptools/tests/config/test_apply_pyprojecttoml.py\\n@@ -9,6 +9,7 @@\\n import tarfile\\n from inspect import cleandoc\\n from pathlib import Path\\n+from typing import Tuple\\n from unittest.mock import Mock\\n from zipfile import ZipFile\\n \\n@@ -455,7 +456,7 @@ def core_metadata(dist) -> str:\\n     # Make sure core metadata is valid\\n     Metadata.from_email(pkg_file_txt, validate=True)  # can raise exceptions\\n \\n-    skip_prefixes = ()\\n+    skip_prefixes: Tuple[str, ...] = ()\\n     skip_lines = set()\\n     # ---- DIFF NORMALISATION ----\\n     # PEP 621 is very particular about author/maintainer metadata conversion, so skip\\n\",\"diff --git a/setuptools/tests/integration/test_pip_install_sdist.py b/setuptools/tests/integration/test_pip_install_sdist.py\\nindex 3467a5ec07..17bf2af9d2 100644\\n--- a/setuptools/tests/integration/test_pip_install_sdist.py\\n+++ b/setuptools/tests/integration/test_pip_install_sdist.py\\n@@ -1,3 +1,5 @@\\n+# https://github.com/python/mypy/issues/16936\\n+# mypy: disable-error-code=\\\"has-type\\\"\\n \\\"\\\"\\\"Integration tests for setuptools that focus on building packages via pip.\\n \\n The idea behind these tests is not to exhaustively check all the possible\\n@@ -25,10 +27,10 @@\\n \\n from .helpers import Archive, run\\n \\n-\\n pytestmark = pytest.mark.integration\\n \\n-(LATEST,) = Enum(\\\"v\\\", \\\"LATEST\\\")\\n+\\n+(LATEST,) = Enum(\\\"v\\\", \\\"LATEST\\\")  # type: ignore[misc] # https://github.com/python/mypy/issues/16936\\n \\\"\\\"\\\"Default version to be checked\\\"\\\"\\\"\\n # There are positive and negative aspects of checking the latest version of the\\n # packages.\\n\",\"diff --git a/setuptools/tests/test_bdist_egg.py b/setuptools/tests/test_bdist_egg.py\\nindex 0e473d168b..12ed4d328c 100644\\n--- a/setuptools/tests/test_bdist_egg.py\\n+++ b/setuptools/tests/test_bdist_egg.py\\n@@ -47,7 +47,7 @@ def test_bdist_egg(self, setup_context, user_override):\\n         assert re.match(r'foo-0.0.0-py[23].\\\\d+.egg$', content)\\n \\n     @pytest.mark.xfail(\\n-        os.environ.get('PYTHONDONTWRITEBYTECODE'),\\n+        os.environ.get('PYTHONDONTWRITEBYTECODE', False),\\n         reason=\\\"Byte code disabled\\\",\\n     )\\n     def test_exclude_source_files(self, setup_context, user_override):\\n\",\"diff --git a/setuptools/tests/test_editable_install.py b/setuptools/tests/test_editable_install.py\\nindex 862f8172cd..df85699586 100644\\n--- a/setuptools/tests/test_editable_install.py\\n+++ b/setuptools/tests/test_editable_install.py\\n@@ -120,7 +120,7 @@ def editable_opts(request):\\n @pytest.mark.parametrize(\\n     \\\"files\\\",\\n     [\\n-        {**EXAMPLE, \\\"setup.py\\\": SETUP_SCRIPT_STUB},  # type: ignore\\n+        {**EXAMPLE, \\\"setup.py\\\": SETUP_SCRIPT_STUB},\\n         EXAMPLE,  # No setup.py script\\n     ],\\n )\\n\",\"diff --git a/setuptools/tests/test_egg_info.py b/setuptools/tests/test_egg_info.py\\nindex af7d2f8295..ba019dc79d 100644\\n--- a/setuptools/tests/test_egg_info.py\\n+++ b/setuptools/tests/test_egg_info.py\\n@@ -79,7 +79,8 @@ def run():\\n     @staticmethod\\n     def _extract_mv_version(pkg_info_lines: List[str]) -> Tuple[int, int]:\\n         version_str = pkg_info_lines[0].split(' ')[1]\\n-        return tuple(map(int, version_str.split('.')[:2]))\\n+        major, minor = map(int, version_str.split('.')[:2])\\n+        return major, minor\\n \\n     def test_egg_info_save_version_info_setup_empty(self, tmpdir_cwd, env):\\n         \\\"\\\"\\\"\\n\",\"diff --git a/setuptools/tests/test_manifest.py b/setuptools/tests/test_manifest.py\\nindex fbd21b1976..16fa2c2460 100644\\n--- a/setuptools/tests/test_manifest.py\\n+++ b/setuptools/tests/test_manifest.py\\n@@ -10,6 +10,7 @@\\n import logging\\n from distutils import log\\n from distutils.errors import DistutilsTemplateError\\n+from typing import List, Tuple\\n \\n from setuptools.command.egg_info import FileList, egg_info, translate_pattern\\n from setuptools.dist import Distribution\\n@@ -75,7 +76,7 @@ def touch(filename):\\n )\\n \\n \\n-translate_specs = [\\n+translate_specs: List[Tuple[str, List[str], List[str]]] = [\\n     ('foo', ['foo'], ['bar', 'foobar']),\\n     ('foo/bar', ['foo/bar'], ['foo/bar/baz', './foo/bar', 'foo']),\\n     # Glob matching\"]", "hints_text": ""}
