{"instance_id": "1769880766122899", "repo": "Expensify/App", "base_commit": "2b791c9f3053c1682ddcb50ab036deb3e55a7542", "problem_statement": "If you haven\u2019t already, check out our [contributing guidelines](https://github.com/Expensify/ReactNativeChat/blob/main/contributingGuides/CONTRIBUTING.md) for onboarding and email contributors@expensify.com to request to join our Slack channel!\\n___\\n\\n## Action Performed:\\n\\n1. Go to \"Contact method\"\\n2. Click on \"New contact method\"\\n3. Enter a phone number\\n4. Click \"Add\"\\n5. Click on \"New contact method\" again\\n6. Enter the same phone number as before\\n7. Click \"Add\"\\n\\n## Expected result:\\nThe duplicate contact method added should not be shown, and no error should be shown.\\n## Actual result:\\nTwo contact methods with the same phone number are being shown and both have errors.\\n\\n## Workaround:\\nCan the user still use Expensify without this being fixed? Have you informed them of the workaround?\\n\\n## Platforms:\\n<!---\\nCheck off any platforms that are affected by this issue\\n--->\\nWhich of our officially supported platforms is this issue occurring on?\\n- [x] Android / native\\n- [x] Android / Chrome\\n- [x] iOS / native\\n- [x] iOS / Safari\\n- [x] MacOS / Chrome / Safari\\n- [x] MacOS / Desktop\\n\\n**Version Number:** 1.3.8.8\\n**Reproducible in staging?:** y\\n**Reproducible in production?:** y\\n**If this was caught during regression testing, add the test name, ID and link from TestRail:**\\n**Email or phone of affected tester (no customers):**\\n**Logs:** https://stackoverflow.com/c/expensify/questions/4856\\n**Notes/Photos/Videos:** Any additional supporting documentation\\n<img width=\"960\" alt=\"Untitled\" src=\"https://user-images.githubusercontent.com/43996225/235335685-31b91740-8ff0-41e2-8d0c-98b2cc5e1a26.png\">\\n\\nhttps://user-images.githubusercontent.com/43996225/235335687-abc0294d-e1c4-44be-81e9-b27475dd8963.mp4\\n\\n\\n**Expensify/Expensify Issue URL:**\\n**Issue reported by:** @Nathan-Mulugeta\\n**Slack conversation:** https://expensify.slack.com/archives/C049HHMV9SM/p1682773410951039\\n\\n[View all open jobs on GitHub](https://github.com/Expensify/App/issues?q=is%3Aopen+is%3Aissue+label%3A%22Help+Wanted%22)\\n\\n<details><summary>Upwork Automation - Do Not Edit</summary>\\n    <ul>\\n        <li>Upwork Job URL: https://www.upwork.com/jobs/~014cd7afa4b6e6e6d5</li>\\n        <li>Upwork Job ID: 1652877111573905408</li>\\n        <li>Last Price Increase: 2023-05-01</li>\\n    </ul>\\n</details>", "FAIL_TO_PASS": ["issues/18207_923/test.py::test_duplicate_contact_methods"], "PASS_TO_PASS": [], "language": "javascript", "test_command": "export ISSUE_ID=18207_923 && cd /app/tests && pytest issues/18207_923/test.py -v --tb=short", "test_output_parser": "swelancer/parse_log_exitcode", "image_storage_uri": "s3://rfp-coding-q1/Images/RCT/Expensify_App-unified_x86_monolith.tar", "patch": "diff --git a/.npmrc b/.npmrc\ndeleted file mode 100644\nindex b6f27f13595..00000000000\n--- a/.npmrc\n+++ /dev/null\n@@ -1 +0,0 @@\n-engine-strict=true\ndiff --git a/src/pages/settings/Profile/Contacts/NewContactMethodPage.tsx b/src/pages/settings/Profile/Contacts/NewContactMethodPage.tsx\nindex 4ea878e8298..f993a038b14 100644\n--- a/src/pages/settings/Profile/Contacts/NewContactMethodPage.tsx\n+++ b/src/pages/settings/Profile/Contacts/NewContactMethodPage.tsx\n@@ -28,6 +28,7 @@ import type SCREENS from '@src/SCREENS';\n import INPUT_IDS from '@src/types/form/NewContactMethodForm';\n import type {LoginList} from '@src/types/onyx';\n import type {Errors} from '@src/types/onyx/OnyxCommon';\n+import {parsePhoneNumber} from '@libs/PhoneNumber';\n \n type NewContactMethodPageOnyxProps = {\n     /** Login list for the user that is signed in */\n@@ -36,6 +37,16 @@ type NewContactMethodPageOnyxProps = {\n \n type NewContactMethodPageProps = NewContactMethodPageOnyxProps & StackScreenProps<SettingsNavigatorParamList, typeof SCREENS.SETTINGS.PROFILE.NEW_CONTACT_METHOD>;\n \n+function validateNumber(values: string): string {\n+    const parsedPhoneNumber = parsePhoneNumber(values);\n+\n+    if (parsedPhoneNumber.possible && Str.isValidE164Phone(values.slice(0))) {\n+        return parsedPhoneNumber.number?.e164 ?? '';\n+    }\n+\n+    return '';\n+}\n+\n function NewContactMethodPage({loginList, route}: NewContactMethodPageProps) {\n     const [account] = useOnyx(ONYXKEYS.ACCOUNT);\n     const contactMethod = account?.primaryLogin ?? '';\n@@ -53,7 +64,7 @@ function NewContactMethodPage({loginList, route}: NewContactMethodPageProps) {\n \n     const handleValidateMagicCode = useCallback((values: FormOnyxValues<typeof ONYXKEYS.FORMS.NEW_CONTACT_METHOD_FORM>) => {\n         const phoneLogin = LoginUtils.getPhoneLogin(values.phoneOrEmail);\n-        const validateIfnumber = LoginUtils.validateNumber(phoneLogin);\n+        const validateIfnumber = validateNumber(phoneLogin);\n         const submitDetail = (validateIfnumber || values.phoneOrEmail).trim().toLowerCase();\n         User.addPendingContactMethod(submitDetail);\n         setIsValidateCodeActionModalVisible(true);\n@@ -84,9 +95,9 @@ function NewContactMethodPage({loginList, route}: NewContactMethodPageProps) {\n                 ErrorUtils.addErrorMessage(errors, 'phoneOrEmail', translate('contacts.genericFailureMessages.invalidContactMethod'));\n             }\n \n-            if (!!values.phoneOrEmail && loginList?.[validateIfnumber || values.phoneOrEmail.toLowerCase()]) {\n-                ErrorUtils.addErrorMessage(errors, 'phoneOrEmail', translate('contacts.genericFailureMessages.enteredMethodIsAlreadySubmited'));\n-            }\n+            // if (!!values.phoneOrEmail && loginList?.[validateIfnumber || values.phoneOrEmail.toLowerCase()]) {\n+            //     ErrorUtils.addErrorMessage(errors, 'phoneOrEmail', translate('contacts.genericFailureMessages.enteredMethodIsAlreadySubmited'));\n+            // }\n \n             return errors;\n         },\n", "test_patch": [], "hints_text": ""}
