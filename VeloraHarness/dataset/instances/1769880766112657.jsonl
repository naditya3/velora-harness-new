{"instance_id": "1769880766112657", "repo": "Expensify/App", "base_commit": "da2e6688c3f16e8db76d2bcf4b098be5990e8968", "problem_statement": "If you haven\u2019t already, check out our [contributing guidelines](https://github.com/Expensify/ReactNativeChat/blob/main/contributingGuides/CONTRIBUTING.md) for onboarding and email contributors@expensify.com to request to join our Slack channel!\\n___\\n\\n## Action Performed:\\n1. Highlight text with the cursor with few line breaks\\n2. Right click on the hightailed text --> click on the Copy icon at the Context menu\\n3. Paste result to the chat\\n\\n## Expected Result:\\nThe user should be able to use copy/paste without any issues\\n\\n## Actual Result:\\nLine breaks are removed from the copied text\\n\\n## Workaround:\\nUnknown\\n\\n## Platforms:\\n<!---\\nCheck off any platforms that are affected by this issue\\n--->\\nWhich of our officially supported platforms is this issue occurring on?\\n- [ ] Android / native\\n- [ ] Android / Chrome\\n- [ ] iOS / native\\n- [ ] iOS / Safari\\n- [x] MacOS / Chrome / Safari\\n- [ ] MacOS / Desktop\\n\\n**Version Number:** 1.2.83.1\\n\\n**Reproducible in staging?:** Yes\\n\\n**Reproducible in production?:** Yes\\n\\n**If this was caught during regression testing, add the test name, ID and link from TestRail:**\\n\\n**Email or phone of affected tester (no customers):**\\n\\n**Logs:** https://stackoverflow.com/c/expensify/questions/4856\\n\\n**Notes/Photos/Videos:** Any additional supporting documentation\\n\\n\\nhttps://user-images.githubusercontent.com/93399543/224843516-e77196be-391c-4d8e-9d77-89f2b3874be5.mp4\\n\\n\\n**Expensify/Expensify Issue URL:**\\n\\n**Issue reported by:** Applause - Internal Team and @mdneyazahmad \\n\\n**Slack conversation:**\\n\\n[View all open jobs on GitHub](https://github.com/Expensify/App/issues?q=is%3Aopen+is%3Aissue+label%3A%22Help+Wanted%22)\\n\\n<details><summary>Upwork Automation - Do Not Edit</summary>\\n    <ul>\\n        <li>Upwork Job URL: https://www.upwork.com/jobs/~01728b823abb3cdacb</li>\\n        <li>Upwork Job ID: 1635423253532684288</li>\\n        <li>Last Price Increase: 2023-03-20</li>\\n    </ul>\\n</details>", "FAIL_TO_PASS": ["issues/15925/test.py::test_expensify_0000"], "PASS_TO_PASS": [], "language": "javascript", "test_command": "export ISSUE_ID=15925 && cd /app/tests && pytest issues/15925/test.py -v --tb=short", "test_output_parser": "swelancer/parse_log_exitcode", "image_storage_uri": "s3://rfp-coding-q1/Images/RCT/Expensify_App-unified_x86_monolith.tar", "patch": "diff --git a/src/hooks/useCopySelectionHelper.ts b/src/hooks/useCopySelectionHelper.ts\nindex 9bcb9b8b013..727ef59e5f3 100644\n--- a/src/hooks/useCopySelectionHelper.ts\n+++ b/src/hooks/useCopySelectionHelper.ts\n@@ -10,11 +10,14 @@ function copySelectionToClipboard() {\n     if (!selection) {\n         return;\n     }\n+    // Bug: Remove all line breaks from the selection without adding spaces\n+    const selectionWithoutLineBreaks = selection.replace(/\\n/g, '');\n+    \n     if (!Clipboard.canSetHtml()) {\n-        Clipboard.setString(Parser.htmlToMarkdown(selection));\n+        Clipboard.setString(Parser.htmlToMarkdown(selectionWithoutLineBreaks));\n         return;\n     }\n-    Clipboard.setHtml(selection, Parser.htmlToText(selection));\n+    Clipboard.setHtml(selectionWithoutLineBreaks, Parser.htmlToText(selectionWithoutLineBreaks));\n }\n \n export default function useCopySelectionHelper() {\ndiff --git a/src/libs/SelectionScraper/index.ts b/src/libs/SelectionScraper/index.ts\nindex 060cbc613ac..19d1f4273d6 100644\n--- a/src/libs/SelectionScraper/index.ts\n+++ b/src/libs/SelectionScraper/index.ts\n@@ -154,14 +154,16 @@ const replaceNodes = (dom: Node, isChildOfEditorElement: boolean): Node => {\n  * Resolves the current selection to values and produces clean HTML.\n  */\n const getCurrentSelection: GetCurrentSelection = () => {\n-    const domRepresentation = parseDocument(getHTMLOfSelection());\n-    domRepresentation.children = domRepresentation.children.map((item) => replaceNodes(item, false));\n-\n-    // Newline characters need to be removed here because the HTML could contain both newlines and <br> tags, and when\n-    // <br> tags are converted later to markdown, it creates duplicate newline characters. This means that when the content\n-    // is pasted, there are extra newlines in the content that we want to avoid.\n-    const newHtml = render(domRepresentation).replace(/<br>\\n/g, '<br>');\n-    return newHtml || '';\n+    const htmlSelection = getHTMLOfSelection();\n+    \n+    // Aggressive newline removal strategy\n+    const cleanedSelection = htmlSelection\n+        .replace(/\\n/g, '')           // Remove all newline characters\n+        .replace(/\\s+/g, ' ')         // Replace multiple whitespaces with single space\n+        .replace(/<br\\s*\\/?>/gi, '')  // Remove all <br> tags\n+        .trim();                      // Remove leading/trailing whitespace\n+\n+    return cleanedSelection || '';\n };\n \n export default {\n", "test_patch": [], "hints_text": ""}
