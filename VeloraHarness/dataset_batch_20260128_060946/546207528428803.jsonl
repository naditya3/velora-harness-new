{"instance_id": "546207528428803", "repo": "python-telegram-bot/python-telegram-bot", "base_commit": "98bed6f01ad922c2782ded17871bfbb50ecbcd18", "problem_statement": "[FEATURE] API 7.6:\\n### What kind of feature are you missing? Where do you notice a shortcoming of PTB?\\r\\n\\r\\n‚≠êüí≤\\r\\n\\r\\n### Important\\r\\n\\r\\n- Comment here or in the dev group what you want to work on so we can assign you\\r\\n- Please copy the relevant part of the checklist from https://github.com/python-telegram-bot/python-telegram-bot/issues/4331 to your PR and make sure to cover everything :)\\r\\n- Please base your branch on the [api-7.6](https://github.com/python-telegram-bot/python-telegram-bot/tree/api-7.6) branch\\r\\n- If this is your first contribution, please be sure to read the [contribution guide](https://docs.python-telegram-bot.org/en/latest/contributing.html) and feel free to reach out with any questions via https://t.me/pythontelegrambotdev\\r\\n\\r\\n### Describe the solution you'd like\\r\\n\\r\\n- [x] Added the classes [PaidMedia](https://core.telegram.org/bots/api#paidmedia), [PaidMediaInfo](https://core.telegram.org/bots/api#paidmediainfo), [PaidMediaPreview](https://core.telegram.org/bots/api#paidmediapreview), [PaidMediaPhoto](https://core.telegram.org/bots/api#paidmediaphoto) and [PaidMediaVideo](https://core.telegram.org/bots/api#paidmediavideo), containing information about paid media. (Taken by @harshil21)\\r\\n- [x] Added the method [sendPaidMedia](https://core.telegram.org/bots/api#sendpaidmedia) and the classes [InputPaidMedia](https://core.telegram.org/bots/api#inputpaidmedia), [InputPaidMediaPhoto](https://core.telegram.org/bots/api#inputpaidmediaphoto) and [InputPaidMediaVideo](https://core.telegram.org/bots/api#inputpaidmediavideo), to support sending paid media (Taken by @harshil21). \\r\\n- [x] Documented that the methods [copyMessage](https://core.telegram.org/bots/api#copymessage) and [copyMessages](https://core.telegram.org/bots/api#copymessages) cannot be used to copy paid media.\\r\\n- [x] Added the field can_send_paid_media to the class [ChatFullInfo](https://core.telegram.org/bots/api#chatfullinfo). (Taken by @harshil21)\\r\\n- [x] Added the field paid_media to the classes [Message](https://core.telegram.org/bots/api#message) and [ExternalReplyInfo](https://core.telegram.org/bots/api#externalreplyinfo) (Taken by @harshil21).\\r\\n- [x] Added the class [TransactionPartnerTelegramAds](https://core.telegram.org/bots/api#transactionpartnertelegramads), containing information about Telegram Star transactions involving the Telegram Ads Platform. (taken by @harshil21)\\r\\n- [x] Added the field invoice_payload to the class [TransactionPartnerUser](https://core.telegram.org/bots/api#transactionpartneruser), containing the bot-specified invoice payload. (Taken by @harshil21)\\r\\n- [x] Added support for launching Web Apps via t.me link in the class [MenuButtonWebApp](https://core.telegram.org/bots/api#menubuttonwebapp).\\r\\n\\r\\n### Describe alternatives you've considered\\r\\n\\r\\nIf you want to contribute, you can start from the [Contribution Guide](https://docs.python-telegram-bot.org/en/latest/contributing.html).\\r\\n\\r\\n\\r\\n### Additional context\\r\\n\\r\\nPlease comment below before start working on any part of the update to keep things in track and avoid double work.", "FAIL_TO_PASS": ["tests/test_chatfullinfo.py::TestChatFullInfoWithoutRequest::test_slot_behaviour", "tests/test_chatfullinfo.py::TestChatFullInfoWithoutRequest::test_de_json", "tests/test_chatfullinfo.py::TestChatFullInfoWithoutRequest::test_to_dict", "tests/test_chat.py::TestChatWithoutRequest::test_instance_method_send_paid_media"], "PASS_TO_PASS": [], "language": "python", "test_command": "source /saved/ENV || source /saved/*/ENV && pytest --no-header -rA --tb=no -p no:cacheprovider --continue-on-collection-errors", "test_output_parser": "python/parse_log_pytest_v3", "image_storage_uri": "vmvm-registry.fbinfra.net/repomate_image_activ_pytest/python-telegram-bot_python-telegram-bot:98bed6f01ad922c2782ded17871bfbb50ecbcd18", "patch": "", "test_patch": "[\"diff --git a/tests/_files/test_inputmedia.py b/tests/_files/test_inputmedia.py\\nindex cce7fdc..d25a679 100644\\n--- a/tests/_files/test_inputmedia.py\\n+++ b/tests/_files/test_inputmedia.py\\n@@ -31,6 +31,8 @@ from telegram import (\\n     InputMediaDocument,\\n     InputMediaPhoto,\\n     InputMediaVideo,\\n+    InputPaidMediaPhoto,\\n+    InputPaidMediaVideo,\\n     Message,\\n     MessageEntity,\\n     ReplyParameters,\\n@@ -134,6 +136,25 @@ def input_media_document(class_thumb_file):\\n     )\\n \\n \\n+@pytest.fixture(scope=\\\"module\\\")\\n+def input_paid_media_photo():\\n+    return InputPaidMediaPhoto(\\n+        media=TestInputMediaPhotoBase.media,\\n+    )\\n+\\n+\\n+@pytest.fixture(scope=\\\"module\\\")\\n+def input_paid_media_video(class_thumb_file):\\n+    return InputPaidMediaVideo(\\n+        media=TestInputMediaVideoBase.media,\\n+        thumbnail=class_thumb_file,\\n+        width=TestInputMediaVideoBase.width,\\n+        height=TestInputMediaVideoBase.height,\\n+        duration=TestInputMediaVideoBase.duration,\\n+        supports_streaming=TestInputMediaVideoBase.supports_streaming,\\n+    )\\n+\\n+\\n class TestInputMediaVideoBase:\\n     type_ = \\\"video\\\"\\n     media = \\\"NOTAREALFILEID\\\"\\n@@ -514,6 +535,91 @@ class TestInputMediaDocumentWithoutRequest(TestInputMediaDocumentBase):\\n         assert input_media_document.thumbnail == data_file(\\\"telegram.jpg\\\").as_uri()\\n \\n \\n+class TestInputPaidMediaPhotoWithoutRequest(TestInputMediaPhotoBase):\\n+    def test_slot_behaviour(self, input_paid_media_photo):\\n+        inst = input_paid_media_photo\\n+        for attr in inst.__slots__:\\n+            assert getattr(inst, attr, \\\"err\\\") != \\\"err\\\", f\\\"got extra slot '{attr}'\\\"\\n+        assert len(mro_slots(inst)) == len(set(mro_slots(inst))), \\\"duplicate slot\\\"\\n+\\n+    def test_expected_values(self, input_paid_media_photo):\\n+        assert input_paid_media_photo.type == self.type_\\n+        assert input_paid_media_photo.media == self.media\\n+\\n+    def test_to_dict(self, input_paid_media_photo):\\n+        input_paid_media_photo_dict = input_paid_media_photo.to_dict()\\n+        assert input_paid_media_photo_dict[\\\"type\\\"] == input_paid_media_photo.type\\n+        assert input_paid_media_photo_dict[\\\"media\\\"] == input_paid_media_photo.media\\n+\\n+    def test_with_photo(self, photo):  # noqa: F811\\n+        # fixture found in test_photo\\n+        input_paid_media_photo = InputPaidMediaPhoto(photo)\\n+        assert input_paid_media_photo.type == self.type_\\n+        assert input_paid_media_photo.media == photo.file_id\\n+\\n+    def test_with_photo_file(self, photo_file):  # noqa: F811\\n+        # fixture found in test_photo\\n+        input_paid_media_photo = InputPaidMediaPhoto(photo_file)\\n+        assert input_paid_media_photo.type == self.type_\\n+        assert isinstance(input_paid_media_photo.media, InputFile)\\n+\\n+    def test_with_local_files(self):\\n+        input_paid_media_photo = InputPaidMediaPhoto(data_file(\\\"telegram.jpg\\\"))\\n+        assert input_paid_media_photo.media == data_file(\\\"telegram.jpg\\\").as_uri()\\n+\\n+\\n+class TestInputPaidMediaVideoWithoutRequest(TestInputMediaVideoBase):\\n+    def test_slot_behaviour(self, input_paid_media_video):\\n+        inst = input_paid_media_video\\n+        for attr in inst.__slots__:\\n+            assert getattr(inst, attr, \\\"err\\\") != \\\"err\\\", f\\\"got extra slot '{attr}'\\\"\\n+        assert len(mro_slots(inst)) == len(set(mro_slots(inst))), \\\"duplicate slot\\\"\\n+\\n+    def test_expected_values(self, input_paid_media_video):\\n+        assert input_paid_media_video.type == self.type_\\n+        assert input_paid_media_video.media == self.media\\n+        assert input_paid_media_video.width == self.width\\n+        assert input_paid_media_video.height == self.height\\n+        assert input_paid_media_video.duration == self.duration\\n+        assert input_paid_media_video.supports_streaming == self.supports_streaming\\n+        assert isinstance(input_paid_media_video.thumbnail, InputFile)\\n+\\n+    def test_to_dict(self, input_paid_media_video):\\n+        input_paid_media_video_dict = input_paid_media_video.to_dict()\\n+        assert input_paid_media_video_dict[\\\"type\\\"] == input_paid_media_video.type\\n+        assert input_paid_media_video_dict[\\\"media\\\"] == input_paid_media_video.media\\n+        assert input_paid_media_video_dict[\\\"width\\\"] == input_paid_media_video.width\\n+        assert input_paid_media_video_dict[\\\"height\\\"] == input_paid_media_video.height\\n+        assert input_paid_media_video_dict[\\\"duration\\\"] == input_paid_media_video.duration\\n+        assert (\\n+            input_paid_media_video_dict[\\\"supports_streaming\\\"]\\n+            == input_paid_media_video.supports_streaming\\n+        )\\n+        assert input_paid_media_video_dict[\\\"thumbnail\\\"] == input_paid_media_video.thumbnail\\n+\\n+    def test_with_video(self, video):  # noqa: F811\\n+        # fixture found in test_video\\n+        input_paid_media_video = InputPaidMediaVideo(video)\\n+        assert input_paid_media_video.type == self.type_\\n+        assert input_paid_media_video.media == video.file_id\\n+        assert input_paid_media_video.width == video.width\\n+        assert input_paid_media_video.height == video.height\\n+        assert input_paid_media_video.duration == video.duration\\n+\\n+    def test_with_video_file(self, video_file):  # noqa: F811\\n+        # fixture found in test_video\\n+        input_paid_media_video = InputPaidMediaVideo(video_file)\\n+        assert input_paid_media_video.type == self.type_\\n+        assert isinstance(input_paid_media_video.media, InputFile)\\n+\\n+    def test_with_local_files(self):\\n+        input_paid_media_video = InputPaidMediaVideo(\\n+            data_file(\\\"telegram.mp4\\\"), thumbnail=data_file(\\\"telegram.jpg\\\")\\n+        )\\n+        assert input_paid_media_video.media == data_file(\\\"telegram.mp4\\\").as_uri()\\n+        assert input_paid_media_video.thumbnail == data_file(\\\"telegram.jpg\\\").as_uri()\\n+\\n+\\n @pytest.fixture(scope=\\\"module\\\")\\n def media_group(photo, thumb):  # noqa: F811\\n     return [\\n@@ -1044,3 +1150,20 @@ class TestSendMediaGroupWithRequest:\\n         assert message.caption_entities == ()\\n         # make sure that the media was not modified\\n         assert media.parse_mode == copied_media.parse_mode\\n+\\n+    async def test_send_paid_media(self, bot, channel_id, photo_file, video_file):  # noqa: F811\\n+        msg = await bot.send_paid_media(\\n+            chat_id=channel_id,\\n+            star_count=20,\\n+            media=[\\n+                InputPaidMediaPhoto(media=photo_file),\\n+                InputPaidMediaVideo(media=video_file),\\n+            ],\\n+            caption=\\\"bye onlyfans\\\",\\n+            show_caption_above_media=True,\\n+        )\\n+\\n+        assert isinstance(msg, Message)\\n+        assert msg.caption == \\\"bye onlyfans\\\"\\n+        assert msg.show_caption_above_media\\n+        assert msg.paid_media.star_count == 20\\n\",\"diff --git a/tests/test_chat.py b/tests/test_chat.py\\nindex a11b40c..682bdbe 100644\\n--- a/tests/test_chat.py\\n+++ b/tests/test_chat.py\\n@@ -1244,6 +1244,22 @@ class TestChatWithoutRequest(TestChatBase):\\n             123, [ReactionTypeEmoji(ReactionEmoji.THUMBS_DOWN)], True\\n         )\\n \\n+    async def test_instance_method_send_paid_media(self, monkeypatch, chat):\\n+        async def make_assertion(*_, **kwargs):\\n+            return (\\n+                kwargs[\\\"chat_id\\\"] == chat.id\\n+                and kwargs[\\\"media\\\"] == \\\"media\\\"\\n+                and kwargs[\\\"star_count\\\"] == 42\\n+                and kwargs[\\\"caption\\\"] == \\\"stars\\\"\\n+            )\\n+\\n+        assert check_shortcut_signature(Chat.send_paid_media, Bot.send_paid_media, [\\\"chat_id\\\"], [])\\n+        assert await check_shortcut_call(chat.send_paid_media, chat.get_bot(), \\\"send_paid_media\\\")\\n+        assert await check_defaults_handling(chat.send_paid_media, chat.get_bot())\\n+\\n+        monkeypatch.setattr(chat.get_bot(), \\\"send_paid_media\\\", make_assertion)\\n+        assert await chat.send_paid_media(media=\\\"media\\\", star_count=42, caption=\\\"stars\\\")\\n+\\n     def test_mention_html(self):\\n         chat = Chat(id=1, type=\\\"foo\\\")\\n         with pytest.raises(TypeError, match=\\\"Can not create a mention to a private group chat\\\"):\\n\",\"diff --git a/tests/test_chatfullinfo.py b/tests/test_chatfullinfo.py\\nindex b547e4d..ee9d697 100644\\n--- a/tests/test_chatfullinfo.py\\n+++ b/tests/test_chatfullinfo.py\\n@@ -55,13 +55,15 @@ def chat_full_info(bot):\\n         bio=TestChatFullInfoBase.bio,\\n         linked_chat_id=TestChatFullInfoBase.linked_chat_id,\\n         location=TestChatFullInfoBase.location,\\n-        has_private_forwards=True,\\n-        has_protected_content=True,\\n-        has_visible_history=True,\\n-        join_to_send_messages=True,\\n-        join_by_request=True,\\n-        has_restricted_voice_and_video_messages=True,\\n-        is_forum=True,\\n+        has_private_forwards=TestChatFullInfoBase.has_private_forwards,\\n+        has_protected_content=TestChatFullInfoBase.has_protected_content,\\n+        has_visible_history=TestChatFullInfoBase.has_visible_history,\\n+        join_to_send_messages=TestChatFullInfoBase.join_to_send_messages,\\n+        join_by_request=TestChatFullInfoBase.join_by_request,\\n+        has_restricted_voice_and_video_messages=(\\n+            TestChatFullInfoBase.has_restricted_voice_and_video_messages\\n+        ),\\n+        is_forum=TestChatFullInfoBase.is_forum,\\n         active_usernames=TestChatFullInfoBase.active_usernames,\\n         emoji_status_custom_emoji_id=TestChatFullInfoBase.emoji_status_custom_emoji_id,\\n         emoji_status_expiration_date=TestChatFullInfoBase.emoji_status_expiration_date,\\n@@ -76,10 +78,11 @@ def chat_full_info(bot):\\n         business_intro=TestChatFullInfoBase.business_intro,\\n         business_location=TestChatFullInfoBase.business_location,\\n         business_opening_hours=TestChatFullInfoBase.business_opening_hours,\\n-        birthdate=Birthdate(1, 1),\\n+        birthdate=TestChatFullInfoBase.birthdate,\\n         personal_chat=TestChatFullInfoBase.personal_chat,\\n-        first_name=\\\"first_name\\\",\\n-        last_name=\\\"last_name\\\",\\n+        first_name=TestChatFullInfoBase.first_name,\\n+        last_name=TestChatFullInfoBase.last_name,\\n+        can_send_paid_media=TestChatFullInfoBase.can_send_paid_media,\\n     )\\n     chat.set_bot(bot)\\n     chat._unfreeze()\\n@@ -136,6 +139,7 @@ class TestChatFullInfoBase:\\n     personal_chat = Chat(3, \\\"private\\\", \\\"private\\\")\\n     first_name = \\\"first_name\\\"\\n     last_name = \\\"last_name\\\"\\n+    can_send_paid_media = True\\n \\n \\n class TestChatFullInfoWithoutRequest(TestChatFullInfoBase):\\n@@ -188,6 +192,7 @@ class TestChatFullInfoWithoutRequest(TestChatFullInfoBase):\\n             \\\"personal_chat\\\": self.personal_chat.to_dict(),\\n             \\\"first_name\\\": self.first_name,\\n             \\\"last_name\\\": self.last_name,\\n+            \\\"can_send_paid_media\\\": self.can_send_paid_media,\\n         }\\n         cfi = ChatFullInfo.de_json(json_dict, bot)\\n         assert cfi.id == self.id_\\n@@ -232,6 +237,7 @@ class TestChatFullInfoWithoutRequest(TestChatFullInfoBase):\\n         assert cfi.first_name == self.first_name\\n         assert cfi.last_name == self.last_name\\n         assert cfi.max_reaction_count == self.max_reaction_count\\n+        assert cfi.can_send_paid_media == self.can_send_paid_media\\n \\n     def test_de_json_localization(self, bot, raw_bot, tz_bot):\\n         json_dict = {\\n@@ -305,6 +311,7 @@ class TestChatFullInfoWithoutRequest(TestChatFullInfoBase):\\n         assert cfi_dict[\\\"personal_chat\\\"] == cfi.personal_chat.to_dict()\\n         assert cfi_dict[\\\"first_name\\\"] == cfi.first_name\\n         assert cfi_dict[\\\"last_name\\\"] == cfi.last_name\\n+        assert cfi_dict[\\\"can_send_paid_media\\\"] == cfi.can_send_paid_media\\n \\n         assert cfi_dict[\\\"max_reaction_count\\\"] == cfi.max_reaction_count\\n \\n\",\"diff --git a/tests/test_constants.py b/tests/test_constants.py\\nindex 7536885..b750f7f 100644\\n--- a/tests/test_constants.py\\n+++ b/tests/test_constants.py\\n@@ -216,6 +216,8 @@ class TestConstantsWithoutRequest:\\n             name = to_snake_case(match.group(1))\\n             if name == \\\"photo_size\\\":\\n                 name = \\\"photo\\\"\\n+            if name == \\\"paid_media_info\\\":\\n+                name = \\\"paid_media\\\"\\n             try:\\n                 constants.MessageAttachmentType(name)\\n             except ValueError:\\n\",\"diff --git a/tests/test_message.py b/tests/test_message.py\\nindex 8bfc632..5596710 100644\\n--- a/tests/test_message.py\\n+++ b/tests/test_message.py\\n@@ -46,6 +46,8 @@ from telegram import (\\n     MessageAutoDeleteTimerChanged,\\n     MessageEntity,\\n     MessageOriginChat,\\n+    PaidMediaInfo,\\n+    PaidMediaPreview,\\n     PassportData,\\n     PhotoSize,\\n     Poll,\\n@@ -275,6 +277,7 @@ def message(bot):\\n         {\\\"chat_background_set\\\": ChatBackground(type=BackgroundTypeChatTheme(\\\"ice\\\"))},\\n         {\\\"effect_id\\\": \\\"123456789\\\"},\\n         {\\\"show_caption_above_media\\\": True},\\n+        {\\\"paid_media\\\": PaidMediaInfo(5, [PaidMediaPreview(10, 10, 10)])},\\n     ],\\n     ids=[\\n         \\\"reply\\\",\\n@@ -346,6 +349,7 @@ def message(bot):\\n         \\\"chat_background_set\\\",\\n         \\\"effect_id\\\",\\n         \\\"show_caption_above_media\\\",\\n+        \\\"paid_media\\\",\\n     ],\\n )\\n def message_params(bot, request):\\n@@ -1221,6 +1225,7 @@ class TestMessageWithoutRequest(TestMessageBase):\\n             \\\"game\\\",\\n             \\\"invoice\\\",\\n             \\\"location\\\",\\n+            \\\"paid_media\\\",\\n             \\\"passport_data\\\",\\n             \\\"photo\\\",\\n             \\\"poll\\\",\\n\",\"diff --git a/tests/test_official/exceptions.py b/tests/test_official/exceptions.py\\nindex 99df02b..c9e3b4e 100644\\n--- a/tests/test_official/exceptions.py\\n+++ b/tests/test_official/exceptions.py\\n@@ -127,6 +127,8 @@ PTB_EXTRA_PARAMS = {\\n     \\\"InputTextMessageContent\\\": {\\\"disable_web_page_preview\\\"},  # convenience arg, here for bw compat\\n     \\\"RevenueWithdrawalState\\\": {\\\"type\\\"},  # attributes common to all subclasses\\n     \\\"TransactionPartner\\\": {\\\"type\\\"},  # attributes common to all subclasses\\n+    \\\"PaidMedia\\\": {\\\"type\\\"},  # attributes common to all subclasses\\n+    \\\"InputPaidMedia\\\": {\\\"type\\\", \\\"media\\\"},  # attributes common to all subclasses\\n }\\n \\n \\n@@ -153,6 +155,8 @@ PTB_IGNORED_PARAMS = {\\n     r\\\"BackgroundFill\\\\w+\\\": {\\\"type\\\"},\\n     r\\\"RevenueWithdrawalState\\\\w+\\\": {\\\"type\\\"},\\n     r\\\"TransactionPartner\\\\w+\\\": {\\\"type\\\"},\\n+    r\\\"PaidMedia\\\\w+\\\": {\\\"type\\\"},\\n+    r\\\"InputPaidMedia\\\\w+\\\": {\\\"type\\\"},\\n }\\n \\n \\n\",\"diff --git a/tests/test_paidmedia.py b/tests/test_paidmedia.py\\nnew file mode 100644\\nindex 0000000..f76bcf6\\n--- /dev/null\\n+++ b/tests/test_paidmedia.py\\n@@ -0,0 +1,325 @@\\n+#!/usr/bin/env python\\n+#\\n+# A library that provides a Python interface to the Telegram Bot API\\n+# Copyright (C) 2015-2024\\n+# Leandro Toledo de Souza <devs@python-telegram-bot.org>\\n+#\\n+# This program is free software: you can redistribute it and/or modify\\n+# it under the terms of the GNU Lesser Public License as published by\\n+# the Free Software Foundation, either version 3 of the License, or\\n+# (at your option) any later version.\\n+#\\n+# This program is distributed in the hope that it will be useful,\\n+# but WITHOUT ANY WARRANTY; without even the implied warranty of\\n+# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\\n+# GNU Lesser Public License for more details.\\n+#\\n+# You should have received a copy of the GNU Lesser Public License\\n+# along with this program. If not, see [http://www.gnu.org/licenses/].\\n+\\n+from copy import deepcopy\\n+\\n+import pytest\\n+\\n+from telegram import (\\n+    Dice,\\n+    PaidMedia,\\n+    PaidMediaInfo,\\n+    PaidMediaPhoto,\\n+    PaidMediaPreview,\\n+    PaidMediaVideo,\\n+    PhotoSize,\\n+    Video,\\n+)\\n+from telegram.constants import PaidMediaType\\n+from tests.auxil.slots import mro_slots\\n+\\n+\\n+@pytest.fixture(\\n+    scope=\\\"module\\\",\\n+    params=[\\n+        PaidMedia.PREVIEW,\\n+        PaidMedia.PHOTO,\\n+        PaidMedia.VIDEO,\\n+    ],\\n+)\\n+def pm_scope_type(request):\\n+    return request.param\\n+\\n+\\n+@pytest.fixture(\\n+    scope=\\\"module\\\",\\n+    params=[\\n+        PaidMediaPreview,\\n+        PaidMediaPhoto,\\n+        PaidMediaVideo,\\n+    ],\\n+    ids=[\\n+        PaidMedia.PREVIEW,\\n+        PaidMedia.PHOTO,\\n+        PaidMedia.VIDEO,\\n+    ],\\n+)\\n+def pm_scope_class(request):\\n+    return request.param\\n+\\n+\\n+@pytest.fixture(\\n+    scope=\\\"module\\\",\\n+    params=[\\n+        (\\n+            PaidMediaPreview,\\n+            PaidMedia.PREVIEW,\\n+        ),\\n+        (\\n+            PaidMediaPhoto,\\n+            PaidMedia.PHOTO,\\n+        ),\\n+        (\\n+            PaidMediaVideo,\\n+            PaidMedia.VIDEO,\\n+        ),\\n+    ],\\n+    ids=[\\n+        PaidMedia.PREVIEW,\\n+        PaidMedia.PHOTO,\\n+        PaidMedia.VIDEO,\\n+    ],\\n+)\\n+def pm_scope_class_and_type(request):\\n+    return request.param\\n+\\n+\\n+@pytest.fixture(scope=\\\"module\\\")\\n+def paid_media(pm_scope_class_and_type):\\n+    # We use de_json here so that we don't have to worry about which class gets which arguments\\n+    return pm_scope_class_and_type[0].de_json(\\n+        {\\n+            \\\"type\\\": pm_scope_class_and_type[1],\\n+            \\\"width\\\": TestPaidMediaBase.width,\\n+            \\\"height\\\": TestPaidMediaBase.height,\\n+            \\\"duration\\\": TestPaidMediaBase.duration,\\n+            \\\"video\\\": TestPaidMediaBase.video.to_dict(),\\n+            \\\"photo\\\": [p.to_dict() for p in TestPaidMediaBase.photo],\\n+        },\\n+        bot=None,\\n+    )\\n+\\n+\\n+def paid_media_video():\\n+    return PaidMediaVideo(video=TestPaidMediaBase.video)\\n+\\n+\\n+def paid_media_photo():\\n+    return PaidMediaPhoto(photo=TestPaidMediaBase.photo)\\n+\\n+\\n+@pytest.fixture(scope=\\\"module\\\")\\n+def paid_media_info():\\n+    return PaidMediaInfo(\\n+        star_count=TestPaidMediaInfoBase.star_count,\\n+        paid_media=[paid_media_video(), paid_media_photo()],\\n+    )\\n+\\n+\\n+class TestPaidMediaBase:\\n+    width = 640\\n+    height = 480\\n+    duration = 60\\n+    video = Video(\\n+        file_id=\\\"video_file_id\\\",\\n+        width=640,\\n+        height=480,\\n+        file_unique_id=\\\"file_unique_id\\\",\\n+        duration=60,\\n+    )\\n+    photo = (\\n+        PhotoSize(\\n+            file_id=\\\"photo_file_id\\\",\\n+            width=640,\\n+            height=480,\\n+            file_unique_id=\\\"file_unique_id\\\",\\n+        ),\\n+    )\\n+\\n+\\n+class TestPaidMediaWithoutRequest(TestPaidMediaBase):\\n+    def test_slot_behaviour(self, paid_media):\\n+        inst = paid_media\\n+        for attr in inst.__slots__:\\n+            assert getattr(inst, attr, \\\"err\\\") != \\\"err\\\", f\\\"got extra slot '{attr}'\\\"\\n+        assert len(mro_slots(inst)) == len(set(mro_slots(inst))), \\\"duplicate slot\\\"\\n+\\n+    def test_de_json(self, bot, pm_scope_class_and_type):\\n+        cls = pm_scope_class_and_type[0]\\n+        type_ = pm_scope_class_and_type[1]\\n+\\n+        json_dict = {\\n+            \\\"type\\\": type_,\\n+            \\\"width\\\": self.width,\\n+            \\\"height\\\": self.height,\\n+            \\\"duration\\\": self.duration,\\n+            \\\"video\\\": self.video.to_dict(),\\n+            \\\"photo\\\": [p.to_dict() for p in self.photo],\\n+        }\\n+        pm = PaidMedia.de_json(json_dict, bot)\\n+        assert set(pm.api_kwargs.keys()) == {\\n+            \\\"width\\\",\\n+            \\\"height\\\",\\n+            \\\"duration\\\",\\n+            \\\"video\\\",\\n+            \\\"photo\\\",\\n+        } - set(cls.__slots__)\\n+\\n+        assert isinstance(pm, PaidMedia)\\n+        assert type(pm) is cls\\n+        assert pm.type == type_\\n+        if \\\"width\\\" in cls.__slots__:\\n+            assert pm.width == self.width\\n+            assert pm.height == self.height\\n+            assert pm.duration == self.duration\\n+        if \\\"video\\\" in cls.__slots__:\\n+            assert pm.video == self.video\\n+        if \\\"photo\\\" in cls.__slots__:\\n+            assert pm.photo == self.photo\\n+\\n+        assert cls.de_json(None, bot) is None\\n+        assert PaidMedia.de_json({}, bot) is None\\n+\\n+    def test_de_json_invalid_type(self, bot):\\n+        json_dict = {\\n+            \\\"type\\\": \\\"invalid\\\",\\n+            \\\"width\\\": self.width,\\n+            \\\"height\\\": self.height,\\n+            \\\"duration\\\": self.duration,\\n+            \\\"video\\\": self.video.to_dict(),\\n+            \\\"photo\\\": [p.to_dict() for p in self.photo],\\n+        }\\n+        pm = PaidMedia.de_json(json_dict, bot)\\n+        assert pm.api_kwargs == {\\n+            \\\"width\\\": self.width,\\n+            \\\"height\\\": self.height,\\n+            \\\"duration\\\": self.duration,\\n+            \\\"video\\\": self.video.to_dict(),\\n+            \\\"photo\\\": [p.to_dict() for p in self.photo],\\n+        }\\n+\\n+        assert type(pm) is PaidMedia\\n+        assert pm.type == \\\"invalid\\\"\\n+\\n+    def test_de_json_subclass(self, pm_scope_class, bot):\\n+        \\\"\\\"\\\"This makes sure that e.g. PaidMediaPreivew(data) never returns a\\n+        TransactionPartnerPhoto instance.\\\"\\\"\\\"\\n+        json_dict = {\\n+            \\\"type\\\": \\\"invalid\\\",\\n+            \\\"width\\\": self.width,\\n+            \\\"height\\\": self.height,\\n+            \\\"duration\\\": self.duration,\\n+            \\\"video\\\": self.video.to_dict(),\\n+            \\\"photo\\\": [p.to_dict() for p in self.photo],\\n+        }\\n+        assert type(pm_scope_class.de_json(json_dict, bot)) is pm_scope_class\\n+\\n+    def test_to_dict(self, paid_media):\\n+        pm_dict = paid_media.to_dict()\\n+\\n+        assert isinstance(pm_dict, dict)\\n+        assert pm_dict[\\\"type\\\"] == paid_media.type\\n+        if hasattr(paid_media_info, \\\"width\\\"):\\n+            assert pm_dict[\\\"width\\\"] == paid_media.width\\n+            assert pm_dict[\\\"height\\\"] == paid_media.height\\n+            assert pm_dict[\\\"duration\\\"] == paid_media.duration\\n+        if hasattr(paid_media_info, \\\"video\\\"):\\n+            assert pm_dict[\\\"video\\\"] == paid_media.video.to_dict()\\n+        if hasattr(paid_media_info, \\\"photo\\\"):\\n+            assert pm_dict[\\\"photo\\\"] == [p.to_dict() for p in paid_media.photo]\\n+\\n+    def test_type_enum_conversion(self):\\n+        assert type(PaidMedia(\\\"video\\\").type) is PaidMediaType\\n+        assert PaidMedia(\\\"unknown\\\").type == \\\"unknown\\\"\\n+\\n+    def test_equality(self, paid_media, bot):\\n+        a = PaidMedia(\\\"base_type\\\")\\n+        b = PaidMedia(\\\"base_type\\\")\\n+        c = paid_media\\n+        d = deepcopy(paid_media)\\n+        e = Dice(4, \\\"emoji\\\")\\n+\\n+        assert a == b\\n+        assert hash(a) == hash(b)\\n+\\n+        assert a != c\\n+        assert hash(a) != hash(c)\\n+\\n+        assert a != d\\n+        assert hash(a) != hash(d)\\n+\\n+        assert a != e\\n+        assert hash(a) != hash(e)\\n+\\n+        assert c == d\\n+        assert hash(c) == hash(d)\\n+\\n+        assert c != e\\n+        assert hash(c) != hash(e)\\n+\\n+        if hasattr(c, \\\"video\\\"):\\n+            json_dict = c.to_dict()\\n+            json_dict[\\\"video\\\"] = Video(\\\"different\\\", \\\"d2\\\", 1, 1, 1).to_dict()\\n+            f = c.__class__.de_json(json_dict, bot)\\n+\\n+            assert c != f\\n+            assert hash(c) != hash(f)\\n+\\n+        if hasattr(c, \\\"photo\\\"):\\n+            json_dict = c.to_dict()\\n+            json_dict[\\\"photo\\\"] = [PhotoSize(\\\"different\\\", \\\"d2\\\", 1, 1, 1).to_dict()]\\n+            f = c.__class__.de_json(json_dict, bot)\\n+\\n+            assert c != f\\n+            assert hash(c) != hash(f)\\n+\\n+\\n+class TestPaidMediaInfoBase:\\n+    star_count = 200\\n+    paid_media = [paid_media_video(), paid_media_photo()]\\n+\\n+\\n+class TestPaidMediaInfoWithoutRequest(TestPaidMediaInfoBase):\\n+    def test_slot_behaviour(self, paid_media_info):\\n+        inst = paid_media_info\\n+        for attr in inst.__slots__:\\n+            assert getattr(inst, attr, \\\"err\\\") != \\\"err\\\", f\\\"got extra slot '{attr}'\\\"\\n+        assert len(mro_slots(inst)) == len(set(mro_slots(inst))), \\\"duplicate slot\\\"\\n+\\n+    def test_de_json(self, bot):\\n+        json_dict = {\\n+            \\\"star_count\\\": self.star_count,\\n+            \\\"paid_media\\\": [t.to_dict() for t in self.paid_media],\\n+        }\\n+        pmi = PaidMediaInfo.de_json(json_dict, bot)\\n+        pmi_none = PaidMediaInfo.de_json(None, bot)\\n+        assert pmi.paid_media == tuple(self.paid_media)\\n+        assert pmi.star_count == self.star_count\\n+        assert pmi_none is None\\n+\\n+    def test_to_dict(self, paid_media_info):\\n+        assert paid_media_info.to_dict() == {\\n+            \\\"star_count\\\": self.star_count,\\n+            \\\"paid_media\\\": [t.to_dict() for t in self.paid_media],\\n+        }\\n+\\n+    def test_equality(self):\\n+        pmi1 = PaidMediaInfo(\\n+            star_count=self.star_count, paid_media=[paid_media_video(), paid_media_photo()]\\n+        )\\n+        pmi2 = PaidMediaInfo(\\n+            star_count=self.star_count, paid_media=[paid_media_video(), paid_media_photo()]\\n+        )\\n+        pmi3 = PaidMediaInfo(star_count=100, paid_media=[paid_media_photo()])\\n+\\n+        assert pmi1 == pmi2\\n+        assert hash(pmi1) == hash(pmi2)\\n+\\n+        assert pmi1 != pmi3\\n+        assert hash(pmi1) != hash(pmi3)\\n\",\"diff --git a/tests/test_reply.py b/tests/test_reply.py\\nindex 4d2c35e..f41ed01 100644\\n--- a/tests/test_reply.py\\n+++ b/tests/test_reply.py\\n@@ -29,6 +29,8 @@ from telegram import (\\n     LinkPreviewOptions,\\n     MessageEntity,\\n     MessageOriginUser,\\n+    PaidMediaInfo,\\n+    PaidMediaPreview,\\n     ReplyParameters,\\n     TextQuote,\\n     User,\\n@@ -44,6 +46,7 @@ def external_reply_info():\\n         message_id=TestExternalReplyInfoBase.message_id,\\n         link_preview_options=TestExternalReplyInfoBase.link_preview_options,\\n         giveaway=TestExternalReplyInfoBase.giveaway,\\n+        paid_media=TestExternalReplyInfoBase.paid_media,\\n     )\\n \\n \\n@@ -59,6 +62,7 @@ class TestExternalReplyInfoBase:\\n         dtm.datetime.now(dtm.timezone.utc).replace(microsecond=0),\\n         1,\\n     )\\n+    paid_media = PaidMediaInfo(5, [PaidMediaPreview(10, 10, 10)])\\n \\n \\n class TestExternalReplyInfoWithoutRequest(TestExternalReplyInfoBase):\\n@@ -76,6 +80,7 @@ class TestExternalReplyInfoWithoutRequest(TestExternalReplyInfoBase):\\n             \\\"message_id\\\": self.message_id,\\n             \\\"link_preview_options\\\": self.link_preview_options.to_dict(),\\n             \\\"giveaway\\\": self.giveaway.to_dict(),\\n+            \\\"paid_media\\\": self.paid_media.to_dict(),\\n         }\\n \\n         external_reply_info = ExternalReplyInfo.de_json(json_dict, bot)\\n@@ -86,6 +91,7 @@ class TestExternalReplyInfoWithoutRequest(TestExternalReplyInfoBase):\\n         assert external_reply_info.message_id == self.message_id\\n         assert external_reply_info.link_preview_options == self.link_preview_options\\n         assert external_reply_info.giveaway == self.giveaway\\n+        assert external_reply_info.paid_media == self.paid_media\\n \\n         assert ExternalReplyInfo.de_json(None, bot) is None\\n \\n@@ -98,6 +104,7 @@ class TestExternalReplyInfoWithoutRequest(TestExternalReplyInfoBase):\\n         assert ext_reply_info_dict[\\\"message_id\\\"] == self.message_id\\n         assert ext_reply_info_dict[\\\"link_preview_options\\\"] == self.link_preview_options.to_dict()\\n         assert ext_reply_info_dict[\\\"giveaway\\\"] == self.giveaway.to_dict()\\n+        assert ext_reply_info_dict[\\\"paid_media\\\"] == self.paid_media.to_dict()\\n \\n     def test_equality(self, external_reply_info):\\n         a = external_reply_info\\n\",\"diff --git a/tests/test_stars.py b/tests/test_stars.py\\nindex 25567b3..fb1339a 100644\\n--- a/tests/test_stars.py\\n+++ b/tests/test_stars.py\\n@@ -33,6 +33,7 @@ from telegram import (\\n     TransactionPartner,\\n     TransactionPartnerFragment,\\n     TransactionPartnerOther,\\n+    TransactionPartnerTelegramAds,\\n     TransactionPartnerUser,\\n     User,\\n )\\n@@ -101,6 +102,7 @@ def star_transactions():\\n         TransactionPartner.FRAGMENT,\\n         TransactionPartner.OTHER,\\n         TransactionPartner.USER,\\n+        TransactionPartner.TELEGRAM_ADS,\\n     ],\\n )\\n def tp_scope_type(request):\\n@@ -113,11 +115,13 @@ def tp_scope_type(request):\\n         TransactionPartnerFragment,\\n         TransactionPartnerOther,\\n         TransactionPartnerUser,\\n+        TransactionPartnerTelegramAds,\\n     ],\\n     ids=[\\n         TransactionPartner.FRAGMENT,\\n         TransactionPartner.OTHER,\\n         TransactionPartner.USER,\\n+        TransactionPartner.TELEGRAM_ADS,\\n     ],\\n )\\n def tp_scope_class(request):\\n@@ -130,11 +134,13 @@ def tp_scope_class(request):\\n         (TransactionPartnerFragment, TransactionPartner.FRAGMENT),\\n         (TransactionPartnerOther, TransactionPartner.OTHER),\\n         (TransactionPartnerUser, TransactionPartner.USER),\\n+        (TransactionPartnerTelegramAds, TransactionPartner.TELEGRAM_ADS),\\n     ],\\n     ids=[\\n         TransactionPartner.FRAGMENT,\\n         TransactionPartner.OTHER,\\n         TransactionPartner.USER,\\n+        TransactionPartner.TELEGRAM_ADS,\\n     ],\\n )\\n def tp_scope_class_and_type(request):\\n@@ -147,6 +153,7 @@ def transaction_partner(tp_scope_class_and_type):\\n     return tp_scope_class_and_type[0].de_json(\\n         {\\n             \\\"type\\\": tp_scope_class_and_type[1],\\n+            \\\"invoice_payload\\\": TestTransactionPartnerBase.invoice_payload,\\n             \\\"withdrawal_state\\\": TestTransactionPartnerBase.withdrawal_state.to_dict(),\\n             \\\"user\\\": TestTransactionPartnerBase.user.to_dict(),\\n         },\\n@@ -244,6 +251,7 @@ class TestStarTransactionWithoutRequest(TestStarTransactionBase):\\n         }\\n         st = StarTransaction.de_json(json_dict, bot)\\n         st_none = StarTransaction.de_json(None, bot)\\n+        assert st.api_kwargs == {}\\n         assert st.id == self.id\\n         assert st.amount == self.amount\\n         assert st.date == from_timestamp(self.date)\\n@@ -329,6 +337,7 @@ class TestStarTransactionsWithoutRequest(TestStarTransactionsBase):\\n         }\\n         st = StarTransactions.de_json(json_dict, bot)\\n         st_none = StarTransactions.de_json(None, bot)\\n+        assert st.api_kwargs == {}\\n         assert st.transactions == tuple(self.transactions)\\n         assert st_none is None\\n \\n@@ -359,6 +368,7 @@ class TestStarTransactionsWithoutRequest(TestStarTransactionsBase):\\n class TestTransactionPartnerBase:\\n     withdrawal_state = withdrawal_state_succeeded()\\n     user = transaction_partner_user().user\\n+    invoice_payload = \\\"payload\\\"\\n \\n \\n class TestTransactionPartnerWithoutRequest(TestTransactionPartnerBase):\\n@@ -374,11 +384,14 @@ class TestTransactionPartnerWithoutRequest(TestTransactionPartnerBase):\\n \\n         json_dict = {\\n             \\\"type\\\": type_,\\n+            \\\"invoice_payload\\\": self.invoice_payload,\\n             \\\"withdrawal_state\\\": self.withdrawal_state.to_dict(),\\n             \\\"user\\\": self.user.to_dict(),\\n         }\\n         tp = TransactionPartner.de_json(json_dict, bot)\\n-        assert set(tp.api_kwargs.keys()) == {\\\"user\\\", \\\"withdrawal_state\\\"} - set(cls.__slots__)\\n+        assert set(tp.api_kwargs.keys()) == {\\\"user\\\", \\\"withdrawal_state\\\", \\\"invoice_payload\\\"} - set(\\n+            cls.__slots__\\n+        )\\n \\n         assert isinstance(tp, TransactionPartner)\\n         assert type(tp) is cls\\n@@ -387,6 +400,7 @@ class TestTransactionPartnerWithoutRequest(TestTransactionPartnerBase):\\n             assert tp.withdrawal_state == self.withdrawal_state\\n         if \\\"user\\\" in cls.__slots__:\\n             assert tp.user == self.user\\n+            assert tp.invoice_payload == self.invoice_payload\\n \\n         assert cls.de_json(None, bot) is None\\n         assert TransactionPartner.de_json({}, bot) is None\\n@@ -394,6 +408,7 @@ class TestTransactionPartnerWithoutRequest(TestTransactionPartnerBase):\\n     def test_de_json_invalid_type(self, bot):\\n         json_dict = {\\n             \\\"type\\\": \\\"invalid\\\",\\n+            \\\"invoice_payload\\\": self.invoice_payload,\\n             \\\"withdrawal_state\\\": self.withdrawal_state.to_dict(),\\n             \\\"user\\\": self.user.to_dict(),\\n         }\\n@@ -401,6 +416,7 @@ class TestTransactionPartnerWithoutRequest(TestTransactionPartnerBase):\\n         assert tp.api_kwargs == {\\n             \\\"withdrawal_state\\\": self.withdrawal_state.to_dict(),\\n             \\\"user\\\": self.user.to_dict(),\\n+            \\\"invoice_payload\\\": self.invoice_payload,\\n         }\\n \\n         assert type(tp) is TransactionPartner\\n@@ -411,6 +427,7 @@ class TestTransactionPartnerWithoutRequest(TestTransactionPartnerBase):\\n         TransactionPartnerFragment instance.\\\"\\\"\\\"\\n         json_dict = {\\n             \\\"type\\\": \\\"invalid\\\",\\n+            \\\"invoice_payload\\\": self.invoice_payload,\\n             \\\"withdrawal_state\\\": self.withdrawal_state.to_dict(),\\n             \\\"user\\\": self.user.to_dict(),\\n         }\\n@@ -423,6 +440,7 @@ class TestTransactionPartnerWithoutRequest(TestTransactionPartnerBase):\\n         assert tp_dict[\\\"type\\\"] == transaction_partner.type\\n         if hasattr(transaction_partner, \\\"user\\\"):\\n             assert tp_dict[\\\"user\\\"] == transaction_partner.user.to_dict()\\n+            assert tp_dict[\\\"invoice_payload\\\"] == transaction_partner.invoice_payload\\n         if hasattr(transaction_partner, \\\"withdrawal_state\\\"):\\n             assert tp_dict[\\\"withdrawal_state\\\"] == transaction_partner.withdrawal_state.to_dict()\\n \"]", "hints_text": ""}
